<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>OpenVox VoxStack 网关分析 | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/story/openvox-gw-inside /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="OpenVox VoxStack 网关分析 | Wener Live & Life"/><meta data-rh=true name=description content='因为淘到一个二手 OpenVox 语音网关，就好奇"里面"长什么样。'/><meta data-rh=true property=og:description content='因为淘到一个二手 OpenVox 语音网关，就好奇"里面"长什么样。'/><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2021-03-25T00:00:00.000Z /><meta data-rh=true property=article:tag content=嵌入式,系统,VoIP /><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/story/openvox-gw-inside /><link data-rh=true rel=alternate href=https://wener.me/story/openvox-gw-inside hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/story/openvox-gw-inside hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wener.me/story/openvox-gw-inside","@type":"BlogPosting","author":[],"datePublished":"2021-03-25T00:00:00.000Z","description":"因为淘到一个二手 OpenVox 语音网关，就好奇\"里面\"长什么样。","headline":"OpenVox VoxStack 网关分析","isPartOf":{"@id":"https://wener.me/story","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://wener.me/story/openvox-gw-inside","name":"OpenVox VoxStack 网关分析","url":"https://wener.me/story/openvox-gw-inside"}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.72c320db.js defer></script><script src=/assets/js/main.c07313b6.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a class="navbar__item navbar__link" href=/notes>笔记</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_Ulkt thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_hSNJ margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_KD0z>2025</h3><ul class="sidebarItemList_dElJ clean-list"><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/function-and-interface>工具 - 工 与 具</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/here-my-love-ch2>《我把我的矜持都给了她》：第二章 - 故事的重新开始</a></ul></div><div role=group><h3 class=yearGroupHeading_KD0z>2024</h3><ul class="sidebarItemList_dElJ clean-list"><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/decrypt-classfinal-jar>解密 ClassFinal 加密的 Java Jar 包</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/how-i-note>我记录思考的方式简单总结</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/ml-first-try>第一次尝试机器学习</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_U7V0>OpenVox VoxStack 网关分析</h1><div class="container_cxbP margin-vert--md"><time datetime=2021-03-25T00:00:00.000Z>March 25, 2021</time> · <!-- -->11 min read</div></header><div id=__blog-post-container class=markdown><p>因为淘到一个二手 OpenVox 语音网关，就好奇"里面"长什么样。</p>
<p>Let's find out.</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=vs-agu-e2m0800>VS-AGU-E2M0800<a href=#vs-agu-e2m0800 class=hash-link aria-label="Direct link to VS-AGU-E2M0800" title="Direct link to VS-AGU-E2M0800" translate=no>​</a></h2>
<ul>
<li>VS - VoxStack 系列 - 模块化，热插拔</li>
<li>AGU - Analog Gateway - 模拟网关</li>
<li>软件 1.1.10</li>
<li>硬件 1.0.0</li>
</ul>
<p>一张卡两个模块</p>
<ul>
<li>E2M8HJ9DJ68P - VS 模块
<ul>
<li>M83241G13 - Freescale Semiconductor - NXP
<ul>
<li>Telecom Interface ICs C1K-LS102M 450MHz</li>
<li>IC C1K 450MHZ VOIP 448BGA</li>
</ul>
</li>
</ul>
</li>
<li>FXS-420 v1.2 - FS42HJ1KK4UY5
<ul>
<li>S13215-FM</li>
</ul>
</li>
<li>FXO-400 v1.4 - FXODHJO2XT6L
<ul>
<li>3019-FT 1718FF L0L4</li>
<li>Si3050-FT 1708EM F1Q5</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=web-管理界面>Web 管理界面<a href=#web-管理界面 class=hash-link aria-label="Direct link to Web 管理界面" title="Direct link to Web 管理界面" translate=no>​</a></h2>
<p>界面类似于官方演示 <a href=http://admin:admin@demo.openvox.cn:65327 target=_blank rel="noopener noreferrer">http://admin:admin@demo.openvox.cn:65327</a></p>
<p>通过开启 ssh, 账号名设置为 super 可获取到 root 权限，默认 SSH 端口 12345。</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=硬件>硬件<a href=#硬件 class=hash-link aria-label="Direct link to 硬件" title="Direct link to 硬件" translate=no>​</a></h2>
<blockquote>
<p>未开箱，不一定准确。</p>
</blockquote>

















<table><thead><tr><th>-<th>规格<tbody><tr><td>内存<td>120MB<tr><td>CPU<td>ARMv6-compatible processor rev 5 (v6l)</table>
<p><strong>Comcerto 1000 M83263G</strong></p>
<ul>
<li>ARM1136 - 2 Core, 650MHz</li>
<li>敏迅科技/Mindspeed Technologies 芯片</li>
<li>Mindspeed 主要提供 VoIP 领域解决方案 - DSP, LTE, Transcede</li>
<li>VoIP, Security Engine, PCIe 2, RGMII 2</li>
<li>SDRAM 16/32 bit DDR2-800/667/533</li>
<li>L1 缓存 2x(64K D<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=normal>/</mi><mn>64</mn><mi>K</mi><mi>I</mi></mrow><annotation encoding=application/x-tex>/64K I</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-0.25em></span><span class=mord>/64</span><span class="mord mathnormal" style=margin-right:0.07153em>K</span><span class="mord mathnormal" style=margin-right:0.07847em>I</span></span></span></span>)</li>
<li>VoIP 能力
<ul>
<li>Field hardened voice features</li>
<li>World class acoustic echo cancellation technology</li>
<li>Narrow and wideband codecs</li>
<li>G.711, G.729, G.722, G.723.1, iLBC, T.38, G.729.1, G.722.2, AMR, AMR Wideband</li>
<li>Enhanced echo canceller, CID-I/II, VAD/CNG, AGC</li>
<li>3-Way conferencing</li>
</ul>
</li>
<li>TDM/PCM interface for glue-less VoIP support</li>
<li>2009 年</li>
</ul>
<p><strong>/proc/cpuinfo</strong></p>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">Processor	: ARMv6-compatible processor rev 5 (v6l)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">BogoMIPS	: 648.80</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Features	: swp half thumb fastmult edsp java</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">CPU implementer	: 0x41</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">CPU architecture: 6TEJ</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">CPU variant	: 0x1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">CPU part	: 0xb36</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">CPU revision	: 5</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Hardware	: Comcerto 1000 (EVM)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Revision	: 0000</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Serial		: 0000000000000000</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=系统环境>系统环境<a href=#系统环境 class=hash-link aria-label="Direct link to 系统环境" title="Direct link to 系统环境" translate=no>​</a></h2>
<blockquote>
<p>底层基于 OpenWrt</p>
</blockquote>





























<table><thead><tr><th>-<th>-<tbody><tr><td>uname -a<td>Linux General 2.6.33.5 #4 Tue Aug 29 20:38:01 CST 2017 armv6l unknown<tr><td>Busybox<td>1.4.2<tr><td>Asterisk<td>1.8.20.0 / 1.8.X 发布于 2010-10-21 EOL 2015-10-21<tr><td>dahdi<td>2.6.0<tr><td>dcra<td>0.1.0</table>
<blockquote>
<p>Busybox applet</p>
<p>[, [[, arping, ash, awk, awx, basename, bunzip2, bzcat, cat, chgrp, chmod, chown, chroot, clear, cp, crond, crontab, cut, date, df, dirname, dmesg, du, echo, egrep, env, expr, false, fgrep, find, free, getty, grep, gunzip, gzip, halt, head, hostid, hostname, httpd, id, ifconfig, init, insmod, ipkg, kill, killall, killall5, klogd, length, less, ln, lock, logger, login, logread, ls, lsmod, md5sum, mdev, mesg, mkdir, mkfifo, mknod, mktemp, mount, mv, nc, netmsg, netstat, nice, nslookup, passwd, pidof, ping, ping6, pivot_root, poweroff, printf, ps, pwd, rdate, reboot, renice, reset, rm, rmdir, rmmod, route, sed, seq, sh, sleep, sort, strings, stty, switch_root, sync, sysctl, syslogd, tail, tar, tee, telnet, test, time, top, touch, tr, traceroute, true, tty, udhcpc, umount, uname, uniq, uptime, vconfig, vi, watchdog, wc, wget, which, xargs, yes, zcat</p>
</blockquote>
<p><strong>cmdline</strong></p>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">init=/etc/preinit ubi.mtd=4,2048 ubi.block=0,0 root=/dev/ubiblk0_0 ro rootfstype=squashfs hwaddress=eth0,a0:98:05:0e:04:8e hwaddress=eth2,00:03:7F:0B:00:01 console=ttyS0,115200 mtdparts=comcertonand:256k(uboot),128k(env),128K(param),4M(kernel),20M(root),4M(ekernel),20M(eroot),16M(config),-(system) partno=M83263G fppmode=1</span><br/></span></code></pre></div></div>
<p><strong>内核模块</strong></p>








































<table><thead><tr><th>Module<th>Size<th>Used by<tbody><tr><td>wctdmc1k<td>30096<td>16<tr><td>dcra<td>8524<td>1 wctdmc1k<tr><td>dahdi<td>185948<td>17 wctdmc1k<tr><td>krtpd<td>148520<td>0<tr><td>csmencaps<td>14740<td>2<tr><td>led_key<td>2500<td>4</table>
<ul>
<li>dahdi
<ul>
<li>wctdmc1k - OpenVox 模拟信号处理模块
<ul>
<li>WCTDMC1K 设备驱动 - Mindspeed 开发的芯片驱动</li>
</ul>
</li>
<li>dcra - opvx_dcra - Access Dahdi Channel Registers through procfs</li>
</ul>
</li>
<li>csmencaps - 应该是 FX 处理相关模块</li>
<li>led_key - 应该是驱动面板 led 的</li>
<li>krtpd - Kernel RTP proxy for Asterisk - openvox 开发
<ul>
<li>类似功能开源 <a href=https://github.com/sipwise/rtpengine target=_blank rel="noopener noreferrer">sipwise/rtpengine</a></li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">filename:       /lib/modules/2.6.33.5/dcra.ko</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">license:        GPL v2</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">alias:          opvx_dcra</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">description:    Access Dahdi Channel Registers through procfs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">parmtype:       maxchan:int</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">parmtype:       debug:int</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">depends:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">vermagic:       2.6.33.5 mod_unload ARMv6</span><br/></span></code></pre></div></div>
<p><strong>主要用户进程</strong></p>

























































<table><thead><tr><th>proc<th>desc<tbody><tr><td>/bin/php /my_tools/keeper<td><tr><td>/bin/php /my_tools/logfile_monitor<td><tr><td>/my_tools/checkasteriskstat<td><tr><td>/my_tools/ntpclient<td>时间同步<tr><td>/my_tools/resetkey<td><tr><td>/my_tools/sys_restore<td><tr><td>/my_tools/watchdog<td><tr><td>/usr/sbin/crond<td>定时任务<tr><td>/webservice/service<td><tr><td>asterisk -g<td>asterisk 主进程<tr><td>dropbear -p 12345<td>SSH 守护进程<tr><td>lighttpd -f /etc/lighttpd.conf -m /usr/lib/lighttpd<td>Web 服务</table>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=系统目录>系统目录<a href=#系统目录 class=hash-link aria-label="Direct link to 系统目录" title="Direct link to 系统目录" translate=no>​</a></h3>
<ul>
<li>/www -> /tmp/web/www</li>
<li>/tmp/web/www - cgi-bin css images index.html js lang - 管理应用</li>
<li>/data/
<ul>
<li>info/</li>
<li>log/
<ul>
<li>cdr.db - SQLite 通话记录</li>
<li>sys-log - 系统日志</li>
<li>update.txt - 更新日志</li>
</ul>
</li>
<li>sms/</li>
</ul>
</li>
<li>/my_tools/ - 系统工具</li>
<li>/webservice/service - 服务</li>
<li>/version
<ul>
<li>version - 系统版本</li>
<li>build_time - 构建时间</li>
<li>cfg_ver_list - 配置版本 - 内容 <code>1.1.10</code></li>
<li>def_cfg.tar.gz - asterisk 配置备份</li>
<li>openvpn.sample_configs.tar.gz</li>
<li>sip_bendpoints.sample_configs.tar.gz</li>
</ul>
</li>
</ul>
<p><strong>系统挂载</strong></p>









































<table><thead><tr><th>dev<th>size<th>path<th>fstype<tbody><tr><td>/dev/ubiblk0_0<td>16.1M<td>/<td>rootfs, squashfs<tr><td>none<td>57.5M<td>/tmp<td>tmpfs<tr><td>tmpfs<td>512.0k<td>/dev<td>tmpfs<tr><td>/dev/mtdblock7<td>16.0M<td>/etc/asterisk<td>jffs2<tr><td>/dev/mtdblock8<td>63.5M<td>/data<td>jffs2</table>
<p><strong>mtd 分区</strong></p>





















































































<table><thead><tr><th>mtd<th>fs<th>range<th>name<th>size<th>mount<tbody><tr><td>mtd0<td><td>0x000000000000-0x000000040000<td>uboot<td>256k<td><tr><td>mtd1<td><td>0x000000040000-0x000000060000<td>env<td>128k<td><tr><td>mtd2<td><td>0x000000060000-0x000000080000<td>param<td>128K<td><tr><td>mtd3<td><td>0x000000080000-0x000000480000<td>kernel<td>4M<td><tr><td>mtd4<td>ubi0<td>0x000000480000-0x000001880000<td>root<td>20MB<td>/<tr><td>mtd5<td><td>0x000001880000-0x000001c80000<td>ekernel<td>4M<td><tr><td>mtd6<td><td>0x000001c80000-0x000003080000<td>eroot<td>20M<td><tr><td>mtd7<td>jffs2<td>0x000003080000-0x000004080000<td>config<td>16M<td>/etc/asterisk<tr><td>mtd8<td>jffs2<td>0x000004080000-0x000008000000<td>system<td>63.5MB<td>/data</table>
<p><strong>v1.1.23</strong></p>
<p>版本变化底层系统和软件均无变化，变化的主要是 php 代码和部分配置。</p>













<table><thead><tr><th>-<th>-<tbody><tr><td>uname -a<td>Linux General 2.6.33.5 #23 Mon Oct 14 17:12:50 CST 2019 armv6l unknown</table>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=安装包>安装包<a href=#安装包 class=hash-link aria-label="Direct link to 安装包" title="Direct link to 安装包" translate=no>​</a></h3>
<blockquote>
<p>ipkg list</p>
</blockquote>





























































































































































































<table><thead><tr><th>pkg<th>ver<tbody><tr><td>base-files-comcerto1000<td>14-unknown<tr><td>busybox<td>1.4.2-1<tr><td>cmm<td>7.00-5<tr><td>cyclesoak<td>none-1<tr><td>dropbear<td>0.49-1<tr><td>ethtool<td>3-0<tr><td>hotplug2<td>0.9-1<tr><td>ip<td>2.6.23-1<tr><td>kernel<td>2.6.33.5-comcerto1000-1<tr><td>kmod-csme<td>2.6.33.5+2.14.0-comcerto1000-1<tr><td>kmod-fci<td>2.6.33.5+7.00-comcerto1000-1<tr><td>kmod-fpp-csme<td>2.6.33.5+2.14.0-comcerto1000-1<tr><td>kmod-fpp-driver<td>2.6.33.5-comcerto1000-1<tr><td>kmod-ipt-conntrack<td>2.6.33.5-comcerto1000-1<tr><td>kmod-ipt-core<td>2.6.33.5-comcerto1000-1<tr><td>kmod-matisse<td>1.00-0<tr><td>kmod-nf-conntrack-netlink<td>2.6.33.5-comcerto1000-1<tr><td>kmod-nfnetlink<td>2.6.33.5-comcerto1000-1<tr><td>ldd<td>14<tr><td>libc<td>2.7-14<tr><td>libcli<td>1.9.3-1<tr><td>libgcc<td>4.1.2-14<tr><td>libgdbm<td>1.8.3-0<tr><td>libgmp<td>4.2.1-1<tr><td>libiptc<td>1.4.7-1<tr><td>libncurses<td>5.2-8<tr><td>libnfconntrack<td>0.0.100<tr><td>libnfnetlink<td>1.0.0<tr><td>libopenssl<td>0.9.8q-1<tr><td>libpcap<td>1.1.1-2<tr><td>libpopt<td>1.7-4<tr><td>libpthread<td>2.7-14<tr><td>librt<td>2.7-14<tr><td>libstdcpp<td>4.1.2-14<tr><td>libxtables<td>1.4.7-1<tr><td>msp-firmware<td>2.6.33.5+3.00.11-comcerto1000-1<tr><td>mtd<td>5<tr><td>ntpclient<td>2003_194-2<tr><td>openssl-util<td>0.9.8q-1<tr><td>ppp<td>2.4.3-7<tr><td>ppp-mod-pppoe<td>2.4.3-7<tr><td>rp-pppoe-client<td>3.8-1<tr><td>udevtrigger<td>106-1<tr><td>vapi<td>2.14.0<tr><td>zlib<td>1.2.3-3</table>
<p><strong>/etc/ipkg.conf</strong></p>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">/etc/ipkg.conf</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">src snapshots http://openwrt.org/downloads/snapshots/$S/packages</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">dest root /</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">dest ram /tmp</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=系统工具my_tools>系统工具/my_tools<a href=#系统工具my_tools class=hash-link aria-label="Direct link to 系统工具/my_tools" title="Direct link to 系统工具/my_tools" translate=no>​</a></h3>













































































































































































































<table><thead><tr><th>name<th>type<th>desc<tbody><tr><td>add_syslog<td>shell<td>log 到 syslog<tr><td>addkey_client.sh<td>shell<td><tr><td>addkey_server.sh<td>shell<td><tr><td>astmanproxy<td><td>Asterisk Manager Proxy<tr><td>checkAsteriskProc.sh<td>shell<td>检测并启动 dahdi 和 asterisk<tr><td>checkCapture.sh<td>shell<td>dahdi 停止 dump 给定 chanid<tr><td>checkStartFinish.sh<td>shell<td>sleep 1000s 重启<tr><td>checkasteriskstat<td><td><tr><td>cluster_mode<td>php<td>配置集群模式 - master, slave, standalone<tr><td>cluster_slave<td><td>slave 应用<tr><td>cpuusage<td><td>CPU 使用情况 - 类似 vmstat<tr><td>eth_server.conf<td><td><tr><td>fetch<td><td>解密固件<tr><td>get_backport<td><td><tr><td>gwping<td><td>eth ping 客户端<tr><td>gwpingd<td><td>eth_server - eth_server.conf 为配置文件<tr><td>if_monitor<td><td><tr><td>keeper<td><td>保持进程存在 - 类似 supervisor<tr><td>krtpd_cli<td><td><tr><td>led_key.ko<td>内核模块<td><tr><td>logfile_monitor<td>php<td>日志监控<tr><td>lstast<td><td><tr><td>net_tool<td><td>获取网卡信息<tr><td>ntpclient<td><td>NTP 客户端<tr><td>play_all_led<td><td>所有 LED 亮<tr><td>process_cdr<td><td>CDR 处理<tr><td>readDeviceID<td><td><tr><td>resetkey<td><td><tr><td>restore_cfg_file<td><td>恢复 asterisk 配置文件<tr><td>safe_append_to_file<td><td><tr><td>safe_reboot<td>shell<td>reboot<tr><td>set_busytone.sh<td>shell<td>fxomon.conf busytone 设置<tr><td>set_config<td><td>配置文件操作<tr><td>set_default<td><td><tr><td>set_registers.sh<td>shell<td>注册 dcra<tr><td>sys_restore<td><td><tr><td>unpack.sh<td>shell<td>用于解压固件 - unzip, md5 checmsum, 解密, unzip<tr><td>watchdog<td><td><tr><td>web_language_init<td>php<td>初始化 web 的语言</table>
<ul>
<li>astmanproxy
<ul>
<li><a href=https://github.com/davetroy/astmanproxy target=_blank rel="noopener noreferrer">davetroy/astmanproxy</a></li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 固件解密 - 类似 fetch</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">openssl enc -aes-256-cbc -d -in firmware.img -pass pass:O7r8yGv0cdlNM4lQ -out firmware.tar.gz</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 获取配置</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">/my_tools/set_config /etc/asterisk/gw/web_server.conf get option_value general port 2</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=固件>固件<a href=#固件 class=hash-link aria-label="Direct link to 固件" title="Direct link to 固件" translate=no>​</a></h2>
<p>官网提供固件下载 <a href=https://www.openvox.cn/pub/firmwares target=_blank rel="noopener noreferrer">https://www.openvox.cn/pub/firmwares</a> , Web 界面支持上传或在线更新。</p>
<p>固件更新上传逻辑位于 /www/cgi-bin/php/system-tools.php 。
固件准备好后通过 /my_tools/unpack.sh 解压升级。</p>
<p><strong>固件格式</strong></p>
<ul>
<li>AnalogGateway-current.bin -> tar.gz
<ul>
<li>firmware/AnalogGateway-1.1.20.img.md5</li>
<li>firmware/AnalogGateway-1.1.20.img - openssl enc'd data with salted password</li>
</ul>
</li>
<li>AnalogGateway-1.1.20.img - 解密 -> tar.gz
<ul>
<li>AnalogGateway.img - 应该为系统镜像</li>
<li>key - AnalogGateway.img 的 md5 checksum</li>
<li>u-boot.bin - bootloader</li>
<li>upgrade.sh - 升级脚本</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 下载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">curl -O https://www.openvox.cn/pub/firmwares/Analog%20Gateway/AnalogGateway-current.bin</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 固件为 tar.gz</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">tar zxvf AnalogGateway-current.bin</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cd firmware</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 固件经过 openssl 加密 - 解密后为 tar.tz</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">openssl enc -aes-256-cbc -d -in AnalogGateway-*.img -pass pass:O7r8yGv0cdlNM4lQ -out AnalogGateway.tar.gz</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 解压获取实际内容</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkdir firmware</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">tar zxvf AnalogGateway.tar.gz -C firmware</span><br/></span></code></pre></div></div>
<p><strong>固件升级</strong></p>
<p>固件升级使用 openvox 内置的自定义工具 /usr/bin/auto_update，主要涉及操作 mtd。</p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># -i 1 - 使用 ubiblk</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto_update -i 1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -b 升级 ubook</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto_update -b u-boot.bin</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -f 更新文件， -u 升级系统</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto_update -u -f AnalogGateway.img</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=集群模式>集群模式<a href=#集群模式 class=hash-link aria-label="Direct link to 集群模式" title="Direct link to 集群模式" translate=no>​</a></h2>
<p>运行模式通过 /my_tools/cluster_mode 配置。</p>
<p><strong>slave extension</strong></p>
<div class="language-ini codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-ini codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_general.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_endpoints.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_slave.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_macro.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_slave.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_dialmatchingrules.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ext = slave_password+index</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token section punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token section section-name selector" style="color:rgb(199, 146, 234)">fxs-&lt;ext>-&lt;master_ip></span><span class="token section punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> #00,1,playback(Ext_number)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> #00,n,agi(getsipbinding.sh)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> #00,n,Wait(1)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> #00,n,Hangup()</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> s,1,Dial(SIP/$sip_extension-$slave_masterip)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> s,n,Hangup()</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> *1*2*3*4,1,agi(factoryreset.sh)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> *1*2*3*4,n,Hangup()</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> **,1,playback(IP_address)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> **,n,agi(geteth0ip.sh)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token section punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token section section-name selector" style="color:rgb(199, 146, 234)">sip-$sip_extension</span><span class="token section punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> _X.,1,GotoIf($["${SIP_HEADER(X-Best-Codec)}" = ""]?dial)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> _X.,n,Set(SIP_CODEC=${SIP_HEADER(X-Best-Codec)})</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> _X.,n(dial),Dial(dahdi/${i}r1/${EXTEN},$DIALTIMEOUT)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">exten</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">> _X.,n,Hangup()</span><br/></span></code></pre></div></div>
<p><strong>master extension</strong></p>
<div class="language-ini codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-ini codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_general.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_endpoints.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include sip_master.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_macro.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_fxs.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_master.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_internal.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_routing.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">;#include extensions_sipdef.conf</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include extensions_dialmatchingrules.conf</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=vs_usb-400>VS_USB-400<a href=#vs_usb-400 class=hash-link aria-label="Direct link to VS_USB-400" title="Direct link to VS_USB-400" translate=no>​</a></h2>
<ul>
<li>无线网关</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=系统环境-1>系统环境<a href=#系统环境-1 class=hash-link aria-label="Direct link to 系统环境" title="Direct link to 系统环境" translate=no>​</a></h3>
<ul>
<li>软件版本 2.1.22</li>
<li>硬件版本 1.0</li>
<li>一个主控，多个模块，模块不带 CPU</li>
<li>无线模块为 高通 Gobi 无线宽带芯片技术 - GobiNet - USB 驱动</li>
<li>通道 STM32, 底板 MCU STM8</li>
<li>该版本包含 frpc - 允许 openvox cloud 建立链接 - 映射了 ssh 和 web</li>
</ul>
<blockquote>
<p>该版本最大的区别是模块不在是独立系统。</p>
</blockquote>





















<table><thead><tr><th>HW<th>Desc<tbody><tr><td>CPU<td>Intel(R) Atom(TM) CPU Z3735G @ 1.33GHz<tr><td>Memory<td>1 G<tr><td>Disk<td>16 G Flash</table>





























<table><thead><tr><th>SW<th>Desc<tbody><tr><td>Debian<td>8<tr><td>uname -a<td>Linux Wireless-Gateway 4.19.81 #7 SMP Thu Feb 13 08:24:02 CST 2020 i686 i386<tr><td>Busybox<td>v1.22.1<tr><td>Asterisk<td>1.8.20.0<tr><td>/proc/cmdline<td>BOOT_IMAGE=/vmlinuz ro root=LABEL=kernel1 intel_pstate=disable quiet console=ttyS0,115200n8</table>
<p><strong>/proc/mtrr</strong></p>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">reg00: base=0x0ffd00000 ( 4093MB), size=    4MB, count=1: write-protect</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">reg01: base=0x000000000 (    0MB), size= 1024MB, count=1: write-back</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">reg02: base=0x03e000000 (  992MB), size=   32MB, count=1: uncachable</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">reg03: base=0x03d000000 (  976MB), size=   16MB, count=1: uncachable</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">reg04: base=0x03ce00000 (  974MB), size=    2MB, count=1: uncachable</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">reg05: base=0x03c800000 (  968MB), size=    4MB, count=1: uncachable</span><br/></span></code></pre></div></div>
<p><strong>/proc/mounts</strong></p>



































<table><thead><tr><th>dev<th>size<th>path<th>fs<tbody><tr><td>/dev/mmcblk0p6<td>487.9M<td>/etc/cfg<td>ext4<tr><td>/dev/mmcblk0p7<td>487.9M<td>/data<td>ext4<tr><td>/dev/mmcblk0p2<td>92.8M<td>/boot<td>ext4<tr><td>/dev/mmcblk0p4<td>28.9M<td>/gateway<td>squashfs</table>
<p><strong>modules</strong></p>
<ul>
<li>GobiNet - 驱动无线模块</li>
<li>usb_wwan</li>
<li>cdc_acm</li>
<li>ch341</li>
<li>usbserial - 依赖 USB 串口</li>
<li>cdc_ether</li>
<li>usbnet</li>
<li>r8152</li>
<li>snd_pcm</li>
<li>snd_timer</li>
<li>i2c_hid</li>
<li>i2c_algo_bit</li>
<li>soundcore</li>
<li>sdhci_acpi</li>
<li>button</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=系统目录-1>系统目录<a href=#系统目录-1 class=hash-link aria-label="Direct link to 系统目录" title="Direct link to 系统目录" translate=no>​</a></h3>
<ul>
<li>/my_tools -> /gateway/my_tools</li>
<li>/sound -> /gateway/sound</li>
<li>/webservice -> /gateway/webservice</li>
<li>/version -> /gateway/version</li>
<li>/www -> /gateway/www</li>
<li>/conf</li>
<li>/data
<ul>
<li>log/
<ul>
<li>cdr.db</li>
<li>smsinbox.db</li>
<li>smsoutbox.db</li>
</ul>
</li>
</ul>
</li>
<li>/etc
<ul>
<li>cfg/ - Asteris 配置 - 独立挂载 - 可备份
<ul>
<li>gw/ - 网关配置
<ul>
<li>n2n/ - 2 层 Mesh 组网</li>
<li>sim840w.conf - SIM 模块配置 - AT 命令之类</li>
<li>sim6320.conf - SIM 模块配置</li>
<li>uc15.conf - SIM 模块配置 - UC15</li>
<li>sms.conf - 短信配置</li>
</ul>
</li>
<li>cloud/ - 应该是 openvox 云平台之类的 - <a href=https://cloud.openvox.com.cn/ target=_blank rel="noopener noreferrer">https://cloud.openvox.com.cn/</a>
<ul>
<li>cloud.conf</li>
<li>frpc.ini - openvox 访问 ssh 和 web 的后门</li>
</ul>
</li>
</ul>
</li>
<li>udev/rules.d/
<ul>
<li>gobinet.rules - GobiNet 映射 - <code>/sys/class/net/gobinet*</code></li>
<li>internet.rules - 模块内部 usbnet 映射 - 会 symlink 到 <code>/dev/opvx/</code></li>
</ul>
</li>
</ul>
</li>
<li>/tmp
<ul>
<li>hw_info.cfg - 硬件配置 - 由于生成 asterisk gw_gsm.conf 和 extra-channels.conf 配置</li>
</ul>
</li>
<li>/usr/sbin/cloudMain</li>
<li>/usr/sbin/cloudExternal</li>
<li>/usr/sbin/cloudNat</li>
<li>/gateway - 完整网关系统 - 独立挂载
<ul>
<li>www/ - PHP 网站</li>
<li>my_tools/ - 工具集</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=asterisk>Asterisk<a href=#asterisk class=hash-link aria-label="Direct link to Asterisk" title="Direct link to Asterisk" translate=no>​</a></h2>
<blockquote>
<p>不管什么版本的网关，Asterisk 的版本似乎都没有变过 - 1.8.20.0</p>
</blockquote>













<table><thead><tr><th>mod<th>desc<tbody><tr><td>chan_extra<td>GSM/CDMA Telephony Driver FOR Asterisk</table>
<ul>
<li>chan_extra
<ul>
<li>OpenVox 开发的无线模块 - GSM, CDMA 和新的 LTE 均使用该模块</li>
<li>opvxg4xx 驱动提供支持</li>
<li>配置文件 extra-channels.conf, chan_extra.conf</li>
<li>GSM, CDMA 基于 DAHDi</li>
<li>4G LTE 基于 GobiNet 内核驱动</li>
<li>驱动下载 <a href=https://www.openvox.cn/pub/misc/GSM/ target=_blank rel="noopener noreferrer">https://www.openvox.cn/pub/misc/GSM/</a></li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe opvxg4xx</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># Asterisk 命令</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">gsm show spans</span><br/></span></code></pre></div></div></div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_noif padding--none margin-left--sm"><li class=tag_mzC7><a rel=tag class="tag_xI_x tagRegular_Q4uH" href=/story/tags/嵌入式>嵌入式</a><li class=tag_mzC7><a rel=tag class="tag_xI_x tagRegular_Q4uH" href=/story/tags/系统>系统</a><li class=tag_mzC7><a rel=tag class="tag_xI_x tagRegular_Q4uH" href=/story/tags/vo-ip>VoIP</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/story/../story/2021/2021-03-25-openvox-gw-inside.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/story/agi-vs-ami-vs-ari><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>如何选择 Asterisk 接口</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/story/fix-init-script><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>记录一次修复 init 脚本的经历</div></a></nav></main><div class="col col--2"><div class="tableOfContents_wpyd thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#vs-agu-e2m0800 class="table-of-contents__link toc-highlight">VS-AGU-E2M0800</a><li><a href=#web-管理界面 class="table-of-contents__link toc-highlight">Web 管理界面</a><li><a href=#硬件 class="table-of-contents__link toc-highlight">硬件</a><li><a href=#系统环境 class="table-of-contents__link toc-highlight">系统环境</a><ul><li><a href=#系统目录 class="table-of-contents__link toc-highlight">系统目录</a><li><a href=#安装包 class="table-of-contents__link toc-highlight">安装包</a><li><a href=#系统工具my_tools class="table-of-contents__link toc-highlight">系统工具/my_tools</a></ul><li><a href=#固件 class="table-of-contents__link toc-highlight">固件</a><li><a href=#集群模式 class="table-of-contents__link toc-highlight">集群模式</a><li><a href=#vs_usb-400 class="table-of-contents__link toc-highlight">VS_USB-400</a><ul><li><a href=#系统环境-1 class="table-of-contents__link toc-highlight">系统环境</a><li><a href=#系统目录-1 class="table-of-contents__link toc-highlight">系统目录</a></ul><li><a href=#asterisk class="table-of-contents__link toc-highlight">Asterisk</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2025 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2025-10-09 13:46</div></div></div></footer></div></body>