<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>工单系统设计实现 | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/story/issues-system-design /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="工单系统设计实现 | Wener Live & Life"/><meta data-rh=true name=description content="工单/Issues 系统都不会陌生，Github、Gitlab、Gitea 中每天都在接触的系统。想要学习如何设计实现最简单的是直接从别人的系统逻辑参考理解。"/><meta data-rh=true property=og:description content="工单/Issues 系统都不会陌生，Github、Gitlab、Gitea 中每天都在接触的系统。想要学习如何设计实现最简单的是直接从别人的系统逻辑参考理解。"/><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2020-12-27T00:00:00.000Z /><meta data-rh=true property=article:tag content=架构 /><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/story/issues-system-design /><link data-rh=true rel=alternate href=https://wener.me/story/issues-system-design hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/story/issues-system-design hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wener.me/story/issues-system-design","@type":"BlogPosting","author":[],"datePublished":"2020-12-27T00:00:00.000Z","description":"工单/Issues 系统都不会陌生，Github、Gitlab、Gitea 中每天都在接触的系统。想要学习如何设计实现最简单的是直接从别人的系统逻辑参考理解。","headline":"工单系统设计实现","isPartOf":{"@id":"https://wener.me/story","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://wener.me/story/issues-system-design","name":"工单系统设计实现","url":"https://wener.me/story/issues-system-design"}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.72c320db.js defer></script><script src=/assets/js/main.c07313b6.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a class="navbar__item navbar__link" href=/notes>笔记</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_Ulkt thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_hSNJ margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_KD0z>2025</h3><ul class="sidebarItemList_dElJ clean-list"><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/function-and-interface>工具 - 工 与 具</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/here-my-love-ch2>《我把我的矜持都给了她》：第二章 - 故事的重新开始</a></ul></div><div role=group><h3 class=yearGroupHeading_KD0z>2024</h3><ul class="sidebarItemList_dElJ clean-list"><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/decrypt-classfinal-jar>解密 ClassFinal 加密的 Java Jar 包</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/how-i-note>我记录思考的方式简单总结</a><li class=sidebarItem_vrPW><a class=sidebarItemLink_w3wN href=/story/ml-first-try>第一次尝试机器学习</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_U7V0>工单系统设计实现</h1><div class="container_cxbP margin-vert--md"><time datetime=2020-12-27T00:00:00.000Z>December 27, 2020</time> · <!-- -->8 min read</div></header><div id=__blog-post-container class=markdown><p>工单/Issues 系统都不会陌生，Github、Gitlab、Gitea 中每天都在接触的系统。想要学习如何设计实现最简单的是直接从别人的系统逻辑参考理解。</p>
<p>我理解的工单系统</p>
<ul>
<li>元数据丰富</li>
<li>分类标签体系</li>
<li>基于时间线呈现活动</li>
<li>可扩展性强</li>
<li>能封装出上层管理体系
<ul>
<li>看板</li>
<li>里程碑</li>
<li>日历</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=gitea>Gitea<a href=#gitea class=hash-link aria-label="Direct link to Gitea" title="Direct link to Gitea" translate=no>​</a></h2>
<ul>
<li>Issues 特性
<ul>
<li>上下文切换 - 组织、当前用户</li>
<li>模板</li>
<li>里程碑</li>
<li>标签</li>
<li>指派</li>
<li>时间跟踪</li>
<li>回应 - 表情</li>
<li>过滤
<ul>
<li>Open</li>
<li>Closed</li>
<li>你的仓库</li>
<li>被指派工单</li>
<li>你创建的工单</li>
<li>仓库</li>
</ul>
</li>
<li>排序： 最老的、最近更新、评论数量</li>
<li>搜索、评论、附件</li>
</ul>
</li>
<li>数据模型位于 <a href=https://github.com/go-gitea/gitea/tree/master/models target=_blank rel="noopener noreferrer">models</a>
<ul>
<li>13 个关于用户的模型文件</li>
<li>23 个关于仓库的模型文件</li>
<li><strong>28</strong> 个关于工单的模型文件 - 是系统中最多的模块</li>
</ul>
</li>
<li>评论作为活动/指令，Issues 基于时间关联评论修改操作</li>
</ul>
<p>核心 Issue 模型</p>
<div class="language-go codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-go codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Issue represents an issue or pull request of repository.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>type</span><span class="token plain"> Issue </span><span class="token keyword" style=font-style:italic>struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ID               </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"pk autoincr"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RepoID           </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX UNIQUE(repo_index)"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Repo             </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Repository </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Index            </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"UNIQUE(repo_index)"`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Index in one repository.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	PosterID         </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Poster           </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OriginalAuthor   </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OriginalAuthorID </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"index"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Title            </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"name"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Content          </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"TEXT"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RenderedContent  </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Labels           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Label   </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	MilestoneID      </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Milestone        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Milestone </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Project          </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Project   </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Priority         </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	AssigneeID       </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Assignee         </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User        </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IsClosed         </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">         </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IsRead           </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">         </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IsPull           </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">         </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Indicates whether is a pull request or not.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	PullRequest      </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">PullRequest </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	NumComments      </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Ref              </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	DeadlineUnix timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CreatedUnix timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX created"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	UpdatedUnix timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX updated"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ClosedUnix  timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Attachments      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Attachment </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Comments         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Comment    </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Reactions        ReactionList  </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	TotalTrackedTime </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">         </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Assignees        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// IsLocked limits commenting abilities to users on an issue</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// with write access</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IsLocked </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"NOT NULL DEFAULT false"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// For view issue page.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ShowTag CommentTag </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br/></span></code></pre></div></div>
<p>关联内容</p>
<ul>
<li>上下文关联: Repo, Project</li>
<li>元信息关联: Poster, OriginalAuthor, PullRequest</li>
<li>分类关联: Labels, Milestone</li>
<li>指派关联: Assignee, Assignees</li>
<li>内容关联: Attachments, Comments, Reactions</li>
</ul>
<p>评论核心模型</p>
<div class="language-go codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-go codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Comment represents a comment in commit and issue page.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>type</span><span class="token plain"> Comment </span><span class="token keyword" style=font-style:italic>struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ID               </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"pk autoincr"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Type             CommentType </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	PosterID         </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Poster           </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OriginalAuthor   </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OriginalAuthorID </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IssueID          </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Issue            </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Issue </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	LabelID          </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Label            </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Label   </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	AddedLabels      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Label </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RemovedLabels    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Label </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldProjectID     </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ProjectID        </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldProject       </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Project </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Project          </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Project </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldMilestoneID   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	MilestoneID      </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldMilestone     </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Milestone </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Milestone        </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Milestone </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	AssigneeID       </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RemovedAssignee  </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Assignee         </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	AssigneeTeamID   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"NOT NULL DEFAULT 0"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	AssigneeTeam     </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Team </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ResolveDoerID    </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ResolveDoer      </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">User </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldTitle         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	NewTitle         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldRef           </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	NewRef           </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	DependentIssueID </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	DependentIssue   </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Issue </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommitID        </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Line            </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// - previous line / + proposed line</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	TreePath        </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Content         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"TEXT"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RenderedContent </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Path represents the 4 lines of code cemented by this comment</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Patch       </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	PatchQuoted </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"TEXT patch"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CreatedUnix timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX created"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	UpdatedUnix timeutil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeStamp </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"INDEX updated"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Reference issue in commit message</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommitSHA </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"VARCHAR(40)"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Attachments </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Attachment </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Reactions   ReactionList  </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// For view issue page.</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ShowTag CommentTag </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Review      </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Review </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	ReviewID    </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">   </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"index"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Invalidated </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Reference an issue or pull from another comment, issue or PR</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// All information is about the origin of the reference</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefRepoID    </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">                 </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"index"`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Repo where the referencing</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefIssueID   </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">                 </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"index"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefCommentID </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">                 </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"index"`</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 0 if origin is Issue title or content (or PR's)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefAction    references</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">XRefAction </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"SMALLINT"`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// What hapens if RefIssueID resolves</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefIsPull    </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefRepo    </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Repository </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefIssue   </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Issue      </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	RefComment </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Comment    </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	Commits     </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">List </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	OldCommit   </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	NewCommit   </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommitsNum  </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	IsForcePush </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">`xorm:"-"`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br/></span></code></pre></div></div>
<p>因为评论同时表示了 Issue 的评论和 Commit 评论，因此包含了很多提交相关的信息。评论有相当多的类型</p>
<div class="language-go codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-go codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 普通评论 - 可关联到提交和行</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeComment CommentType </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">iota</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeReopen</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeClose</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeIssueRef         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 工单引用</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeCommitRef        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 提交引用</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeCommentRef       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 评论引用</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypePullRef          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// PR 引用</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeLabel            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 标签修改</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeMilestone        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 里程碑修改</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeAssignees        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 指派人修改</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeChangeTitle      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 标题修改</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeDeleteBranch     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 删除分支</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeStartTracking    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 开始时间跟踪</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeStopTracking     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 结束时间跟踪</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeAddTimeManual    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 手动添加时间跟踪信息</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeCancelTracking   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 取消时间跟踪</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeAddedDeadline    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 添加截止日期</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeModifiedDeadline </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 修改截止日期</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeRemovedDeadline  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 删除截止日期</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeAddDependency    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 添加依赖</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeRemoveDependency </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 删除依赖</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeCode             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 评论代码行</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeReview           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// PR 评论反馈</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeLock             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 锁定工单为协作者</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeUnlock           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 解锁工单</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeChangeTargetBranch </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 修改 PR 目标分支</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeDeleteTimeManual </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 删除时间跟踪</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeReviewRequest    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 添加或删除审核请求</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeMergePull        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 合并 PR</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypePullPush         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 推送到 PR head 分支</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeProject          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 修改项目</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	CommentTypeProjectBoard     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 修改项目面板</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<p>评论类型非常详细，因为 Issues 是基于时间线的事件，评论等同于注释，每个注释都是一个命令，使用命令的方式才能实现时间线变化。</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=gitlab>Gitlab<a href=#gitlab class=hash-link aria-label="Direct link to Gitlab" title="Direct link to Gitlab" translate=no>​</a></h2>
<p>Gitlab 相比 Gitea 的 Issues 功能更加强大</p>
<p><strong>Issues <a href=https://docs.gitlab.com/ee/user/project/issues/ target=_blank rel="noopener noreferrer">功能特性</a></strong></p>
<ul>
<li>内容: 标题, 描述, 任务</li>
<li>人员: 作者, 指派人</li>
<li>状态: 打开/关闭, 健康状态, 可信度, 任务完成度</li>
<li>计划和跟踪: 里程碑, 截止日期，权重，时间跟踪，标签，投票，表情，工单关联，Epic 关联，唯一的编号和地址</li>
<li>其他相关功能
<ul>
<li>看板</li>
<li>Epic</li>
<li>服务台/Service Deck</li>
<li>外部集成</li>
<li>带范围支持层级的 Label</li>
<li>用户 Todo List</li>
<li>燃尽图</li>
<li>分组管理 - 组级别可统计和管理组内项目</li>
<li>迭代</li>
<li>设计管理</li>
<li>价值流</li>
<li>洞察</li>
</ul>
</li>
</ul>
<p>Issues 对于 Gitlab 来说不只是工单管理，在最基础的功能上实现了更多管理和分析相关的功能，作为有一定规模的团队，这些附加的功能都是很有必要的。</p>
<p>核心 <a href=https://github.com/gitlabhq/gitlabhq/blob/2eaa60e4555bb11ad5c0af905217f0fa61cf7cc9/db/structure.sql#L13105 target=_blank rel="noopener noreferrer">issues</a>  表</p>
<ul>
<li>API <a href=https://docs.gitlab.com/ee/api/api_resources.html target=_blank rel="noopener noreferrer">Reference</a></li>
<li>GraphQL <a href=https://gitlab.com/-/graphql-explorer target=_blank rel="noopener noreferrer">explorer</a></li>
</ul>
<div class="language-sql codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-sql codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issues </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    title </span><span class="token keyword" style=font-style:italic>character</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>varying</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    author_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    project_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 项目管理</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> without </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    updated_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> without </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    description </span><span class="token keyword" style=font-style:italic>text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    milestone_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 里程碑</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    iid </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 项目内 ID</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    updated_by_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    weight </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    confidential </span><span class="token keyword" style=font-style:italic>boolean</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 隐秘</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    due_date </span><span class="token keyword" style=font-style:italic>date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 截止日期</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    moved_to_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 迁移</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    lock_version </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    title_html </span><span class="token keyword" style=font-style:italic>text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    description_html </span><span class="token keyword" style=font-style:italic>text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    time_estimate </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 时间预估</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    relative_position </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    service_desk_reply_to </span><span class="token keyword" style=font-style:italic>character</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>varying</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    cached_markdown_version </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    last_edited_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> without </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    last_edited_by_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    discussion_locked </span><span class="token keyword" style=font-style:italic>boolean</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    closed_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    closed_by_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    state_id </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 状态</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    duplicated_to_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 重复标志</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    promoted_to_epic_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">              </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- epic</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    health_status </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 健康状态</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    external_key </span><span class="token keyword" style=font-style:italic>character</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>varying</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">255</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 外部关联</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    sprint_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sprint 关联</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_type </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 类型</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    blocking_issues_count </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>CONSTRAINT</span><span class="token plain"> check_fba63f706d </span><span class="token keyword" style=font-style:italic>CHECK</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lock_version </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 提及的用户</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issue_user_mentions </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    note_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    mentioned_users_ids </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    mentioned_projects_ids </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    mentioned_groups_ids </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 指派关系</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issue_assignees </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 邮件 - service desk</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issue_email_participants </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    updated_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    email </span><span class="token keyword" style=font-style:italic>text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- slas</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issuable_slas </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    due_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 严重程度</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> issuable_severities </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    severity </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- epic</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> epic_issues </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    epic_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    relative_position </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br/></span></code></pre></div></div>
<p>Gitlab 不是通过注释来关联活动，而是通过 events 进行关联。例如</p>
<div class="language-sql codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-sql codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 迭代事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> resource_iteration_events </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    merge_request_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    iteration_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>action</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 标签事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> resource_label_events </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>action</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    merge_request_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    epic_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    label_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    cached_markdown_version </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    reference </span><span class="token keyword" style=font-style:italic>text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    reference_html </span><span class="token keyword" style=font-style:italic>text</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 里程碑事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> resource_milestone_events </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    merge_request_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    milestone_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>action</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    state </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 状态事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> resource_state_events </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    merge_request_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    state </span><span class="token keyword" style=font-style:italic>smallint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    epic_id </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    source_commit </span><span class="token keyword" style=font-style:italic>text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    close_after_error_tracking_resolve </span><span class="token keyword" style=font-style:italic>boolean</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    close_auto_resolve_prometheus_alert </span><span class="token keyword" style=font-style:italic>boolean</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    source_merge_request_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>CONSTRAINT</span><span class="token plain"> check_f0bcfaa3a2 </span><span class="token keyword" style=font-style:italic>CHECK</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">char_length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">source_commit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">40</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token keyword" style=font-style:italic>CONSTRAINT</span><span class="token plain"> state_events_must_belong_to_issue_or_merge_request_or_epic </span><span class="token keyword" style=font-style:italic>CHECK</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">issue_id </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;></span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">::</span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">merge_request_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">epic_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">issue_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">merge_request_id </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;></span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">::</span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">epic_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">issue_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">merge_request_id </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">epic_id </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;></span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">::</span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- 权重事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>CREATE</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>TABLE</span><span class="token plain"> resource_weight_events </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    user_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    issue_id </span><span class="token keyword" style=font-style:italic>bigint</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    weight </span><span class="token keyword" style=font-style:italic>integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    created_at </span><span class="token keyword" style=font-style:italic>timestamp</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>with</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>time</span><span class="token plain"> zone </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br/></span></code></pre></div></div>
<p>使用事件的模式则都是反向关联，扩展性相对通过 Type+条件字段 更好，模块之间影响也会更小。但需要查询所有的事件则会麻烦一点。</p>
<p>Gitlab 的 Issues 页面是在服务端生成的，且生成的内容会缓存，Markdown 生成的 HTML 会直接写入表中，某种程度上减少了需要客户端拉取所有事件的复杂度。</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=总结>总结<a href=#总结 class=hash-link aria-label="Direct link to 总结" title="Direct link to 总结" translate=no>​</a></h2>
<p>虽然只看了 Gitea 和 Gitlab 的实现，但也足够有参考意义，如果要实现简单的工单系统，可能会选择第一种，但要实现复杂的逻辑则考虑选择第二种方式。</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_noif padding--none margin-left--sm"><li class=tag_mzC7><a rel=tag class="tag_xI_x tagRegular_Q4uH" href=/story/tags/架构>架构</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/story/../story/2020/2020-12-27-issues-system-design.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/story/understand-baby-vision><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>理解孩子的视力</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/story/crm-basic-leads-opportunities-accounts-contacts><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>CRM 基础 - 线索、商机、账户、联系人</div></a></nav></main><div class="col col--2"><div class="tableOfContents_wpyd thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#gitea class="table-of-contents__link toc-highlight">Gitea</a><li><a href=#gitlab class="table-of-contents__link toc-highlight">Gitlab</a><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2025 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2025-10-09 13:46</div></div></div></footer></div></body>