"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["89941"],{65630:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>c,toc:()=>a,default:()=>u,metadata:()=>t,assets:()=>l,contentTitle:()=>o});var t=JSON.parse('{"id":"service/storage/s3/versitygw","title":"versitygw","description":"- versity/versitygw","source":"@site/../notes/service/storage/s3/versitygw.md","sourceDirName":"service/storage/s3","slug":"/service/storage/s3/versitygw","permalink":"/notes/service/storage/s3/versitygw","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/s3/versitygw.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1759894156000,"frontMatter":{"title":"versitygw"},"sidebar":"docs","previous":{"title":"s3fs","permalink":"/notes/service/storage/s3/s3fs"},"next":{"title":"Samba","permalink":"/notes/service/storage/samba"}}'),r=s(86106),i=s(17776);let c={title:"versitygw"},o="versitygw",l={},a=[{value:"api error XAdminMethodNotSupported: The method is not supported in single root user mode.",id:"api-error-xadminmethodnotsupported-the-method-is-not-supported-in-single-root-user-mode",level:2},{value:"Public Read",id:"public-read",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"versitygw",children:"versitygw"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/versity/versitygw",children:"versity/versitygw"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Apache-2.0, Go"}),"\n",(0,r.jsx)(n.li,{children:"S3 Gateway"}),"\n",(0,r.jsx)(n.li,{children:"Local -> S3"}),"\n",(0,r.jsx)(n.li,{children:"S3 -> S3"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Backend\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["posix\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["metadata\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"xattrs"}),"\n",(0,r.jsx)(n.li,{children:"--sidecar/VGW_META_SIDECAR - \u5B58\u50A8\u5230\u4E00\u4E2A\u989D\u5916\u76EE\u5F55"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<bucket>/.sgwtmp/multipart/<obj-hash>/<uploadid>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<bucket>/.sgwtmp/multipart/<obj-hash>/<uploadid>/<part>.<random>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<bucket>/.sgwtmp/<obj-hash>.<random>"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"ScoutFS"}),"\n",(0,r.jsx)(n.li,{children:"S3"}),"\n",(0,r.jsx)(n.li,{children:"Azure"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["IAM\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5185\u7F6E IAM\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"--iam-dir, \u5B58\u50A8\u7528\u6237\u5230 users.json"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"S3 - \u4F7F\u7528\u5916\u90E8 S3 \u5B58\u50A8\u7528\u6237\u4FE1\u606F"}),"\n",(0,r.jsx)(n.li,{children:"Vault - \u4F7F\u7528 vault kv-v2 \u5B58\u50A8\u7528\u6237\u4FE1\u606F"}),"\n",(0,r.jsx)(n.li,{children:"LDAP"}),"\n",(0,r.jsx)(n.li,{children:"FreeIPA"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  -e ROOT_ACCESS_KEY=KEY \\\n  -e ROOT_SECRET_KEY=SECRET \\\n  -v ./versitygw/data:/data \\\n  -v ./versitygw/meta:/meta \\\n  -p 7070:7070 \\\n  --name versitygw versity/versitygw posix /data --sidecar /meta/metadata --versioning-dir /meta/versioning --bucketlinks\n\ndocker exec -it versitygw sh\n\nROOT_ACCESS_KEY=myaccess ROOT_SECRET_KEY=mysecret ./versitygw --cert $PWD/cert.pem --key $PWD/cert.key posix /tmp/gw\n\nexport ADMIN_REGION=cn-sh-1\nexport ADMIN_ACCESS_KEY_ID=$ROOT_ACCESS_KEY\nexport ADMIN_SECRET_ACCESS_KEY=$ROOT_SECRET_KEY\nexport ADMIN_ENDPOINT_URL=http://localhost:7070\nexport ADMIN_ALLOW_INSECURE=true\n\n/app/versitygw admin list-buckets\n# \u591A\u7528\u6237\u6A21\u5F0F\n/app/versitygw admin list-users\n\n\n# xattr\napk add attr\n# user.policy={}\ngetfattr -d ./buckets/contents/\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"VGW_BACKEND=posix\nVGW_BACKEND_ARG=<gateway_root_path>\nROOT_ACCESS_KEY_ID=<access_key>\nROOT_SECRET_ACCESS_KEY=<secret_key>\n"})}),"\n",(0,r.jsx)(n.p,{children:"IAM users.json"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "accessAccounts": {\n    "admin": {\n      "access": "KEY_ID",\n      "secret": "ACCESS_KEY",\n      "role": "admin",\n      "userID": 0,\n      "groupID": 0\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h2,{id:"api-error-xadminmethodnotsupported-the-method-is-not-supported-in-single-root-user-mode",children:"api error XAdminMethodNotSupported: The method is not supported in single root user mode."}),"\n",(0,r.jsx)(n.h2,{id:"public-read",children:"Public Read"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# 1. \u914D\u7F6E AWS CLI\naws configure set aws_access_key_id your-root-access-key\naws configure set aws_secret_access_key your-root-secret-key\naws configure set default.region us-east-1\naws configure set default.s3.signature_version s3v4\n\n# 2. \u8BBE\u7F6E endpoint\nexport AWS_ENDPOINT_URL=http://your-versitygw-host:port\n\n# 3. \u521B\u5EFA bucket policy \u6587\u4EF6\ncat > public-read-policy.json << EOF\n{\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": "*",\n      "Action": "s3:GetObject",\n      "Resource": "arn:aws:s3:::your-bucket-name/*"\n    }\n  ]\n}\nEOF\n\n# 4. \u5E94\u7528 bucket policy\naws s3api put-bucket-policy --bucket your-bucket-name --policy file://public-read-policy.json --endpoint-url $AWS_ENDPOINT_URL\n\n# 5. \u6216\u8005\u8BBE\u7F6E ACL\naws s3api put-bucket-acl --bucket your-bucket-name --acl public-read --endpoint-url $AWS_ENDPOINT_URL\n'})})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},17776:function(e,n,s){s.d(n,{R:()=>c,x:()=>o});var t=s(7378);let r={},i=t.createContext(r);function c(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);