"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["24547"],{35947:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>p,metadata:()=>t,assets:()=>h,contentTitle:()=>o});var t=JSON.parse('{"id":"os/linux/sys/hugetlbpage","title":"hugetlbpage","description":"- Translation Lookaside Buffer, TLB","source":"@site/../notes/os/linux/sys/hugetlbpage.md","sourceDirName":"os/linux/sys","slug":"/os/linux/sys/hugetlbpage","permalink":"/notes/os/linux/sys/hugetlbpage","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/sys/hugetlbpage.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1757294976000,"frontMatter":{"title":"hugetlbpage"},"sidebar":"docs","previous":{"title":"dtb","permalink":"/notes/os/linux/sys/dtb"},"next":{"title":"IOPS","permalink":"/notes/os/linux/sys/iops"}}'),l=s(86106),i=s(17776);let r={title:"hugetlbpage"},o="hugetlbpage",h={},a=[];function c(e){let n={a:"a",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"hugetlbpage",children:"hugetlbpage"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Translation Lookaside Buffer, TLB"}),"\n",(0,l.jsx)(n.li,{children:"2MB,1GB"}),"\n",(0,l.jsx)(n.li,{children:"\u51CF\u5C11 TLB \u538B\u529B"}),"\n",(0,l.jsx)(n.li,{children:"\u63D0\u5347\u6027\u80FD"}),"\n",(0,l.jsx)(n.li,{children:"\u9501\u5B9A\u5185\u5B58 - \u4E0D\u53EF\u4EA4\u6362"}),"\n",(0,l.jsx)(n.li,{children:"/proc/sys/vm/nr_hugepages"}),"\n",(0,l.jsxs)(n.li,{children:["hugepages=N\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9884\u7559\u591A\u5C11\u9875"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"CONFIG_HUGETLBFS"}),"\n",(0,l.jsx)(n.li,{children:"CONFIG_HUGETLB_PAGE"}),"\n",(0,l.jsx)(n.li,{children:"mmap MAP_HUGETLB"}),"\n",(0,l.jsx)(n.li,{children:"hugetlbfs"}),"\n",(0,l.jsx)(n.li,{children:"/proc/meminfo \u67E5\u770B\u4F7F\u7528\u60C5\u51B5"}),"\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://wiki.debian.org/Hugepages",children:"https://wiki.debian.org/Hugepages"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.ibm.com/support/knowledgecenter/zh/linuxonibm/liabp/liabptunconfighp.htm",children:"https://www.ibm.com/support/knowledgecenter/zh/linuxonibm/liabp/liabptunconfighp.htm"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://access.redhat.com/solutions/36741",children:"https://access.redhat.com/solutions/36741"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.kernel.org/admin-guide/mm/hugetlbpage.html",children:"https://docs.kernel.org/admin-guide/mm/hugetlbpage.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://web.archive.org/web/20190129035458/https://www.peuss.de/node/67",children:"https://web.archive.org/web/20190129035458/https://www.peuss.de/node/67"})}),"\n",(0,l.jsx)(n.li,{children:"Java -XX:+UseLargePages"}),"\n",(0,l.jsx)(n.li,{children:"Qemu -mem-prealloc -mem-path /dev/hugepages/qemu/windows"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u9700\u8981\u7684\u9875\u5927\u5C0F 2G\nHUGE_SIZE_MB=2048\n# \u901A\u8FC7\u67E5\u770B /proc/meminfo \u6587\u4EF6\u4E2D\u7684 Hugepagesize \u6761\u76EE\u6765\u8BC6\u522B\u8D85\u5927\u9875\u9762\u7684\u5927\u5C0F\u3002 \u4F8B\u5982\uFF1A\nHUGE_PAGE_SIZE_KB=$(grep Hugepagesize /proc/meminfo | awk '{print $2}')\nHUGE_PAGE_SIZE_MB=$((HUGE_PAGE_SIZE_KB / 1024))\n# \u8BA1\u7B97\u9700\u8981\u7684\u8D85\u5927\u9875\u9762\u6570\nHUGE_PAGES_NEEDED=$(((HUGE_SIZE_MB + HUGE_PAGE_SIZE_MB - 1) / HUGE_PAGE_SIZE_MB))\n# \u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u60A8\u7528\u9700\u8981\u7684\u8D85\u5927\u9875\u9762\u5185\u5B58\u91CF\u9664\u4EE5\u8D85\u5927\u9875\u9762\u7684\u5927\u5C0F\u3002\n# \u901A\u8FC7\u5C06\u8D85\u5927\u9875\u9762\u6570\u5199\u5165 /proc/sys/vm/nr_hugepages \u6587\u4EF6\u6765\u5206\u914D\u4F5C\u4E3A\u8D85\u5927\u9875\u9762\u7684\u5185\u5B58\u3002 \u4F8B\u5982\uFF1A\necho $HUGE_PAGES_NEEDED > /proc/sys/vm/nr_hugepages\nHUGE_PAGES_ALLOCATED=$(cat /proc/sys/vm/nr_hugepages)\n# \u901A\u8FC7\u5C06\u8D85\u5927\u9875\u9762\u5185\u5B58\u7684\u5927\u5C0F\uFF08\u4EE5\u5B57\u8282\u8BA1\uFF09\u5199\u5165 /proc/sys/kernel/shmmax \u6587\u4EF6\u6765\u8BBE\u7F6E\u5171\u4EAB\u5185\u5B58\u7684\u4EFB\u4F55\u72EC\u7ACB\u90E8\u5206\u7684\u6700\u5927\u5927\u5C0F\uFF1A \u4F8B\u5982\uFF1A\nSHMMAX_NEEDED=$((HUGE_PAGES_ALLOCATED * HUGE_PAGE_SIZE_KB * 1024))\necho $SHMMAX_NEEDED > /proc/sys/kernel/shmmax\n# \u8BBE\u7F6E\u8981\u5206\u914D\u7684\u603B\u5171\u4EAB\u5185\u5B58\u91CF\uFF1A\n# \u901A\u8FC7\u4F7F\u7528 getconf \u547D\u4EE4\u6765\u8BC6\u522B\u9875\u9762\uFF08\u800C\u4E0D\u662F\u8D85\u5927\u9875\u9762\uFF09\u7684\u5927\u5C0F\u3002 \u4F8B\u5982\uFF1A\nPAGE_SIZE=$(getconf PAGE_SIZE)\n# \u5C06\u8D85\u5927\u9875\u9762\u5185\u5B58\u7684\u9875\u9762\u6570\uFF08\u800C\u4E0D\u662F\u8D85\u5927\u9875\u9762\u6570\uFF09\u5199\u5165 /proc/sys/kernel/shmall \u6587\u4EF6\u3002 \u4F8B\u5982\uFF1A\nSHMALL_NEEDED=$((SHMMAX_NEEDED / PAGE_SIZE))\necho $SHMALL_NEEDED > /proc/sys/kernel/shmall\n\n# \u6302\u8F7D\u540E\u5373\u53EF\u5F00\u59CB\u4F7F\u7528\nmkdir -p /dev/hugepages\nmount -t hugetlbfs hugetlbfs /dev/hugepages\n# fstab\n# hugetlbfs    /dev/hugepages    hugetlbfs    defaults    0 0\n\n# \u67E5\u770B\ncat /proc/meminfo | grep Huge\n"})})]})}function p(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},17776:function(e,n,s){s.d(n,{R:()=>r,x:()=>o});var t=s(7378);let l={},i=t.createContext(l);function r(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);