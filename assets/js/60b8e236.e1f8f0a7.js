"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["97518"],{49211:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>i,toc:()=>a,default:()=>p,metadata:()=>t,assets:()=>l,contentTitle:()=>c});var t=JSON.parse('{"id":"service/api/grpc/grpc-go","title":"gRPC Go","description":"- A new Go API for Protocol Buffers","source":"@site/../notes/service/api/grpc/grpc-go.md","sourceDirName":"service/api/grpc","slug":"/service/api/grpc/go","permalink":"/notes/service/api/grpc/go","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/api/grpc/grpc-go.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1677222278000,"frontMatter":{"title":"gRPC Go"},"sidebar":"docs","previous":{"title":"grpc-gateway","permalink":"/notes/service/api/grpc/gateway"},"next":{"title":"grpc-node","permalink":"/notes/service/api/grpc/node"}}'),o=r(86106),s=r(17776);let i={title:"gRPC Go"},c="gRPC Go",l={},a=[{value:"\u5B9E\u73B0",id:"\u5B9E\u73B0",level:2},{value:"encoding",id:"encoding",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"grpc-go",children:"gRPC Go"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://go.dev/blog/protobuf-apiv2",children:"A new Go API for Protocol Buffers"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2020-03-02"}),"\n",(0,o.jsx)(n.li,{children:"\u57FA\u4E8E reflect"}),"\n",(0,o.jsx)(n.li,{children:"APIv2 google.golang.org/protobuf"}),"\n",(0,o.jsxs)(n.li,{children:["APIv1 github.com/golang/protobuf\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"1.4 \u57FA\u4E8E APIv2 \u5B9E\u73B0"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/planetscale/vtprotobuf",children:"planetscale/vtprotobuf"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u57FA\u4E8E gogo"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://vitess.io/blog/2021-06-03-a-new-protobuf-generator-for-go/",children:"A new Protocol Buffers generator for Go"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/srikrsna/protoc-gen-gotag",children:"srikrsna/protoc-gen-gotag"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/golang/protobuf/issues/52",children:"golang/protobuf#52"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u4E0D\u652F\u6301 struct tag"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/favadi/protoc-go-inject-tag",children:"favadi/protoc-go-inject-tag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/protocolbuffers/protobuf-go",children:"protocolbuffers/protobuf-go"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# debug\nexport GRPC_GO_LOG_VERBOSITY_LEVEL=99\nexport GRPC_GO_LOG_SEVERITY_LEVEL=info\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5B9E\u73B0",children:"\u5B9E\u73B0"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["method - ",(0,o.jsx)(n.code,{children:'"/<service>/<method>"'})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"type ClientConn interface {\n  // \u8BF7\u6C42\n	Invoke(ctx context.Context, method string, args interface{}, reply interface{}, opts ...CallOption) error\n	NewStream(ctx context.Context, desc *StreamDesc, method string, opts ...CallOption) (ClientStream, error)\n}\n\n// \u751F\u6210\u7684 Stream \u63A5\u53E3 - BiStream - Send+Recv\n// <Service>_<Method>Client for Stream\ntype Service_MethodClient interface {\n  // \u6839\u636E Stream \u751F\u6210\u7684 \u8F93\u5165\u8F93\u51FA\n  // ClientStream.SendMsg(m)\n	Send(*ServerReflectionRequest) error\n  // ClientStream.RecvMsg(m)\n	Recv() (*ServerReflectionResponse, error)\n	grpc.ClientStream\n}\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// grpc.Server \u66B4\u9732\u7684\u670D\u52A1\u4FE1\u606F\ntype ServiceInfo struct {\n	Methods []MethodInfo\n	// ServiceDesc\n	Metadata interface{}\n}\ntype MethodInfo struct {\n	Name string\n	IsClientStream bool\n	IsServerStream bool\n}\n\n// \u751F\u6210\u7684 Desc \u4FE1\u606F\n\ntype MethodDesc struct {\n	MethodName string\n	Handler    methodHandler\n}\ntype ServiceDesc struct {\n	ServiceName string\n  // \u6307\u5411 service \u63A5\u53E3\u5B9E\u73B0 - \u68C0\u6D4B\u63A5\u53E3\u662F\u5426\u5339\u914D\n	HandlerType interface{}\n	Methods     []MethodDesc\n	Streams     []StreamDesc\n	Metadata    interface{}\n}\n\ntype StreamHandler func(srv interface{}, stream ServerStream) error\ntype StreamDesc struct {\n	// \u6CE8\u518C\u65F6\u4F7F\u7528  \u540C Method \u540D\u5B57\n	StreamName string\n	Handler    StreamHandler\n\n	// \u7528\u4E8E NewClientStream,ClientConn.NewStream\n	ServerStreams bool\n	ClientStreams bool\n}\n\n// \u62E6\u622A\u5904\u7406\ntype UnaryClientInterceptor func(ctx context.Context, method string, req, reply interface{}, cc *ClientConn, invoker UnaryInvoker, opts ...CallOption) error\n\n// \u5355\u6B21\u8BF7\u6C42\u4F7F\u7528 clientStream \u903B\u8F91\u5B9E\u73B0\nvar unaryStreamDesc = &StreamDesc{ServerStreams: false, ClientStreams: false}\nfunc invoke(ctx context.Context, method string, req, reply interface{}, cc *ClientConn, opts ...CallOption) error {\n	cs, err := newClientStream(ctx, unaryStreamDesc, cc, method, opts...)\n	if err != nil {\n		return err\n	}\n	if err := cs.SendMsg(req); err != nil {\n		return err\n	}\n	return cs.RecvMsg(reply)\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"encoding",children:"encoding"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["google.golang.org/grpc/encoding\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["RegisterCompressor\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"gzip"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["RegisterCodec\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["proto\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"github.com/golang/protobuf/proto"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"type Codec interface {\n	Name() string\n	Marshal(v interface{}) ([]byte, error)\n	Unmarshal(data []byte, v interface{}) error\n}\n\ntype Compressor interface {\n	Name() string\n	Compress(w io.Writer) (io.WriteCloser, error)\n	Decompress(r io.Reader) (io.Reader, error)\n  DecompressedSize(compressedBytes []byte) int // \u53EF\u9009\u5B9E\u73B0\n}\n\n// proto\n\n"})})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},17776:function(e,n,r){r.d(n,{R:()=>i,x:()=>c});var t=r(7378);let o={},s=t.createContext(o);function i(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);