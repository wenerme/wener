"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["597111"],{144990:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>r,toc:()=>h,default:()=>o,metadata:()=>l,assets:()=>c,contentTitle:()=>d});var l=JSON.parse('{"id":"service/observability/logging/fluentbit","title":"Fluentbit","description":"- fluentbit","source":"@site/../notes/service/observability/logging/fluentbit.md","sourceDirName":"service/observability/logging","slug":"/service/observability/logging/fluentbit","permalink":"/notes/service/observability/logging/fluentbit","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/observability/logging/fluentbit.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1660892989000,"frontMatter":{"title":"Fluentbit"},"sidebar":"docs","previous":{"title":"Drain3","permalink":"/notes/service/observability/logging/drain3"},"next":{"title":"Logging Awesome","permalink":"/notes/service/observability/logging/awesome"}}'),t=i(486106),s=i(917776);let r={title:"Fluentbit"},d="Fluentbit",c={},h=[{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:2},{value:"Input",id:"input",level:2},{value:"Fliter",id:"fliter",level:2},{value:"Output",id:"output",level:2},{value:"\u63D2\u4EF6",id:"\u63D2\u4EF6",level:2},{value:"Build",id:"build",level:2},{value:"Fluentd vs Fluentbit",id:"fluentd-vs-fluentbit",level:2},{value:"core stack size",id:"core-stack-size",level:2}];function u(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"fluentbit",children:"Fluentbit"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://fluentbit.io/",children:"fluentbit"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit",children:"fluent/fluent-bit"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.fluentbit.io/manual/installation/sources/build-and-install",children:"Build Options"})}),"\n",(0,t.jsxs)(e.li,{children:["\u6570\u636E\u5904\u7406\u6D41\u7A0B\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["input - ",(0,t.jsx)(e.code,{children:"-i, --input"})]}),"\n",(0,t.jsxs)(e.li,{children:["parser - ",(0,t.jsx)(e.code,{children:"-R, --parser"})]}),"\n",(0,t.jsxs)(e.li,{children:["fliter - ",(0,t.jsx)(e.code,{children:"-F, --fliter"})]}),"\n",(0,t.jsxs)(e.li,{children:["buffer\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"-b --storage_path=PATH"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"-f, --flush=SECONDS"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["router\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u5339\u914D\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"-m, --match"})," - \u7B49\u540C\u4E8E ",(0,t.jsx)(e.code,{children:"-p match=abc"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"-t, --tag"})," - \u8BBE\u7F6E tag\uFF0C\u7B49\u540C\u4E8E ",(0,t.jsx)(e.code,{children:"-p tag=abc"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:'-p, --prop="A=B"'})," - \u8BBE\u7F6E\u63D2\u4EF6\u5C5E\u6027"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"output - \u591A\u4E2A"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.admonition,{type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit/issues/2464",children:"fluent/fluent-bit#464"})," \u5B98\u65B9\u4E0D\u652F\u6301 musl\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Go \u5728 musl \u4E0B\u4E0D\u652F\u6301\u63D2\u4EF6"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# macOS\nbrew install fluent-bit\n# AlpineLinux\napk add fluent-bit -X https://mirrors.aliyun.com/alpine/edge/testing/\n\n# \u8BFB\u53D6 kernel \u6D88\u606F\uFF0C\u8F93\u51FA\u5230 stdout\nfluent-bit -i kmsg -t kernel -o stdout -m '*'\n# Windows Event Log \u8F93\u51FA\u5230 stdout\nfluent-bit -i winlog -p 'channels=Setup,Windows PowerShell' -o stdout\n\n# \u76D1\u542C MQTT - 0.0.0.0:1883\nfluent-bit -i mqtt -t data -o stdout -m '*'\n# \u53D1\u9001 MQTT\nmosquitto_pub  -m '{\"key1\": 123, \"key2\": 456}' -t some/topic\n# Listen=0.0.0.0\n# macOS /usr/local/opt/fluent-bit/etc/fluent-bit/parsers.conf\n# alpinelinux\nfluent-bit -R /usr/local/opt/fluent-bit/etc/fluent-bit/parsers.conf -i syslog -p path=/tmp/flb_syslog -o stdout\nlogger -u /tmp/flb_syslog my_ident my_message\n\n# syslog\n# rfc3164 - \u5E9F\u5F03\u7684 BSD syslog \u534F\u8BAE\n# rfc5424 - \u65B0\u7684\u683C\u5F0F\nfluent-bit -R /etc/fluent-bit/parsers.conf \\\n  -i syslog -p mode=tcp -p listen=0.0.0.0 -p port=5140 -o stdout\n# \u65E5\u5FD7\nlogger -T -n 127.0.0.1 -P 5140 wener\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.fluentbit.io/manual/administration/configuring-fluent-bit",children:"Configuring Fluent Bit"})}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# \u5F15\u5165\u6587\u4EF6\n@INCLUDE somefile.conf\n@INCLUDE input_*.conf\n\n[SERVICE]\n    # \u4E00\u4E2A\u6BB5\u843D\u7F29\u8FDB 4 \u4E2A\u7A7A\u683C\n    # \u53EF\u4EE5\u5B58\u5728\u76F8\u540C\u540D\u5B57 key\n\n    # seconds.nanoseconds\n    Flush     5\n    Daemon    off\n    Log_Level debug\n\u200B\n[INPUT]\n    Name  cpu\n    Tag   my_cpu\n\n[FILTER]\n    Name  stdout\n    Match *\u200B\n\n[OUTPUT]\n    Name  stdout\n    Match my*cpu\n\n[OUTPUT]\n    # \u53EF\u4EE5\u4F7F\u7528\u73AF\u5883\u53D8\u91CF\n    Name  ${MY_OUTPUT}\n    Match *\n\n# \u76F4\u63A5\u8BBE\u7F6E\u53D8\u91CF\n@SET KEY=VAL\n\n# \u4E0A\u6E38\u914D\u7F6E\n[UPSTREAM]\n    name       forward-balancing\n\n[NODE]\n    name       node-1\n    host       127.0.0.1\n    port       43000\n\n[NODE]\n    name       node-2\n    host       127.0.0.1\n    port       44000\n\n[NODE]\n    name       node-3\n    host       127.0.0.1\n    port       45000\n    tls        on\n    tls.verify off\n    shared_key secret\n"})}),"\n",(0,t.jsx)(e.h2,{id:"input",children:"Input"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit#input-plugins",children:"Input Plugins"})}),"\n",(0,t.jsx)(e.li,{children:"collectd"}),"\n",(0,t.jsx)(e.li,{children:"dummy - \u968F\u673A\u751F\u6210\u65E5\u5FD7"}),"\n",(0,t.jsx)(e.li,{children:"exec - \u6267\u884C\u5916\u90E8\u547D\u4EE4"}),"\n",(0,t.jsx)(e.li,{children:"forwad"}),"\n",(0,t.jsx)(e.li,{children:"head - \u8BFB\u53D6\u6587\u4EF6\u524D\u9762\u51E0\u884C"}),"\n",(0,t.jsx)(e.li,{children:"health - TCP \u5065\u5EB7\u68C0\u67E5"}),"\n",(0,t.jsx)(e.li,{children:"\u7CFB\u7EDF - cpu\u3001disk\u3001mem\u3001netif\u3001proc\u3001thermal"}),"\n",(0,t.jsx)(e.li,{children:"kmsg - \u5185\u6838\u65E5\u5FD7"}),"\n",(0,t.jsx)(e.li,{children:"mqtt - MQTT \u670D\u52A1"}),"\n",(0,t.jsx)(e.li,{children:"random - \u751F\u6210\u968F\u673A\u6837\u672C"}),"\n",(0,t.jsx)(e.li,{children:"serial - \u4E32\u53E3"}),"\n",(0,t.jsx)(e.li,{children:"stdin"}),"\n",(0,t.jsx)(e.li,{children:"syslog"}),"\n",(0,t.jsx)(e.li,{children:"systemd"}),"\n",(0,t.jsx)(e.li,{children:"tail"}),"\n",(0,t.jsx)(e.li,{children:"tcp"}),"\n",(0,t.jsx)(e.li,{children:"winlog - Windows Event Log"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"fliter",children:"Fliter"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit#filter-plugins",children:"Fliter Plugins"})}),"\n",(0,t.jsx)(e.li,{children:"expect - \u6761\u4EF6\u8FC7\u6EE4"}),"\n",(0,t.jsx)(e.li,{children:"grep"}),"\n",(0,t.jsx)(e.li,{children:"kubernetes - \u6DFB\u52A0\u5143\u4FE1\u606F"}),"\n",(0,t.jsx)(e.li,{children:"lua"}),"\n",(0,t.jsx)(e.li,{children:"parser - \u89E3\u6790\u8BB0\u5F55"}),"\n",(0,t.jsx)(e.li,{children:"record_modifier - \u4FEE\u6539\u8BB0\u5F55"}),"\n",(0,t.jsx)(e.li,{children:"rewrite_tag - \u6807\u7B7E\u91CD\u5199"}),"\n",(0,t.jsx)(e.li,{children:"stdout"}),"\n",(0,t.jsx)(e.li,{children:"throttle"}),"\n",(0,t.jsx)(e.li,{children:"nest - \u5D4C\u5957\u8BB0\u5F55"}),"\n",(0,t.jsx)(e.li,{children:"modify"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"output",children:"Output"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit#output-plugins",children:"Output Plugins"})}),"\n",(0,t.jsx)(e.li,{children:"es - Elasticsearch"}),"\n",(0,t.jsx)(e.li,{children:"file"}),"\n",(0,t.jsx)(e.li,{children:"forward"}),"\n",(0,t.jsx)(e.li,{children:"http"}),"\n",(0,t.jsx)(e.li,{children:"influxdb"}),"\n",(0,t.jsx)(e.li,{children:"kafka"}),"\n",(0,t.jsx)(e.li,{children:"kafka-rest"}),"\n",(0,t.jsx)(e.li,{children:"nats"}),"\n",(0,t.jsx)(e.li,{children:"null"}),"\n",(0,t.jsx)(e.li,{children:"stdout"}),"\n",(0,t.jsx)(e.li,{children:"tcp"}),"\n",(0,t.jsx)(e.li,{children:"postgresql"}),"\n",(0,t.jsx)(e.li,{children:"cockroachdb - v1.6+"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u63D2\u4EF6",children:"\u63D2\u4EF6"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/fluent/fluent-bit-go",children:"fluent/fluent-bit-go"})," - Golang package to build Fluentbit plugins"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"build",children:"Build"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.fluentbit.io/manual/installation/sources/build-and-install",children:"https://docs.fluentbit.io/manual/installation/sources/build-and-install"})}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://github.com/nih-at/libzip/issues/98",children:"nih-at/libzip#98"})," - undefined reference to `fts_read' and 'fts_close'"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'if [ "$CBUILD" != "$CHOST" ]; then\n  CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"\nfi\n\n# default CORE_STACK_SIZE=((3 * PTHREAD_STACK_MIN) / 2)=3072 is invalid\n# based on https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file\n# set default to 24576\ncmake -B build \\\n  -DCMAKE_INSTALL_PREFIX=/usr \\\n  -DCMAKE_INSTALL_LIBDIR=lib \\\n  -DCMAKE_BUILD_TYPE=None \\\n  -DFLB_CORO_STACK_SIZE=24576 \\\n  -DFLB_TESTS_INTERNAL=Yes \\\n  -DFLB_TLS=On \\\n  -DFLB_JEMALLOC=Off \\\n  $CMAKE_CROSSOPTS .\nmake -C build\n'})}),"\n",(0,t.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(e.h2,{id:"fluentd-vs-fluentbit",children:"Fluentd vs Fluentbit"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://fluentbit.io/documentation/0.8/about/fluentd_and_fluentbit.html",children:"https://fluentbit.io/documentation/0.8/about/fluentd_and_fluentbit.html"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"-"}),(0,t.jsx)(e.th,{children:"Fluentd"}),(0,t.jsx)(e.th,{children:"Fluent Bit"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Scope"}),(0,t.jsx)(e.td,{children:"Servers"}),(0,t.jsx)(e.td,{children:"Embedded & IoT devices"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Language"}),(0,t.jsx)(e.td,{children:"C & Ruby"}),(0,t.jsx)(e.td,{children:"C"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Memory"}),(0,t.jsx)(e.td,{children:"~20MB"}),(0,t.jsx)(e.td,{children:"~150KB"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Performance"}),(0,t.jsx)(e.td,{children:"High Performance"}),(0,t.jsx)(e.td,{children:"High Performance"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Dependencies"}),(0,t.jsx)(e.td,{children:"Ruby Gem, need gems."}),(0,t.jsx)(e.td,{children:"no dependencies, unless some special plugin requires them."})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Plugins"}),(0,t.jsx)(e.td,{children:"300+ plugins available"}),(0,t.jsx)(e.td,{children:"~15 plugins available"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"License"}),(0,t.jsx)(e.td,{children:"Apache License v2.0"}),(0,t.jsx)(e.td,{children:"Apache License v2.0"})]})]})]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# fluentd\nresources:\n  requests:\n    cpu: 100m\n    memory: 200Mi\n  limits:\n    memory: 500Mi\n\n# fluentbit\nresources:\n  requests:\n    cpu: 5m\n    memory: 10Mi\n  limits:\n    cpu: 50m\n    memory: 60Mi\n"})}),"\n",(0,t.jsx)(e.h2,{id:"core-stack-size",children:"core stack size"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["PTHREAD_STACK_MIN\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"musl \u4E0B\u4E3A 2048"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"FLB_CORO_STACK_SIZE=((3 * PTHREAD_STACK_MIN) / 2)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"musl \u4E0B\u4E3A 3072 - \u662F\u65E0\u6548\u7684 core stack size"}),"\n",(0,t.jsx)(e.li,{children:"\u53EF\u4EE5\u8003\u8651\u8BBE\u7F6E\u4E3A 24576"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-c",children:"// \u9ED8\u8BA4\n#define FLB_CORO_STACK_SIZE      ((3 * PTHREAD_STACK_MIN) / 2)\n"})})]})}function o(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}},917776:function(n,e,i){i.d(e,{R:()=>r,x:()=>d});var l=i(7378);let t={},s=l.createContext(t);function r(n){let e=l.useContext(s);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),l.createElement(s.Provider,{value:e},n.children)}}}]);