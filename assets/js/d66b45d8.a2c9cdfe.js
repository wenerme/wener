"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["31133"],{71202:function(e,n,o){o.r(n),o.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>m,metadata:()=>l,assets:()=>r,contentTitle:()=>t});var l=JSON.parse('{"id":"languages/go/lib/ko","title":"ko","description":"- google/ko","source":"@site/../notes/languages/go/lib/ko.md","sourceDirName":"languages/go/lib","slug":"/languages/go/lib/ko","permalink":"/notes/languages/go/lib/ko","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/go/lib/ko.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1647984068000,"frontMatter":{"title":"ko"},"sidebar":"docs","previous":{"title":"graphql","permalink":"/notes/languages/go/lib/graphql"},"next":{"title":"kratos","permalink":"/notes/languages/go/lib/kratos"}}'),s=o(86106),i=o(17776);let a={title:"ko"},t="ko",r={},c=[];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ko",children:"ko"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/google/ko",children:"google/ko"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Go source to Kubernetes"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["KO_DOCKER_REPO\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"KO_DOCKER_REPO=ko.local, -L, --local - \u672C\u5730\uFF0C\u4E0D push"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"KO_CONFIG_PATH=.ko.yaml"}),"\n",(0,s.jsx)(n.li,{children:"KIND_CLUSTER_NAME"}),"\n",(0,s.jsx)(n.li,{children:"--platform=linux/amd64,linux/arm64 - \u591A\u5E73\u53F0\u6784\u5EFA"}),"\n",(0,s.jsx)(n.li,{children:"KO_DATA_PATH=kodata - \u9759\u6001\u8D44\u6E90\u8DEF\u5F84"}),"\n",(0,s.jsx)(n.li,{children:"GOFLAGS"}),"\n",(0,s.jsx)(n.li,{children:"\u9ED8\u8BA4\u5305\u542B -trimpath"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E0D\u80FD\u7528 CGO"}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# macOS\nbrew install ko\n# Go install\ngo install github.com/google/ko@latest\n\nko build ./cmd/app\n\nko resolve -f config/ > release.yaml\n# ko resolve -f config/ | kubectl apply -f -\nko apply -f config/\nko delete -f config/\n\nkustomize build config | ko resolve -f -\n\n# bash completion\nko completion\n# go.mod\nko publish -L --bare --platform=linux/amd64 --push=false -t $(git rev-parse HEAD) .\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# \u9ED8\u8BA4\u57FA\u7840\u955C\u50CF\ndefaultBaseImage: gcr.io/distroless/static:nonroot\n\n# \u4FEE\u6539\u57FA\u7840\u955C\u50CF\nbaseImageOverrides:\n  github.com/my-user/my-repo/cmd/app: registry.example.com/base/for/app\n  github.com/my-user/my-repo/cmd/foo: registry.example.com/base/for/foo\n\n# \u81EA\u5B9A\u4E49\u6784\u5EFA\nbuilds:\n  - id: foo\n    main: ./foobar/foo\n    env:\n      - GOPRIVATE=git.internal.example.com,source.developers.google.com\n    flags:\n      - -tags\n      - netgo\n    ldflags:\n      - -s -w\n      - -extldflags "-static"\n      - -X main.version={{.Env.VERSION}}\n  - id: bar\n    main: ./foobar/bar/main.go\n    env:\n      - GOCACHE=/workspace/.gocache\n    ldflags:\n      - -s\n      - -w\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"template \u652F\u6301\u6A21\u677F - \u4F46\u53EA\u652F\u6301 \u73AF\u5883\u53D8\u91CF"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ko build ./cmd/app"})," \u9ED8\u8BA4\u955C\u50CF\u540D\u5B57 ",(0,s.jsx)(n.code,{children:"${KO_DOCKER_REPO}/app-<md5>"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"--base-import-paths,-B - \u5FFD\u7565 md5"}),"\n",(0,s.jsx)(n.li,{children:"--bare - \u53EA\u7528 repo \u90E8\u5206"}),"\n",(0,s.jsx)(n.li,{children:"--preserve-import-path,-P - repo \u540E\u518D\u52A0\u4E0A \u6A21\u5757 \u8DEF\u5F84"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-deployment\nspec:\n  replicas: 3\n  template:\n    spec:\n      containers:\n        - name: my-app\n          # Import Path\n          image: ko://github.com/my-user/my-repo/cmd/app\n"})})]})}function m(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},17776:function(e,n,o){o.d(n,{R:()=>a,x:()=>t});var l=o(7378);let s={},i=l.createContext(s);function a(e){let n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);