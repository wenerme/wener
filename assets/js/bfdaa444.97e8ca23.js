"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["68470"],{69401:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>a,toc:()=>c,default:()=>d,metadata:()=>s,assets:()=>r,contentTitle:()=>o});var s=JSON.parse('{"id":"web/editor/tinacms","title":"TinaCMS","description":"\u5728 Web \u4E0A\u6DFB\u52A0\u5C5E\u6027\u7F16\u8F91\u529F\u80FD\u3002","source":"@site/../notes/web/editor/tinacms.md","sourceDirName":"web/editor","slug":"/web/editor/tinacms","permalink":"/notes/web/editor/tinacms","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/editor/tinacms.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1653992153000,"frontMatter":{"title":"TinaCMS"},"sidebar":"docs","previous":{"title":"synced-store","permalink":"/notes/web/editor/synced-store"},"next":{"title":"tiptap","permalink":"/notes/web/editor/tiptap/"}}'),i=t(86106),l=t(17776);let a={title:"TinaCMS"},o="TinaCMS",r={},c=[{value:"schema",id:"schema",level:2},{value:"next-tinacms-json",id:"next-tinacms-json",level:2}];function m(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"tinacms",children:"TinaCMS"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728 Web \u4E0A\u6DFB\u52A0\u5C5E\u6027\u7F16\u8F91\u529F\u80FD\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/tinacms/tinacms",children:"tinacms/tinacms"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u76EE\u524D\u4E3B\u8981\u96C6\u6210 next \u548C gatsby"}),"\n",(0,i.jsx)(e.li,{children:"\u540E\u7AEF\u4EA4\u4E92\u76EE\u524D\u4EE5 git \u4E3A\u4E3B"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u81EA\u5B9A\u4E49\u540E\u7AEF\u53EF\u53C2\u7167 next \u7684 local json \u65B9\u5F0F"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u867D\u7136\u540D\u5B57\u662F tinacms \u4F46\u66F4\u504F\u5411\u7F16\u8F91\u5668 - Contextual Editing\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6A21\u578B -formify->\u8868\u5355<->API"}),"\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E Git \u7684 CMS - \u4F46\u4E2A\u4EBA\u8BA4\u4E3A\u5176\u7F16\u8F91\u529F\u80FD\u66F4\u6709\u610F\u601D"}),"\n",(0,i.jsx)(e.li,{children:"Git \u540E\u7AEF\u751F\u6210 GraphQL API"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 final-form \u6784\u5EFA form"}),"\n"]})}),"\n",(0,i.jsx)(e.h2,{id:"schema",children:"schema"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Tina Content API"}),"\n",(0,i.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/tinacms/src/index.ts#L47-L50",children:"defineSchema"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/@tinacms/schema-tools/src/types/SchemaTypes.ts",children:"@tinacms/schema-tools/src/types/SchemaTypes.ts"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/blob/37ee94fb30bcbcc38c2ebf84ccbd3eb7e7485016/packages/@tinacms/schema-tools/src/schema/TinaSchema.ts",children:"@tinacms/schema-tools/src/schema/TinaSchema.ts"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:'title=".tina/schema.ts"',children:"import { defineSchema } from 'tinacms';\n\nconst schema = defineSchema({\n  // entity\n  collections: [\n    {\n      label: 'Blog Posts',\n      name: 'post',\n      path: 'content/posts',\n      fields: [\n        {\n          // scalar - string, datetime, boolean, image, number\n          // nonscalar - object, reference, rich-text, image\n          type: 'string',\n\n          // string\n          isBody: false,\n          isTitle: true,\n\n          // datetime\n          dateFormat: '',\n          timeFormat: '',\n\n          // reference\n          reverseLookup: { label: '', name: '' },\n          collections: [],\n\n          // object\n          visualSelector: false,\n          templates: '',\n          fields: [],\n\n          // \u57FA\u7840\u5B57\u6BB5\n          label: 'Title',\n          name: 'title',\n          required: true,\n          description: '',\n          list: false,\n\n          ui: {\n            defaultValue: 'A new title', // \u5B9A\u4E49\u9ED8\u8BA4\u503C\n            component: 'textarea', // \u5B9A\u4E49 UI \u7EC4\u4EF6\n          },\n        },\n        {\n          type: 'string',\n          label: 'Post Body',\n          name: 'body',\n          // markdown body\n          isBody: true,\n        },\n        {\n          label: 'Tags',\n          name: 'tags',\n          type: 'string',\n          // array\n          list: true,\n        },\n        {\n          label: 'Categories',\n          name: 'categories',\n          type: 'string',\n          list: true,\n          // \u9650\u5B9A\u503C\n          options: [\n            {\n              value: 'movies',\n              label: 'Movies',\n            },\n            {\n              value: 'music',\n              label: 'Music',\n            },\n          ],\n        },\n        // \u5D4C\u5957\u5BF9\u8C61\n        {\n          label: 'Testimonial',\n          name: 'testimonial',\n          type: 'object',\n          fields: [\n            {\n              label: 'Quote',\n              name: 'quote',\n              type: 'string',\n              ui: {\n                component: 'textarea',\n              },\n            },\n          ],\n        },\n        {\n          label: 'Author',\n          name: 'author',\n          type: 'reference',\n          collections: ['author'], // \u5F15\u7528\u5DF2\u6709 entity\n        },\n      ],\n    },\n  ],\n});\n\nexport default schema;\n"})}),"\n",(0,i.jsx)(e.h2,{id:"next-tinacms-json",children:"next-tinacms-json"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u57FA\u4E8E \u672C\u5730 JSON \u63D0\u4F9B\u7F16\u8F91\u6570\u636E\uFF0C\u5DF2\u5E9F\u5F03\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tinacms/tinacms/tree/master/packages/next-tinacms-json",children:"next-tinacms-json"})}),"\n",(0,i.jsx)(e.li,{children:"useJsonForm"}),"\n",(0,i.jsx)(e.li,{children:"useLocalJsonForm"}),"\n",(0,i.jsx)(e.li,{children:"useGlobalJsonForm"}),"\n",(0,i.jsx)(e.li,{children:"InlineJsonForm: A render-children component"}),"\n",(0,i.jsx)(e.li,{children:"inlineJsonForm: A higher-order component"}),"\n",(0,i.jsxs)(e.li,{children:["\u5B9E\u73B0\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u83B7\u53D6 json \u6587\u4EF6\u6570\u636E"}),"\n",(0,i.jsxs)(e.li,{children:["next \u5168\u5C40\u521D\u59CB\u5316\u65F6\u5019\u914D\u7F6E json \u6620\u5C04\u5173\u7CFB ",(0,i.jsx)(e.code,{children:"{fileRelativePath:string,data:any}"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u901A\u8FC7 ",(0,i.jsx)(e.code,{children:"useLocalJsonForm"})," \u83B7\u53D6\u6620\u5C04\u7684\u6587\u4EF6\u6570\u636E"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"export function useLocalJsonForm<T = any>(\n  // \u6587\u4EF6\u6620\u5C04\u5B9A\u4E49\n  jsonFile: JsonFile<T>,\n  options?: Options,\n) {\n  const [values, form] = useJsonForm(jsonFile, options);\n\n  usePlugins(form);\n\n  return [values, form];\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"import { useCallback } from 'react';\nimport { useWatchFormValues, useForm, useCMS, FormOptions, Field } from 'tinacms';\nimport { generateFields } from './generate-fields';\n\n/**\n * \u8868\u793A git \u5B58\u50A8\u7684\u6587\u4EF6\n */\nexport interface JsonFile<T = any> {\n  fileRelativePath: string;\n  data: T;\n}\n\nexport interface Options {\n  id?: string;\n  label?: string;\n  fields?: Field[];\n  actions?: FormOptions<any>['actions'];\n}\n/**\n * \u521B\u5EFA\u4E00\u4E2A\u7F16\u8F91 GIT \u91CC JSON \u7684\u8868\u5355\n */\nexport function useJsonForm<T = any>(jsonFile: JsonFile<T>, options: Options = {}) {\n  const cms = useCMS();\n\n  const id = options.id || jsonFile.fileRelativePath;\n  const label = options.label || jsonFile.fileRelativePath;\n  const fields = options.fields || generateFields(jsonFile);\n  const actions = options.actions || [];\n  // \u521B\u5EFA\u8868\u5355\n  const [values, form] = useForm(\n    {\n      id,\n      label,\n      fields,\n      actions,\n      loadInitialValues() {\n        // \u901A\u8FC7 git \u63A5\u53E3\u521D\u59CB\u5316\u6570\u636E\n        return cms.api.git.show(jsonFile.fileRelativePath).then((git: { content: string }) => {\n          const jsonFileInGit = JSON.parse(git.content);\n\n          return jsonFileInGit;\n        });\n      },\n      onSubmit() {\n        // \u901A\u8FC7 git \u63A5\u53E3\u63D0\u4EA4\u6570\u636E - \u7248\u672C\u6982\u5FF5\n        return cms.api.git.commit({\n          files: [jsonFile.fileRelativePath],\n          message: `Commit from Tina: Update ${jsonFile.fileRelativePath}`,\n        });\n      },\n      reset() {\n        // \u91CD\u7F6E\u4FEE\u6539\n        return cms.api.git.reset({ files: [id] });\n      },\n    },\n    //\n    { values: jsonFile.data, label },\n  );\n\n  const writeToDisk = useCallback(\n    (formState) => {\n      // \u53D8\u5316\u4FEE\u6539\u5230\u6587\u4EF6\n      cms.api.git.writeToDisk({\n        fileRelativePath: jsonFile.fileRelativePath,\n        content: JSON.stringify(formState.values, null, 2),\n      });\n    },\n    [jsonFile.fileRelativePath],\n  );\n  // \u76D1\u542C\u8868\u5355\u53D8\u5316\n  useWatchFormValues(form, writeToDisk);\n\n  return [values || jsonFile.data, form];\n}\n"})})]})}function d(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(m,{...n})}):m(n)}},17776:function(n,e,t){t.d(e,{R:()=>a,x:()=>o});var s=t(7378);let i={},l=s.createContext(i);function a(n){let e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);