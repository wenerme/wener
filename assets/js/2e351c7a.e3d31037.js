"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["86881"],{60495:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>i,toc:()=>d,default:()=>h,metadata:()=>s,assets:()=>c,contentTitle:()=>o});var s=JSON.parse('{"id":"db/relational/postgresql/postgresql-constraint","title":"CONSTRAINT","description":"- CHECK","source":"@site/../notes/db/relational/postgresql/postgresql-constraint.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/constraint","permalink":"/notes/db/relational/postgresql/constraint","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-constraint.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1715155165000,"frontMatter":{"title":"CONSTRAINT"},"sidebar":"docs","previous":{"title":"PostgreSQL \u914D\u7F6E","permalink":"/notes/db/relational/postgresql/conf"},"next":{"title":"PostgreSQL Cookbook","permalink":"/notes/db/relational/postgresql/cookbook"}}'),r=t(86106),l=t(17776);let i={title:"CONSTRAINT"},o="CONSTRAINT",c={},d=[];function a(n){let e={a:"a",code:"code",h1:"h1",header:"header",hr:"hr",li:"li",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"constraint",children:"CONSTRAINT"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["CHECK\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u8868\u8FBE\u5F0F\u6821\u9A8C"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"NOT NULL"}),"\n",(0,r.jsxs)(e.li,{children:["UNIQUE\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u9ED8\u8BA4\u547D\u540D\u89C4\u5219  ",(0,r.jsx)(e.code,{children:"<TABLE>_<COLUMN>_key"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"unique(tid,entity_id)"})," -> ",(0,r.jsx)(e.code,{children:"flow_tid_entity_id_key"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["PRIMARY KEY\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u9ED8\u8BA4 INDEX \u547D\u540D\u89C4\u5219  ",(0,r.jsx)(e.code,{children:"<TABLE>_pkey"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["FOREIGN KEY\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u9ED8\u8BA4\u547D\u540D\u89C4\u5219 ",(0,r.jsx)(e.code,{children:"<TABLE>_<COLUMN>_fkey"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["EXCLUDE\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6709\u70B9\u7C7B\u4F3C partial index"}),"\n",(0,r.jsx)(e.li,{children:"\u4F1A\u521B\u5EFA\u5BF9\u5E94\u7D22\u5F15"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["CONSTRAINT\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u53EF\u4EE5 defer"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["UNIQUE & PRIMARY KEY\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u90FD\u4F1A\u521B\u5EFA btree unique index"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"alter table tab add unique (tid,rid,cid);\n\nselect * from information_schema.constraint_column_usage;\n\n-- \u53EA\u652F\u6301 IF EXISTS\nalter table tab drop constraint if exists tab_tid_rid_cid_key ;\n\n-- try cache\nDO $$\nBEGIN\n\n  BEGIN\n    ALTER TABLE foo ADD CONSTRAINT bar ;\n  EXCEPTION\n    WHEN duplicate_table THEN  -- UNIQUE - 9.6.8\n    WHEN duplicate_object THEN -- FOREIGN KEY\n    WHEN invalid_table_definition THEN -- PRIMARY KEY - 11.9\n      RAISE NOTICE 'Table constraint foo.bar already exists';\n  END;\n\nEND $$;\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/ddl-constraints.html",children:"https://www.postgresql.org/docs/current/ddl-constraints.html"})}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://stackoverflow.com/a/6804058/1870054",children:"https://stackoverflow.com/a/6804058/1870054"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"add constraint if not exists"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/errcodes-appendix.html",children:"https://www.postgresql.org/docs/current/errcodes-appendix.html"})}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},17776:function(n,e,t){t.d(e,{R:()=>i,x:()=>o});var s=t(7378);let r={},l=s.createContext(r);function i(n){let e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);