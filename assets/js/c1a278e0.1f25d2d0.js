"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["32917"],{81964:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>c,toc:()=>o,default:()=>t,metadata:()=>r,assets:()=>h,contentTitle:()=>d});var r=JSON.parse('{"id":"devops/web/haproxy/haproxy-version","title":"HAProxy Version","description":"| version       | date       |","source":"@site/../notes/devops/web/haproxy/haproxy-version.md","sourceDirName":"devops/web/haproxy","slug":"/devops/web/haproxy/version","permalink":"/notes/devops/web/haproxy/version","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/web/haproxy/haproxy-version.md","tags":[{"inline":true,"label":"Version","permalink":"/notes/tags/version"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1738747458000,"frontMatter":{"title":"HAProxy Version","tags":["Version"]},"sidebar":"docs","previous":{"title":"HAProxy Tuning","permalink":"/notes/devops/web/haproxy/tuning"},"next":{"title":"Apache HTTPD","permalink":"/notes/devops/web/httpd"}}'),l=s(86106),i=s(17776);let c={title:"HAProxy Version",tags:["Version"]},d="HAProxy Version",h={},o=[{value:"HAProxy 3.1",id:"haproxy-31",level:2},{value:"HAProxy 3.0",id:"haproxy-30",level:2},{value:"HAProxy 2.9",id:"haproxy-29",level:2},{value:"HAProxy 2.8",id:"haproxy-28",level:2},{value:"HAProxy 2.7",id:"haproxy-27",level:2},{value:"HAProxy 2.6",id:"haproxy-26",level:2},{value:"HAProxy 2.5",id:"haproxy-25",level:2},{value:"HAProxy 2.4",id:"haproxy-24",level:2},{value:"HAProxy 2.3",id:"haproxy-23",level:2}];function x(n){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"haproxy-version",children:"HAProxy Version"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"version"}),(0,l.jsx)(e.th,{children:"date"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"[HAProxy 3.1]"}),(0,l.jsx)(e.td,{children:"2024-11-26"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-30",children:"HAProxy 3.0"})}),(0,l.jsx)(e.td,{children:"2024-05-29"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-29",children:"HAProxy 2.9"})}),(0,l.jsx)(e.td,{children:"2023-12-05"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-28",children:"HAProxy 2.8"})}),(0,l.jsx)(e.td,{children:"2023-05-31"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-27",children:"HAProxy 2.7"})}),(0,l.jsx)(e.td,{children:"2022-12-01"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-26",children:"HAProxy 2.6"})}),(0,l.jsx)(e.td,{children:"2022-05-31"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-25",children:"HAProxy 2.5"})}),(0,l.jsx)(e.td,{children:"2021-11-23"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-24",children:"HAProxy 2.4"})}),(0,l.jsx)(e.td,{children:"2021-05-13"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.a,{href:"#haproxy-23",children:"HAProxy 2.3"})}),(0,l.jsx)(e.td,{children:"2020-11-05"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-31",children:"HAProxy 3.1"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65B0\u7684 SPOE"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u5347 H2 \u6027\u80FD"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-3-1",children:"https://www.haproxy.com/blog/announcing-haproxy-3-1"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-30",children:"HAProxy 3.0"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528 guid \u8DDF\u8E2A\u914D\u7F6E\u5BF9\u8C61"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"dump stats-file"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"reload \u540E\u4E0D\u4F1A\u4E22\u5931\u7EDF\u8BA1\u6570\u636E"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u65E5\u5FD7\u652F\u6301 JSON \u548C CBOR \u683C\u5F0F"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-3-0",children:"https://www.haproxy.com/blog/announcing-haproxy-3-0"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-29",children:"HAProxy 2.9"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u4F18\u5316\uFF1A \u5185\u5B58\u4F7F\u7528\u3001\u7EBF\u7A0B\u9501\u3001\u65E5\u5FD7\u9501\u3001\u8FDE\u63A5\u6C60\u3001Maps\u3001\u7F13\u5B58\u9501\u3001QUIC \u5185\u5B58\u3001Stick tables \u9501"}),"\n",(0,l.jsxs)(e.li,{children:["HTTP \u5185\u5B58\u4F7F\u7528\u4F18\u5316\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"zero-copy forwarding"}),"\n",(0,l.jsx)(e.li,{children:"tune.disable-zero-copy-forwarding"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["json_query\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8F6C\u6362 json \u54CD\u5E94\u6570\u636E"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["L7 fetch\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"req.cook_names"}),"\n",(0,l.jsx)(e.li,{children:"res.cook_names"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Load balancing syslog"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"log-forward graylog\n  # Listen on Graylog ports\n  bind :12201\n  dgram-bind :12201\n  log backend@mylog-rrb local0\n\nbackend mylog-rrb\n  mode log\n  balance roundrobin\n\n  server log1 udp@10.0.0.1:514\n  server log2 udp@10.0.0.2:514\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-2-9",children:"https://www.haproxy.com/blog/announcing-haproxy-2-9"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-28",children:"HAProxy 2.8"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["OCSP Stapling\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4EE5\u524D ",(0,l.jsx)(e.code,{children:"set ssl ocsp-response"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u73B0\u5728\u5185\u7F6E\u652F\u6301 ",(0,l.jsx)(e.code,{children:"ocs-update on"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u5168\u5C40\u914D\u7F6E\u53C2\u6570\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tune.ssl.ocsp-update.mindelay"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tune.ssl.ocsp-update.maxdelay"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u65B0 Command\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"update ssl ocsp-response"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"show ssl ocsp-updates"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"HTTP \u538B\u7F29\u540E\u7AEF Request & Response"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"backend webservers\n  balance roundrobin\n  server web1 192.168.56.10:8080 check maxconn 30\n\n  filter compression\n  compression direction both\n  compression offload\n  compression algo-req gzip\n  compression type-req application/json\n  compression algo-res gzip\n  compression type-res text/css text/html text/javascript text/plain\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["HTTP Forwarded Header\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5728 ",(0,l.jsx)(e.code,{children:"option forwarde"})," \u4E4B\u4E0A\u63A7\u5236"]}),"\n",(0,l.jsx)(e.li,{children:"rfc7239_is_valid"}),"\n",(0,l.jsx)(e.li,{children:"rfc7239_field"}),"\n",(0,l.jsx)(e.li,{children:"rfc7239_n2nn"}),"\n",(0,l.jsx)(e.li,{children:"rfc7239_n2np"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"HTTP Actions"}),"\n",(0,l.jsxs)(e.li,{children:["Tuning HTTP/2 Performance\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"tune.h2.be.initial-window-size"}),"\n",(0,l.jsx)(e.li,{children:"tune.h2.be.max-concurrent-streams"}),"\n",(0,l.jsx)(e.li,{children:"tune.h2.fe.initial-window-size"}),"\n",(0,l.jsx)(e.li,{children:"tune.h2.fe.max-concurrent-streams"}),"\n",(0,l.jsx)(e.li,{children:"tune.h2.initial-window-size"}),"\n",(0,l.jsx)(e.li,{children:"tune.h2.max-concurrent-streams"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Defaults for Listener Sharding\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"tune.listener.default-shards"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Default ALPN Values\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u9ED8\u8BA4 ",(0,l.jsx)(e.code,{children:"h2,http/1.1"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u914D\u7F6E\u4E86 QUIC \u4F1A\u589E\u52A0 ",(0,l.jsx)(e.code,{children:"h3"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Fetch Method\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"bc_rtt, bc_rttver"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u96C6\u6210 acme.sh\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"add the deploy script for acme.sh in admin directory"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u76F4\u63A5\u9881\u53D1\u8BC1\u4E66"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Signing Algorithms for TLS\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"ssl-default-bind-client-sigalgs"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"ssl-default-bind-sigalgs"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u4F7F\u7528 WolfSSL \u7F16\u8BD1"}),"\n",(0,l.jsxs)(e.li,{children:["Lua\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"mailers - \u4E4B\u524D\u4E3A C \u73B0\u5728\u4E3A Lua \u6A21\u5757"}),"\n",(0,l.jsxs)(e.li,{children:["New Event Framework in Lua\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"core.event_sub()"}),", ",(0,l.jsx)(e.code,{children:"Server.event_sub()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Queues in Lua - ",(0,l.jsx)(e.code,{children:"core.queue()"})]}),"\n",(0,l.jsx)(e.li,{children:"Lua Functions for Server Information"}),"\n",(0,l.jsx)(e.li,{children:"Timeout for Lua execution"}),"\n",(0,l.jsxs)(e.li,{children:["Disable the Default Resolvers Section for the HTTP Client\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["global ",(0,l.jsx)(e.code,{children:"httpclient.resolvers.disabled on"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"global\n  lua-load /etc/haproxy/mailers.lua\n\ndefaults\n  email-alert mailers smtp_servers\n  email-alert from haproxy@example.com\n  email-alert to helpdesk@example.com\n  email-alert level info\n\nmailers smtp_servers\n  mailer mailserver1 mailserver1.example.com:25\n"})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/rnwood/smtp4dev",children:"https://github.com/rnwood/smtp4dev"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Email \u6D4B\u8BD5\u670D\u52A1"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-2-8",children:"https://www.haproxy.com/blog/announcing-haproxy-2-8"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-27",children:"HAProxy 2.7"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Traffic shaping\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4E0B\u8F7D\u901F\u5EA6\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"filter bwlim-out"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"http-response set-bandwidth-limit"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4E0A\u4F20\u901F\u5EA6\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"filter bwlim-in"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"http-request set-bandwidth-limit"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"thread-group"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4E4B\u524D\u6700\u591A 64 \u4E2A\u7EBF\u7A0B - ",(0,l.jsx)(e.code,{children:"thread-group 1 threads 64"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u73B0\u5728\u53EF\u4EE5 64*64=4096 \u4E2A\u7EBF\u7A0B - ",(0,l.jsx)(e.code,{children:"thread-group 64 threads 64"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"QUICv2"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'echo "reload" | sudo socat -t300 /run/haproxy-master.sock -\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"show startup-logs"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-26",children:"HAProxy 2.6"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"HTTP/3 over QUIC"}),"\n",(0,l.jsxs)(e.li,{children:["Generic hash load balancing algorithm\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"balance hash pathq"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301 OpenSSL 3.0"}),"\n",(0,l.jsxs)(e.li,{children:["Master CLI\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"HAProxy worker processes"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"socat /run/haproxy-master.sock -"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"http-request set-var"}),", ",(0,l.jsx)(e.code,{children:"tcp-request content set-var"})," \u652F\u6301 \u9009\u9879\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ifexists, ifnotexists, ifempty, ifnotempty, ifset, ifnotset, ifgt, iflt"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u663E\u793A\u6240\u6709\u914D\u7F6E\nhaproxy -dKhelp -q -c -f /dev/null\n# \u67D0\u4E2A\u4E3B\u9898\u4E0B\u7684\u914D\u7F6E\u9879\nhaproxy -dKacl -q -c -f /dev/null\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-haproxy",children:"frontend mysite\n  # enables HTTP/3 over QUIC\n  bind quic4@:443 ssl crt /etc/haproxy/certs/foo.com/cert.pem alpn h3\n  # \u652F\u6301 stateless reset packets https://tools.ietf.org/id/draft-ietf-quic-transport-29.html#name-stateless-reset\n  #cluster-secret\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Reload"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-haproxy",children:"global\n  stats socket /var/run/haproxy/api.sock mode 660 level admin expose-fd listeners\n"})}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-25",children:"HAProxy 2.5"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"QUIC, HTTP/3 - \u5B9E\u9A8C\u652F\u6301"}),"\n",(0,l.jsxs)(e.li,{children:["\u5B8C\u6574\u52A8\u6001\u670D\u52A1\u652F\u6301\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"2.4 \u52A8\u6001\u670D\u52A1\u4E0D\u652F\u6301 check, track, slowstart, error-limit, ssl, observe"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u5728 defaults \u914D\u7F6E tcp-request \u548C http-request \u89C4\u5219"}),"\n",(0,l.jsxs)(e.li,{children:["Lua\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65B0\u589E httpclient - \u53EF\u53D1\u8D77\u8BF7\u6C42"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-2-5/",children:"Announcing HAProxy 2.5"})}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u7279\u6027\u68C0\u67E5\nhaproxy -cc 'feature(PROMEX)' || echo not supported\n\n# runtime api shell\nsocat stdio tcp4-connect:127.0.0.1:9999\n\nexperimental-mode on\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-haproxy",children:"global\n  nbthread 40\n\ndefaults frontend-defaults\n  log global\n  mode http\n  option httplog\n  option dontlognull\n  timeout client  10m\n  # \u65B0\u589E\n  http-request redirect scheme https unless { ssl_fc }\n\nfrontend mysite from frontend-defaults\n  mode http\n  # \u5E9F\u5F03 process \u4F7F\u7528 thread\n  # \u65B0\u589E shards \u53C2\u6570 - \u7B49\u540C\u4E8E\u591A\u6B21 bind\n  bind :80 thread 1-20 shards 2 name website\n  bind :443 ssl crt /etc/haproxy/ssl/cert.pem\n  default_backend webservers\n"})}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-24",children:"HAProxy 2.4"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u53D8\u5316\u975E\u5E38\u5927"}),"\n"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u534F\u8BAE\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["HTTP2/WebSocket\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://tools.ietf.org/html/rfc8441",children:"rfc8441"})," HTTP CONNECT"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"FIX - Financial Information eXchange"}),"\n",(0,l.jsxs)(e.li,{children:["MQTT\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5305\u6709\u6548\u6027\u6821\u9A8C"}),"\n",(0,l.jsx)(e.li,{children:"\u57FA\u4E8E\u5BA2\u6237\u7AEF\u6807\u8BC6\u8DEF\u7531"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u8D1F\u8F7D\u5747\u8861\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301 TCP DNS"}),"\n",(0,l.jsx)(e.li,{children:"\u7194\u65AD\u589E\u5F3A - http_fail_cnt, http_fail_rate"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["SSL/TLS\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u52A8\u6001 SSL \u8BC1\u4E66\u5B58\u50A8 - \u4E0D\u518D\u9700\u8981\u91CD\u542F"}),"\n",(0,l.jsxs)(e.li,{children:["\u5141\u8BB8\u52A8\u6001 SNI \u94FE\u63A5\u590D\u7528 - ",(0,l.jsx)(e.code,{children:"sni req.hdr(host)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Observability\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5185\u7F6E ",(0,l.jsx)(e.strong,{children:"OpenTracing"})]}),"\n",(0,l.jsx)(e.li,{children:"Prometheus \u589E\u52A0\u6307\u6807"}),"\n",(0,l.jsxs)(e.li,{children:["\u7EDF\u8BA1\u589E\u52A0 SSL/TLS \u6A21\u5757\u76F8\u5173 - ",(0,l.jsx)(e.code,{children:"stats show-modules"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7F13\u5B58\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301 Vary \u5934 - ",(0,l.jsx)(e.code,{children:"process-vary on"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u6700\u5927\u7F13\u5B58\u6761\u76EE\u63A7\u5236 - ",(0,l.jsx)(e.code,{children:"max-secondary-entries 10"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u914D\u7F6E\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301\u9884\u5904\u7406\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:".if <condition> ... .elif <condition> ... .else ... .endif"})}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:".diag"}),", ",(0,l.jsx)(e.code,{children:".notice"}),", ",(0,l.jsx)(e.code,{children:".warning"}),", ",(0,l.jsx)(e.code,{children:".alert"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"-dD \u663E\u793A\u8BCA\u65AD\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u6761\u4EF6\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"defined(<name>)"})}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"feature(<name>)"})," - ",(0,l.jsx)(e.code,{children:"haproxy -vv"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"OT - OpenTracing"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"streq(<str1>,<str2>)"}),", ",(0,l.jsx)(e.code,{children:"strneq(<str1>,<str2>)"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"version_atleast(<ver>)"}),", ",(0,l.jsx)(e.code,{children:"version_before(<ver>)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u9ED8\u8BA4\u8DEF\u5F84 - ",(0,l.jsx)(e.code,{children:"default-path"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u9ED8\u8BA4\u547D\u540D - ",(0,l.jsx)(e.code,{children:"default http-defaults from tcp-defaults"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u52A8\u6001\u8D85\u65F6 - ",(0,l.jsx)(e.code,{children:"http-request set-timeout"})]}),"\n",(0,l.jsxs)(e.li,{children:["TCP \u5347\u7EA7 HTTP - fe tcp, be http - ",(0,l.jsx)(e.code,{children:"tcp-request content switch-mode"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u5339\u914D\u5220\u9664 HTTP \u5934 - ",(0,l.jsx)(e.code,{children:"http-request del-header X-Forwarded -m beg"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u65B0\u589E\u5B9E\u9A8C\u6A21\u5F0F - \u5F00\u542F\u5B9E\u9A8C\u529F\u80FD\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u52A8\u6001\u670D\u52A1\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u901A\u8FC7 runtime api \u65B0\u589E\u670D\u52A1"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u53D8\u91CF\u4FEE\u6539"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Lua\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u591A\u7EBF\u7A0B - ",(0,l.jsx)(e.code,{children:"lua-load-per-thread"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-2-4",children:"Announcing HAProxy 2.4"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# runtime api\necho "help add" | socat /var/run/haproxy/api.sock -\necho "show state" | socat /var/run/haproxy/api.sock -\n\n# \u670D\u52A1\necho "experimental-mode on; add server be_app/app4 192.168.1.22:80" | socat /var/run/haproxy/api.sock -\necho "experimental-mode on; del server be_app/app4" | socat /var/run/haproxy/api.sock -\n# \u53D8\u91CF\necho "experimental-mode on; get var proc.myapp_version" | socat /var/run/haproxy/api.sock -\necho "experimental-mode on; set var proc.myapp_version str(green)" | socat /var/run/haproxy/api.sock -\necho "experimental-mode on; get var proc.myapp_version" | socat /var/run/haproxy/api.sock -\n'})}),"\n",(0,l.jsx)(e.h2,{id:"haproxy-23",children:"HAProxy 2.3"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u94FE\u63A5\u589E\u5F3A - \u4E3A\u652F\u6301 QUIC \u548C UDP \u505A\u51C6\u5907\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B8C\u5584 Linux keepalive - \u652F\u6301 sysctl \u4FEE\u6539\u53C2\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8BAE - Syslog TCP/UDP"}),"\n",(0,l.jsxs)(e.li,{children:["\u8D1F\u8F7D\u5747\u8861\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"balance uri path-only - \u89E3\u51B3 HTTP1 \u548C HTTP2 \u5730\u5740\u4E0D\u4E00\u6837\u95EE\u9898"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["SSL/TLS\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5141\u8BB8\u9759\u6001 SNI \u94FE\u63A5\u590D\u7528 - ",(0,l.jsx)(e.code,{children:"sni str(example.local)"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Observability\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["stats HTTP 2 \u4FE1\u606F - ",(0,l.jsx)(e.code,{children:"stats show-modules"})]}),"\n",(0,l.jsx)(e.li,{children:"\u57FA\u4E8E SPOE \u96C6\u6210 OpenTracing"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Lua 5.4"}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.haproxy.com/blog/announcing-haproxy-2-3",children:"Announcing HAProxy 2.3"})}),"\n"]}),"\n"]}),"\n"]})]})}function t(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(x,{...n})}):x(n)}},17776:function(n,e,s){s.d(e,{R:()=>c,x:()=>d});var r=s(7378);let l={},i=r.createContext(l);function c(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:c(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);