"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["403919"],{988272:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>h,default:()=>j,metadata:()=>d,assets:()=>c,contentTitle:()=>i});var d=JSON.parse('{"id":"db/relational/postgresql/psql","title":"psql","description":"- ~/.psqlrc","source":"@site/../notes/db/relational/postgresql/psql.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/psql","permalink":"/notes/db/relational/postgresql/psql","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/psql.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1724402050000,"frontMatter":{"title":"psql"},"sidebar":"docs","previous":{"title":"prest","permalink":"/notes/db/relational/postgresql/prest"},"next":{"title":"Spilo","permalink":"/notes/db/relational/postgresql/spilo"}}'),r=s(486106),l=s(917776);let t={title:"psql"},i="psql",c={},h=[];function x(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",hr:"hr",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"psql",children:"psql"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"~/.psqlrc"}),"\n",(0,r.jsx)(e.li,{children:"~/.psql_history"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"meta command"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\a"})}),(0,r.jsx)(e.td,{children:"toggle align"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsxs)(e.td,{children:[(0,r.jsx)(e.code,{children:"\\c <db>"}),", ",(0,r.jsx)(e.code,{children:"\\connect <db>"})]}),(0,r.jsx)(e.td,{children:"\u5207\u6362 \u6570\u636E\u5E93 = \u91CD\u8FDE"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\c [-reuse-previous=on|off] [db [user] [host] [port] | conninfo]"})}),(0,r.jsx)(e.td,{children:"\u5207\u6362 \u94FE\u63A5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\C [title]"})}),(0,r.jsxs)(e.td,{children:["\u8BBE\u7F6E\u6807\u9898 = ",(0,r.jsx)(e.code,{children:"\\pset title TITLE"})]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\cd [dir]"})}),(0,r.jsx)(e.td,{children:"\u5207\u6362\u76EE\u5F55"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\conninfo"})}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u8FDE\u63A5\u4FE1\u606F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\dn"})}),(0,r.jsx)(e.td,{children:"list schema"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\ds"})}),(0,r.jsx)(e.td,{children:"list relation"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\dt *.*"})}),(0,r.jsx)(e.td,{children:"list all table"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\dt"})}),(0,r.jsx)(e.td,{children:"list public schema table"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\du"})}),(0,r.jsx)(e.td,{children:"list users"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\dx"})}),(0,r.jsx)(e.td,{children:"list extensions"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\l"})}),(0,r.jsx)(e.td,{children:"list database"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\df[amptwS+]"})}),(0,r.jsx)(e.td,{children:"list functions"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\copy"})}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\g [ (option=value [...]) ] [ filename ]"})}),(0,r.jsx)(e.td,{children:"\u6267\u884C\u8F93\u51FA\u5230\u6587\u4EF6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\g [ (option=value [...]) ] [ |command ]"})}),(0,r.jsx)(e.td,{children:"\u6267\u884C\u8F93\u51FA\u5230\u547D\u4EE4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\g [ (option=value [...]) ]"})}),(0,r.jsx)(e.td,{children:"\u6267\u884C\u8F93\u51FA\u5230 stdout"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\if exp \\elif exp \\else \\endif"})}),(0,r.jsx)(e.td,{children:"\u6761\u4EF6\u5224\u65AD"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"\\timing [ on | off ]"})}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u6267\u884C\u65F6\u95F4"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"a - agg"}),"\n",(0,r.jsx)(e.li,{children:"n - normal"}),"\n",(0,r.jsx)(e.li,{children:"p - procedure"}),"\n",(0,r.jsx)(e.li,{children:"t - trigger"}),"\n",(0,r.jsx)(e.li,{children:"w - window"}),"\n",(0,r.jsx)(e.li,{children:"S - system object"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"+"})," - \u989D\u5916\u4FE1\u606F"]}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"caution",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["meta command \u9700\u8981\u5728\u4E00\u884C - \u7279\u522B\u662F ",(0,r.jsx)(e.code,{children:"\\copy()"})]}),"\n",(0,r.jsxs)(e.li,{children:["\u53D8\u91CF\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"\\set name value"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"\\echo :name"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"\\unset name"})}),"\n"]}),"\n"]}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"var"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"AUTOCOMMIT"}),(0,r.jsx)(e.td,{children:"\u81EA\u52A8\u63D0\u4EA4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"COMP_KEYWORD_CASE"})}),(0,r.jsx)(e.td,{children:"\u5173\u952E\u5B57\u5927\u5C0F\u5199"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"DBNAME"}),(0,r.jsx)(e.td,{children:"\u6570\u636E\u5E93\u540D"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ECHO"}),(0,r.jsx)(e.td,{children:"\u8F93\u51FA"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ECHO_HIDDEN"}),(0,r.jsx)(e.td,{children:"\u9690\u85CF\u8F93\u51FA"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ENCODING"}),(0,r.jsx)(e.td,{children:"\u7F16\u7801"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ERROK"}),(0,r.jsx)(e.td,{children:"\u9519\u8BEF\u5FFD\u7565"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"FETCH_COUNT"}),(0,r.jsx)(e.td,{children:"\u6BCF\u6B21\u83B7\u53D6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HIDE_TABLEAM"}),(0,r.jsx)(e.td,{children:"\u9690\u85CF\u8868"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HIDE_TOAST_COMPRESSION"}),(0,r.jsx)(e.td,{children:"\u9690\u85CF\u538B\u7F29"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HISTCONTROL"}),(0,r.jsx)(e.td,{children:"\u5386\u53F2\u63A7\u5236"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HISTFILE"}),(0,r.jsx)(e.td,{children:"\u5386\u53F2\u6587\u4EF6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HISTSIZE"}),(0,r.jsx)(e.td,{children:"\u5386\u53F2\u5927\u5C0F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"HOST"}),(0,r.jsx)(e.td,{children:"\u4E3B\u673A"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"IGNOREEOF"}),(0,r.jsx)(e.td,{children:"\u5FFD\u7565 EOF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"LASTOID"}),(0,r.jsx)(e.td,{children:"\u6700\u540E OID"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"LAST_ERROR_MESSAGE"}),(0,r.jsx)(e.td,{children:"\u6700\u540E\u9519\u8BEF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"LAST_ERROR_SQLSTATE"}),(0,r.jsx)(e.td,{children:"\u6700\u540E\u9519\u8BEF\u72B6\u6001"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ON_ERROR_ROLLBACK"}),(0,r.jsx)(e.td,{children:"\u9519\u8BEF\u56DE\u6EDA"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ON_ERROR_STOP"}),(0,r.jsx)(e.td,{children:"\u9519\u8BEF\u505C\u6B62"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"PORT"}),(0,r.jsx)(e.td,{children:"\u7AEF\u53E3"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"PROMPT1,PROMPT2,PROMPT3"}),(0,r.jsx)(e.td,{children:"\u63D0\u793A\u7B26"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"QUIET"}),(0,r.jsx)(e.td,{children:"\u5B89\u9759"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ROW_COUNT"}),(0,r.jsx)(e.td,{children:"\u884C\u6570"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SERVER_VERSION_NAME"}),(0,r.jsx)(e.td,{children:"\u670D\u52A1\u5668\u7248\u672C"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SERVER_VERSION_NUM"}),(0,r.jsx)(e.td,{children:"\u670D\u52A1\u5668\u7248\u672C\u53F7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SHELL_ERROR"}),(0,r.jsx)(e.td,{children:"shell \u9519\u8BEF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SHOW_ALL_RESULTS"}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u6240\u6709\u7ED3\u679C"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SHOW_CONTEXT"}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u4E0A\u4E0B\u6587"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SINGLELINE"}),(0,r.jsxs)(e.td,{children:["\u5355\u884C ",(0,r.jsx)(e.code,{children:"-S"})]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SINGLESTEP"}),(0,r.jsxs)(e.td,{children:["\u5355\u6B65 ",(0,r.jsx)(e.code,{children:"-s"})]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SQLSTATE"}),(0,r.jsx)(e.td,{children:"\u72B6\u6001"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"USER"}),(0,r.jsx)(e.td,{children:"\u7528\u6237"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"VERBOSITY"}),(0,r.jsx)(e.td,{children:"\u8BE6\u7EC6\u5EA6 default, verbose, terse, sqlstate"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"VERSION"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"VERSION_NAME"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"VERSION_NUN"}),(0,r.jsx)(e.td,{})]})]})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"\\echo :VERSION\n\n-- \u83B7\u53D6\u7A0B\u5E8F\u8FD4\u56DE\n\\set val `cat test.txt`\n\nselect :'VERSION' as ver;\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsx)(e.tr,{children:(0,r.jsx)(e.th,{children:"flag"})})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsx)(e.tr,{children:(0,r.jsx)(e.td,{children:"-h,--host=hostname"})}),(0,r.jsx)(e.tr,{children:(0,r.jsx)(e.td,{children:"-p,--port=port"})})]})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'brew install libpq # client only\nexport PATH="$(brew --prefix)/opt/libpq/bin:$PATH"\n\n# brew install postgresql@15 #\n\n# \u4F7F\u7528\u94FE\u63A5\u5B57\u7B26\u4E32\npsql "service=myservice sslmode=require"\npsql postgresql://dbmaster:5433/mydb?sslmode=require\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\\copy { table [ ( column_list ) ] } from { 'filename' | program 'command' | stdin | pstdin } [ [ with ] ( option [, ...] ) ] [ where condition ]\n\\copy { table [ ( column_list ) ] | ( query ) } to { 'filename' | program 'command' | stdout | pstdout } [ [ with ] ( option [, ...] ) ]\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u548C ",(0,r.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/sql-copy.html",children:"COPY"})," \u7C7B\u4F3C\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"COPY \u662F\u8F93\u51FA\u5230\u670D\u52A1\u7AEF"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"\\copy"})," \u662F\u8F93\u51FA\u5230\u5BA2\u6237\u7AEF\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u7C7B\u4F3C ",(0,r.jsx)(e.code,{children:"COPY ... TO STDOUT "})," - \u4E0D\u8FC7\u8FD9\u6837\u53EF\u4EE5\u5199\u591A\u884C SQL"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:'-- \u4E24\u8005\u6548\u679C\u76F8\u540C, \u4F46 copy \u652F\u6301\u591A\u884C, \\copy \u53EA\u80FD\u5728\u4E00\u884C\n\\copy (select 1 as val) TO \'test.csv\' WITH CSV HEADER\nCOPY (\n  select 1 as val\n) TO STDOUT WITH CSV HEADER \\g test.csv;\n\n\n-- COPY \u5904\u7406 conflict - \u53EA\u80FD\u901A\u8FC7\u4E34\u65F6\u8868\u6765\u5904\u7406\n-- \u5982\u679C\u5728\u4E8B\u52A1 BEGIN, COMMIT \u91CC\u53EF\u4EE5\u589E\u52A0 ON COMMIT DROP\nCREATE TEMP TABLE tmp_table  (LIKE main_table INCLUDING DEFAULTS);\nCOPY tmp_table FROM \'data.csv\';\nINSERT INTO main_table SELECT * FROM tmp_table ON CONFLICT DO NOTHING;\n\n-- \u94FE\u63A5\u4FE1\u606F\n\\conninfo\n-- You are connected to database "test" as user "admin" on host "127.0.0.1" at port "5432".\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u914D\u5408 ",(0,r.jsx)(e.a,{href:"/notes/db/relational/postgresql/pgpass",children:"pgpass"})," \u907F\u514D\u8F93\u5165\u5BC6\u7801"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.postgresql.org/docs/current/app-psql.html",children:"psql"})}),"\n"]})]})}function j(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(x,{...n})}):x(n)}},917776:function(n,e,s){s.d(e,{R:()=>t,x:()=>i});var d=s(7378);let r={},l=d.createContext(r);function t(n){let e=d.useContext(l);return d.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),d.createElement(l.Provider,{value:e},n.children)}}}]);