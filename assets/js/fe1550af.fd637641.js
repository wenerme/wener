"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["17625"],{461946:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>o,toc:()=>d,default:()=>a,metadata:()=>i,assets:()=>c,contentTitle:()=>l});var i=JSON.parse('{"id":"service/network/proxy/sing-box/README","title":"sing-box","description":"- SagerNet/sing-box","source":"@site/../notes/service/network/proxy/sing-box/README.md","sourceDirName":"service/network/proxy/sing-box","slug":"/service/network/proxy/sing-box/","permalink":"/notes/service/network/proxy/sing-box/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/proxy/sing-box/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1750997941000,"frontMatter":{"title":"sing-box"},"sidebar":"docs","previous":{"title":"Shadowsocks","permalink":"/notes/service/network/proxy/shadowsocks"},"next":{"title":"Sing Box Awesome","permalink":"/notes/service/network/proxy/sing-box/awesome"}}'),r=s(486106),t=s(917776);let o={title:"sing-box"},l="sing-box",c={},d=[];function x(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"sing-box",children:"sing-box"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/SagerNet/sing-box",children:"SagerNet/sing-box"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"GPLv3, Golang"}),"\n",(0,r.jsx)(e.li,{children:"universal proxy platform"}),"\n",(0,r.jsxs)(e.li,{children:["\u652F\u6301\u534F\u8BAE\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ShadowTLS / Shadowsocks / Trojan / VLESS / VLESS-REALITY / VMess-HTTPUpgrade-TLS / VMess-WebSocket-TLS / VMess-WebSocket / VMess"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"GSO - Generic Segmentation Offload - \u901A\u7528\u5206\u6BB5\u5378\u8F7D"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"caution",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["TUN ICMP \u4F1A\u88AB\u62E6\u622A\u4E14\u65E0\u6CD5\u7ED5\u8FC7\uFF0C\u5BFC\u81F4\u6240\u6709 ping \u90FD < 1ms\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/google/gvisor/issues/8657",children:"google/gvisor#8657"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["prefer_ipv4 \u4E0D\u4E00\u5B9A\u80FD\u4FDD\u8BC1 IPv4 \u4F18\u5148\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/SagerNet/sing-box/issues/932#issuecomment-1738723839",children:"#932"})}),"\n"]}),"\n"]}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"abbr."}),(0,r.jsx)(e.th,{children:"stand for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SFM"}),(0,r.jsx)(e.td,{children:"sing-box for MacOS"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SFA"}),(0,r.jsx)(e.td,{children:"sing-box for Android"})]})]})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# macOS Homebrew\nbrew install sing-box # \u547D\u4EE4\u884C /opt/homebrew/etc/sing-box/config.json\nbrew install sfm      # \u684C\u9762\u5E94\u7528\n\n/opt/homebrew/opt/sing-box/bin/sing-box version\n\n# AlpineLinux\n# /usr/bin/sing-box\n# sing-box -D /var/lib/sing-box -C /etc/sing-box check\n# sing-box -D /var/lib/sing-box -C /etc/sing-box run\napk add -X https://mirrors.tuna.tsinghua.edu.cn/alpine/edge/testing/ --no-cache sing-box\nkill -HUP $(pgrep sing-box) # reload\n\n# https://github.com/SagerNet/sing-box/releases\n# https://sing-box.sagernet.org/changelog/\nVERSION=1.11.6\ncurl -L -o sing-box.tar.gz https://github.com/SagerNet/sing-box/releases/download/v${VERSION}/sing-box-${VERSION}-$(uname -s | tr '[:upper:]' '[:lower:]')-$(uname -m | sed 's/x86_64/amd64/').tar.gz\n# gtar -zxvf sing-box.tar.gz --strip-components=1 --wildcards '*/sing-box'\ntar zxvf sing-box.tar.gz --strip-components=1 --wildcards '*/sing-box'\n./sing-box version\n\n# Linux\nsudo mv sing-box /usr/local/bin/\n# sudo mv sing-box /usr/bin/ # \u914D\u5408 sing-box-openrc\napk add -X https://mirrors.tuna.tsinghua.edu.cn/alpine/edge/testing/ --no-cache sing-box\n\ndocker run -d \\\n  -v /etc/sing-box:/etc/sing-box/ \\\n  --name=sing-box \\\n  --restart=always \\\n  ghcr.io/sagernet/sing-box \\\n  -D /var/lib/sing-box \\\n  -C /etc/sing-box/ run\n\nsing-box version\nsing-box check -c conf.json\nsing-box run conf.json\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"flag"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"-c config.json"})}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"-C config.d"})}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"-D CWD"})}),(0,r.jsx)(e.td,{})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"abbr."}),(0,r.jsx)(e.th,{children:"stand for"}),(0,r.jsx)(e.th,{children:"meaning"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"VAPID"}),(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ECH"}),(0,r.jsx)(e.td,{children:"Encrypted Client Hello"}),(0,r.jsx)(e.td,{children:"\u52A0\u5BC6\u5BA2\u6237\u7AEF Hello"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RDRC"}),(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["srs\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4E8C\u8FDB\u5236\u7684 rule set, zlib \u538B\u7F29"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["Router\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["router\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"router.rules"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["dns\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"dns.rules"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"DnsClient"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"func RouteConnection(ctx context.Context, conn net.Conn, metadata adapter.InboundContext)"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[".matchRule\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6309\u9700\u67E5\u627E ProcessInfo"}),"\n",(0,r.jsx)(e.li,{children:"\u6309\u9700 \u5339\u914D FakeIP, \u5339\u914D\u5230\u4E86\u66F4\u65B0 FQDN"}),"\n",(0,r.jsx)(e.li,{children:"\u6309\u9700 DnsReverseMapping - IP -> Domain"}),"\n",(0,r.jsx)(e.li,{children:"\u904D\u5386 .rules.Match(metadata)"}),"\n",(0,r.jsx)(e.li,{children:".actionSniff"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"action=route"}),"\n",(0,r.jsx)(e.li,{children:"action=reject"}),"\n",(0,r.jsx)(e.li,{children:"action=hijack-dns"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["NetworkManager\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u76D1\u6D4B \u7F51\u7EDC\u72B6\u6001"}),"\n",(0,r.jsx)(e.li,{children:"\u76D1\u6D4B \u7F51\u7EDC\u63A5\u53E3"}),"\n",(0,r.jsx)(e.li,{children:"\u76D1\u6D4B \u7535\u6E90"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"InboundManager"}),"\n",(0,r.jsx)(e.li,{children:"OutboundManager"}),"\n",(0,r.jsx)(e.li,{children:"EndpointManager"}),"\n",(0,r.jsx)(e.li,{children:"ConnectionManager"}),"\n",(0,r.jsx)(e.li,{children:"platform.Interface"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ts",children:"/*\n	DomainStrategyAsIS DomainStrategy = iota\n	DomainStrategyPreferIPv4\n	DomainStrategyPreferIPv6\n	DomainStrategyUseIPv4\n	DomainStrategyUseIPv6\n*/\n// `prefer_ipv4` `prefer_ipv6` `ipv4_only` `ipv6_only`\ntype DomainStrategy = 'prefer_ipv4';\n"})})]})}function a(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(x,{...n})}):x(n)}},917776:function(n,e,s){s.d(e,{R:()=>o,x:()=>l});var i=s(7378);let r={},t=i.createContext(r);function o(n){let e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);