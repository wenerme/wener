"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["58031"],{82066:function(n,e,l){l.r(e),l.d(e,{frontMatter:()=>r,toc:()=>h,default:()=>o,metadata:()=>s,assets:()=>d,contentTitle:()=>t});var s=JSON.parse('{"id":"db/column/cql","title":"CQL","description":"- https://docs.datastax.com/en/cql-oss/3.3/","source":"@site/../notes/db/column/cql.md","sourceDirName":"db/column","slug":"/db/column/cql","permalink":"/notes/db/column/cql","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/column/cql.md","tags":[{"inline":true,"label":"SQL","permalink":"/notes/tags/sql"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1664927783000,"frontMatter":{"title":"CQL","tags":["SQL"]},"sidebar":"docs","previous":{"title":"Clickhouse SQL","permalink":"/notes/db/column/clickhouse/sql"},"next":{"title":"DuckDB","permalink":"/notes/db/column/duckdb"}}'),i=l(86106),c=l(17776);let r={title:"CQL",tags:["SQL"]},t="CQL",d={},h=[{value:"cqlsh",id:"cqlsh",level:2},{value:"CQL",id:"cql-1",level:2}];function a(n){let e={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"cql",children:"CQL"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.datastax.com/en/cql-oss/3.3/",children:"https://docs.datastax.com/en/cql-oss/3.3/"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/datastax/nodejs-driver",children:"datastax/nodejs-driver"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"cqlsh",children:"cqlsh"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"SHOW VERSION;\nSHOW HOST;\n\nSHOW SESSION $id;\n\nSOURCE '/data/commands.cql'\n\nCAPTURE;\nCAPTURE OFF;\nCAPTURE '/data/file';\n\nTRACING ON;\nTRACING OFF;\n\nPAGING ON;\nPAGING OFF;\nPAGING $page_size_in_rows;\n\nEXPAND ON;\nEXPAND OFF;\n\n-- LOGIN <username> [<password>]\n\nCLEAR;\nCLS;\n\n-- DESCRIBE <>\nDESCRIBE CLUSTER;\nDESCRIBE SCHEMA;\nDESCRIBE KEYSPACES;\nDESCRIBE KEYSPACE keyspace_name;\nDESCRIBE TABLES;\nDESCRIBE TABLE table_name;\nDESCRIBE MATERIALIZED VIEW view_name;\nDESCRIBE TYPES;\nDESCRIBE TYPE type_name;\nDESCRIBE FUNCTIONS;\nDESCRIBE FUNCTION function_name;\nDESCRIBE AGGREGATES;\nDESCRIBE AGGREGATE aggregate_function_name;\n\n-- COPY <table name> [(<column>, ...)] TO <file name> WITH <copy option> [AND <copy option> ...]\n-- MAXREQUESTS=6 PAGESIZE=1000 PAGETIMEOUT=10\n-- BEGINTOKEN, ENDTOKEN\n-- MAXOUTPUTSIZE=-1\n-- ENCODING=utf8\n\n-- COPY <table name> [(<column>, ...)] FROM <file name> WITH <copy option> [AND <copy option> ...]\n-- INGESTRATE=100000 MAXROWS=-1 SKIPROWS=0 SKIPCOLS=0 MAXPARSEERRORS=-1 MAXINSERTERRORS=1000\n-- ERRFILE=import_<ks>_<table>.err\n-- MAXBATCHSIZE=20 MINBATCHSIZE=2\n-- CHUNKSIZE=1000\nCOPY test FROM 'file.csv' WITH HEADER=true;\n\n-- COPY\n-- NULLVAL=null HEADER=false DECIMALSEP=.\n-- THOUSANDSSEP\n-- BOOLSTYlE True, False\n-- NUMPROCESSES\n-- MAXATTEMPTS=5\n-- REPORTFREQUENCY=0.25\n-- RATEFILE\n"})}),"\n",(0,i.jsx)(e.h2,{id:"cql-1",children:"CQL"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["KEYSPACE - CREATE, DROP, DESCRIBE, ALTER\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6570\u636E\u5E93\u6982\u5FF5"}),"\n",(0,i.jsx)(e.li,{children:"durable_writes"}),"\n",(0,i.jsxs)(e.li,{children:["replication\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["class\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["NetworkTopologyStrategy\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"<datacenter>"})," - \u7ED9\u5B9A dc \u7684\u526F\u672C\u6570"]}),"\n",(0,i.jsx)(e.li,{children:"replication_factor - dc \u9ED8\u8BA4\u526F\u672C\u6570"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["SimpleStrategy\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["replication_factor\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5168\u5C40\u526F\u672C\u6570\uFF0C\u4E0D\u8003\u8651 datacenter"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"USE keyspace"}),"\n",(0,i.jsxs)(e.li,{children:["TABLE\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["column\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"STATIC - \u76F8\u540C\u5206\u7247\u503C\u76F8\u540C"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["PRIMARY KEY\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E0D\u6307\u5B9A\u5219\u6BCF\u884C\u4E3A\u4E00\u4E2A partition"}),"\n",(0,i.jsx)(e.li,{children:"\u503C\u4E0D\u80FD\u4E3A null"}),"\n",(0,i.jsx)(e.li,{children:"\u7B2C\u4E00\u4E2A\u5217\u4F5C\u4E3A partition key"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"PRIMARY KEY ((a, b), c)"})," - \u591A\u4E2A partation key\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"c \u4E3A clustering column"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["table_options\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.del,{children:"COMPACT STORAGE"})}),"\n",(0,i.jsxs)(e.li,{children:["CLUSTERING ORDER\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u57FA\u4E8E clustering column \u6392\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u4FEE\u6539\u6392\u5E8F"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"comment"}),"\n",(0,i.jsx)(e.li,{children:"read_repair_chance=0"}),"\n",(0,i.jsx)(e.li,{children:"dclocal_read_repair_chance=0"}),"\n",(0,i.jsx)(e.li,{children:"speculative_retry=99PERCENTILE"}),"\n",(0,i.jsx)(e.li,{children:"gc_grace_seconds=864000"}),"\n",(0,i.jsx)(e.li,{children:"tombstone_gc"}),"\n",(0,i.jsx)(e.li,{children:"bloom_filter_fp_chance=0.01"}),"\n",(0,i.jsx)(e.li,{children:"default_time_to_live=0"}),"\n",(0,i.jsxs)(e.li,{children:["cdc\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"enabled=false"}),"\n",(0,i.jsx)(e.li,{children:"preimage=false"}),"\n",(0,i.jsx)(e.li,{children:"ttl"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["compaction - \u5408\u5E76 SSTables\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"tombstone_threshold=0.2"}),"\n",(0,i.jsx)(e.li,{children:"tombstone_compaction_interval=86400s - 1day"}),"\n",(0,i.jsxs)(e.li,{children:["SizeTieredCompactionStrategy - STCS - \u9ED8\u8BA4\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"bucket_high=1.5, bucket_low=0.5"}),"\n",(0,i.jsx)(e.li,{children:"min_sstable_size=50"}),"\n",(0,i.jsx)(e.li,{children:"min_threshold=4, max_threshold=32"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["LeveledCompactionStrategy - LCS\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"sstable_size_in_mb=160"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"IncrementalCompactionStrategy - ICS - \u4F01\u4E1A\u7248"}),"\n",(0,i.jsxs)(e.li,{children:["DateTieredCompactionStrategy - TWCS\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"1 sstable/time window"}),"\n",(0,i.jsx)(e.li,{children:"compaction_window_unit=DAYS, compaction_window_size=1"}),"\n",(0,i.jsx)(e.li,{children:"expired_sstable_check_frequency_seconds=600"}),"\n",(0,i.jsx)(e.li,{children:"min_threshold=4, max_threshold=32"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["compression\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["sstable_compression=LZ4Compressor\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"SnappyCompressor"}),"\n",(0,i.jsx)(e.li,{children:"DeflateCompressor"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"chunk_length_in_kb=4KB"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"scylla_encryption_options"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"caching = {'enabled': 'true'}"})}),"\n",(0,i.jsx)(e.li,{children:"speculative_retry"}),"\n",(0,i.jsxs)(e.li,{children:["cache\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"enabled=true"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["INDEX - \u4E8C\u7EA7\u7D22\u5F15\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u672C\u5730 - \u5355\u5206\u7247"}),"\n",(0,i.jsx)(e.li,{children:"\u5168\u5C40"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["TTL\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BBE\u7F6E\u4E3A\u5217\u7EF4\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u4EE5\u884C\u7EF4\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u8868\u53EF\u4EE5\u8BBE\u7F6E\u9ED8\u8BA4 default_time_to_live"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["JSON\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"SELECT JSON"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"INSERT JSON"})}),"\n",(0,i.jsx)(e.li,{children:"fromJson"}),"\n",(0,i.jsx)(e.li,{children:"toJson"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["CREATE MATERIALIZED VIEW\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["SELECT \u9650\u5236\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E0D\u53EF\u4EE5 ALLOW FILTERING"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u5141\u8BB8 order"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u5305\u542B limit"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["ScyllaDB \u6269\u5C55\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"SELECT BYPASS CACHE"}),"\n",(0,i.jsx)(e.li,{children:"CREATE TABLE WITH paxos_grace_seconds"}),"\n",(0,i.jsx)(e.li,{children:"SELECT/INSERT USING TIMEOUT"}),"\n",(0,i.jsx)(e.li,{children:"KEYSPACE options"}),"\n",(0,i.jsx)(e.li,{children:"PRUNE MATERIALIZED VIEW"}),"\n",(0,i.jsxs)(e.li,{children:["CREATE MATERIALIZED VIEW WITH synchronous_updates\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u540C\u6B65\u66F4\u65B0"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"MV \u4E8C\u7EA7\u7D22\u5F15 synchronous_updates"}),"\n",(0,i.jsx)(e.li,{children:"REDUCEFUNC for UDA"}),"\n",(0,i.jsx)(e.li,{children:"per_partition_rate_limit"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"CREATE KEYSPACE catalog WITH REPLICATION = { 'class' : 'NetworkTopologyStrategy','DC1' : 3};\nuse catalog;\nCREATE TABLE mutant_data (\n   first_name text,\n   last_name text,\n   address text,\n   picture_location text,\n   PRIMARY KEY((first_name, last_name)));\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.scylladb.com/stable/cql/ddl.html",children:"https://docs.scylladb.com/stable/cql/ddl.html"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.scylladb.com/stable/cql/types.html",children:"https://docs.scylladb.com/stable/cql/types.html"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.scylladb.com/stable/cql/compaction.html",children:"https://docs.scylladb.com/stable/cql/compaction.html"})}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},17776:function(n,e,l){l.d(e,{R:()=>r,x:()=>t});var s=l(7378);let i={},c=s.createContext(i);function r(n){let e=s.useContext(c);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);