"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["36406"],{59656:function(e,l,n){n.r(l),n.d(l,{frontMatter:()=>t,toc:()=>h,default:()=>a,metadata:()=>s,assets:()=>d,contentTitle:()=>c});var s=JSON.parse('{"id":"devops/kubernetes/ops/helm2","title":"HELM2 - \u4E0D\u63A8\u8350","description":"V2 - V3","source":"@site/../notes/devops/kubernetes/ops/helm2.md","sourceDirName":"devops/kubernetes/ops","slug":"/devops/kubernetes/ops/helm2","permalink":"/notes/devops/kubernetes/ops/helm2","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/ops/helm2.md","tags":[{"inline":true,"label":"Deprecated","permalink":"/notes/tags/deprecated"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1709090151000,"frontMatter":{"title":"HELM2 - \u4E0D\u63A8\u8350","tags":["Deprecated"]},"sidebar":"docs","previous":{"title":"HELM \u5305\u7BA1\u7406\u5668","permalink":"/notes/devops/kubernetes/ops/helm"},"next":{"title":"\u8BA4\u8BC1\u6388\u6743","permalink":"/notes/devops/kubernetes/ops/k8s-auth"}}'),i=n(86106),r=n(17776);let t={title:"HELM2 - \u4E0D\u63A8\u8350",tags:["Deprecated"]},c="Helm 2 - \u4E0D\u63A8\u8350\u4F7F\u7528",d={},h=[{value:"V2 - V3",id:"v2---v3",level:2},{value:"Tiller \u5B89\u88C5",id:"tiller-\u5B89\u88C5",level:2},{value:"Helm 2 Tiller",id:"helm-2-tiller",level:2},{value:"FAQ",id:"faq",level:2},{value:"Error: could not find a ready tiller pod",id:"error-could-not-find-a-ready-tiller-pod",level:3},{value:"Helm \u547D\u4EE4 Hang \u4F4F",id:"helm-\u547D\u4EE4-hang-\u4F4F",level:3}];function o(e){let l={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.header,{children:(0,i.jsx)(l.h1,{id:"helm-2---\u4E0D\u63A8\u8350\u4F7F\u7528",children:"Helm 2 - \u4E0D\u63A8\u8350\u4F7F\u7528"})}),"\n",(0,i.jsx)(l.h2,{id:"v2---v3",children:"V2 - V3"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"\u79FB\u9664 Tiller - \u9700\u8981\u5B89\u88C5\u5230\u96C6\u7FA4\u91CC\u7684\u90E8\u5206"}),"\n",(0,i.jsx)(l.li,{children:"\u4E09\u8DEF\u5408\u5E76\u66F4\u65B0\u7684\u5347\u7EA7\u7B56\u7565"}),"\n",(0,i.jsx)(l.li,{children:"\u53D1\u5E03\u540D\u5728\u547D\u540D\u7A7A\u95F4\u4E0B\u800C\u4E0D\u662F\u5168\u5C40"}),"\n",(0,i.jsx)(l.li,{children:"\u4F7F\u7528 secret \u4F5C\u4E3A\u9ED8\u8BA4\u5B58\u50A8"}),"\n",(0,i.jsxs)(l.li,{children:["Go \u5BFC\u5165\u8DEF\u5F84\u53D8\u5316 ",(0,i.jsx)(l.code,{children:"k8s.io/helm"})," -> ",(0,i.jsx)(l.code,{children:"helm.sh/helm/v3"})]}),"\n",(0,i.jsxs)(l.li,{children:["\u65B0\u589E ",(0,i.jsx)(l.a,{href:"https://helm.sh/docs/chart_template_guide/builtin_objects/",children:".Capabilities"})," \u5185\u5EFA\u5BF9\u8C61 - \u7528\u4E8E\u68C0\u6D4B\u96C6\u7FA4\u73AF\u5883"]}),"\n",(0,i.jsx)(l.li,{children:"\u4F7F\u7528 JSONSchema \u9A8C\u8BC1 Chart"}),"\n",(0,i.jsx)(l.li,{children:"\u5C06 requirements.yaml \u5408\u5E76\u5230 Chart.yaml - \u4F9D\u8D56\u5B9A\u4E49"}),"\n",(0,i.jsxs)(l.li,{children:["\u5B89\u88C5\u65F6\u5FC5\u987B\u6307\u5B9A\u540D\u5B57\u6216 ",(0,i.jsx)(l.code,{children:"--generate-name"})]}),"\n",(0,i.jsxs)(l.li,{children:["\u652F\u6301 OCI ",(0,i.jsx)(l.a,{href:"https://helm.sh/docs/topics/registries/",children:"\u6CE8\u518C\u4E2D\u5FC3"})," - docker \u6CE8\u518C\u4E2D\u5FC3\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:["\u5B9E\u9A8C\u9636\u6BB5 ",(0,i.jsx)(l.code,{children:"HELM_EXPERIMENTAL_OCI=1"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(l.li,{children:["\u79FB\u9664 ",(0,i.jsx)(l.code,{children:"helm serve"})]}),"\n",(0,i.jsxs)(l.li,{children:["\u547D\u4EE4\u4FEE\u6539\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"inspect"})," -> ",(0,i.jsx)(l.code,{children:"show"})]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"fetch"})," -> ",(0,i.jsx)(l.code,{children:"pull"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(l.li,{children:["\u5B89\u88C5\u652F\u6301 ",(0,i.jsx)(l.code,{children:"--create-namespace"})," \u521B\u5EFA\u547D\u540D\u7A7A\u95F4"]}),"\n",(0,i.jsxs)(l.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:(0,i.jsx)(l.a,{href:"https://helm.sh/docs/faq/#changes-since-helm-2",children:"Changes since Helm 2"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(l.h2,{id:"tiller-\u5B89\u88C5",children:"Tiller \u5B89\u88C5"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"\u90E8\u5206\u7CFB\u7EDF\u8FD8\u4F9D\u8D56 Tiller"}),"\n",(0,i.jsx)(l.li,{children:"\u76EE\u524D\u7248\u672C v2.16.1 - 20191129"}),"\n",(0,i.jsxs)(l.li,{children:["\u4F7F\u7528 tiller \u9700\u8981\u4F7F\u7528\u65E7\u7248\u672C helm - \u4F8B\u5982 ",(0,i.jsx)(l.a,{href:"https://get.helm.sh/helm-v2.16.1-darwin-amd64.tar.gz",children:"https://get.helm.sh/helm-v2.16.1-darwin-amd64.tar.gz"})]}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-bash",children:"kubectl -n kube-system create serviceaccount tiller\n\nkubectl create clusterrolebinding tiller \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-system:tiller\n\nhelm init --service-account tiller\n\n# \u53EF\u4EE5\u4FEE\u6539\u955C\u50CF\u4ED3\u5E93 - \u907F\u514D\u65E0\u6CD5\u5B89\u88C5\n# helm init --service-account tiller --tiller-image registry.wener.me/kubernetes-helm/tiller:v2.16.1\n\n# \u83B7\u53D6\u90E8\u7F72\u72B6\u6001\nkubectl -n kube-system rollout status deploy/tiller-deploy\n# \u5982\u679C\u5931\u8D25\u53EF\u4EE5\u8003\u8651\u91CD\u8BD5\nkubectl -n kube-system rollout restart deploy/tiller-deploy\n\n# \u5F53\u524D\u7248\u672C - \u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF - \u5982\u679C\u90FD\u6709\u8F93\u51FA\u5219\u8BF4\u660E\u90E8\u7F72\u6210\u529F\nhelm version\n"})}),"\n",(0,i.jsx)(l.h2,{id:"helm-2-tiller",children:"Helm 2 Tiller"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:["v2 ",(0,i.jsx)(l.a,{href:"https://v2.helm.sh/",children:"\u6587\u6863"})]}),"\n",(0,i.jsx)(l.li,{children:"\u6709\u4E9B\u73AF\u5883\u8FD8\u662F\u4F7F\u7528\u7684 Tiller"}),"\n",(0,i.jsxs)(l.li,{children:["\u5168\u5C40\u53C2\u6570\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--debug"})," \u8F93\u51FA\u66F4\u591A\u4FE1\u606F"]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--home"})," HELM_HOME \u9ED8\u8BA4 ",(0,i.jsx)(l.code,{children:"$HOME/.helm/"})]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--host"})," HELM_HOST \u4F8B\u5982 \u4F7F\u7528\u672C\u5730 export HELM_HOST=:44134"]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--kube-context"})," Kube \u7684\u4E0A\u4E0B\u6587"]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--kubeconfig"})," \u914D\u7F6E\u8DEF\u5F84 KUBECONFIG \u9ED8\u8BA4 ",(0,i.jsx)(l.code,{children:"$HOME/.kube/config"})]}),"\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"--tiller-namespace"})," \u4F7F\u7528\u7684\u7A7A\u95F4 - \u9ED8\u8BA4 kube-system - \u53EF\u4F7F\u7528\u73AF\u5883\u53D8\u91CF TILLER_NAMESPACE"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-bash",children:"# helm init - \u521D\u59CB\u5316\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\n# -c --client-only \u53EA\u521D\u59CB\u5316\u5BA2\u6237\u7AEF\n\n# \u5B89\u88C5\u53EF\u6307\u5B9A\u8D26\u53F7 - \u9700\u8981 cluster-admin \u6743\u9650\nhelm init --service-account $tiller_account\n\n# TLS \u5B89\u88C5\n# gitlab \u7684\u5B89\u88C5\u547D\u4EE4\nhelm init --tiller-tls --tiller-tls-verify --tls-ca-cert /data/helm/helm/config/ca.pem --tiller-tls-cert /data/helm/helm/config/cert.pem --tiller-tls-key /data/helm/helm/config/key.pem --service-account tiller\n\n# \u67E5\u770B helm \u76F8\u5173\u8D44\u6E90\nkubetcl get all -l app=helm\n\n# \u5220\u9664/\u5378\u8F7D\nhelm reset\n# \u66B4\u529B\nkubetcl delete all -l app=helm\n"})}),"\n",(0,i.jsx)(l.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(l.h3,{id:"error-could-not-find-a-ready-tiller-pod",children:"Error: could not find a ready tiller pod"}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-bash",children:"# \u786E\u4FDD\u6709\u5DE5\u4F5C\u7684 tiller-deploy\n# \u4E5F\u53EF\u80FD\u4E0D\u662F\u4F7F\u7528\u7684 kube-system \u4E0B\u7684 tiller \u9700\u8981\u6CE8\u610F\nkubectl -n kube-system get po \uFF5C grep tiller-deploy\n"})}),"\n",(0,i.jsx)(l.h3,{id:"helm-\u547D\u4EE4-hang-\u4F4F",children:"Helm \u547D\u4EE4 Hang \u4F4F"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"\u4E00\u822C\u662F\u7F51\u7EDC\u6216\u8005 CA \u7684\u95EE\u9898\u6216\u8005\u8D26\u53F7\u95EE\u9898"}),"\n",(0,i.jsx)(l.li,{children:"\u5982\u679C\u96C6\u7FA4\u90E8\u7F72\u4E86\u591A\u4E2A tiller \u53EF\u80FD\u4F1A\u6709\u95EE\u9898"}),"\n",(0,i.jsx)(l.li,{children:"44134/44135"}),"\n"]})]})}function a(e={}){let{wrapper:l}={...(0,r.R)(),...e.components};return l?(0,i.jsx)(l,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},17776:function(e,l,n){n.d(l,{R:()=>t,x:()=>c});var s=n(7378);let i={},r=s.createContext(i);function t(e){let l=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function c(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:l},e.children)}}}]);