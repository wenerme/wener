"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["513712"],{320706:function(n,e,l){l.r(e),l.d(e,{frontMatter:()=>t,toc:()=>a,default:()=>u,metadata:()=>r,assets:()=>c,contentTitle:()=>d});var r=JSON.parse('{"id":"web/framework/electron/electron-builder","title":"electron-builder","description":"- electron-userland/electron-builder","source":"@site/../notes/web/framework/electron/electron-builder.md","sourceDirName":"web/framework/electron","slug":"/web/framework/electron/builder","permalink":"/notes/web/framework/electron/builder","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/framework/electron/electron-builder.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1669864776000,"frontMatter":{"title":"electron-builder"},"sidebar":"docs","previous":{"title":"Electron Browser","permalink":"/notes/web/framework/electron/browser"},"next":{"title":"Electron Dev","permalink":"/notes/web/framework/electron/dev"}}'),i=l(486106),s=l(917776);let t={title:"electron-builder"},d="electron-builder",c={},a=[{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:2},{value:"macOS",id:"macos",level:3},{value:"Windows",id:"windows",level:3},{value:"Publish",id:"publish",level:3},{value:"Icons",id:"icons",level:2},{value:"\u81EA\u52A8\u5347\u7EA7",id:"\u81EA\u52A8\u5347\u7EA7",level:2},{value:"electron-updater vs autoUpdater",id:"electron-updater-vs-autoupdater",level:2},{value:"blockmap",id:"blockmap",level:2}];function o(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"electron-builder",children:"electron-builder"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/electron-userland/electron-builder",children:"electron-userland/electron-builder"})}),"\n",(0,i.jsx)(e.li,{children:"\u6CE8\u610F .npmrc \u6216 .yarnrc \u914D\u7F6E\u597D mirror"}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{type:"caution",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["electron-builder \u63D0\u4F9B\u591A\u5E73\u53F0\u6253\u5305\uFF0C\u4F46\u4E0D\u8981\u671F\u671B\u80FD\u8DE8\u5E73\u53F0\u6784\u5EFA\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"node \u90E8\u5206\u5305\u9700\u8981\u7F16\u8BD1"}),"\n",(0,i.jsx)(e.li,{children:"dmg \u53EA\u80FD\u5728 mac \u4E0B\u624D\u80FD\u7B7E\u540D"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4F7F\u7528\u955C\u50CF\nexport ELECTRON_BUILDER_BINARIES_MIRROR=http://npm.taobao.org/mirrors/electron-builder-binaries/\n\nelectron-builder build --publish never\n\n# \u6784\u5EFA windows \u5355 exe - \u9ED8\u8BA4 nsis \u5B89\u88C5\nelectron-builder build --win portable\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"flag"}),(0,i.jsx)(e.th,{children:"default"}),(0,i.jsx)(e.th,{children:"mean"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--mac,-m,-o,--macos"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--linux,-l"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--win,-w,--windows"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--x64"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"x86_64"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--ia32"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"x86"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--armv7l"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--arm64"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--universal"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--dir"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"\u6784\u5EFA\u4E3A\u76EE\u5F55\uFF0C\u4E0D\u6253\u5305"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--prepackaged, --pd"}),(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--projectDir,--project"}),(0,i.jsx)(e.td,{children:"$PWD"}),(0,i.jsx)(e.td,{})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"--config,-c"}),(0,i.jsx)(e.td,{children:"electron-builder.yml"}),(0,i.jsx)(e.td,{children:"\u914D\u7F6E\u6587\u4EF6"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"electron-builder --linux deb tar.xz\nelectron-builder --win --ia32\nelectron-builder --win nsis-web --ia32\n# \u989D\u5916\u914D\u7F6E\nelectron-builder -c.extraMetadata.foo=bar\nelectron-builder --config.nsis.unicode=false\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4F1A\u4ECE package.json \u8BFB\u53D6\u90E8\u5206\u5143\u4FE1\u606F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"name"}),"\n",(0,i.jsx)(e.li,{children:"description"}),"\n",(0,i.jsx)(e.li,{children:"homepage"}),"\n",(0,i.jsx)(e.li,{children:"license"}),"\n",(0,i.jsx)(e.li,{children:"author: { name, email }"}),"\n",(0,i.jsx)(e.li,{children:"repository: string | { url }"}),"\n",(0,i.jsx)(e.li,{children:"build - \u914D\u7F6E"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u914D\u7F6E\u65B9\u5F0F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"packages.son \u4E2D build \u5B57\u6BB5"}),"\n",(0,i.jsx)(e.li,{children:"--config yaml-json5-toml-js"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u4F1A\u8BFB\u53D6 electron-builder.env \u73AF\u5883\u53D8\u91CF"}),"\n",(0,i.jsx)(e.li,{children:"macOS - mac, mas(Mac Application Store),dmg,pkg"}),"\n",(0,i.jsx)(e.li,{children:"windows - win,nsis, nsisWeb,appx,squirrelWindows"}),"\n",(0,i.jsx)(e.li,{children:"linux - linux,deb,snap,appImage,pacman,rpm,freebsd,p5p,apk"}),"\n",(0,i.jsxs)(e.li,{children:["${macro}\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"arch - x64, ia32, armv7l, arm64"}),"\n",(0,i.jsx)(e.li,{children:"os - mac,linux,win"}),"\n",(0,i.jsx)(e.li,{children:"platform - darwin,linux,win32 - Node process.platform"}),"\n",(0,i.jsx)(e.li,{children:"name - package.json name"}),"\n",(0,i.jsx)(e.li,{children:"productName"}),"\n",(0,i.jsx)(e.li,{children:"version - beta"}),"\n",(0,i.jsx)(e.li,{children:"channel"}),"\n",(0,i.jsx)(e.li,{children:"env.ENV_NAME"}),"\n",(0,i.jsx)(e.li,{children:"buildVersion, buildNumber - AppInfo"}),"\n",(0,i.jsx)(e.li,{children:"ext - exe - windows"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"appId: me.wener.desk.DeskAssistant\n# \u5305\u542B\u7684\u5185\u5BB9\n# \u53EF\u4EE5\u81EA\u5B9A\u4E49 { from, to, filter }\nfiles: ['dist', 'node_modules', 'package.json']\ndirectories:\n  app: build/app\n  buildResources: assets\n  output: build/release\n# macOS Contents/Resources \u76EE\u5F55, Windows.Linux resource \u76EE\u5F55\nextraResources: ['./assets/**']\n# macOS Contents \u76EE\u5F55, Windows,Linux \u6839\u76EE\u5F55\nextraFiles: []\npublish:\n  provider: github\n  owner: electron-react-boilerplate\n  repo: electron-react-boilerplate\nafterSign: '.erb/scripts/notarize.js'\nelectronDownload:\n"})}),"\n",(0,i.jsx)(e.h3,{id:"macos",children:"macOS"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"mac:\nmas:\ndmg:\npkg:\n"})}),"\n",(0,i.jsx)(e.h3,{id:"windows",children:"Windows"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u57FA\u4E8E appId \u6216 name \u8BA1\u7B97 guid"}),"\n",(0,i.jsx)(e.li,{children:"\u63A8\u8350\u4F7F\u7528 guid"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# Windows \u6784\u5EFA\u914D\u7F6E\nwin:\n  # nsis, nsis-web, portable, appx, msi, squirrel, 7z, zip, tar.xz, tar.lz, tar.gz, tar.bz2, dir\n  target:\n    - nsis\n    - target: nsis\n      arch:\n        - x64\n        - ia32\n  icon: build/icon.ico\n  # legalTrademarks:\nnsis:\n  oneClick: true\n  perMachine: false\n  allowElevation: true\n  allowToChangeInstallationDirectory: false\n\n  # Install\n  installerIcon: build/installerIcon.ico\n  uninstallerIcon: build/uninstallerIcon.ico\n  installerHeader: build/installerHeader.bmp\n  installerHeaderIcon: build/installerHeaderIcon.ico\n  # 164 \xd7 314\n  # ${NSISDIR}\\\\Contrib\\\\Graphics\\\\Wizard\\\\nsis3-metro.bmp\n  installerSidebar: build/installerSidebar.bmp\n  # build/installerSidebar.bmp\n  # ${NSISDIR}\\\\Contrib\\\\Graphics\\\\Wizard\\\\nsis3-metro.bmp\n  uninstallerSidebar: build/uninstallerSidebar.bmp\n  uninstallDisplayName: ${productName} ${version}\n\n  # Script\n  include: build/installer.nsh\n  script: build/installer.nsi\n  # {license,eula}.{txt,html}\n  # _zh,_en - \u652F\u6301\u591A\u8BED\u8A00\n  license:\n  artifactName: ${productName} Setup ${version}.${ext}\n  # one-click \u5B89\u88C5\u65F6\u662F\u5426\u5378\u8F7D\u65F6\u5220\u9664 app \u6570\u636E\n  deleteAppDataOnUninstall: false\n  # nsis-web\n  differentialPackage: true\n\n  # \u6B63\u5E38 installer \u8BED\u8A00\u914D\u7F6E\n  displayLanguageSelector: false\n  installerLanguages: []\n  # https://msdn.microsoft.com/en-au/goglobal/bb964664.aspx\n  # 1033 -> English - United States\n  language: 1033\n  multiLanguageInstaller:\n  packElevateHelper: true\n  preCompressedFileExtensions: ['.avi', '.mov', '.m4v', '.mp4', '.m4p', '.qt', '.mkv', '.webm', '.vmdk']\n  unicode: true\n  # \u4F7F\u7528 GUID \u800C\u4E0D\u662F\u5E94\u7528\u540D\u5B57\n  guid:\n  warningsAsErrors: true\n  runAfterFinish: true\n\n  createDesktopShortcut: true\n  createStartMenuShortcut: true\n  menuCategory: false\n  # \u9ED8\u8BA4\u5E94\u7528\u540D\u5B57\n  shortcutName:\nnsisWeb:\n  # \u9ED8\u8BA4\u901A\u8FC7 publish \u8BA1\u7B97\n  # \u81EA\u5B9A\u4E49 X-Arch \u5934\n  appPackageUrl: https://example.com/download/latest\n  artifactName: ${productName} Web Setup ${version}.${ext}\n  portable:\n  # user, highest, admin\n  requestExecutionLevel: user\n  # TEMP \u76EE\u5F55\u540D - \u9ED8\u8BA4 build uuid\n  unpackDirName:\nappx:\nsquirrelWindows:\n"})}),"\n",(0,i.jsx)(e.h3,{id:"publish",children:"Publish"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["provider\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["github - \u9ED8\u8BA4\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"env GH_TOKEN, GITHUB_TOKEN"}),"\n",(0,i.jsx)(e.li,{children:"repo, owner, vPrefixedTagName=true, host=github.com, protocol=https, token, private, releaseType=draft"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["PublishConfiguration\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"publishAutoUpdate=true"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["--publish - \u63A7\u5236\u4EC0\u4E48\u65F6\u5019\u53D1\u5E03\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"onTag"}),"\n",(0,i.jsx)(e.li,{children:"onTagOrDraft"}),"\n",(0,i.jsx)(e.li,{children:"always"}),"\n",(0,i.jsx)(e.li,{children:"never"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"publish:\n  - provider: s3 # env AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY\n    bucket:\n    endpoint: http://minio:3000\n    channel: latest\n    path: /\n    # public-read | private | null\n    acl: null\n    storageClass: STANDARD\n  - provider: generic\n    url:\n    channel: latest\n    useMultipleRangeRequest: true\nwin:\n  publish:\n    - github\n    - bintray\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"s3 acl"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "AllowAppS3Releases",\n      "Effect": "Allow",\n      "Action": [\n        "s3:AbortMultipartUpload",\n        "s3:GetObject",\n        "s3:GetObjectAcl",\n        "s3:GetObjectVersion",\n        "s3:ListMultipartUploadParts",\n        "s3:PutObject",\n        "s3:PutObjectAcl"\n      ],\n      "Resource": ["arn:aws:s3:::release-bucket/*"]\n    },\n    {\n      "Effect": "Allow",\n      "Action": ["s3:ListBucket", "s3:ListBucketMultipartUploads"],\n      "Resource": ["arn:aws:s3:::release-bucket"]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"icons",children:"Icons"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u653E\u5728 buildResources \u76EE\u5F55"}),"\n",(0,i.jsxs)(e.li,{children:["macOS\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"icon.icns, icon.png - 512x512"}),"\n",(0,i.jsxs)(e.li,{children:["background.png, ",(0,i.jsx)(e.a,{href:"mailto:background@2x.png",children:"background@2x.png"})," - DMG background"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Windows - NSIS\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"icon.ico, icon.png - 256x256"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Linux\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E Windows \u6216 macOS \u751F\u6210\u6216 build/icons \u76EE\u5F55"}),"\n",(0,i.jsx)(e.li,{children:"build/icons/iconXxX.png - 16,32,48,64,128,256,512 - \u6216\u8005\u53EA\u6709 512"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u81EA\u52A8\u5347\u7EA7",children:"\u81EA\u52A8\u5347\u7EA7"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"macOS DMG, Windows NSIS, Linux AppImage"}),"\n",(0,i.jsx)(e.li,{children:"macOS \u5FC5\u987B\u8981\u7B7E\u540D"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"// AppImageUpdater, MacUpdater, NsisUpdater\nimport { autoUpdater } from 'electron-updater';\n\nexport default class AppUpdater {\n  constructor() {\n    const log = require('electron-log');\n    log.transports.file.level = 'debug';\n    autoUpdater.logger = log;\n    autoUpdater.checkForUpdatesAndNotify();\n  }\n}\n\n// \u5185\u7F6E autoUpdater \u529F\u80FD\u66F4\u5F31\n// import { autoUpdater } from \"electron\"\n"})}),"\n",(0,i.jsx)(e.h2,{id:"electron-updater-vs-autoupdater",children:"electron-updater vs autoUpdater"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["autoUpdater\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5185\u7F6E"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 macOS \u7B7E\u540D\u8BA4\u8BC1"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["electron-updater\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E09\u65B9"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u9700\u8981\u4E13\u95E8\u7684 \u53D1\u5E03 \u670D\u52A1\u5668"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 Windows \u548C macOS \u7B7E\u540D\u8BA4\u8BC1"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u52A8\u751F\u6210\u6240\u6709\u5143\u6570\u636E\u6587\u4EF6\u548C\u5347\u7EA7\u6587\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"\u6240\u6709\u5E73\u53F0\u652F\u6301\u4E0B\u8F7D\u8FDB\u5EA6\u548C\u90E8\u5206\u5347\u7EA7"}),"\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u652F\u6301\u8F83\u591A provider - github release, s3, http"}),"\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\u7B80\u5355"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"blockmap",children:"blockmap"}),"\n",(0,i.jsx)(e.p,{children:"\u5305\u5185\u5BB9\u5217\u8868\uFF0C\u5185\u5BB9 hash \u503C\uFF0C\u5347\u7EA7\u65F6\u7528\u4E8E\u5BF9\u6BD4\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/electron-userland/electron-builder/issues/2851",children:"electron-userland/electron-builder#2851"}),"\nWhat is the purpose of blockmap file?"]}),"\n"]})]})}function u(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},917776:function(n,e,l){l.d(e,{R:()=>t,x:()=>d});var r=l(7378);let i={},s=r.createContext(i);function t(n){let e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);