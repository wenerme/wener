"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["50311"],{99742:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>c,default:()=>p,metadata:()=>i,assets:()=>o,contentTitle:()=>a});var i=JSON.parse('{"id":"web/nodejs/npm-faq","title":"NPM FAQ","description":"\u73AF\u5883\u53D8\u91CF","source":"@site/../notes/web/nodejs/npm-faq.md","sourceDirName":"web/nodejs","slug":"/web/nodejs/npm-faq","permalink":"/notes/web/nodejs/npm-faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/nodejs/npm-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1696577752000,"frontMatter":{"title":"NPM FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"nodemon","permalink":"/notes/web/nodejs/nodemon"},"next":{"title":"NPM Version","permalink":"/notes/web/nodejs/npm-version"}}'),l=s(86106),t=s(17776);let r={title:"NPM FAQ",tags:["FAQ"]},a="NPM FAQ",o={},c=[{value:"\u73AF\u5883\u53D8\u91CF",id:"\u73AF\u5883\u53D8\u91CF",level:2},{value:"lockfileVersion: 2 install script",id:"lockfileversion-2-install-script",level:2},{value:"speed up npm ci",id:"speed-up-npm-ci",level:2},{value:"\u67E5\u770B native \u6A21\u5757\u4F9D\u8D56",id:"\u67E5\u770B-native-\u6A21\u5757\u4F9D\u8D56",level:2},{value:"ENOTEMPTY: directory not empty, rename",id:"enotempty-directory-not-empty-rename",level:2},{value:"global permission deined",id:"global-permission-deined",level:2},{value:"package",id:"package",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"npm-faq",children:"NPM FAQ"})}),"\n",(0,l.jsx)(n.h2,{id:"\u73AF\u5883\u53D8\u91CF",children:"\u73AF\u5883\u53D8\u91CF"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"npm_config_*"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.npmjs.com/cli/v9/using-npm/config#environment-variables",children:"https://docs.npmjs.com/cli/v9/using-npm/config#environment-variables"})}),"\n",(0,l.jsxs)(n.li,{children:["NPM_CONFIG_REGISTRY\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Yarn \u65E0 ",(0,l.jsx)(n.a,{href:"https://github.com/yarnpkg/yarn/issues/2091",children:"https://github.com/yarnpkg/yarn/issues/2091"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"lockfileversion-2-install-script",children:"lockfileVersion: 2 install script"}),"\n",(0,l.jsx)(n.p,{children:"\u6CA1\u6709 hasInstallScript\uFF0C\u5BFC\u81F4\u6CA1\u6709\u8C03\u7528\u5B89\u88C5\u811A\u672C\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npx fix-has-install-script\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:'title="ESBuild"',children:"# \u5728\u4E0D\u4FEE\u6539 packages-lock.json \u7684\u60C5\u51B5\u4E0B\u624B\u52A8\u5B89\u88C5\u662F\u6700\u7B80\u5355\u7684\nnode ./node_modules/esbuild/install.js\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/npm/cli/issues/2606",children:"npm/cli#2606"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"speed-up-npm-ci",children:"speed up npm ci"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# --cache $PWD/.cache \u786E\u4FDD\u5229\u7528\u7F13\u5B58\n# --only=production \u4E0D\u5B89\u88C5 dev - \u770B\u60C5\u51B5 - \u4F8B\u5982 \u57FA\u7840\u5BB9\u5668\u5DF2\u7ECF\u5305\u542B\n# --silent\nnpm ci --prefer-offline --no-audit\n\n# \u6216\u8005\u8FD8\u662F\u76F4\u63A5\u7528 install - \u4FDD\u7559\u73B0\u6709 node_modules\nnpm install --no-fund --no-audit\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u67E5\u770B-native-\u6A21\u5757\u4F9D\u8D56",children:"\u67E5\u770B native \u6A21\u5757\u4F9D\u8D56"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'find node_modules -type f -name "*.node" 2> /dev/null | grep -v "obj\\.target" | xargs ldd\n\nnpx native-modules\n'})}),"\n",(0,l.jsx)(n.h2,{id:"enotempty-directory-not-empty-rename",children:"ENOTEMPTY: directory not empty, rename"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5C1D\u8BD5\u5220\u9664"}),"\n",(0,l.jsx)(n.li,{children:"\u5C1D\u8BD5 --force"}),"\n",(0,l.jsx)(n.li,{children:"\u5C1D\u8BD5\u65B0\u7248\u672C"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -g npm\n"})}),"\n",(0,l.jsx)(n.h2,{id:"global-permission-deined",children:"global permission deined"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. chown\nsudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}\n\n# 2. \u4FEE\u6539 prefix\nnpm config get prefix # \u5F53\u524D prefix\n\nmkdir -p ~/.npm-global\nnpm config set prefix ~/.npm-global\n# NPM_CONFIG_PREFIX\nexport PATH=~/.npm-global/bin:$PATH\n"})}),"\n",(0,l.jsx)(n.h2,{id:"package",children:"package"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u53D1\u5E03 tgz\nnpm --registry=http://nxrm.local/repository/npm-hosted publish package.tgz\n\n# \u76F4\u63A5\u4E0A\u4F20\ncurl -u user:password -X POST "http://localhost:8081/service/rest/v1/components?repository=npm-private" -H "accept: application/json" -H "Content-Type: multipart/form-data" -F "npm.asset=@my-npm-package-0.0.0.tgz;type=application/x-compressed"\n\n# \u4E0B\u8F7D\ncurl -LO $(npm view lodash \'dist.tarball\')\n'})})]})}function p(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},17776:function(e,n,s){s.d(n,{R:()=>r,x:()=>a});var i=s(7378);let l={},t=i.createContext(l);function r(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);