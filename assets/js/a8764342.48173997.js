"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["724403"],{17429:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>o,default:()=>u,metadata:()=>s,assets:()=>c,contentTitle:()=>l});var s=JSON.parse('{"id":"devops/kubernetes/k8s-start","title":"Kubernetes Getting Started","description":"- Deploying Kubernetes on Raspberry Pi","source":"@site/../notes/devops/kubernetes/k8s-start.md","sourceDirName":"devops/kubernetes","slug":"/devops/kubernetes/start","permalink":"/notes/devops/kubernetes/start","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/k8s-start.md","tags":[{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Kubernetes","permalink":"/notes/tags/kubernetes"},{"inline":true,"label":"Guide","permalink":"/notes/tags/guide"},{"inline":true,"label":"kubeadm","permalink":"/notes/tags/kubeadm"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Kubernetes Getting Started","tags":["DevOps","Kubernetes","Guide","kubeadm"]},"sidebar":"docs","previous":{"title":"Kubernetes Best Practices","permalink":"/notes/devops/kubernetes/practice"},"next":{"title":"K8S \u4F7F\u7528\u7ECF\u9A8C","permalink":"/notes/devops/kubernetes/story"}}'),r=t(486106),i=t(917776);let a={title:"Kubernetes Getting Started",tags:["DevOps","Kubernetes","Guide","kubeadm"]},l="Kubernetes Getting Started",c={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Docker Configuration",id:"docker-configuration",level:3},{value:"System Configuration",id:"system-configuration",level:3},{value:"Installation",id:"installation",level:2},{value:"Cluster Initialization",id:"cluster-initialization",level:2},{value:"Configure kubectl",id:"configure-kubectl",level:3},{value:"Networking (CNI)",id:"networking-cni",level:2},{value:"Adding Worker Nodes",id:"adding-worker-nodes",level:2},{value:"Verification",id:"verification",level:2},{value:"Create Namespace",id:"create-namespace",level:3},{value:"Deploy Verification App",id:"deploy-verification-app",level:3},{value:"Expose Service",id:"expose-service",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kubernetes-getting-started",children:"Kubernetes Getting Started"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://opensource.com/article/20/6/kubernetes-raspberry-pi",children:"Deploying Kubernetes on Raspberry Pi"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.h3,{id:"docker-configuration",children:"Docker Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Check Docker info:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker info\n"})}),"\n",(0,r.jsx)(n.p,{children:"Configure Docker daemon:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo cat > /etc/docker/daemon.json << EOF\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2"\n}\nEOF\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Enable cgroups in ",(0,r.jsx)(n.code,{children:"/boot/cmdline.txt"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1 swapaccount=1\n"})}),"\n",(0,r.jsx)(n.h3,{id:"system-configuration",children:"System Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Enable net.bridge.bridge-nf-call-iptables and -iptables6\ncat << EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsudo sysctl --system\n"})}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt install -y kubelet kubeadm kubectl\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cluster-initialization",children:"Cluster Initialization"}),"\n",(0,r.jsx)(n.p,{children:"Generate token:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"TOKEN=$(sudo kubeadm token generate)\necho $TOKEN\n"})}),"\n",(0,r.jsx)(n.p,{children:"Initialize control plane:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm init --token=${TOKEN} --kubernetes-version=v1.18.2 --pod-network-cidr=10.244.0.0/16\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configure-kubectl",children:"Configure kubectl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsx)(n.h2,{id:"networking-cni",children:"Networking (CNI)"}),"\n",(0,r.jsx)(n.p,{children:"Deploy Flannel:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -sSL https://raw.githubusercontent.com/coreos/flannel/v0.12.0/Documentation/kube-flannel.yml | kubectl apply -f -\n"})}),"\n",(0,r.jsx)(n.h2,{id:"adding-worker-nodes",children:"Adding Worker Nodes"}),"\n",(0,r.jsx)(n.p,{children:"Run the join command on worker nodes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm join <control-plane-host>:6443 --token <token> --discovery-token-ca-cert-hash sha256:<hash>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,r.jsx)(n.h3,{id:"create-namespace",children:"Create Namespace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace kube-verify\nkubectl get namespaces\n"})}),"\n",(0,r.jsx)(n.h3,{id:"deploy-verification-app",children:"Deploy Verification App"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat << EOF | kubectl create -f -\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: kube-verify\n  namespace: kube-verify\n  labels:\n    app: kube-verify\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: kube-verify\n  template:\n    metadata:\n      labels:\n        app: kube-verify\n    spec:\n      containers:\n      - name: nginx\n        image: quay.io/clcollins/kube-verify:01\n        ports:\n        - containerPort: 8080\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"Check deployment:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get all -n kube-verify\n"})}),"\n",(0,r.jsx)(n.h3,{id:"expose-service",children:"Expose Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat << EOF | kubectl create -f -\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-verify\n  namespace: kube-verify\nspec:\n  selector:\n    app: kube-verify\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"Test access:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl <service-ip>\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>l});var s=t(7378);let r={},i=s.createContext(r);function a(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);