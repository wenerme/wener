"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["140095"],{136282:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>s,assets:()=>c,contentTitle:()=>d});var s=JSON.parse('{"id":"devops/kubernetes/internal/k8s-hpa","title":"HPA","description":"HPA","source":"@site/../notes/devops/kubernetes/internal/k8s-hpa.md","sourceDirName":"devops/kubernetes/internal","slug":"/devops/kubernetes/internal/k8s-hpa","permalink":"/notes/devops/kubernetes/internal/k8s-hpa","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/internal/k8s-hpa.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1772243505000,"frontMatter":{"title":"HPA"},"sidebar":"docs","previous":{"title":"Kubernetes DNS","permalink":"/notes/devops/kubernetes/internal/k8s-dns"},"next":{"title":"Kubernetes \u6807\u7B7E","permalink":"/notes/devops/kubernetes/internal/k8s-labels"}}'),t=i(486106),l=i(917776);let r={title:"HPA"},d,c={},a=[{value:"HPA",id:"hpa",level:2}];function o(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"hpa",children:"HPA"}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5148\u5199 memory \u518D\u5199 cpu\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u907F\u514D argocd diff \u51FA\u73B0\u95EE\u9898\uFF0C\u5E8F\u5217\u5316\u987A\u5E8F\u95EE\u9898"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u8D44\u6E90\u4F7F\u7528\u7387\u57FA\u4E8E requests \u8BA1\u7B97\uFF0C\u800C\u4E0D\u662F limits"}),"\n",(0,t.jsxs)(n.li,{children:["Pod \u5982\u679C OOM Killed \u4F1A\u5BFC\u81F4\u65E0\u6CD5\u83B7\u53D6 metrics \u65E0\u6CD5\u89E6\u53D1 HPA \u53EF\u80FD\u9020\u6210\u96EA\u5D29\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u526F\u672C\u6570\u91CF\u548C utilization \u8C03\u6574\u907F\u514D\u51FA\u73B0\u8FD9\u6837\u95EE\u9898"}),"\n",(0,t.jsx)(n.li,{children:"\u4F8B\u5982 3Pod, utilization 60%, \u7A81\u7136\u6765\u6D41\u91CF, \u6302\u4E86\u4E00\u4E2A, \u5269\u4E0B 2Pod, \u5219\u9700\u8981 utilization 90% \u624D\u80FD\u89E6\u53D1\u6269\u5BB9"}),"\n",(0,t.jsx)(n.li,{children:"OOM Killed \u7684 Pod \u8FDB\u5165 CrashLoopBackOff\uFF0Cmetrics \u7F3A\u5931\u65F6 HPA \u6309 0% \u5229\u7528\u7387\u8BA1\u7B97\uFF08scale-up \u573A\u666F\uFF09\uFF0C\u62C9\u4F4E\u6574\u4F53\u5E73\u5747\u503C\uFF0C\u5BFC\u81F4\u66F4\u96BE\u89E6\u53D1\u6269\u5BB9\u3002"}),"\n"]}),"\n"]}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"API Version"}),(0,t.jsx)(n.th,{style:{textAlign:"right"},children:"K8S"}),(0,t.jsx)(n.th,{children:"\u8BF4\u660E"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"autoscaling/v1"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:"1.1+"}),(0,t.jsx)(n.td,{children:"\u4EC5\u652F\u6301 CPU\uFF0CtargetCPUUtilizationPercentage"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"autoscaling/v2beta1"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:"1.12+"}),(0,t.jsx)(n.td,{children:"\u652F\u6301\u591A\u6307\u6807"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"autoscaling/v2beta2"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:"1.16+"}),(0,t.jsx)(n.td,{children:"\u589E\u52A0 behavior \u914D\u7F6E"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"autoscaling/v2"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:"1.23+"}),(0,t.jsx)(n.td,{children:"\u6B63\u5F0F\u7248\uFF0C\u63A8\u8350\u4F7F\u7528"})]})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"v1.16 \u540E\u5141\u8BB8 minReplicas=0"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#horizontalpodautoscaler-v2-autoscaling",children:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#horizontalpodautoscaler-v2-autoscaling"})}),"\n",(0,t.jsxs)(n.li,{children:["metrics\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["type\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ContainerResource\uFF1A\u9488\u5BF9\u7279\u5B9A\u5BB9\u5668\u7684\u8D44\u6E90\uFF08\u5982 CPU\u3001\u5185\u5B58\uFF09\u8FDB\u884C\u4F38\u7F29\uFF0C\u9002\u7528\u4E8E\u591A\u5BB9\u5668 Pod \u573A\u666F\u3002"}),"\n",(0,t.jsx)(n.li,{children:"Resource\uFF1A\u6839\u636E Pod \u6574\u4F53\u8D44\u6E90\uFF08\u5982 CPU\u3001\u5185\u5B58\uFF09\u5229\u7528\u7387\u8FDB\u884C\u4F38\u7F29\uFF0C\u662F\u6700\u5E38\u7528\u7684\u7C7B\u578B\u3002"}),"\n",(0,t.jsx)(n.li,{children:"Pods\uFF1A\u6839\u636E\u6BCF\u4E2A Pod \u7684\u81EA\u5B9A\u4E49\u6307\u6807\uFF08\u5982\u8BF7\u6C42\u6570\u3001\u961F\u5217\u957F\u5EA6\uFF09\u8FDB\u884C\u4F38\u7F29\uFF0C\u9700\u5728 Pod \u5185\u66B4\u9732\u6307\u6807\u3002"}),"\n",(0,t.jsx)(n.li,{children:"Object\uFF1A\u6839\u636E\u5176\u4ED6 Kubernetes \u5BF9\u8C61\u7684\u6307\u6807\uFF08\u5982 Service \u7684 QPS\uFF09\u8FDB\u884C\u4F38\u7F29\uFF0C\u9700\u914D\u7F6E\u6307\u6807\u6765\u6E90\u5BF9\u8C61\u3002"}),"\n",(0,t.jsx)(n.li,{children:"External\uFF1A\u6839\u636E\u96C6\u7FA4\u5916\u90E8\u7CFB\u7EDF\u7684\u6307\u6807\uFF08\u5982\u4E91\u670D\u52A1\u76D1\u63A7\u3001\u7B2C\u4E09\u65B9 API\uFF09\u8FDB\u884C\u4F38\u7F29\uFF0C\u9700\u914D\u7F6E\u5916\u90E8\u6307\u6807\u6E90\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["containerResource\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53EF\u4EE5\u9009\u62E9\u76EE\u6807 container"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"resource"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["target\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"type - Utilization, Value, AverageValue"}),"\n",(0,t.jsx)(n.li,{children:"averageUtilization - \u6240\u6709 Pod - \u53EA\u80FD Resource"}),"\n",(0,t.jsx)(n.li,{children:"averageValue"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["behavior - scaleDown, scaleUp\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["policies\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"type: Pods"}),"\n",(0,t.jsx)(n.li,{children:"value - \u6BCF\u6B21\u53D8\u5316\u7684 Pod \u6570\u91CF"}),"\n",(0,t.jsxs)(n.li,{children:["periodSeconds - \u95F4\u9694\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"0-1800"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"selectPolicy=Max"}),"\n",(0,t.jsxs)(n.li,{children:["stabilizationWindowSeconds\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"0-3600"}),"\n",(0,t.jsx)(n.li,{children:"up \u9ED8\u8BA4 0"}),"\n",(0,t.jsx)(n.li,{children:"down \u9ED8\u8BA4 300 - 5 \u5206\u949F"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u8868\u8FF0\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6269\u5BB9: \u7B49\u5F850\u79D2\u7ACB\u5373\u54CD\u5E94\uFF0C\u6BCF\u6B21\u6269\u5BB91\u4E2APod\uFF0C\u7136\u540E\u7B49\u5F852\u5206\u949F\u518D\u6B21\u8BC4\u4F30"}),"\n",(0,t.jsx)(n.li,{children:"\u7F29\u5BB9: \u7B49\u5F855\u5206\u949F\u786E\u8BA4\u8D1F\u8F7D\u4E0B\u964D\uFF0C\u6BCF\u6B21\u7F29\u5BB91\u4E2APod\uFF0C\u7136\u540E\u7B49\u5F852\u5206\u949F\u518D\u6B21\u8BC4\u4F30"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: server\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: server\n  minReplicas: 2\n  maxReplicas: 10\n  metrics:\n    - type: Resource # Resource\u3001Pods\u3001Object\u3001External\n      resource:\n        name: cpu\n        target:\n          type: Utilization\n          averageUtilization: 50\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"desiredReplicas = ceil[currentReplicas * ( currentMetricValue / desiredMetricValue )]\n"})})]})}function h(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},917776:function(e,n,i){i.d(n,{R:()=>r,x:()=>d});var s=i(7378);let t={},l=s.createContext(t);function r(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);