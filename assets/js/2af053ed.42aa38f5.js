"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["90794"],{45463:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>o,metadata:()=>l,assets:()=>c,contentTitle:()=>d});var l=JSON.parse('{"id":"db/relational/sqlite/libsql","title":"libsql","description":"- \u652F\u6301 replica sync - read \u8BBF\u95EE\u672C\u5730 sqlite\uFF0Cwrite \u8BBF\u95EE\u8FDC\u7A0B","source":"@site/../notes/db/relational/sqlite/libsql.md","sourceDirName":"db/relational/sqlite","slug":"/db/relational/sqlite/libsql","permalink":"/notes/db/relational/sqlite/libsql","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/sqlite/libsql.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1737304142000,"frontMatter":{"title":"libsql"},"sidebar":"docs","previous":{"title":"SQLite","permalink":"/notes/db/relational/sqlite/"},"next":{"title":"litefs","permalink":"/notes/db/relational/sqlite/litefs"}}'),i=s(86106),t=s(17776);let r={title:"libsql"},d="libsql",c={},a=[{value:"sqld",id:"sqld",level:2},{value:"Notes",id:"notes",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"libsql",children:"libsql"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 replica sync - read \u8BBF\u95EE\u672C\u5730 sqlite\uFF0Cwrite \u8BBF\u95EE\u8FDC\u7A0B"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 CS \u7ED3\u6784"}),"\n",(0,i.jsxs)(n.li,{children:["\u652F\u6301\u534F\u8BAE\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"HTTP"}),"\n",(0,i.jsx)(n.li,{children:"WebSocket"}),"\n",(0,i.jsx)(n.li,{children:"SQLite API - embed"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql",children:"tursodatabase/libsql"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MIT, C"}),"\n",(0,i.jsx)(n.li,{children:"fork of SQLite"}),"\n",(0,i.jsx)(n.li,{children:"SQLite ABI"}),"\n",(0,i.jsx)(n.li,{children:"SQLite C API"}),"\n",(0,i.jsx)(n.li,{children:"PostgreSQL wire protocol"}),"\n",(0,i.jsx)(n.li,{children:"backend SQLite, mvSQLite/FoundationDB"}),"\n",(0,i.jsx)(n.li,{children:"\u793E\u533A\u8FD0\u8425\uFF0C\u63A5\u53D7\u8D21\u732E"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql/blob/main/libsql-sqlite3/doc/libsql_extensions.md",children:"\u7279\u6027"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ALTER TABLE ... ALTER COLUMN ..."})}),"\n",(0,i.jsx)(n.li,{children:"WASM UDF"}),"\n",(0,i.jsx)(n.li,{children:"RANDOM ROWID"}),"\n",(0,i.jsx)(n.li,{children:"Virtual WAL - \u53EF\u4EE5 hook WAL \u5B9E\u73B0"}),"\n",(0,i.jsx)(n.li,{children:"libsql_close_hook"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql/tree/main/libsql-server",children:"tursodatabase/libsql/libsql-server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MIT, Rust"}),"\n",(0,i.jsx)(n.li,{children:"\u670D\u52A1\u7AEF"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql-client-ts",children:"tursodatabase/libsql-client-ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql-client-go",children:"tursodatabase/libsql-client-go"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql-client-rs",children:"tursodatabase/libsql-client-rs"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql-js",children:"tursodatabase/libsql-js"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"better sqlite API"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["DataGrip \u652F\u6301 ",(0,i.jsx)(n.a,{href:"https://youtrack.jetbrains.com/issue/DBE-21330",children:"DBE-21330"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u6269\u5C55 ",(0,i.jsx)(n.a,{href:"https://docs.turso.tech/libsql#extensions",children:"https://docs.turso.tech/libsql#extensions"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'brew install libsql\nsqld --http-listen-addr 0.0.0.0:8080 --grpc-listen-addr 0.0.0.0:5001 --db-path ./db/ --admin-listen-addr 0.0.0.0:8088 --enable-namespaces\n# \u670D\u52A1\u7AEF\u7684 DB\nsqlite3 db/dbs/default/data ".table"\n\n# HTTP\ncurl -d \'{"statements": ["SELECT * FROM users"]}\' 127.0.0.1:8080\n\n# Multitenancy\n# AMIN\ncurl -X POST http://localhost:8088/v1/namespaces/wener/create -v --json \'{}\'\n# wener.local \u4F1A\u4ECE host \u83B7\u53D6 namespace - \u56E0\u4E3A grpc \u9ED8\u8BA4\u60C5\u51B5\u4E0D\u652F\u6301 path\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { createClient } from '@libsql/client';\n\nconst client = createClient({\n  url: 'http://localhost:8080',\n});\n\nawait client.execute('CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT)');\nawait client.execute('INSERT INTO users (name) VALUES (?)', ['Alice']);\nconst result = await client.execute('SELECT * FROM users');\nconsole.log(result.rows);\n\n// \u672C\u5730\u526F\u672C\nconst client = createClient({\n  url: 'file:path/to/db-file.db',\n  authToken: '...',\n  syncUrl: '...',\n  syncInterval: 60,\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sqld",children:"sqld"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql/tree/main/libsql-server",children:"tursodatabase/libsql/libsql-server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MIT, Rust"}),"\n",(0,i.jsx)(n.li,{children:"\u670D\u52A1\u7AEF"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Docker"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"env"}),(0,i.jsx)(n.th,{children:"for"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_HTTP_AUTH"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"basic:${base64('user:pass')}"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_AUTH_JWT_KEY_FILE"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_AUTH_JWT_KEY"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_DB_PATH"}),(0,i.jsx)(n.td,{children:"iku.db"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_NODE"}),(0,i.jsx)(n.td,{children:"primary/replica/standalone"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_PRIMARY_URL"}),(0,i.jsxs)(n.td,{children:["for replica, gRPC URL, ",(0,i.jsx)(n.code,{children:"https://<host>:<port>"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_HTTP_LISTEN_ADDR"}),(0,i.jsx)(n.td,{children:"0.0.0.0:8080"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_GRPC_LISTEN_ADDR"}),(0,i.jsx)(n.td,{children:"0.0.0.0:5001"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLD_HEARTBEAT_URL"}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# -e SQLD_NODE=replica\ndocker run --rm -it \\\n  -v $PWD/data:/var/lib/sqld \\\n  -p 8080:8080 \\\n  -e SQLD_NODE=primary \\\n  --name sqld ghcr.io/tursodatabase/libsql-server:latest\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql/blob/main/docs/DOCKER.md",children:"https://github.com/tursodatabase/libsql/blob/main/docs/DOCKER.md"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["ADMIN\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /v1/namespaces/:namespace/create"})," ",(0,i.jsx)(n.code,{children:'{"dump_url":""}'})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DELETE /v1/namespaces/:namespace"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"POST /v1/namespaces/:namespace/fork/:to"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"replica sync \u9700\u8981\u672C\u5730\u5B58\u50A8"}),"\n",(0,i.jsx)(n.li,{children:"frame = 4kB"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/tursodatabase/libsql/blob/main/docs/USER_GUIDE.md",children:"https://github.com/tursodatabase/libsql/blob/main/docs/USER_GUIDE.md"})}),"\n"]})]})}function o(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},17776:function(e,n,s){s.d(n,{R:()=>r,x:()=>d});var l=s(7378);let i={},t=l.createContext(i);function r(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);