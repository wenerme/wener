"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["856226"],{291591:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>c,toc:()=>o,default:()=>h,metadata:()=>l,assets:()=>d,contentTitle:()=>t});var l=JSON.parse('{"id":"devops/kubernetes/network/network","title":"Kubernates \u7F51\u7EDC","description":"\u7F51\u7EDC\u8BBE\u8BA1","source":"@site/../notes/devops/kubernetes/network/README.md","sourceDirName":"devops/kubernetes/network","slug":"/devops/kubernetes/network/","permalink":"/notes/devops/kubernetes/network/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/network/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1629019137000,"frontMatter":{"id":"network","title":"Kubernates \u7F51\u7EDC"},"sidebar":"docs","previous":{"title":"Kubernetes \u7248\u672C","permalink":"/notes/devops/kubernetes/version"},"next":{"title":"Apisix Ingress","permalink":"/notes/devops/kubernetes/network/apisix-ingress"}}'),r=s(486106),i=s(917776);let c={id:"network",title:"Kubernates \u7F51\u7EDC"},t="Kubernates Network",d={},o=[{value:"\u7F51\u7EDC\u8BBE\u8BA1",id:"\u7F51\u7EDC\u8BBE\u8BA1",level:2},{value:"\u8D44\u6E90",id:"\u8D44\u6E90",level:2},{value:"\u96C6\u7FA4\u7F51\u7EDC",id:"\u96C6\u7FA4\u7F51\u7EDC",level:2},{value:"\u670D\u52A1\u53D1\u73B0",id:"\u670D\u52A1\u53D1\u73B0",level:2},{value:"resolv.conf",id:"resolvconf",level:2},{value:"\u670D\u52A1\u7F51\u7EDC",id:"\u670D\u52A1\u7F51\u7EDC",level:2},{value:"ClusterIP",id:"clusterip",level:3},{value:"NodePort",id:"nodeport",level:3},{value:"LoadBalancer",id:"loadbalancer",level:3},{value:"Ingress",id:"ingress",level:3},{value:"ExternalName",id:"externalname",level:3},{value:"ExternalIPs",id:"externalips",level:3},{value:"FAQ",id:"faq",level:2},{value:"NodePort vs HostPort vs HostNetwork",id:"nodeport-vs-hostport-vs-hostnetwork",level:3}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kubernates-network",children:"Kubernates Network"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7F51\u7EDC\u8BBE\u8BA1",children:"\u7F51\u7EDC\u8BBE\u8BA1"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7269\u7406\u7F51\u7EDC - Phycial Net - OS Net\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8282\u70B9\u4E4B\u9645\u7F51\u7EDC\u901A\u4FE1"}),"\n",(0,r.jsx)(n.li,{children:"\u5BBF\u4E3B\u673A\u5B9E\u9645\u7F51\u7EDC - \u4F8B\u5982 eth0"}),"\n",(0,r.jsx)(n.li,{children:"\u5730\u5740\u4E3A node-ip"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5BB9\u5668\u7F51\u7EDC - Pod Net\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5BB9\u5668\u4E4B\u95F4\u4E92\u901A\u7684\u7F51\u7EDC"}),"\n",(0,r.jsx)(n.li,{children:"\u6BCF\u4E2A\u5BB9\u5668\u90FD\u6709\u552F\u4E00\u72EC\u7ACB IP"}),"\n",(0,r.jsx)(n.li,{children:"\u901A\u5E38\u5B9E\u73B0\u662F\u4E00\u4E2A\u8282\u70B9\u4E00\u4E2A\u5B50\u7F51\uFF0C\u8BA9\u7ED9 Pod \u5206\u914D\u5B50\u7F51\u8FDB\u884C\u901A\u4FE1"}),"\n",(0,r.jsx)(n.li,{children:"Pod \u7F51\u7EDC\u6D41\u91CF\u5728\u7269\u7406\u7F51\u7EDC\u4E0A\u770B\u4E0D\u5230 - \u4F8B\u5982 eth0 \u4E0A\u770B\u4E0D\u5230"}),"\n",(0,r.jsxs)(n.li,{children:["CNI - Container Network Interface - \u5BB9\u5668\u7F51\u7EDC\u63A5\u53E3 - \u6807\u51C6\u5316\u4E86\u5BB9\u5668\u4E4B\u95F4\u7F51\u7EDC\u5B9E\u73B0\u63A5\u53E3\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JSON \u914D\u7F6E - \u63D2\u4EF6\u5316"}),"\n",(0,r.jsx)(n.li,{children:"kubelet \u5728\u6BCF\u6B21\u542F\u52A8 pod \u524D\u90FD\u4F1A\u8C03\u7528 cni \u63D2\u4EF6"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/etc/cni/net.d"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/opt/cni/bin"})}),"\n",(0,r.jsxs)(n.li,{children:["\u5E38\u89C1\u540E\u7AEF\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"linux-bridge"}),"\n",(0,r.jsx)(n.li,{children:"ipvlan"}),"\n",(0,r.jsx)(n.li,{children:"macvlan"}),"\n",(0,r.jsx)(n.li,{children:"Open vSwitch"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u6709\u975E\u5E38\u591A\u4E0D\u540C\u7684\u5B9E\u73B0\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"flannel - \u4F1A\u5728\u8282\u70B9\u4E0A\u521B\u5EFA flannel1.1 \u7F51\u5361\u6765\u901A\u4FE1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u670D\u52A1\u7F51\u7EDC - Service Net\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u96C6\u7FA4\u5185\u90E8\u670D\u52A1\u53D1\u73B0\u3001\u6D41\u91CF\u5206\u53D1"}),"\n",(0,r.jsx)(n.li,{children:"\u670D\u52A1\u53D1\u73B0 - \u4F8B\u5982 nginx.default.svc.cluser.local \u57DF\u540D"}),"\n",(0,r.jsx)(n.li,{children:"\u6CA1\u6709\u8BBF\u95EE\u63A7\u5236\u3001\u6CA1\u6709\u6D41\u91CF\u63A7\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u865A\u62DF\u5730\u5740 - VIP - Virtual IP"}),"\n",(0,r.jsxs)(n.li,{children:["\u4E09\u79CD\u6A21\u5F0F\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ClusterIP"}),"\n",(0,r.jsx)(n.li,{children:"LoadBalancer"}),"\n",(0,r.jsx)(n.li,{children:"NodePort"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["kube-proxy - \u914D\u7F6E iptables \u66B4\u9732\u670D\u52A1\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u901A\u8FC7\u4FEE\u6539 iptables \u6765\u5B9E\u73B0\u6D41\u91CF\u8F6C\u53D1"}),"\n",(0,r.jsx)(n.li,{children:"iptables \u6307\u5411\u6BCF\u4E2A endpoint"}),"\n",(0,r.jsx)(n.li,{children:"\u6BCF\u4E2A\u5305\u6253\u968F\u673A\u6570\u7528\u6765\u5B9E\u73B0\u8D1F\u8F7D - \u4F46\u4E0D\u7CBE\u786E"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["iptables-save \u4F1A\u770B\u5230 ",(0,r.jsx)(n.code,{children:"KUBE-SERVICE"})," \u76F8\u5173\u7684\u89C4\u5219"]}),"\n",(0,r.jsx)(n.li,{children:"service-cird \u6307\u5B9A\u4E86 ClusterIP \u7684\u5730\u5740\u6BB5"}),"\n",(0,r.jsx)(n.li,{children:"\u670D\u52A1\u4E4B\u4E0B\u4E3A Endpoint - \u901A\u5E38\u4E3A Pod\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5B9A\u4E49 Endpoint"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Ingress\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Kubernates \u7684\u7F51\u7EDC\u5165\u53E3\uFF0C\u5C06\u670D\u52A1\u66B4\u9732\u5230\u5916\u90E8"}),"\n",(0,r.jsx)(n.li,{children:"\u76F4\u63A5\u4E0E Pod \u901A\u4FE1\u800C\u4E0D\u662F\u4E0E\u670D\u52A1\u901A\u4FE1"}),"\n",(0,r.jsx)(n.li,{children:"\u901A\u5E38\u4E3A 7 \u5C42 HTTP - \u90E8\u5206\u652F\u6301 4 \u5C42 TCP"}),"\n",(0,r.jsx)(n.li,{children:"\u5927\u591A\u5B9E\u73B0\u4E5F\u652F\u6301 CRD \u65B9\u5F0F\uFF0C\u652F\u6301\u66F4\u590D\u6742\u7684\u5B9A\u4E49\u903B\u8F91"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Egress - \u51FA\u53E3\u6D41\u91CF\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4F7F\u7528\u8F83\u5C11\uFF0C\u76EE\u524D calico \u652F\u6301"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=H5Zl_kDOwBU",children:"The Easy--Don't Drive Yourself Crazy--Way to Kubernetes Networking [B] - Gerard Hickey"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://itnext.io/an-illustrated-guide-to-kubernetes-networking-part-1-d1ede3322727",children:"An illustrated guide to Kubernetes Networking"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u8D44\u6E90",children:"\u8D44\u6E90"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["ServiceLoadBalancerClass - v1.22 beta\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"spec.loadBalancerClass"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["IngressClass\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"spec.parameters.scope: Namespace - Namespace \u7EAC\u5EA6 IngressClass v1.22 beta"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u96C6\u7FA4\u7F51\u7EDC",children:"\u96C6\u7FA4\u7F51\u7EDC"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/cluster-administration/networking/",children:"Cluster Networking"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/network/networking.md",children:"\u7F51\u7EDC\u8BBE\u8BA1\u6587\u6863"})}),"\n",(0,r.jsxs)(n.li,{children:["\u56DB\u79CD\u7F51\u7EDC\u7C7B\u578B\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u5BB9\u5668 \u5230 \u5BB9\u5668"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5BF9\u4E8E\u5BB9\u5668\u672C\u8EAB\u6765\u8BF4\u5B83\u5C31\u50CF\u8FD0\u884C\u5728\u540C\u4E00\u4E2A\u4E3B\u673A\u4E0A"}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Pod \u5230 Pod"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6BCF\u4E2A\u90FD\u6709\u771F\u5B9E\u72EC\u7ACB IP"}),"\n",(0,r.jsx)(n.li,{children:"IP \u8DE8\u8282\u70B9\u552F\u4E00\u3001\u901A\u4FE1"}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Pod \u5230 Service"}),"\n",(0,r.jsx)(n.li,{children:"\u5916\u90E8 \u5230 Service"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u8981\u6C42\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pod \u4E4B\u95F4\u4E92\u901A - \u65E0 NAT"}),"\n",(0,r.jsx)(n.li,{children:"\u8282\u70B9\u4E0A Agent \u548C Pod \u4E92\u901A"}),"\n",(0,r.jsx)(n.li,{children:"\u652F\u6301 Host \u7F51\u7EDC\u7684\u5E73\u53F0 - Pod \u5728\u4E3B\u673A\u7F51\u7EDC\u4E0B\u80FD\u4E0E\u5176\u4ED6 Pod \u4E92\u901A - \u65E0 NAT"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5B9E\u73B0\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Linux L2 \u5C42\u6865\u63A5\u7F51\u7EDC\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.tinc-vpn.org/",children:"Tinc"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/coreos/flannel",children:"coreos/flannel"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/projectcalico/calico",children:"projectcalico/calico"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/ovn-org/ovn-kubernetes",children:"ovn-org/ovn-kubernetes"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u670D\u52A1\u53D1\u73B0",children:"\u670D\u52A1\u53D1\u73B0"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/network/service-discovery.md",children:"Service Discovery Proposal"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u63A8\u8350 Annotation"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "api.service.kubernetes.io/protocol": "REST",\n  "api.service.kubernetes.io/scheme": "http",\n  "api.service.kubernetes.io/path": "cxfcdi",\n  "api.service.kubernetes.io/description-path": "cxfcdi/swagger.json",\n  "api.service.kubernetes.io/description-language": "SwaggerJSON"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"resolvconf",children:"resolv.conf"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/network/pod-resolv-conf.md",children:"Custom /etc/resolv.conf"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u670D\u52A1\u7F51\u7EDC",children:"\u670D\u52A1\u7F51\u7EDC"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://medium.com/google-cloud/922f010849e0",children:"Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"clusterip",children:"ClusterIP"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u65E0\u5916\u90E8\u8BBF\u95EE"}),"\n",(0,r.jsxs)(n.li,{children:["\u53EF\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"kubectl proxy --port=8080"})," \u8FDB\u884C\u8BBF\u95EE - \u5730\u5740\u4E3A ",(0,r.jsx)(n.code,{children:"http://localhost:8080/api/v1/proxy/namespaces/<NAMESPACE>/services/<SERVICE-NAME>:<PORT-NAME>/"})]}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u4E8E\u8C03\u8BD5\u548C\u66B4\u9732\u5185\u90E8\u670D\u52A1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-internal-service\nspec:\n  selector:\n    app: my-app\n  type: ClusterIP\n  ports:\n    - name: http\n      port: 80\n      targetPort: 80\n      protocol: TCP\n"})}),"\n",(0,r.jsx)(n.h3,{id:"nodeport",children:"NodePort"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u63D0\u4F9B\u5916\u90E8\u8BBF\u95EE\u6700\u539F\u59CB\u7684\u65B9\u6CD5"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u6240\u6709\u8282\u70B9\u5F00\u542F\u76F8\u540C\u7AEF\u53E3\u8FDB\u884C\u8F6C\u53D1"}),"\n",(0,r.jsxs)(n.li,{children:["\u7F3A\u70B9\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4E00\u4E2A\u670D\u52A1\u53EA\u80FD\u66B4\u9732\u4E00\u4E2A\u7AEF\u53E3"}),"\n",(0,r.jsx)(n.li,{children:"\u7AEF\u53E3\u9650\u5B9A\u5728 30000\u201332767"}),"\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u5173\u6CE8\u8282\u70B9\u5730\u5740\u53D8\u5316"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u573A\u666F\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6F14\u793A\u670D\u52A1"}),"\n",(0,r.jsx)(n.li,{children:"\u5355\u7AEF\u53E3\u670D\u52A1 - \u4F8B\u5982 DNS"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-nodeport-service\nspec:\n  selector:\n    app: my-app\n  type: NodePort\n  ports:\n    - name: http\n      port: 80\n      targetPort: 80\n      # \u4E0D\u6307\u5B9A\u5219\u968F\u673A\u5206\u914D\n      # 30000-32767\n      nodePort: 30036\n      protocol: TCP\n"})}),"\n",(0,r.jsx)(n.h3,{id:"loadbalancer",children:"LoadBalancer"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6807\u51C6\u7684\u66B4\u9732\u670D\u52A1\u65B9\u5F0F"}),"\n",(0,r.jsx)(n.li,{children:"\u6BCF\u4E2A\u670D\u52A1\u90FD\u4F1A\u83B7\u53D6\u5230\u81EA\u5DF1\u7684 IP - \u56E0\u6B64\u6BCF\u4E2A\u66B4\u9732\u7684\u670D\u52A1\u90FD\u4F1A\u9700\u8981\u5BF9\u8D1F\u8F7D\u5747\u8861\u4ED8\u8D39"}),"\n",(0,r.jsxs)(n.li,{children:["\u7F3A\u70B9\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8D1F\u8F7D\u5747\u8861\u662F\u7531\u5E73\u53F0\u63D0\u4F9B\u4E14\u4F34\u968F\u8D39\u7528"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/danderson/metallb",children:"danderson/metallb"})," - \u57FA\u4E8E\u8DEF\u7531\u7684\u5185\u90E8 LB \u5B9E\u73B0"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53EF\u901A\u8FC7\u81EA\u5B9A\u4E49 ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/developing-cloud-controller-manager/",children:"Cloud Controller Manager"})," \u6765\u63D0\u4F9B LoadBalancer"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer",children:"Create an External Load Balancer"})}),"\n",(0,r.jsxs)(n.li,{children:["NGINX Ingress Controller ",(0,r.jsx)(n.a,{href:"https://kubernetes.github.io/ingress-nginx/deploy/baremetal",children:"Bare-metal considerations"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: example-service\nspec:\n  selector:\n    app: example\n  ports:\n    - port: 8765\n      targetPort: 9376\n  type: LoadBalancer\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5C06\u67D0\u4E2A\u670D\u52A1\u901A\u8FC7\u8D1F\u8F7D\u5747\u8861\u7684\u65B9\u5F0F\u8FDB\u884C\u7AEF\u53E3\u66B4\u9732\nkubectl expose svc web --type=LoadBalancer --port=80 --target-port=8080 --external-ip=192.168.1.2 --name=web-lb\n\n# \u67E5\u770B\u670D\u52A1\u72B6\u6001\u5305\u542B\u5730\u5740\u4FE1\u606F\nkubectl describe svc ingress-nginx-ingress-controller\n"})}),"\n",(0,r.jsx)(n.h3,{id:"ingress",children:"Ingress"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4E0D\u662F\u4E00\u4E2A\u670D\u52A1"}),"\n",(0,r.jsx)(n.li,{children:"\u5E94\u7528\u5C42\u8DEF\u7531 - \u5206\u4E3A Ingress \u5B9A\u4E49\u548C IngressController \u63A7\u5236\u5668"}),"\n",(0,r.jsxs)(n.li,{children:["\u5E38\u89C1\u5B9E\u73B0 Nginx\u3001Istio\u3001",(0,r.jsx)(n.a,{href:"https://github.com/containous/traefik",children:"Traefik"}),"\u3001",(0,r.jsx)(n.a,{href:"https://github.com/projectcontour/contour",children:"Contour"})]}),"\n",(0,r.jsx)(n.li,{children:"\u4E00\u822C\u9700\u8981\u914D\u5957 cert-manager \u4F7F\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u80FD\u9644\u5E26\u5176\u5B83\u80FD\u529B SSL\u3001\u9274\u6743\u3001\u8DEF\u7531\u7B49"}),"\n",(0,r.jsxs)(n.li,{children:["\u573A\u666F\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4F7F\u7528 HTTP \u534F\u8BAE"}),"\n",(0,r.jsx)(n.li,{children:"\u4E00\u4E2A\u540E\u7AEF\u66B4\u9732\u591A\u4E2A\u670D\u52A1"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: my-ingress\nspec:\n  backend:\n    serviceName: other\n    servicePort: 8080\n  rules:\n    - host: foo.mydomain.com\n      http:\n        paths:\n          - backend:\n              serviceName: foo\n              servicePort: 8080\n    - host: mydomain.com\n      http:\n        paths:\n          - path: /bar/*\n            backend:\n              serviceName: bar\n              servicePort: 8080\n"})}),"\n",(0,r.jsx)(n.h3,{id:"externalname",children:"ExternalName"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4F1A\u5C06 ",(0,r.jsx)(n.code,{children:"my-service.prod.svc.cluster.local"})," CNAME \u4E3A ",(0,r.jsx)(n.code,{children:"my.database.example.com"})]}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679C\u4F7F\u7528 SSL \u4F1A\u6709\u8BC1\u4E66\u95EE\u9898"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679C\u4F7F\u7528\u7684\u73AF\u5883 DNS \u4E0D\u4E92\u901A\u4E5F\u4F1A\u6709\u95EE\u9898"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\n  namespace: prod\nspec:\n  type: ExternalName\n  externalName: my.database.example.com\n"})}),"\n",(0,r.jsx)(n.h3,{id:"externalips",children:"ExternalIPs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\nspec:\n  selector:\n    app: MyApp\n  ports:\n    - name: http\n      protocol: TCP\n      port: 80\n      targetPort: 9376\n  externalIPs:\n    - 80.11.12.10\n"})}),"\n",(0,r.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h3,{id:"nodeport-vs-hostport-vs-hostnetwork",children:"NodePort vs HostPort vs HostNetwork"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u90FD\u662F\u4E3A\u4E86\u5728\u865A\u62DF\u8282\u70B9\u4E0A\u66B4\u9732\u7AEF\u53E3"}),"\n",(0,r.jsx)(n.li,{children:"TLS \u573A\u666F\u5982\u679C\u60F3\u8981\u83B7\u53D6\u5230\u5BA2\u6237\u7AEF IP \u5219\u9700\u8981\u66B4\u9732\u7AEF\u53E3\u5230\u4E3B\u673A - \u5426\u5219\u4F7F\u7528 tcp proxy - \u5F88\u9EBB\u70E6"}),"\n",(0,r.jsxs)(n.li,{children:["NodePort\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u63A8\u8350\u65B9\u5F0F"}),"\n",(0,r.jsx)(n.li,{children:"Kubernetes \u7BA1\u7406 - \u7AEF\u53E3\u8303\u56F4 30000\u201332767"}),"\n",(0,r.jsx)(n.li,{children:"\u53EF\u4EE5\u8F6C\u53D1\u670D\u52A1 - \u4E0D\u9700\u8981\u8282\u70B9\u8FD0\u884C POD"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["HostPort\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4E0D\u63A8\u8350\u4F7F\u7528 - \u9664\u975E\u4E0D\u5F97\u5DF2 - node daemon"}),"\n",(0,r.jsx)(n.li,{children:"Kubernetes \u9884\u7559\u7AEF\u53E3"}),"\n",(0,r.jsx)(n.li,{children:"\u8282\u70B9\u9700\u8981\u8FD0\u884C POD"}),"\n",(0,r.jsx)(n.li,{children:"\u53D6\u51B3\u4E8E CNI \u5B9E\u73B0"}),"\n",(0,r.jsx)(n.li,{children:"\u4F1A\u5F71\u54CD pod \u8C03\u5EA6 - \u56E0\u4E3A\u7AEF\u53E3\u51B2\u7A81"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["HostNetwork\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4E0D\u4F9D\u8D56 CNI"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u5BBF\u4E3B\u673A\u7F51\u7EDC\u7A7A\u95F4"}),"\n",(0,r.jsx)(n.li,{children:"\u80FD\u8BBF\u95EE lookback \u8BBE\u5907\u3001\u670D\u52A1 \u7B49"}),"\n",(0,r.jsx)(n.li,{children:"\u80FD\u591F\u83B7\u53D6\u8282\u70B9\u4E0A\u7684\u7F51\u7EDC\u6D3B\u52A8"}),"\n",(0,r.jsx)(n.li,{children:"DaemonSet \u65F6\u53EF\u4EE5\u4F7F\u7528"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/kubernetes/issues/23920",children:"https://github.com/kubernetes/kubernetes/issues/23920"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},917776:function(e,n,s){s.d(n,{R:()=>c,x:()=>t});var l=s(7378);let r={},i=l.createContext(r);function c(e){let n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);