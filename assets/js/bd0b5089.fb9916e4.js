"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["93254"],{31626:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>d,toc:()=>l,default:()=>h,metadata:()=>o,assets:()=>i,contentTitle:()=>t});var o=JSON.parse('{"id":"service/forge/drone/drone-runner","title":"Drone Runner","description":"- exec runner \u76EE\u524D\u7528\u4E0D\u4E86 - \u65E0\u6CD5\u6CE8\u5165 git cred","source":"@site/../notes/service/forge/drone/drone-runner.md","sourceDirName":"service/forge/drone","slug":"/service/forge/drone/runner","permalink":"/notes/service/forge/drone/runner","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/forge/drone/drone-runner.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1731048203000,"frontMatter":{"title":"Drone Runner"},"sidebar":"docs","previous":{"title":"Drone Pipeline","permalink":"/notes/service/forge/drone/pipeline"},"next":{"title":"Forge Awesome","permalink":"/notes/service/forge/awesome"}}'),s=r(86106),c=r(17776);let d={title:"Drone Runner"},t="drone runner",i={},l=[{value:"exec runner",id:"exec-runner",level:2},{value:"docker runner",id:"docker-runner",level:2},{value:"kubernates runner",id:"kubernates-runner",level:2}];function u(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"drone-runner",children:"drone runner"})}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["exec runner \u76EE\u524D\u7528\u4E0D\u4E86 - \u65E0\u6CD5\u6CE8\u5165 git cred\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u65B0\u7684\u63D2\u4EF6\u57FA\u4E8E container"}),"\n",(0,s.jsx)(n.li,{children:"exec \u4E0D\u518D\u7EF4\u62A4\u4E86"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"exec-runner",children:"exec runner"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"/etc/drone-runner-exec/config"}),"\n",(0,s.jsx)(n.li,{children:"~/.drone-runner-exec/config"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-exec",children:"drone-runners/drone-runner-exec"})," \u5DF2\u7ECF\u88AB\u5F52\u6863"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl -L https://github.com/drone-runners/drone-runner-exec/releases/latest/download/drone_runner_exec_linux_amd64.tar.gz | tar zx\nsudo install -t /usr/local/bin drone-runner-exec\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"DRONE_RPC_PROTO=https\nDRONE_RPC_HOST=drone.company.com\nDRONE_RPC_SECRET=super-duper-secret\nDRONE_LOG_FILE=/var/log/drone-runner-exec/log.txt\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u914D\u7F6E UI \u540E\u53EF\u8BBF\u95EE runner \u7684\u754C\u9762\uFF0C :3000"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"DRONE_UI_USERNAME=root"}),"\n",(0,s.jsx)(n.li,{children:"DRONE_UI_PASSWORD=root"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# daemon \u524D\u53F0\u8FD0\u884C\ndrone-runner-exec daemon /etc/drone-runner-exec/config\n\nDRONE_DEBUG=true drone-runner-exec service run --config /etc/drone-runner-exec/config\n\n# \u670D\u52A1\u6A21\u5F0F - \u540E\u53F0\ndrone-runner-exec service install # \u4E0D\u662F OpenRC /etc/init.d/drone-runner-exec\ndrone-runner-exec service start   # service run\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"var"}),(0,s.jsx)(n.th,{children:"e.g."})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DRONE_RUNNER_ROOT"}),(0,s.jsx)(n.td,{children:"/tmp"})]})})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.drone.io/runner/exec/configuration/reference/",children:"https://docs.drone.io/runner/exec/configuration/reference/"})}),"\n",(0,s.jsxs)(n.li,{children:["\u6CE8\u518C\u7684 Webhook ",(0,s.jsx)(n.code,{children:"https://drone.dev.wener.me/hook?secret="})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"docker-runner",children:"docker runner"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --detach \\\n  --volume=/var/run/docker.sock:/var/run/docker.sock \\\n  --env=DRONE_RPC_PROTO=https \\\n  --env=DRONE_RPC_HOST=drone.company.com \\\n  --env=DRONE_RPC_SECRET=super-duper-secret \\\n  --env=DRONE_RUNNER_CAPACITY=2 \\\n  --env=DRONE_RUNNER_NAME=first-runner \\\n  --publish=3000:3000 \\\n  --restart=always \\\n  --name=runner \\\n  drone/drone-runner-docker:1\n\ndocker run --rm -it \\\n  --volume=/var/run/docker.sock:/var/run/docker.sock \\\n  --env-file=config \\\n  --publish=3000:3000 \\\n  --name=drone-runner drone/drone-runner-docker:1\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["DRONE_RUNNER_CLONE_IMAGE=docker/git:1\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"clone \u5230 /drone/src/.git/"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.drone.io/runner/docker/configuration/reference/",children:"https://docs.drone.io/runner/docker/configuration/reference/"})}),"\n",(0,s.jsx)(n.li,{children:"DRONE_RUNNER_VOLUMES"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'if [ ! -z "${DRONE_NETRC_FILE}" ]; then\n	echo $DRONE_NETRC_FILE > $HOME/.netrc\n	chmod 600 $HOME/.netrc\nfi\nunset DRONE_SCRIPT\nunset DRONE_NETRC_MACHINE\nunset DRONE_NETRC_USERNAME\nunset DRONE_NETRC_PASSWORD\nunset DRONE_NETRC_FILE\nset -e\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-docker/blob/7e9969423c0883c0300c974bbb7583e3d9ece875/engine/compiler/shell/shell.go#L37-L50",children:"https://github.com/drone-runners/drone-runner-docker/blob/7e9969423c0883c0300c974bbb7583e3d9ece875/engine/compiler/shell/shell.go#L37-L50"})}),"\n",(0,s.jsxs)(n.li,{children:["DRONE_BUILD_DEBUG=true\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F1A\u8BBE\u7F6E DRONE_TMATE_HOST"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"kubernates-runner",children:"kubernates runner"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-kube",children:"drone-runners/drone-runner-kube"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/drone-runners/drone-runner-kube/blob/master/command/daemon/config.go",children:"https://github.com/drone-runners/drone-runner-kube/blob/master/command/daemon/config.go"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  --name=drone-runner-kube drone/drone-runner-kube\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.drone.io/runner/kubernetes/installation/",children:"https://docs.drone.io/runner/kubernetes/installation/"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},17776:function(e,n,r){r.d(n,{R:()=>d,x:()=>t});var o=r(7378);let s={},c=o.createContext(s);function d(e){let n=o.useContext(c);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);