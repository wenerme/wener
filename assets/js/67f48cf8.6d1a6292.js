"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["31462"],{72526:function(e,s,n){n.r(s),n.d(s,{frontMatter:()=>a,toc:()=>d,default:()=>m,metadata:()=>t,assets:()=>i,contentTitle:()=>c});var t=JSON.parse('{"id":"devops/kubernetes/app/sealed-secrets","title":"sealed-secrets","description":"- bitnami-labs/sealed-secrets","source":"@site/../notes/devops/kubernetes/app/sealed-secrets.md","sourceDirName":"devops/kubernetes/app","slug":"/devops/kubernetes/app/sealed-secrets","permalink":"/notes/devops/kubernetes/app/sealed-secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/app/sealed-secrets.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1693122196000,"frontMatter":{"title":"sealed-secrets"},"sidebar":"docs","previous":{"title":"Reloader","permalink":"/notes/devops/kubernetes/app/reloader"},"next":{"title":"stolon","permalink":"/notes/devops/kubernetes/app/stolon"}}'),l=n(86106),r=n(17776);let a={title:"sealed-secrets"},c="sealed-secrets",i={},d=[{value:"already exists and is not managed by SealedSecret",id:"already-exists-and-is-not-managed-by-sealedsecret",level:2},{value:"\u5220\u9664 secret \u91CD\u5EFA",id:"\u5220\u9664-secret-\u91CD\u5EFA",level:2}];function o(e){let s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"sealed-secrets",children:"sealed-secrets"})}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"https://github.com/bitnami-labs/sealed-secrets",children:"bitnami-labs/sealed-secrets"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Apache-2.0, Go"}),"\n",(0,l.jsx)(s.li,{children:"one-way encrypted Secrets"}),"\n",(0,l.jsx)(s.li,{children:"\u52A0\u5BC6 Secret \u5BF9\u8C61\u4E3A SealedSecret\uFF0C\u7528\u4E8E\u5B89\u5168\u63D0\u4EA4\u5230 git \u4ED3\u5E93"}),"\n",(0,l.jsx)(s.li,{children:"\u96C6\u7FA4\u5185\u7684 controller \u4F1A\u5C06 SealedSecret \u89E3\u5BC6\u4E3A Secret"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\u6A21\u5F0F\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"strict - \u9ED8\u8BA4 - \u540D\u5B57\u548C namespace \u5339\u914D"}),"\n",(0,l.jsx)(s.li,{children:"namespace-wide - \u76F8\u540C namespace \u5185\u53EF\u4FEE\u6539 name"}),"\n",(0,l.jsx)(s.li,{children:"cluster-wide - \u53EF\u4FEE\u6539 namespace \u548C name"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.admonition,{type:"caution",children:(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["SealdSecret \u662F\u7ED1\u5B9A namespace\uFF0Ckubeseal \u7684\u65F6\u5019\u6307\u5B9A\u6216\u539F secret \u5305\u542B\uFF0C\u4E0D\u53EF\u4FEE\u6539\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u6216\u8005\u6307\u5B9A ",(0,l.jsx)(s.code,{children:'sealedsecrets.bitnami.com/cluster-wide": "true"'})," \u96C6\u7FA4\u5185\u53EF\u7528"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\u5982\u679C\u4E00\u4E2A yaml \u5305\u542B\u591A\u4E2A secret \u53EA\u6709\u7B2C\u4E00\u4E2A\u4F1A seal - ",(0,l.jsx)(s.a,{href:"https://github.com/bitnami-labs/sealed-secrets/issues/114",children:"#114"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u5220\u9664 secret \u4E0D\u4F1A\u91CD\u5EFA - ",(0,l.jsx)(s.a,{href:"https://github.com/bitnami-labs/sealed-secrets/issues/224",children:"bitnami-labs/sealed-secrets#224"})]}),"\n"]})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u96C6\u7FA4\u5B89\u88C5\n# \u67E5\u770B\u7248\u672C https://github.com/bitnami-labs/sealed-secrets/releases\nkubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.13.1/controller.yaml\n\nbrew install kubeseal\n\n# \u6B63\u5E38 secret\necho -n bar | kubectl create secret generic mysecret --dry-run=client --from-file=foo=/dev/stdin -o json > mysecret.json\n# seal\nkubeseal < mysecret.json > mysealedsecret.json\n# \u521B\u5EFA seal\nkubectl create -f mysealedsecret.json\n# \u751F\u6210 secret\nkubectl get secret mysecret\n\n# \u9650\u5B9A\u8303\u56F4\nkubeseal --scope cluster-wide < secret.yaml > sealed-secret.json\n\n# \u5907\u4EFD master.key - \u6062\u590D\u5219\u53EF\u4EE5\u4F7F\u5F97\u4E4B\u524D\u7684\u52A0\u5BC6\u6570\u636E\u751F\u6548\nkubectl get secret -n kube-system -l sealedsecrets.bitnami.com/sealed-secrets-key -o yaml > master.key\n\n# \u6062\u590D master.key\nkubectl apply -f master.key\n# \u751F\u6548\nkubectl delete pod -n kube-system -l name=sealed-secrets-controller\n\n# \u79BB\u7EBF\u89E3\u5BC6\nkubeseal --recovery-unseal --recovery-private-key file1.key\n"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-yaml",children:"annotations:\n  # \u96C6\u7FA4\u5185\u53EF\u89E3\u5BC6 - \u4E0D\u7ED1\u5B9A namespace\n  sealedsecrets.bitnami.com/cluster-wide\": 'true'\n  # \u4E0D\u7ED1\u5B9A name\n  sealedsecrets.bitnami.com/namespace-wide: 'true'\n"})}),"\n",(0,l.jsx)(s.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(s.h2,{id:"already-exists-and-is-not-managed-by-sealedsecret",children:"already exists and is not managed by SealedSecret"}),"\n",(0,l.jsx)(s.p,{children:"\u5B58\u5728\u4E8E\u5C06 secret \u8FC1\u79FB\u4E3A sealed-secrets \u7684\u60C5\u51B5"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://github.com/bitnami-labs/sealed-secrets/issues/288",children:"bitnami-labs/sealed-secrets#288"})}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-yaml",children:"annotations:\n  # \u8BC6\u522B\u65B9\u5F0F\n  sealedsecrets.bitnami.com/managed: 'true'\n"})}),"\n",(0,l.jsx)(s.h2,{id:"\u5220\u9664-secret-\u91CD\u5EFA",children:"\u5220\u9664 secret \u91CD\u5EFA"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u76EE\u524D\u4E0D\u652F\u6301"}),"\n",(0,l.jsxs)(s.li,{children:["\u91CD\u542F controller \u53EF\u4EE5 - \u4F46\u662F sealedsecrets \u591A\u7684\u65F6\u5019\u975E\u5E38\u6162\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u5355\u4E2A\u4E00\u822C 0.7 - 1.2s"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://github.com/bitnami-labs/sealed-secrets/issues/224",children:"bitnami-labs/sealed-secrets#224"})}),"\n"]})]})}function m(e={}){let{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},17776:function(e,s,n){n.d(s,{R:()=>a,x:()=>c});var t=n(7378);let l={},r=t.createContext(l);function a(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);