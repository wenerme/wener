"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["674269"],{740421:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>h,default:()=>a,metadata:()=>i,assets:()=>d,contentTitle:()=>c});var i=JSON.parse('{"id":"os/linux/linux-faq","title":"Linux FAQ","description":"Hardening","source":"@site/../notes/os/linux/linux-faq.md","sourceDirName":"os/linux","slug":"/os/linux/faq","permalink":"/notes/os/linux/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/linux-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1765157611000,"frontMatter":{"title":"Linux FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"\u63A8\u8350\u9ED8\u8BA4\u8BBE\u7F6E","permalink":"/notes/os/linux/default"},"next":{"title":"Linux Glossary","permalink":"/notes/os/linux/glossary"}}'),l=s(486106),r=s(917776);let t={title:"Linux FAQ",tags:["FAQ"]},c="Linux FAQ",d={},h=[{value:"Hardening",id:"hardening",level:2},{value:"SIGINT vs SIGTERM vs SIGHUP",id:"sigint-vs-sigterm-vs-sighup",level:2},{value:"kernel-ml vs kernel-lt",id:"kernel-ml-vs-kernel-lt",level:2},{value:"context switch",id:"context-switch",level:2},{value:"hostname",id:"hostname",level:2},{value:"\u91CD\u65B0\u626B\u63CF\u5206\u533A",id:"\u91CD\u65B0\u626B\u63CF\u5206\u533A",level:2},{value:"The NVM Checksum Is Not Valid",id:"the-nvm-checksum-is-not-valid",level:2},{value:"PCIe Bus Error: severity=Corrected, type=Physical Layer, id=00e5(Receiver ID)",id:"pcie-bus-error-severitycorrected-typephysical-layer-id00e5receiver-id",level:2},{value:"halt vs poweroff vs shutdown",id:"halt-vs-poweroff-vs-shutdown",level:2},{value:"&#39;RTLD_NEXT&#39; undeclared",id:"rtld_next-undeclared",level:2},{value:"mmap: Operation not permitted",id:"mmap-operation-not-permitted",level:2},{value:"\u67E5\u770B\u5185\u6838\u914D\u7F6E",id:"\u67E5\u770B\u5185\u6838\u914D\u7F6E",level:2},{value:"\u6CA1\u6709 /proc/config.gz",id:"\u6CA1\u6709-procconfiggz",level:2},{value:"\u91CA\u653E\u78C1\u76D8\u7A7A\u95F4",id:"\u91CA\u653E\u78C1\u76D8\u7A7A\u95F4",level:2},{value:"limit",id:"limit",level:3},{value:"usb tethering",id:"usb-tethering",level:2},{value:"/tmp",id:"tmp",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"linux-faq",children:"Linux FAQ"})}),"\n",(0,l.jsx)(n.h2,{id:"hardening",children:"Hardening"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u78C1\u76D8\u52A0\u5BC6"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.pluralsight.com/blog/it-ops/linux-hardening-secure-server-checklist",children:"https://www.pluralsight.com/blog/it-ops/linux-hardening-secure-server-checklist"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"sigint-vs-sigterm-vs-sighup",children:"SIGINT vs SIGTERM vs SIGHUP"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["SIGHUP - 1\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6302\u8D77"}),"\n",(0,l.jsx)(n.li,{children:"\u6709\u65F6\u5019\u7528\u4E8E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E \u6216\u8005 \u91CD\u542F \u6216\u8005 \u65E5\u5FD7\u8F6E\u8F6C"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["SIGINT - 2\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4E2D\u65AD"}),"\n",(0,l.jsx)(n.li,{children:"\u901A\u5E38\u662F Ctrl+C"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["SIGTERM - 15\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7EC8\u6B62"}),"\n",(0,l.jsx)(n.li,{children:"\u901A\u5E38\u662F kill"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"kernel-ml-vs-kernel-lt",children:"kernel-ml vs kernel-lt"}),"\n",(0,l.jsx)(n.p,{children:"RHEL \u5185\u6838 flavor"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["kernel-ml - mainline\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Linux \u4E3B\u7EBF\u7248\u672C - \u66F4\u65B0\uFF0C\u66F4\u65B0\u66F4\u5FEB\u66F4\u591A"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["kernel-lt - long term\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Linux \u957F\u671F\u652F\u6301\u7248\u672C - \u66F4\u7A33\u5B9A\uFF0C\u66F4\u65B0\u66F4\u5C11"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"context-switch",children:"context switch"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cat /proc/3736/status | grep ctxt\n\napk add sysstat\npidstat -w -l -p 3736\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man1/pidstat.1.html",children:"https://man7.org/linux/man-pages/man1/pidstat.1.html"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"hostname",children:"hostname"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u4E3B\u673A\u540D\nhostname\nhostname -s\ncat /etc/hostname\nsysctl -n kernel.hostname\ncat /proc/sys/kernel/hostname\n\n# \u57DF\u540D\n# --fqdn/--long\nhostname -f\nsysctl -n kernel.domainname\ncat /proc/sys/kernel/domainname\n\n# \u4FEE\u6539\nhostname "wener-s1"\ndomainname "phy.wener.me"\n# \u76F8\u540C\necho wener-s1 > /proc/sys/kernel/hostname\necho phy.wener.me > /proc/sys/kernel/domainname\n\n# /etc/hosts\n# 127.0.0.1 wener-s1.phy.wener.me wener-s1\n# /etc/resolv.conf\n# search phy.wener.me\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"NIS \u7CFB\u7EDF - \u4E0D\u9700\u8981\u4E0E DNS \u6709\u5173\u7CFB\uFF0C\u4F46\u4E5F\u53EF\u4EE5\u6709\u5173\u7CFB"}),"\n",(0,l.jsx)(n.li,{children:"FQDN \u662F\u8F85\u52A9\u7EF4\u62A4\u5927\u6279\u91CF\u7684\u7F51\u7EDC\u8BBE\u5907\uFF0C\u4E00\u822C\u9700\u8981\u914D\u5408\u5185\u90E8 DNS \u89E3\u6790"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man1/hostname.1.html",children:"https://man7.org/linux/man-pages/man1/hostname.1.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.kernel.org/doc/Documentation/sysctl/kernel.txt",children:"https://www.kernel.org/doc/Documentation/sysctl/kernel.txt"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u91CD\u65B0\u626B\u63CF\u5206\u533A",children:"\u91CD\u65B0\u626B\u63CF\u5206\u533A"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"partprobe\nmdev -s\n\n# \u5F3A\u5236\u5185\u6838\u8BFB\u53D6\u5206\u533A\nhdparm -z /dev/sda\n\n# \u624B\u52A8\u521B\u5EFA\nmknod /dev/hdc1 b 22 1\n# \u9A8C\u8BC1\u53EF\u8BFB\ncat /dev/hdc1 > /dev/null\n\n# \u76F4\u63A5\u8BFB\u53D6\u5206\u533A - \u6302\u8F7D\u4E3A loop\nlosetup /dev/loop0 /dev/hdc -o $((63 * 512))\nmount /dev/loop0 /mnt/hdc1\n# \u67E5\u770B\nfdisk -l -u /dev/hdc\n"})}),"\n",(0,l.jsx)(n.h2,{id:"the-nvm-checksum-is-not-valid",children:"The NVM Checksum Is Not Valid"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"e1000e: Intel(R) PRO/1000 Network Driver - 3.2.6-k\ne1000e: Copyright(c) 1999 - 2015 Intel Corporation.\ne1000e 0000:00:1f.6: Interrupt Throttling Rate (ints/sec) set to dynamic conservative mode\ne1000e 0000:00:1f.6: The NVM Checksum Is Not Valid\ne1000e: probe of 0000:00:1f.6 failed with error -5\n"})}),"\n",(0,l.jsx)(n.h2,{id:"pcie-bus-error-severitycorrected-typephysical-layer-id00e5receiver-id",children:"PCIe Bus Error: severity=Corrected, type=Physical Layer, id=00e5(Receiver ID)"}),"\n",(0,l.jsxs)(n.p,{children:["\u542F\u52A8\u53C2\u6570\u6DFB\u52A0 ",(0,l.jsx)(n.code,{children:"pcie_aspm=off"})]}),"\n",(0,l.jsx)(n.h2,{id:"halt-vs-poweroff-vs-shutdown",children:"halt vs poweroff vs shutdown"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["halt\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7EC8\u6B62\u6240\u6709\u8FDB\u7A0B\u5E76\u5173\u95ED CPU"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["poweroff\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4E0E halt \u76F8\u4F3C,\u4F46\u4E5F\u4F1A\u5173\u95ED PC \u81EA\u8EAB.\u4F1A\u53D1\u9001 ACPI \u547D\u4EE4\u5230\u4E3B\u677F, PSU \u7136\u540E\u5207\u65AD\u7535\u6E90"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["shutdown -t now\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4E0E poweroff \u76F8\u4F3C,\u4F46\u4F1A\u6267\u884C\u5173\u673A\u811A\u672C"}),"\n",(0,l.jsx)(n.li,{children:"\u6700\u4F18\u96C5\u7684\u5173\u673A\u65B9\u5F0F"}),"\n",(0,l.jsxs)(n.li,{children:["\u4F1A\u5148 ",(0,l.jsx)(n.code,{children:"kill -15 "}),"\u7136\u540E ",(0,l.jsx)(n.code,{children:"kill -9"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u73B0\u4EE3\u7684 ",(0,l.jsx)(n.code,{children:"halt"})," \u548C ",(0,l.jsx)(n.code,{children:"reboot"})," \u4E00\u822C\u4E5F\u4F1A\u8C03\u7528 shutdown"]}),"\n",(0,l.jsx)(n.li,{children:"openrc \u6709 shutdown level"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"rtld_next-undeclared",children:"'RTLD_NEXT' undeclared"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["gcc \u6DFB\u52A0 ",(0,l.jsx)(n.code,{children:"-D_GNU_SOURCE"})]}),"\n",(0,l.jsx)(n.li,{children:"\u56E0\u4E3A\u4E0D\u662F\u6807\u51C6\u7684 POSIX \u5B9A\u4E49"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"mmap-operation-not-permitted",children:"mmap: Operation not permitted"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53EF\u80FD\u662F\u7531\u4E8E\u5185\u6838\u5F00\u542F\u4E86 ",(0,l.jsx)(n.code,{children:"CONFIG_STRICT_DEVMEM"})," \u5BFC\u81F4, \u51FA\u4E8E\u5B89\u5168\u8003\u8651, \u5728\u7528\u6237\u7A7A\u95F4\u4E0D\u5141\u8FDB\u884C\u8D85\u8FC7 1MB \u7684\u7269\u7406\u5185\u5B58\u64CD\u4F5C"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"http://blog.sina.com.cn/s/blog_6f5b220601012xbc.html",children:"http://blog.sina.com.cn/s/blog_6f5b220601012xbc.html"})}),"\n",(0,l.jsxs)(n.li,{children:["\u6709\u53EF\u80FD\u662F\u56E0\u4E3A mmap \u5305\u542B\u4E86 ",(0,l.jsx)(n.code,{children:"PROT_EXEC"}),", \u5728 PaX \u4E0B\u4F1A\u5931\u8D25"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sysctl dev.mem.restricted\n# /proc/sys/dev/mem/restricted\n\n# https://stackoverflow.com/a/36507784/1870054\n# \u8BE5\u64CD\u4F5C\u4F1A\u7981\u7528\u5F88\u591A PaX \u7279\u6027\n# https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options#Support_soft_mode\nsysctl -w kernel.pax.softmode=1\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u67E5\u770B\u5185\u6838\u914D\u7F6E",children:"\u67E5\u770B\u5185\u6838\u914D\u7F6E"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5E38\u89C1\u914D\u7F6E\u8DEF\u5F84\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/boot/config"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/boot/config-$(uname -r)"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/proc/config.gz"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9700\u8981\u52A0\u8F7D\u6A21\u5757"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cat /proc/config.gz | gunzip > running.config\nzcat /proc/config.gz > running.config\n\ngrep CONFIG_IKCONFIG running.config\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6CA1\u6709-procconfiggz",children:"\u6CA1\u6709 /proc/config.gz"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"modprobe configs\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u91CA\u653E\u78C1\u76D8\u7A7A\u95F4",children:"\u91CA\u653E\u78C1\u76D8\u7A7A\u95F4"}),"\n",(0,l.jsx)(n.p,{children:"rm \u4E0D\u4E00\u5B9A\u4F1A\u91CA\u653E\u7A7A\u95F4, \u53EF\u4EE5 cp /dev/null xx\nlsof | grep deleted"}),"\n",(0,l.jsx)(n.h3,{id:"limit",children:"limit"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"soft limits <= hard limit"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ulimit -a  # \u6240\u6709\nulimit -Hn # hard\nulimit -Sn # soft\n\n# sysctl -w fs.file-max=\ncat /proc/sys/fs/file-max\n"})}),"\n",(0,l.jsx)(n.h2,{id:"usb-tethering",children:"usb tethering"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Authentication Suites (2) : PSK unknown (6)\n"})}),"\n",(0,l.jsx)(n.h2,{id:"tmp",children:"/tmp"}),"\n",(0,l.jsx)(n.p,{children:"/tmp \u662F\u5E94\u8BE5\u653E\u5728 tmpfs \u8FD8\u662F\u653E\u5728 \u78C1\u76D8 \u4E0A"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["/tmp \u653E\u5728 tmpfs \u4E0A\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5185\u5B58\u6EA2\u51FA\u98CE\u9669"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"/var/tmp \u653E\u5728\u78C1\u76D8\u4E0A"}),"\n"]}),"\n",(0,l.jsx)(n.h1,{id:"tbd",children:"TBD"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://stackoverflow.com/questions/332629/rm-not-freeing-diskspace",children:"https://stackoverflow.com/questions/332629/rm-not-freeing-diskspace"}),"\n",(0,l.jsx)(n.a,{href:"https://unix.stackexchange.com/questions/34140/tell-fs-to-free-space-from-deleted-files-now",children:"https://unix.stackexchange.com/questions/34140/tell-fs-to-free-space-from-deleted-files-now"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://serverfault.com/questions/232525/df-in-linux-not-showing-correct-free-space-after-file-removal/232526",children:"https://serverfault.com/questions/232525/df-in-linux-not-showing-correct-free-space-after-file-removal/232526"})}),"\n",(0,l.jsx)(n.p,{children:"ls -l /proc/*/fd/ | grep deleted\nlsof +L1"}),"\n",(0,l.jsx)(n.p,{children:"df -ah\ndu -sh"}),"\n",(0,l.jsx)(n.p,{children:"df -i"}),"\n",(0,l.jsx)(n.p,{children:"dumpe2fs /dev/sda1 | grep -i reserved"}),"\n",(0,l.jsx)(n.p,{children:"Most Linux filesystems reserve 5% space for use only the root user."}),"\n",(0,l.jsx)(n.p,{children:"You can see this with e.g"}),"\n",(0,l.jsx)(n.p,{children:"dumpe2fs /dev/sda1 | grep -i reserved\nYou can change the reserved amount using :"}),"\n",(0,l.jsx)(n.p,{children:"tune2fs -m 0 /dev/sda1"}),"\n",(0,l.jsxs)(n.p,{children:["Tracking down where disk space has gone on Linux?\n",(0,l.jsx)(n.a,{href:"https://unix.stackexchange.com/questions/125429/tracking-down-where-disk-space-has-gone-on-linux",children:"https://unix.stackexchange.com/questions/125429/tracking-down-where-disk-space-has-gone-on-linux"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/moby/moby/issues/32420",children:"https://github.com/moby/moby/issues/32420"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://unix.stackexchange.com/questions/125429/tracking-down-where-disk-space-has-gone-on-linux",children:"https://unix.stackexchange.com/questions/125429/tracking-down-where-disk-space-has-gone-on-linux"})})]})}function a(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},917776:function(e,n,s){s.d(n,{R:()=>t,x:()=>c});var i=s(7378);let l={},r=i.createContext(l);function t(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);