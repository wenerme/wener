"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["278825"],{752726:function(e,s,t){t.r(s),t.d(s,{frontMatter:()=>r,toc:()=>o,default:()=>h,metadata:()=>n,assets:()=>a,contentTitle:()=>c});var n=JSON.parse('{"id":"db/relational/postgresql/timescale","title":"TimeScale","description":"- \u9002\u7528\u4E8E","source":"@site/../notes/db/relational/postgresql/timescale.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/timescale","permalink":"/notes/db/relational/postgresql/timescale","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/timescale.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1692169664000,"frontMatter":{"title":"TimeScale"},"sidebar":"docs","previous":{"title":"Spilo","permalink":"/notes/db/relational/postgresql/spilo"},"next":{"title":"WAL-G","permalink":"/notes/db/relational/postgresql/wal-g"}}'),i=t(486106),l=t(917776);let r={title:"TimeScale"},c="TimeScale",a={},o=[{value:"Notes",id:"notes",level:2}];function d(e){let s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"timescale",children:"TimeScale"})}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\u9002\u7528\u4E8E\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\u9700\u8981\u65F6\u5E8F\u6570\u636E\u5B58\u50A8"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\u4E0D\u9002\u7528\u4E8E\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\u76D1\u63A7"}),"\n",(0,i.jsx)(s.li,{children:"Metrics"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["promscale \u505C\u6B62\u5F00\u53D1 ",(0,i.jsx)(s.a,{href:"https://github.com/timescale/promscale/issues/1836",children:"promscale#1836"})]}),"\n"]})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"http://www.timescale.com/",children:"TimeScale"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://github.com/timescale/timescaledb",children:"timescale/timescaledb"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Apache-2.0"}),"\n",(0,i.jsx)(s.li,{children:"An open-source time-series database optimized for fast ingest and complex queries. Engineered up from PostgreSQL, packaged as an extension."}),"\n",(0,i.jsx)(s.li,{children:"data retention policies"}),"\n",(0,i.jsx)(s.li,{children:"continuous aggregate views"}),"\n",(0,i.jsx)(s.li,{children:"downsampling"}),"\n",(0,i.jsx)(s.li,{children:"data gap-filling"}),"\n",(0,i.jsx)(s.li,{children:"interpolation"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://blog.timescale.com/time-series-data-postgresql-10-vs-timescaledb-816ee808bac5",children:"Problems with PostgreSQL 10 for time-series data"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://blog.timescale.com/blog/building-a-distributed-time-series-database-on-postgresql/",children:"Building a distributed time-series database on PostgreSQL"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://github.com/timescale/pg_prometheus",children:"timescale/pg_prometheus"})," - ",(0,i.jsx)(s.a,{href:"https://github.com/timescale/prometheus-postgresql-adapter",children:"timescale/prometheus-postgresql-adapter"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"PostgreSQL extension for Prometheus data"}),"\n",(0,i.jsx)(s.li,{children:"\u4E0D\u518D\u4F7F\u7528\u8BE5\u7ED3\u6784"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://github.com/timescale/timescale-prometheus",children:"timescale/timescale-prometheus"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"prometheus \u4EA4\u4E92\u65B0\u7684\u67B6\u6784"}),"\n",(0,i.jsx)(s.li,{children:"\u4F5C\u4E3A RemoteStorage"}),"\n",(0,i.jsxs)(s.li,{children:["prometheus ",(0,i.jsx)(s.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write",children:"remote_write"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://docs.timescaledb.com/using-timescaledb/telemetry",children:"https://docs.timescaledb.com/using-timescaledb/telemetry"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"timescaledb.telemetry_level=off"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"ALTER [SYSTEM | DATABASE | USER] { *db_name* | *role_specification* } SET timescaledb.telemetry_level=off"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"https://github.com/timescale/timescaledb/issues/638",children:"timescale/timescaledb#638"})," - List of recommended ZFS/Zpool settings"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# \u57FA\u4E8E postgres \u4E0A\u6E38\u6784\u5EFA\u7684\u955C\u50CF\n# https://github.com/timescale/timescaledb-docker\n# timescale/timescaledb-postgis \u5305\u542B postgis \u6269\u5C55\ndocker run --rm -it \\\n  -p 5432:5432 \\\n  -v $PWD/data:/var/lib/postgresql/data \\\n  -e POSTGRES_DB=timescale \\\n  -e POSTGRES_USER=timescale \\\n  -e POSTGRES_PASSWORD=timescale \\\n  --name timescaledb timescale/timescaledb:latest-pg12\n\n# http://localhost:9201/metrics\n# -log-level \u9ED8\u8BA4 debug\n# -async-acks \u5728\u5199\u5165\u5230\u6570\u636E\u5E93\u4E4B\u524D\u54CD\u5E94 - \u53EF\u80FD\u4E22\u4F46 metric \u573A\u666F\u4E0B\u4E00\u822C\u4E0D\u5F71\u54CD\ndocker run --rm -it --link timescaledb:db \\\n  -p 9201:9201 \\\n  --name ts-prometheus timescale/timescale-prometheus \\\n  -async-acks \\\n  -db-host=db -db-name=timescale -db-port=5432 -db-user=timescale -db-password=timescale\n\nprometheus --config.file=prometheus.yml\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"prometheus.yml"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:"global:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  - job_name: 'node'\n    static_configs:\n      - targets: ['localhost:9100']\n\n  - job_name: 'tsdb-prom'\n    static_configs:\n      - targets: ['localhost:9201']\n\nremote_write:\n  - url: 'http://localhost:9201/write'\nremote_read:\n  - url: 'http://localhost:9201/read'\n"})}),"\n",(0,i.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["create_hypertable\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"chunk_time_interval=7d"}),"\n",(0,i.jsx)(s.li,{children:"partitioning_column"}),"\n",(0,i.jsx)(s.li,{children:"number_partitions - \u57FA\u4E8E partitioning_column \u7684 hash \u5206\u7247"}),"\n",(0,i.jsxs)(s.li,{children:["associated_schema_name=",(0,i.jsx)(s.code,{children:"_timescaledb_internal"})]}),"\n",(0,i.jsxs)(s.li,{children:["associated_table_prefix=",(0,i.jsx)(s.code,{children:"_hyper"})]}),"\n",(0,i.jsx)(s.li,{children:"replication_factor=timescaledb.hypertable_replication_factor_default"}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.timescale.com/api/latest/hypertable/create_hypertable/",children:"https://docs.timescale.com/api/latest/hypertable/create_hypertable/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"SELECT create_hypertable('samples', 'ts', chunk_time_interval => INTERVAL '7 day');\n\nselect chunks_detailed_size('samples');\nselect * from timescaledb_information.chunks;\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.timescale.com/introduction/architecture",children:"Architecture & Concepts"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.timescale.com/use-timescale/latest/hypertables/",children:"https://docs.timescale.com/use-timescale/latest/hypertables/"})}),"\n"]})]})}function h(e={}){let{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},917776:function(e,s,t){t.d(s,{R:()=>r,x:()=>c});var n=t(7378);let i={},l=n.createContext(i);function r(e){let s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);