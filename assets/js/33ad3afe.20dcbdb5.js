"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["457602"],{876462:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>s,toc:()=>c,default:()=>u,metadata:()=>a,assets:()=>l,contentTitle:()=>o});var a=JSON.parse('{"id":"service/forge/gitlab/gitlab-ci-java","title":"GitLab Java","description":"- gitlab-runner#4566","source":"@site/../notes/service/forge/gitlab/gitlab-ci-java.md","sourceDirName":"service/forge/gitlab","slug":"/service/forge/gitlab/ci-java","permalink":"/notes/service/forge/gitlab/ci-java","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/forge/gitlab/gitlab-ci-java.md","tags":[{"inline":true,"label":"Ops","permalink":"/notes/tags/ops"},{"inline":true,"label":"Service","permalink":"/notes/tags/service"},{"inline":true,"label":"GitLab","permalink":"/notes/tags/git-lab"},{"inline":true,"label":"CI","permalink":"/notes/tags/ci"},{"inline":true,"label":"Java","permalink":"/notes/tags/java"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"GitLab Java","tags":["Ops","Service","GitLab","CI","Java"]},"sidebar":"docs","previous":{"title":"Gitlab CI \u6280\u5DE7","permalink":"/notes/service/forge/gitlab/ci-cookbook"},"next":{"title":"gitlab-ci.yml","permalink":"/notes/service/forge/gitlab/ci-yml"}}'),i=t(486106),r=t(917776);let s={title:"GitLab Java",tags:["Ops","Service","GitLab","CI","Java"]},o="GitLab CI Java",l={},c=[];function d(e){let n={a:"a",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"gitlab-ci-java",children:"GitLab CI Java"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gitlab.com/gitlab-org/gitlab-runner/-/issues/4566#note_222730933",children:"gitlab-runner#4566"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"image: maven:3.5-jdk-11-slim\n\ncache:\n  paths:\n    - .m2/repository\n    - node_modules/\n    - frontend/node\n    - frontend/node_modules/\n\nvariables:\n  # This will suppress any download for dependencies and plugins or upload messages which would clutter the console log.\n  # `showDateTime` will show the passed time in milliseconds. You need to specify `--batch-mode` to make this work.\n  MAVEN_OPTS: '-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true'\n  # As of Maven 3.3.0 instead of this you may define these options in `.mvn/maven.config` so the same config is used\n  # when running from the command line.\n  # `installAtEnd` and `deployAtEnd` are only effective with recent version of the corresponding plugins.\n  MAVEN_CLI_OPTS: '-s $CI_PROJECT_DIR/.m2/settings.xml --batch-mode --errors --fail-at-end --show-version -DinstallAtEnd=true -DdeployAtEnd=true'\n\nstages:\n  - build\n  - docker\n  - deploy\n\nbuild:\n  stage: build\n  script:\n    - cd frontend\n    - mvn package $MAVEN_CLI_OPTS\n    - cd ../backend\n    - mvn package $MAVEN_CLI_OPTS\n    # Escreve vers\xe3o do Pom num arquivo pra usar no docker build\n    - POM_VERSION=$(mvn --non-recursive help:evaluate -Dexpression=project.version | grep -v '\\[.*')\n    - echo $POM_VERSION >> version.txt\n  artifacts:\n    paths:\n      - backend/target/*.jar\n      - backend/version.txt\n\nbuild_image:\n  stage: docker\n  image: docker:19.03.0-dind\n  only:\n    - master\n    - release.*\n  script:\n    # L\xea vers\xe3o do Pom\n    - POM_VERSION=$(cat backend/version.txt)\n    - echo $POM_VERSION\n    - echo $CI_REGISTRY\n    - echo $CI_BUILD_TOKEN\n    - echo $CI_REGISTRY_IMAGE\n    # Build da imagem docker\n    - docker login -u $CI_DEPLOY_USER -p $CI_DEPLOY_PASSWORD $CI_REGISTRY\n    - docker build -t $CI_REGISTRY_IMAGE:$POM_VERSION .\n    - docker push $CI_REGISTRY_IMAGE:$POM_VERSION\n"})})]})}function u(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>s,x:()=>o});var a=t(7378);let i={},r=a.createContext(i);function s(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);