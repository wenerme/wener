"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["8583"],{10887:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>o,toc:()=>r,default:()=>m,metadata:()=>i,assets:()=>c,contentTitle:()=>t});var i=JSON.parse('{"id":"devops/infra/ansible/ansible-collection","title":"Ansible Collection","description":"- Collection \u662F Ansible Galaxy Role \u7684\u7EE7\u627F\u8005","source":"@site/../notes/devops/infra/ansible/ansible-collection.md","sourceDirName":"devops/infra/ansible","slug":"/devops/infra/ansible/collection","permalink":"/notes/devops/infra/ansible/collection","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/infra/ansible/ansible-collection.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1693463269000,"frontMatter":{"title":"Ansible Collection"},"sidebar":"docs","previous":{"title":"Ansible for Cloud","permalink":"/notes/devops/infra/ansible/cloud"},"next":{"title":"Ansible Cookbook","permalink":"/notes/devops/infra/ansible/cookbook"}}'),a=l(86106),s=l(17776);let o={title:"Ansible Collection"},t="Ansible Collection",c={},r=[{value:"dev",id:"dev",level:2},{value:"lint",id:"lint",level:2},{value:"playbook",id:"playbook",level:2},{value:"requirements.yml",id:"requirementsyml",level:2},{value:"ansible.cfg",id:"ansiblecfg",level:2},{value:"\u5185\u7F6E",id:"\u5185\u7F6E",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ansible-collection",children:"Ansible Collection"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Collection \u662F Ansible Galaxy Role \u7684\u7EE7\u627F\u8005"}),"\n",(0,a.jsx)(n.li,{children:"\u4E0D\u53EA\u80FD\u5305\u542B role\uFF0C\u8FD8\u80FD\u5305\u542B\u5404\u79CD\u63D2\u4EF6\uFF0C\u6587\u6863\uFF0C\u4EFB\u52A1\u7B49"}),"\n",(0,a.jsxs)(n.li,{children:["\u9ED8\u8BA4\u5B89\u88C5\u76EE\u5F55 ",(0,a.jsx)(n.code,{children:"~/.ansible/collections"})," - COLLECTIONS_PATHS,"]}),"\n",(0,a.jsx)(n.li,{children:"\u5168\u5C40\u4F4D\u7F6E /usr/share/ansible/collections"}),"\n",(0,a.jsxs)(n.li,{children:["\u9ED8\u8BA4\u670D\u52A1\u5668 ",(0,a.jsx)(n.a,{href:"https://galaxy.ansible.com",children:"https://galaxy.ansible.com"})," - GALAXY_SERVER"]}),"\n",(0,a.jsx)(n.li,{children:"server_list \u6216 GALAXY_SERVER_LIST \u53EF\u6307\u5B9A\u4E00\u7EC4\u670D\u52A1"}),"\n",(0,a.jsxs)(n.li,{children:["\u5185\u5EFA collections \u5B89\u88C5\u4F4D\u7F6E ",(0,a.jsx)(n.code,{children:"/usr/lib/python3.8/site-packages/ansible_collections"})]}),"\n",(0,a.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.ansible.com/ansible/devel/user_guide/collections_using.html",children:"\u4F7F\u7528\u6587\u6863"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# namespace.collection\nansible-galaxy collection install wenerme.alpine\n# \u53EF\u4EE5\u4E0B\u8F7D\u79BB\u7EBF\u4F7F\u7528\nansible-galaxy collection download wenerme.alpine\n\n# \u53EF\u4EE5\u76F4\u63A5\u5B89\u88C5 tar\uFF0C\u53EF\u4EE5\u6307\u5B9A\u76EE\u5F55\n# \u76EE\u5F55\u4F1A\u6DFB\u52A0 ansible_collections\nansible-galaxy collection install my_namespace-my_collection-1.0.0.tar.gz -p ./collections\n\n# \u53EF\u4EE5\u9650\u5B9A\u7248\u672C\nansible-galaxy collection install 'my_namespace.my_collection:>=1.0.0,<2.0.0'\n\n# \u80FD\u4ECE\u4ED3\u5E93\u5B89\u88C5\n# \u4E5F\u65B9\u4FBF\u4F7F\u7528\u79C1\u6709 collection\nansible-galaxy collection install git+https://github.com/organization/repo_name.git,devel\nansible-galaxy collection install git@github.com:organization/repo_name.git\nansible-galaxy collection install git+file:///home/user/path/to/repo/.git\n\n# \u5B89\u88C5\u4F9D\u8D56\n# \u7B49\u540C\u4E8E ansible-galaxy role install -r + ansible-galaxy collection install -r\nansible-galaxy install -r requirements.yml\n# \u53EF\u4EE5\u4E0B\u8F7D\u6240\u6709\u4F9D\u8D56\nansible-galaxy collection download -r requirements.yml\n\n# \u67E5\u770B\u5DF2\u5B89\u88C5\nansible-galaxy collection list\n# \u67E5\u770B\u76EE\u5F55\u4E0B\u5185\u5BB9\nansible-galaxy collection list -p '/opt/ansible/collections:/etc/ansible/collections'\n# \u9A8C\u8BC1\nansible-galaxy collection verify wenerme.alpine -vvv\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dev",children:"dev"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/dev_guide/developing_collections.html",children:"Developing collections"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/ansible/creator-ee",children:"ansible/creator-ee"})}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ansible-galaxy collection init my_namespace.my_collection\n"})}),"\n",(0,a.jsx)(n.h2,{id:"lint",children:"lint"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770B\u6240\u6709\u89C4\u5219\nansible-lint -L\n# \u53EA\u6267\u884C\u90E8\u5206\u89C4\u5219\nansible-lint --enable-list command-instead-of-shell\n\n# auto lint\nansible-lint\n"})}),"\n",(0,a.jsx)(n.h2,{id:"playbook",children:"playbook"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# FQDN\n- hosts: all\n  tasks:\n  - my_namespace.my_collection.mymodule:\n      option1: value\n  - import_role:\n      name: my_namespace.my_collection.role1\n  - debug:\n      msg: '{{ lookup(\"my_namespace.my_collection.lookup1\", 'param1')| my_namespace.my_collection.filter1 }}'\n---\n# use collections\n- hosts: all\n  collections:\n  - my_namespace.my_collection\n  tasks:\n  - import_role:\n      name: role1\n  - mymodule:\n      option1: value\n  - debug:\n      msg: '{{ lookup(\"my_namespace.my_collection.lookup1\", 'param1')| my_namespace.my_collection.filter1 }}'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"requirementsyml",children:"requirements.yml"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# Ansible Galaxy \u89D2\u8272\nroles:\n  - name: geerlingguy.java\n    version: 1.9.6\n\ncollections:\n  # \u540D\u5B57\n  - wenerme.alpine\n  # \u8BE6\u7EC6\u4FE1\u606F\n  - name: https://github.com/organization/repo_name.git\n    type: git\n    version: devel\n\n  - name: geerlingguy.php_roles\n    version: 0.9.3\n    source: https://galaxy.ansible.com\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ansiblecfg",children:"ansible.cfg"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",children:"[default]\n# \u5B89\u88C5\u5230\u5F53\u524D\u76EE\u5F55\n# ./ansible_collections/<namespace>/<collection>\ncollections_paths = ./\n# ./roles/<namespace>.<collection>\nroles_path = ./roles\n\n# \u5B9A\u4E49\u670D\u52A1\u7AEF\n[galaxy]\nserver_list = automation_hub, my_org_hub, release_galaxy, test_galaxy\n\n[galaxy_server.automation_hub]\n# url, token, username, password, auth_url\n# ANSIBLE_GALAXY_SERVER_{{ id }}_{{ key }}\nurl=https://cloud.redhat.com/api/automation-hub/\nauth_url=https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token\ntoken=my_ah_token\n\n[galaxy_server.my_org_hub]\nurl=https://automation.my_org/\nusername=my_user\npassword=my_pass\n\n[galaxy_server.release_galaxy]\nurl=https://galaxy.ansible.com/\ntoken=my_token\n\n[galaxy_server.test_galaxy]\nurl=https://galaxy-dev.ansible.com/\ntoken=my_test_token\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u5185\u7F6E",children:"\u5185\u7F6E"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/index.html",children:"Collection Index"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html",children:"ansible.builtin"})}),"\n"]}),"\n"]}),"\n"]})]})}function m(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},17776:function(e,n,l){l.d(n,{R:()=>o,x:()=>t});var i=l(7378);let a={},s=i.createContext(a);function o(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);