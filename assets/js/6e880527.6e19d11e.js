"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["25741"],{20941:function(e,s,n){n.r(s),n.d(s,{frontMatter:()=>i,toc:()=>c,default:()=>h,metadata:()=>a,assets:()=>d,contentTitle:()=>r});var a=JSON.parse('{"id":"os/alpine/alpine-health","title":"Health Check","description":"DISK","source":"@site/../notes/os/alpine/alpine-health.md","sourceDirName":"os/alpine","slug":"/os/alpine/health","permalink":"/notes/os/alpine/health","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/alpine/alpine-health.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1639484090000,"frontMatter":{"title":"Health Check"},"sidebar":"docs","previous":{"title":"Alpine GLIBC","permalink":"/notes/os/alpine/glibc"},"next":{"title":"Alpine Image","permalink":"/notes/os/alpine/image"}}'),t=n(86106),l=n(17776);let i={title:"Health Check"},r="Health Check",d={},c=[{value:"DISK",id:"disk",level:2},{value:"\u5355\u4E2A\u78C1\u76D8",id:"\u5355\u4E2A\u78C1\u76D8",level:2},{value:"SCSI",id:"scsi",level:2},{value:"IO Load",id:"io-load",level:2},{value:"sar",id:"sar",level:2}];function o(e){let s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"health-check",children:"Health Check"})}),"\n",(0,t.jsx)(s.h2,{id:"disk",children:"DISK"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"apk add smartmontools\n# -a \u8F93\u51FA\u6240\u6709\u4FE1\u606F\nsmartctl -a /dev/sdb\n# -x \u8F93\u51FA\u66F4\u591A\u4FE1\u606F, \u5305\u542B\u975E smart \u4FE1\u606F\nsmartctl -x /dev/sdb\n# -H \u8F93\u51FA\u5065\u5EB7\u72B6\u6001\nsmartctl -H /dev/sdb\n# -t \u8FD0\u884C\u6D4B\u8BD5, -a \u67E5\u770B\u72B6\u6001\nsmartctl -t short /dev/sdb\n\n# \u574F\u5757\u68C0\u6D4B\napk add e2fsprogs-extra\n# \u6CE8\u610F: \u975E\u5E38\u6162\n# 1TB 4 runs(-w) \u5DEE\u4E0D\u591A 70 \u5C0F\u65F6\nbadblocks -v /dev/sdb\n"})}),"\n",(0,t.jsx)(s.h2,{id:"\u5355\u4E2A\u78C1\u76D8",children:"\u5355\u4E2A\u78C1\u76D8"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"iotop \u4E0D\u652F\u6301\u6307\u5B9A\u78C1\u76D8"}),"\n",(0,t.jsxs)(s.li,{children:["dstat \u5DF2\u7ECF\u4E0D\u518D\u7EF4\u62A4\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\u53EF\u5C1D\u8BD5 ",(0,t.jsx)(s.a,{href:"https://github.com/scottchiefbaker/dool",children:"scottchiefbaker/dool"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"iostat -d 10 /dev/sdf\n\ndstat -D sda,sdc\ndstat -tdD /dev/sda --top-io\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u78C1\u76D8\u53EA\u8BFB\u72B6\u6001\ncat /sys/block/sda/sda2/ro\n# \u5C06\u78C1\u76D8\u8BBE\u7F6E\u4E3A\u53EA\u8BFB\necho 1 >/sys/block/sda/sda2/ro\n"})}),"\n",(0,t.jsx)(s.h2,{id:"scsi",children:"SCSI"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/Power+Systems/page/SCSI+-+Hot+add,+remove,+rescan+of+SCSI+devices",children:"SCSI - Hot add, remove, rescan of SCSI devices"})}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'apk add lsscsi\n# \u67E5\u770B scsi \u8BBE\u5907\nlsscsi\ncat /proc/scsi/scsi\n\n# \u91CD\u65B0\u626B\u63CF\necho "- - -" > /sys/class/scsi_host/host0/scan\n# \u79FB\u9664\u8BBE\u5907\necho 1 > /sys/bus/scsi/drivers/sd/<SCSI-ID>/delete\n'})}),"\n",(0,t.jsx)(s.h2,{id:"io-load",children:"IO Load"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"apk add sysstat\n# %iowait - CPU \u7B49\u5F85 IO \u7684\u65F6\u95F4 - CPU \u8D1F\u8F7D\u9AD8\u60C5\u51B5\u8BE5\u503C\u610F\u4E49\u4E0D\u5927\niostat\n\napk add iotop\n# \u5206\u6790\u6BCF\u4E2A\u8FDB\u7A0B io \u60C5\u51B5\niotop\n"})}),"\n",(0,t.jsx)(s.h2,{id:"sar",children:"sar"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\u6536\u96C6\u8BB0\u5F55 /proc, /sys \u4FE1\u606F\u8BB0\u5F55\u5230\u6587\u4EF6\uFF0C\u7528\u4E8E\u9700\u8981\u7684\u65F6\u5019\u67E5\u770B"}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://man7.org/linux/man-pages/man1/sar.1.html",children:"sar.1"})}),"\n",(0,t.jsx)(s.li,{children:"\u914D\u7F6E /etc/sysconfig/sysstat"}),"\n",(0,t.jsxs)(s.li,{children:["\u9ED8\u8BA4\u65E5\u5FD7\u76EE\u5F55 - /var/log/sa\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"/var/log/sa/saDD"}),"\n",(0,t.jsx)(s.li,{children:"/var/log/sa/saYYYYMMDD"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# \u67E5\u770B - \u7C7B\u4F3C iostat \u7ED3\u679C\nsar\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"\u914D\u7F6E cron \u5B9A\u65F6\u751F\u6210"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"# Run sar to gather stats\n*/2 * * * *   /usr/lib/sa/sa1 1 1\n# Additional run at 23:59 to rotate the statistics file\n59 23 * * *   /usr/lib/sa/sa1 60 2\n"})})]})}function h(e={}){let{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},17776:function(e,s,n){n.d(s,{R:()=>i,x:()=>r});var a=n(7378);let t={},l=a.createContext(t);function i(e){let s=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(l.Provider,{value:s},e.children)}}}]);