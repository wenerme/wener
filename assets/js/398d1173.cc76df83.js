"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["257232"],{860356:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>l,toc:()=>o,default:()=>h,metadata:()=>s,assets:()=>d,contentTitle:()=>i});var s=JSON.parse('{"id":"service/network/curl","title":"curl","description":"- manpage","source":"@site/../notes/service/network/curl.md","sourceDirName":"service/network","slug":"/service/network/curl","permalink":"/notes/service/network/curl","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/curl.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1723961178000,"frontMatter":{"title":"curl"},"sidebar":"docs","previous":{"title":"coturn","permalink":"/notes/service/network/coturn"},"next":{"title":"DHCP","permalink":"/notes/service/network/dhcp/"}}'),r=t(486106),c=t(917776);let l={title:"curl"},i="curl",d={},o=[{value:"\u6D4B\u8BD5 CORS",id:"\u6D4B\u8BD5-cors",level:2},{value:"\u5EF6\u65F6",id:"\u5EF6\u65F6",level:2},{value:"websocket",id:"websocket",level:2},{value:"Mark bundle as not supporting multiuse",id:"mark-bundle-as-not-supporting-multiuse",level:2},{value:"bad range specification in URL position",id:"bad-range-specification-in-url-position",level:2},{value:"CApath: none",id:"capath-none",level:2},{value:"hang after TLS handshake, Client hello",id:"hang-after-tls-handshake-client-hello",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"curl",children:"curl"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://curl.se/docs/manpage.html",children:"manpage"})}),"\n",(0,r.jsx)(n.li,{children:"-J \u4F7F\u7528\u670D\u52A1\u7AEF\u8FD4\u56DE\u7684\u540D\u5B57"}),"\n",(0,r.jsxs)(n.li,{children:["--remote-name-all\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u9ED8\u8BA4 ",(0,r.jsx)(n.code,{children:"-O"})," \u53EA\u5F71\u54CD\u7B2C\u4E00\u4E2A"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u652F\u6301\u534F\u8BAE\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"file"}),"\n",(0,r.jsx)(n.li,{children:"sftp, ftp, ftps"}),"\n",(0,r.jsx)(n.li,{children:"dict gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtsp smb smbs smtp smtps telnet tftp"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u6D4B\u8BD5 SNI\n# resolve \u4E0D\u53EF\u4EE5\u6307\u5B9A\u8FDC\u7A0B port\n# connect-to \u53EF\u4EE5\u6307\u5B9A port\ncurl -vik --resolve example.com:8443:127.0.0.1 https://example.com:8443\ncurl -vik --resolve example.com:443:127.0.0.1 https://example.com\n\ncurl -vik --connect-to example.com:443:127.0.0.1:8443 https://example.com\n\ncurl -H \"Host: www.example.com\" http://localhost/\n\n# \u534F\u8BAE\u9650\u5B9A\ncurl --http1.1 --no-alpn --no-npn --tlsv1.2 --tls-max 1.2 https://example.com\n\ncurl -sI https://curl.se -o/dev/null -w '%{http_version}\\n'\ncurl -sI --http3 https://curl.se -o/dev/null -w '%{http_version}\\n'\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"flag"}),(0,r.jsx)(n.th,{children:"since"}),(0,r.jsx)(n.th,{children:"for"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-X, --request <method>"})}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-x, --proxy [protocol://]host[:port]"})}),(0,r.jsx)(n.td,{}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"https?"}),",",(0,r.jsx)(n.code,{children:"socks{4,5}{a,h}"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--json <data>"})}),(0,r.jsx)(n.td,{children:"7.82"}),(0,r.jsx)(n.td,{children:"--data+POST+Content-Type+Accept"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output-dir <dir>"})}),(0,r.jsx)(n.td,{children:"7.73"}),(0,r.jsx)(n.td,{children:"\u6307\u5B9A\u8F93\u51FA\u76EE\u5F55"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--create-dirs"})}),(0,r.jsx)(n.td,{}),(0,r.jsxs)(n.td,{children:["\u521B\u5EFA\u8F93\u51FA\u76EE\u5F55 mode=",(0,r.jsx)(n.code,{children:"0750"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-C, --continue-at <offset>"})}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"\u7EE7\u7EED\u4E0B\u8F7D"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--remote-name-all"})}),(0,r.jsx)(n.td,{}),(0,r.jsxs)(n.td,{children:["\u5168\u90E8\u4F7F\u7528 remote-name - URL \u6587\u4EF6\u540D\u90E8\u5206 - ",(0,r.jsx)(n.code,{children:"-O"})," \u53EA\u5F71\u54CD\u7B2C\u4E00\u4E2A"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-O, --remote-name"})}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"\u7B2C\u4E00\u4E2A\u4F7F\u7528 remote-name"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-J, --remote-header-name"})}),(0,r.jsx)(n.td,{}),(0,r.jsxs)(n.td,{children:["\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"Content-Disposition"})," \u5934\u91CC\u7684\u6587\u4EF6\u540D"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--create-file-mode <mode>"})}),(0,r.jsx)(n.td,{children:"7.75"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--dns-servers NS"}),(0,r.jsx)(n.td,{children:"7.33"}),(0,r.jsx)(n.td,{children:"c-ares"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-Z, --parallel"}),(0,r.jsx)(n.td,{children:"7.66"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--parallel-max <num>"})}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"50"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"--haproxy-protocol"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:"\u6D4B\u8BD5 HAProxy \u4EE3\u7406"})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["proxy\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"port=1080"}),"\n",(0,r.jsx)(n.li,{children:"socks5h - \u4F7F\u7528 \u4EE3\u7406 resolve \u540D\u5B57\u800C\u975E\u672C\u5730 dns"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-p, --proxytunnel"})," - \u4F7F\u7528 HTTP CONNECT"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -LOC- https://example.com/pancakes.jpg # \u7EE7\u7EED\u4E0A\u6B21\u4E0B\u8F7D\u4F4D\u7F6E\n\n# \u4E0B\u8F7D\u5230\u6307\u5B9A\u76EE\u5F55\uFF0C\u76EE\u5F55\u4E0D\u5B58\u5728\u5219\u521B\u5EFA\ncurl --create-dirs -O --output-dir /tmp/receipes https://example.com/pancakes.jpg\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6D4B\u8BD5-cors",children:"\u6D4B\u8BD5 CORS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl --head \\\n  -H "Origin: http://example.com" \\\n  -H "Access-Control-Request-Method: POST" \\\n  -H "Access-Control-Request-Headers: X-Requested-With" \\\n  -X OPTIONS --verbose \\\n  https://www.googleapis.com/discovery/v1/apis\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5EF6\u65F6",children:"\u5EF6\u65F6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# %{stderr} \u5199\u5165\u5230 stderr\ncat << EOF > curl-format.txt\n     time_namelookup:  %{time_namelookup}s\\n\n        time_connect:  %{time_connect}s\\n\n     time_appconnect:  %{time_appconnect}s\\n\n    time_pretransfer:  %{time_pretransfer}s\\n\n       time_redirect:  %{time_redirect}s\\n\n  time_starttransfer:  %{time_starttransfer}s\\n\n                      ----------\\n\n          time_total:  %{time_total}s\\n\nEOF\n# https://everything.curl.dev/usingcurl/verbose/writeout\ncurl -o /dev/null -s -w "@curl-format.txt" https://wener.me\ncat curl-format.txt | curl -o /dev/null -s -w @- https://wener.me\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"     time_namelookup:  0.001639s\n        time_connect:  1.230475s\n     time_appconnect:  1.708174s\n    time_pretransfer:  1.708254s\n       time_redirect:  0.000000s\n  time_starttransfer:  1.962050s\n                      ----------\n          time_total:  1.971632s\n"})}),"\n",(0,r.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h2,{id:"websocket",children:"websocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl --include \\\n  --no-buffer \\\n  --header "Connection: Upgrade" \\\n  --header "Upgrade: websocket" \\\n  --header "Host: example.com:80" \\\n  --header "Origin: http://example.com:80" \\\n  --header "Sec-WebSocket-Key: SGVsbG8sIHdvcmxkIQ==" \\\n  --header "Sec-WebSocket-Version: 13" \\\n  http://example.com:80/\n\n# https://github.com/vi/websocat\napk add websocat\n\nwebsocat -vv \'wss://\'\n'})}),"\n",(0,r.jsx)(n.h2,{id:"mark-bundle-as-not-supporting-multiuse",children:"Mark bundle as not supporting multiuse"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HTTP/2 \u68C0\u6D4B"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/curl/curl/blob/da973165965962a435a23ade336d9a17daf044ef/lib/http.c#L4276-L4279",children:"lib/http.c#L4276-L4279"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'if(conn->httpversion < 20) {\n   conn->bundle->multiuse = BUNDLE_NO_MULTIUSE;\n   infof(data, "Mark bundle as not supporting multiuse\\n");\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"bad-range-specification-in-url-position",children:"bad range specification in URL position"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"-g/--globoff"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -g "https://wener.me/[1,2]"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"capath-none",children:"CApath: none"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"CAfile: /etc/ssl/certs/ca-certificates.crt\nCApath: none\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CURL_CA_BUNDLE"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# /usr/share/ca-certificates\napk add ca-certificates\n\n# /etc/ssl/certs/ca-certificates.crt\n# /etc/ssl/cert.pem\n# /etc/ssl1.1/cert.pem\n# /etc/ssl1.1/certs\napk add ca-certificates-bundle\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hang-after-tls-handshake-client-hello",children:"hang after TLS handshake, Client hello"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53EF\u80FD\u662F MTU \u95EE\u9898"}),"\n",(0,r.jsxs)(n.li,{children:["docker in docker \u7684\u65F6\u5019\u51FA\u73B0\u4E86\uFF0C\u8C03\u4F4E mtu\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"dockerd --mtu=1400"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/microsoft/WSL/issues/4698#issuecomment-871279847",children:"https://github.com/microsoft/WSL/issues/4698#issuecomment-871279847"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://serverfault.com/questions/231036",children:"https://serverfault.com/questions/231036"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},917776:function(e,n,t){t.d(n,{R:()=>l,x:()=>i});var s=t(7378);let r={},c=s.createContext(r);function l(e){let n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);