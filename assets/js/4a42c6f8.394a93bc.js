"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["80742"],{36595:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>l,toc:()=>c,default:()=>x,metadata:()=>i,assets:()=>o,contentTitle:()=>d});var i=JSON.parse('{"id":"voip/openvox-asterisk","title":"OpenVox Asterisk","description":"- \u53C2\u8003","source":"@site/../notes/voip/openvox-asterisk.md","sourceDirName":"voip","slug":"/voip/openvox-asterisk","permalink":"/notes/voip/openvox-asterisk","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/voip/openvox-asterisk.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1624798319000,"frontMatter":{"title":"OpenVox Asterisk"},"sidebar":"docs","previous":{"title":"\u786C\u4EF6\u8BBE\u5907","permalink":"/notes/voip/hardware/"},"next":{"title":"OpenVox","permalink":"/notes/voip/openvox"}}'),t=s(86106),r=s(17776);let l={title:"OpenVox Asterisk"},d="OpenVox Asterisk",o={},c=[{value:"macro",id:"macro",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"openvox-asterisk",children:"OpenVox Asterisk"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://openvoxwiki.atlassian.net/wiki/spaces/VG/pages/2473082832/GSM+Gateways+APP+Note",children:"GSM Gateways APP Note"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u53D1\u8D77\u547C\u53EB\nchannel originate SIP/6003 extension 10086@sip-6003\nchannel originate IAX2/dev/6003 extension 10086@iax-dev\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"conf"}),(0,t.jsx)(e.th,{children:"val"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astetcdir"}),(0,t.jsx)(e.td,{children:"/etc/asterisk"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astmoddir"}),(0,t.jsx)(e.td,{children:"/usr/lib/asterisk/modules"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astvarlibdir"}),(0,t.jsx)(e.td,{children:"/usr/lib/asterisk"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astagidir"}),(0,t.jsx)(e.td,{children:"/usr/lib/asterisk/agi-bin"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astspooldir"}),(0,t.jsx)(e.td,{children:"/tmp/media/spool/asterisk"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astrundir"}),(0,t.jsx)(e.td,{children:"/var/run"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astlogdir"}),(0,t.jsx)(e.td,{children:"/tmp/log/asterisk"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"astdatadir"}),(0,t.jsx)(e.td,{children:"/etc/asterisk"})]})]})]}),"\n",(0,t.jsx)(e.admonition,{title:"\u{1F4A1}",type:"tip",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"spool \u4E3A /tmp/media/spool/asterisk"}),"\n",(0,t.jsx)(e.li,{children:"\u5F55\u97F3\u5B58\u50A8\u5728 /tmp/media/spool/asterisk/monitor"}),"\n",(0,t.jsx)(e.li,{children:"tmpfs \u6839\u636E\u5185\u5B58\u4E0D\u4E00\u6837\u5927\u5C0F\u4E0D\u4E00\u6837 - \u5C0F\u7684\u53EF\u80FD\u53EA\u6709 30MB \u5DE6\u53F3 free \u5185\u5B58"}),"\n"]})}),"\n",(0,t.jsx)(e.admonition,{title:"\u26A0\uFE0F",type:"caution",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["wg \u7CFB\u5217\u6CA1\u6709 app_stack\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u57FA\u4E8E Debian 8, Linux 4.19.81, asterisk 1.8.20"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"rtg - \u8DEF\u7531\u5206\u7EC4"}),"\n",(0,t.jsxs)(e.li,{children:["\u4E00\u4E2A\u8DEF\u7531\u89C4\u5219\u4F1A\u57FA\u4E8E\u76EE\u6807\u751F\u6210 N \u4E2A context - ",(0,t.jsx)(e.code,{children:"rtg-test-1"})]}),"\n",(0,t.jsx)(e.li,{children:"\u6BCF\u4E2A\u76EE\u6807 include \u4E00\u4E2A"}),"\n",(0,t.jsxs)(e.li,{children:["sounds - \u53EA\u6709\u90E8\u5206 sounds \u53EF\u7528\u4E8E\u6D4B\u8BD5\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"agent-pass.gsm"}),"\n",(0,t.jsx)(e.li,{children:"auth-incorrect.gsm"}),"\n",(0,t.jsx)(e.li,{children:"auth-thankyou.gsm"}),"\n",(0,t.jsx)(e.li,{children:"vm-goodbye.gsm"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:'; \u81EA\u5B9A\u4E49\u8DEF\u7531 \u76EE\u6807 channel \u8BBE\u7F6E\u4E3A custom \u652F\u6301\u81EA\u5B9A\u4E49\u4E0A\u4E0B\u6587\n; Macro(my-inside) -> macro-my-inside\n[rtg-test-1]\nexten => _[*#+0-9].,1,NoOp(_[*#+0-9]. matches Rule rtg-test-1)\nexten => _[*#+0-9].,n,Set(CDR_CALLEEID=${EXTEN})\nexten => _[*#+0-9].,n,Macro(my-inside)\nexten => _[*#+0-9].,n(nochannel),ChannelHangup("${CDR_TOCHAN}")\nexten => _[*#+0-9].,n,Goto(nocdr,s,1)\nexten => _[*#+0-9].,n,Hangup()\n\n[nothingtodo]\nexten => _[*#+0-9].,1,NoOp(Nothing to do, Not setting out channel)\nexten => _[*#+0-9].,n,Hangup(42)\n\n# SIP \u5185\u7EBF\n[internalsip]\nexten => _9X.,1,NoOp(SIP Internal Call)\nexten => _9X.,n,Set(CDR_CALLEEID=${EXTEN:1})\nexten => _9X.,n,Set(CDR_TOCHAN=${EXTEN:1})\nexten => _9X.,n,Set(CDR_TOCHAN=${SHELL(/my_tools/get_sipendpointname "${CDR_TOCHAN}")})\nexten => _9X.,n,Dial(SIP/${EXTEN:1})\nexten => _9X.,n,Hangup(42)\n\n# SIP \u51FA\u5C40\u903B\u8F91\n[sipinbound]\nexten => _[*#+0-9].,1,NoOp(SIP Inbound)\nexten => _[*#+0-9].,n,GotoIf(${DIALPLAN_EXISTS(${SIPROUTE},${EXTEN},1)}?:nocdr)\nexten => _[*#+0-9].,n,Goto(${SIPROUTE},${EXTEN},1)\nexten => _[*#+0-9].,n(nocdr),Goto(nocdr,s,1)\n\n[iaxinbound]\nexten => _[*#+0-9].,1,NoOp(IAX Inbound)\nexten => _[*#+0-9].,n,GotoIf(${DIALPLAN_EXISTS(${IAXROUTE},${EXTEN},1)}?:nocdr)\nexten => _[*#+0-9].,n,Goto(${IAXROUTE},${EXTEN},1)\nexten => _[*#+0-9].,n(nocdr),Goto(nocdr,s,1)\n\n[nocdr]\nexten => s,1,ChannelHangup("${CDR_TOCHAN}")\nexten => s,n,Hangup(42)\n\n[globals]\n# \u9ED8\u8BA4 SIP \u8DEF\u7531\nSIPROUTE=sipdefault\n'})}),"\n",(0,t.jsx)(e.h2,{id:"macro",children:"macro"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["dial-failover\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["gsm\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"Macro(dial-failover,,${EXTEN},${POLICY_GROUP-RND-OUT},RET)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4F8B\u5982 ",(0,t.jsx)(e.code,{children:'Macro("SIP/6003-0000000c", "dial-failover,,10086,extra/7,0,gsm-4,RET")'})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"ARG1 forward callee id"}),"\n",(0,t.jsx)(e.li,{children:"ARG2 dial extension"}),"\n",(0,t.jsx)(e.li,{children:"ARG3 \u8BBE\u5907"}),"\n",(0,t.jsx)(e.li,{children:"ARG4 extension flag"}),"\n",(0,t.jsx)(e.li,{children:"ARG5 CDR_TOCHAN"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["wg - ",(0,t.jsx)(e.code,{children:"Macro(dial-failover,,${CDR_CALLEEID},RET,extra/r1,0,0)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"ARG1 \u547C\u8F6C\u53F7\u7801"}),"\n",(0,t.jsx)(e.li,{children:"ARG2 \u8865\u53EB\u53F7"}),"\n",(0,t.jsx)(e.li,{children:"ARG3 \u8FD4\u56DE - nocarrier, hangup, congestion"}),"\n",(0,t.jsx)(e.li,{children:"ARG4 \u8BBE\u5907"}),"\n",(0,t.jsx)(e.li,{children:"ARG5 \u989D\u5916\u6807\u8BC6"}),"\n",(0,t.jsx)(e.li,{children:"ARG6 CDR \u4E2D\u7684 TO"}),"\n",(0,t.jsx)(e.li,{children:"4\uFF0C5\uFF0C6 \u53D8\u91CF\u5728\u6BCF\u4E00\u6B21 failover \u4F1A\u9012\u589E"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function x(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>l,x:()=>d});var i=s(7378);let t={},r=i.createContext(t);function l(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);