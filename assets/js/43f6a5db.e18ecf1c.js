"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["829125"],{509911:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>o,toc:()=>l,default:()=>h,metadata:()=>i,assets:()=>a,contentTitle:()=>c});var i=JSON.parse('{"id":"service/network/vpn/strongswan/strongswan-conf","title":"strongSwan \u914D\u7F6E","description":"- ConfigurationFiles","source":"@site/../notes/service/network/vpn/strongswan/strongswan-conf.md","sourceDirName":"service/network/vpn/strongswan","slug":"/service/network/vpn/strongswan/conf","permalink":"/notes/service/network/vpn/strongswan/conf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/vpn/strongswan/strongswan-conf.md","tags":[{"inline":true,"label":"Configuration","permalink":"/notes/tags/configuration"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1680070123000,"frontMatter":{"title":"strongSwan \u914D\u7F6E","tags":["Configuration"]},"sidebar":"docs","previous":{"title":"strongSwan","permalink":"/notes/service/network/vpn/strongswan/"},"next":{"title":"strongSwan Cookbook","permalink":"/notes/service/network/vpn/strongswan/cookbook"}}'),t=s(486106),r=s(917776);let o={title:"strongSwan \u914D\u7F6E",tags:["Configuration"]},c="strongSwan \u914D\u7F6E",a={},l=[{value:"strongswan.conf",id:"strongswanconf",level:2},{value:"strongswan.d",id:"strongswand",level:3},{value:"swanctl.conf",id:"swanctlconf",level:2},{value:"ipsec.conf",id:"ipsecconf",level:2},{value:"\u81EA\u52A8\u91CD\u8FDE",id:"\u81EA\u52A8\u91CD\u8FDE",level:2},{value:"ipsec.conf to swanctl.conf",id:"ipsecconf-to-swanctlconf",level:2}];function d(n){let e={a:"a",annotation:"annotation",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"strongswan-\u914D\u7F6E",children:"strongSwan \u914D\u7F6E"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/ConfigurationFiles",children:"ConfigurationFiles"})}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"strongswanconf",children:"strongswan.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/StrongswanConf",children:"strongswan.conf"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Daemon \u914D\u7F6E, \u9ED8\u8BA4\u662F stroke \u63D2\u4EF6, starter \u542F\u52A8 ipsec.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsxs)(e.mrow,{children:[(0,t.jsxs)(e.mrow,{children:[(0,t.jsx)(e.mi,{children:"s"}),(0,t.jsx)(e.mi,{children:"y"}),(0,t.jsx)(e.mi,{children:"s"}),(0,t.jsx)(e.mi,{children:"c"}),(0,t.jsx)(e.mi,{children:"o"}),(0,t.jsx)(e.mi,{children:"n"}),(0,t.jsx)(e.mi,{children:"f"}),(0,t.jsx)(e.mi,{children:"d"}),(0,t.jsx)(e.mi,{children:"i"}),(0,t.jsx)(e.mi,{children:"r"})]}),(0,t.jsx)(e.mo,{children:"\u2212"})]}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"{sysconfdir} - "})]})})}),(0,t.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",children:"sysco"}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"n"}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"fd"}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"i"}),(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"})]}),(0,t.jsx)(e.span,{className:"mord",children:"\u2212"})]})})]}),"{prefix}/etc"]}),"\n",(0,t.jsx)(e.li,{children:"${piddir} - /var/run"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u57FA\u7840\u914D\u7F6E"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"charon {\n    load_modular = yes\n    plugins {\n        include strongswan.d/charon/*.conf\n    }\n}\n\ninclude strongswan.d/*.conf\n"})}),"\n",(0,t.jsx)(e.h3,{id:"strongswand",children:"strongswan.d"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"charon/ - \u63D2\u4EF6\u914D\u7F6E\u76EE\u5F55"}),"\n",(0,t.jsx)(e.li,{children:"charon-logging.conf"}),"\n",(0,t.jsx)(e.li,{children:"charon.conf"}),"\n",(0,t.jsx)(e.li,{children:"pki.conf"}),"\n",(0,t.jsx)(e.li,{children:"pool.conf"}),"\n",(0,t.jsx)(e.li,{children:"scepclient.conf"}),"\n",(0,t.jsx)(e.li,{children:"starter.conf"}),"\n",(0,t.jsx)(e.li,{children:"swanctl.conf"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"swanctlconf",children:"swanctl.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/Swanctlconf",children:"swanctl.conf"})}),"\n",(0,t.jsx)(e.li,{children:"/etc/swanctl/swanctl.conf"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"connections {\n  connection-name {\n    # 0 - \u54CD\u5E94 IKEv1, IKEv2; \u4F7F\u7528 IKEv2\n    # 1 - IKEv1/ISAKMP\n    # 2 - IKEv2\n    version=0\n\n    # XFRM\n    if_id_in=0\n    if_id_out=0\n\n    # ipsec left\n    # \u6DFB\u52A0\u540E\u7F00\u6307\u5B9A\u591A\u4E2A local-2, local-3\n    local {\n    }\n    # ipsec right\n    remote {\n    }\n    children {\n      child-name {\n      }\n    }\n  }\n}\n# \u865A\u62DF\u5730\u5740\n# ipsec rightsourceip, rightdns\npools {\n}\n# \u7C7B\u4F3C ipsec.secrets\nsecrets {\n}\n# ipsec.conf ca\nauthorities {\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"connections.<conn>.remote<suffix>.auth"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"connections.<conn>.children.<child>.local_ts"})}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# connections\nswanctl --load-conns\n# pools\nswanctl --load-pools\n# secrets\nswanctl --load-creds\n# authorities\nswanctl --load-authorities\n"})}),"\n",(0,t.jsx)(e.h2,{id:"ipsecconf",children:"ipsec.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/IKEv2CipherSuites",children:"IKEv2 Cipher Suites"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/IpsecConf",children:"ipsec.conf"})}),"\n",(0,t.jsx)(e.li,{children:"/etc/ipsec.conf"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# \u901A\u7528\u914D\u7F6E\nconfig setup\n# \u53EF\u5305\u542B\u5916\u90E8\u914D\u7F6E\n# include ipsec.*.conf\n\n  cachecrls=no\n  # dmn, mgr, ike, chd, job, cfg, knl, net, asn, enc, lib, esp, tls, tnc, imc, imv, pts\n  # -1,0,1,2,3,4\n  # charondebug=dmn 3, ike 1, net -1\n  # IKE charon daemon\n  charonstart=yes\n  # yes | ifuri | no\n  strictcrlpolicy=no\n  # yes | no | never | replace | keep\n  uniqueids = yes\n\n  # 5.0.0 \u4E4B\u524D IKEv1 pluto daemon \u6709\u5176\u4ED6\u914D\u7F6E\u9879\u76EE\n\n# \u5B9A\u4E49\u8FDE\u63A5\n# conn <name>\n# \u9ED8\u8BA4\u8FDE\u63A5\u914D\u7F6E\nconn %default\n\n# \u5B9A\u4E49 CA\n# ca <name>\n# \u9ED8\u8BA4 CA \u914D\u7F6E\nca %default\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"conn"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# IKEv2 EAP auth \u65F6 AAA \u540E\u7AEF\u6807\u8BC6\u7B26\n# aaa_identity = <id>\n\n# \u4E0E esp \u914D\u7F6E\u4E92\u65A5 - \u9ED8\u8BA4 esp\n# ah = <cipher suites>\n\n# IKEv1 Aggressive or Main Mode\naggressive=no\n\n# \u5305\u542B\u5176\u4ED6 section \u914D\u7F6E\n# also = <name>\n\n# pubkey | rsasig | ecdsasig | psk | secret | xauthrsasig | xauthpsk | never\nauthby = pubkey\n\n# ignore | add | route | start\n# add - \u52A0\u8F7D\u4E0D\u542F\u52A8, route - \u52A0\u8F7D\u5B89\u88C5 trap \u5982\u679C\u5339\u914D leftsubnet rightsubnet \u5219\u542F\u52A8, start - \u52A0\u8F7D\u542F\u52A8,\nauto = ignore\n\n# \u8FDC\u7A0B\u610F\u5916\u5173\u95ED\u8FDE\u63A5\u65F6\u89E6\u53D1\u52A8\u4F5C\n# none | clear | hold | restart\ncloseaction = none\n\n# IPComp \u5185\u5BB9\u538B\u7F29 - \u5728\u52A0\u5BC6\u524D\ncompress = no\n\n# Dead Peer Detection\n# none | clear | hold | restart\n# hold - \u5B89\u88C5 trap \u5339\u914D\u7684\u65F6\u5019\u518D\u91CD\u65B0\u534F\u5546\u8FDE\u63A5\ndpdaction = none\ndpddelay = 30s\ndpdtimeout = 150s\n\n# \u4E0D\u6D3B\u8DC3\u8D85\u65F6\u540E\u5173\u95ED\u8FDE\u63A5\n# inactivity = <time>\n\n# %identity - EAP Identity method\n# eap_identity = <id>\nesp = aes128-sha256\n\n# \u5F3A\u5236 udp \u5C01\u88C5 esp \u5305 - \u5373\u4FBF\u6CA1\u6709\u68C0\u6D4B\u5230 NAT\nforceencaps = no\n# yes | accept | force | no\nfragmentation = yes\n\nike = aes128-sha256-modp3072\nikedscp = 000000\n# keying channel \u8FDE\u63A5 (ISAKMP , IKE SA) \u751F\u547D\u5468\u671F - \u5230\u671F\u4ECE\u65B0\u534F\u5546\nikelifetime = 3h\ninstallpolicy = yes\n# ike | ikev1 | ikev2\n# ike \u53D1\u8D77 ikev2 \u4F46\u4E5F\u63A5\u53D7 ikev1\nkeyexchange = ike\n# \u534F\u5546\u91CD\u8BD5\u6B21\u6570\nkeyingtries = 3 # %forever\n\n# lifebytes = <number>\n# lifepackets = <number>\nlifetime = 1h\n\n# marginbytes = <number>\n# marginpackets = <number>\nmargintime = 9m\n\n# xfrm \u8FDE\u63A5 mark\n# mark = <value>[/<mask>]\n# mark_in = <value>[/<mask>]\n# mark_our = <value>[/<mask>]\n\nmobike = yes\n\n# push | pull\nmodeconfig = pull\n\nreauth = yes\nrekey = yes\nrekeyfuzz = 100%\nreplay_window = -1\n\n# reqid = <number>\nsha256_96 = no\n# tfc = <value>\n\n# tunnel | transport | transport_proxy | passthrough | drop\n# tunnel - host-to-host, host-to-subnet, subnet-to-subnet\n# transport - host-to-host\n# transport_proxy - Mobile IPv6 transport proxy\n# passthrough - \u65E0 ipsec \u5904\u7406\ntype = tunnel\n\n# client | server\nxauth = client\n# xauth_identity = <id>\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"left|right"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u9ED8\u8BA4 left \u4E3A\u672C\u5730"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# <ip address> | <fqdn> | %any | %any4 | %any6 | range | subnet\n# %any - \u534F\u5546\u65F6\u81EA\u52A8\u586B\u5145\n# %defaultroute - 5.0 \u4E4B\u524D\u7684 %any\n# % \u524D\u7F00\u9690\u542B rightallowany=yes\nright=%any\nrightallowany=no\n\n# rightauth = <auth method>\n# rightauth2 = <auth method>\n# rightca = <issuer dn> | %same\n# rightca2 = <issuer dn> | %same\n# rightcert = <path>\n# rightcert2 = <path>\n# rightcertpolicy = <OIDs>\n# rightdns = <servers>\nrightfirewall = no\n# rightgroups = <group list>\n# rightgroups2 = <group list>\nrighthostaccess = no\n# rightid = <id>\n# rightid2 = <id>\nrightikeport = <port>\nrightprotoport = <protocol>/<port>\nrightrsasigkey = <raw rsa public key> | <path to public key>\nrightsigkey = <raw public key> | <path to public key>\n# never | no | ifasked | always | yes\nrightsendcert = ifasked\n\n# \u865A\u62DF IP\n# 5.0.1 \u4E4B\u540E\u652F\u6301 \u9017\u53F7 \u5206\u5272\u591A\u4E2A\u503C - \u591A\u4E2A IP\n# %config, %cfg, %modeconfig, %modecfg\n# leftsourceip = %config4 | %config6 | <ip address>\n\n# rightsourceip = %config | <network>/<netmask> | <from>-<to> | %poolname\n\n# \u9ED8\u8BA4 left/32|128\n# \u9650\u5B9A\u534F\u8BAE\u548C\u7AEF\u53E3 - 10.0.0.1[tcp/http],fec1::1[udp],10.0.0.0/16[/53]\n# 5.1.0 - \u5FFD\u7565\u7684\u503C\u53EF\u4F7F\u7528 %any - fec1::1[udp/%any],10.0.0.0/16[%any/53]\n# %opaque RFC 4301 OPAQUE \u534F\u8BAE\u9009\u62E9\n# %dynamic \u7B49\u540C\u4E8E\u5FFD\u7565\u8BE5\u914D\u7F6E\n# rightsubnet = <ip subnet>[[<proto/port>]][,...]\n# \u811A\u672C\u76EE\u5F55\n# rightupdown = <path>\n\n# Mediation Extension\nmediation = no\n# mediated_by = <name>\n# me_peerid = <id>\n"})}),"\n",(0,t.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(e.h2,{id:"\u81EA\u52A8\u91CD\u8FDE",children:"\u81EA\u52A8\u91CD\u8FDE"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ini",children:"# \u5982\u679C\u6CA1\u7528\u5230 virtual ip\nauto=route\n\n# vip - \u91CD\u5EFA SAs\ndpdaction=restart\ncloseaction=restart\nkeyingtries=%forever\nauto=start\n"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["\u53C2\u8003 ",(0,t.jsx)(e.a,{href:"https://serverfault.com/a/970035/190601",children:"https://serverfault.com/a/970035/190601"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"ipsecconf-to-swanctlconf",children:"ipsec.conf to swanctl.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"https://wiki.strongswan.org/projects/strongswan/wiki/Fromipsecconf",children:"Migration from ipsec.conf to swanctl.conf"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://gitlab.com/Thermi/ipsec2swanctl",children:"Thermi/ipsec2swanctl"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"curl -LO https://gitlab.com/Thermi/ipsec2swanctl/-/raw/master/ipsec2swanctl.py\n\npython3 ipsec2swanctl.py --ipsecconf /etc/ipsec.conf -o swanctl.conf -d -w\n\nswanctl --load-conns --file swanctl.conf\n"})})]})}function h(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},917776:function(n,e,s){s.d(e,{R:()=>o,x:()=>c});var i=s(7378);let t={},r=i.createContext(t);function o(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);