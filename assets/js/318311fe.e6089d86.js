"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["55150"],{14479:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>t,toc:()=>a,default:()=>x,metadata:()=>s,assets:()=>d,contentTitle:()=>c});var s=JSON.parse('{"id":"voip/asterisk/asterisk-ami","title":"Asterisk AMI","description":"- AMI - Asterisk Manager Interface","source":"@site/../notes/voip/asterisk/asterisk-ami.md","sourceDirName":"voip/asterisk","slug":"/voip/asterisk/ami","permalink":"/notes/voip/asterisk/ami","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/voip/asterisk/asterisk-ami.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1621756378000,"frontMatter":{"title":"Asterisk AMI"},"sidebar":"docs","previous":{"title":"Asterisk AGI","permalink":"/notes/voip/asterisk/agi"},"next":{"title":"ARI","permalink":"/notes/voip/asterisk/air"}}'),l=i(86106),r=i(17776);let t={title:"Asterisk AMI"},c="Asterisk AMI",d={},a=[{value:"AMI \u534F\u8BAE",id:"ami-\u534F\u8BAE",level:2},{value:"\u4E00\u6B21\u547C\u53EB\u8FC7\u7A0B\u4EA7\u751F\u7684\u4E8B\u4EF6",id:"\u4E00\u6B21\u547C\u53EB\u8FC7\u7A0B\u4EA7\u751F\u7684\u4E8B\u4EF6",level:2}];function h(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"asterisk-ami",children:"Asterisk AMI"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AMI - Asterisk Manager Interface"}),"\n",(0,l.jsxs)(e.li,{children:["\u914D\u7F6E\u6587\u4EF6 ",(0,l.jsx)(e.code,{children:"manager.conf"})]}),"\n",(0,l.jsx)(e.li,{children:"\u9ED8\u8BA4\u7AEF\u53E3 5038"}),"\n",(0,l.jsxs)(e.li,{children:["\u670D\u52A1\u7AEF\u4F1A\u4E3B\u52A8\u53D1\u9001\u5934 ",(0,l.jsx)(e.code,{children:"Asterisk Call Manager/3.2.0"})]}),"\n",(0,l.jsx)(e.li,{children:"\u54CD\u5E94\u5747\u4E3A\u5F02\u6B65\u4E8B\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"\u5305\u7C7B\u578B\u5206\u4E3A: \u4E8B\u4EF6, \u54CD\u5E94, \u548C\u53D1\u9001\u7684\u64CD\u4F5C"}),"\n",(0,l.jsx)(e.li,{children:"\u683C\u5F0F\u7C7B\u4F3C\u4E8E HTTP \u5934"}),"\n",(0,l.jsx)(e.li,{children:"Action,Response,Event \u5FC5\u987B\u5728\u7B2C\u4E00\u884C"}),"\n",(0,l.jsx)(e.li,{children:"\u8BF7\u6C42\u901A\u8FC7 ActionID, \u670D\u52A1\u7AEF\u8FD4\u56DE ActionID \u6765\u8BC6\u522B\u54CD\u5E94"}),"\n",(0,l.jsxs)(e.li,{children:["\u4E00\u6B21\u8BF7\u6C42\u9664\u4E86\u4F1A\u8FD4\u56DE\u4E00\u4E2A\u54CD\u5E94\u4EE5\u5916, \u53EF\u80FD\u8FD8\u4F1A\u8303\u56F4\u4E00\u5217\u6570\u636E, \u6B64\u65F6\u5217\u6570\u636E\u662F\u901A\u8FC7\u4E8B\u4EF6\u53D1\u9001\u7684, \u6CA1\u6709 ActionID\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4F8B\u5982: \u4EE5 ",(0,l.jsx)(e.code,{children:"EndpointDetail"})," \u5F00\u59CB, \u4EE5 ",(0,l.jsx)(e.code,{children:"EndpointDetailComplete"})," \u7ED3\u675F"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Action\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"CLIENT -> Asterisk"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Response\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"CLIENT -> Asterisk -Response-> CLIENT"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Event\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Asterisk -> CLIENT"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://wiki.asterisk.org/wiki/display/AST/AMI+v2+Specification",children:"AMI v2 Specification"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"asterisk 12+"}),"\n",(0,l.jsx)(e.li,{children:"\u7248\u672C\u53F7\u4E3A 2.0.0 - asterisk 1.8 \u662F 1.1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AMI v1 \u53EF\u80FD\u5185\u5BB9\u5305\u542B\u6362\u884C"}),"\n",(0,l.jsx)(e.li,{children:"UTF8 \u5305\u542B BOM - EF BB BF"}),"\n"]})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u547D\u4EE4\u6587\u6863\nasterisk -rx 'manager show commands'\n# \u4E8B\u4EF6\u6587\u6863\nasterisk -rx 'manager show events'\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"manager.conf"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/asterisk/asterisk/blob/1.8/configs/manager.conf.sample",children:"1.8/configs/manager.conf.sample"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"ami-\u534F\u8BAE",children:"AMI \u534F\u8BAE"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u521D\u59CB\u670D\u52A1\u7AEF\u4F1A\u53D1\u9001\u4E00\u6761\u4FE1\u606F\u5305\u542B\u7248\u672C\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"Asterisk Call Manager/1.1"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u4F1A\u63A5\u6536\u5230 FullyBooted \u8868\u793A\u542F\u52A8\u5B8C\u6210"}),"\n",(0,l.jsx)(e.li,{children:"\u65B0\u7248\u672C\u4F1A\u8FD4\u56DE SuccessfulAuth - \u5305\u542B\u8D26\u53F7\u6743\u9650\u3001\u94FE\u63A5\u7B49\u4FE1\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u670D\u52A1\u9000\u51FA\u6216\u91CD\u542F\u4F1A\u53D1\u9001 Shutdown"}),"\n",(0,l.jsxs)(e.li,{children:["Newchannel - \u901A\u9053\u5EFA\u7ACB\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5305\u542B Uniqueid \u53EF\u7528\u4E8E\u6301\u7EED\u8DDF\u8E2A\u901A\u9053"}),"\n",(0,l.jsx)(e.li,{children:"\u7136\u540E\u4F1A\u6709\u5F88\u591A VarSet - SIPURI"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u4E00\u6B21\u547C\u53EB\u8FC7\u7A0B\u4EA7\u751F\u7684\u4E8B\u4EF6",children:"\u4E00\u6B21\u547C\u53EB\u8FC7\u7A0B\u4EA7\u751F\u7684\u4E8B\u4EF6"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Event: Newchannel\nPrivilege: call,all\nChannelState: 0\nCallerIDNum: 6003\nAccountCode:\nChannel: SIP/6003-000000de\nChannelStateDesc: Down\nCallerIDName:\nExten: 10085\nContext: sipinbound\nUniqueid: 1621433208.393\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"SIPURI=sip:6003@192.168.1.2"}),"\n",(0,l.jsx)(e.li,{children:"SIPDOMAIN=192.168.1.2"}),"\n",(0,l.jsx)(e.li,{children:"SIPCALLID=NKEVsn22tE"}),"\n",(0,l.jsx)(e.li,{children:"SIPROUTE=sip-6003 - \u5E94\u7528\u81EA\u5B9A\u4E49"}),"\n",(0,l.jsx)(e.li,{children:"Newstate - Ring"}),"\n",(0,l.jsx)(e.li,{children:"Newexten - \u6267\u884C\u7684 extension \u5E8F\u5217"}),"\n",(0,l.jsxs)(e.li,{children:["Macro \u5305\u542B\u7684\u53D8\u91CF\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"MACRO_EXTEN"}),"\n",(0,l.jsx)(e.li,{children:"MACRO_CONTEXT"}),"\n",(0,l.jsx)(e.li,{children:"MACRO_PRIORITY"}),"\n",(0,l.jsx)(e.li,{children:"MACRO_DEPTH"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Newchannel - EXTRA/7-1 \u5BF9\u65B9\u901A\u9053\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DIALEDPEERNUMBER=7/10086"}),"\n",(0,l.jsx)(e.li,{children:"NewCallerid EXTRA/7-1"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Newstate - Dialing"}),"\n",(0,l.jsx)(e.li,{children:"Dial"}),"\n",(0,l.jsx)(e.li,{children:"RTCPReceived"}),"\n",(0,l.jsx)(e.li,{children:"RTCPSent"}),"\n",(0,l.jsx)(e.li,{children:"Newstate - Up"}),"\n",(0,l.jsx)(e.li,{children:"DIALSTATUS=ANSWER"}),"\n",(0,l.jsx)(e.li,{children:"DIALEDPEERNAME=EXTRA/7-1"}),"\n",(0,l.jsx)(e.li,{children:"BRIDGEPEER=EXTRA/7-1 - \u4E24\u4E2A\u901A\u8FBE\u8BBE\u7F6E\u5BF9\u65B9\u4E3A peer"}),"\n",(0,l.jsx)(e.li,{children:"BRIDGEPEER=SIP/6003-000000de"}),"\n",(0,l.jsx)(e.li,{children:"Bridge"}),"\n",(0,l.jsx)(e.li,{children:"BRIDGEPVTCALLID=NKEVsn22tE"}),"\n",(0,l.jsx)(e.li,{children:"Unlink - \u65AD\u5F00 bridge"}),"\n",(0,l.jsx)(e.li,{children:"ANSWEREDTIME=16"}),"\n",(0,l.jsx)(e.li,{children:"ExtraUp - \u677F\u5361 Board=1"}),"\n",(0,l.jsx)(e.li,{children:"Hangup - EXTRA/7-1"}),"\n",(0,l.jsxs)(e.li,{children:["RTPAUDIOQOS=ssrc=1662980482;themssrc=2301022491;lp=0;rxjitter=0.014852;rxcount=1238;txjitter=0.000000;txcount=1238;rlp=0;rtt=0.005000\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RTP QOS \u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Hangup - SIP/6003-000000de\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"CallerIDNum: 6003"}),"\n",(0,l.jsx)(e.li,{children:"Uniqueid: 1621433208.393"}),"\n"]}),"\n"]}),"\n"]})]})}function x(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}},17776:function(n,e,i){i.d(e,{R:()=>t,x:()=>c});var s=i(7378);let l={},r=s.createContext(l);function t(n){let e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);