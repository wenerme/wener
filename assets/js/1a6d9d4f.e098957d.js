"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["722743"],{352592:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>t,toc:()=>h,default:()=>x,metadata:()=>s,assets:()=>d,contentTitle:()=>c});var s=JSON.parse('{"id":"devops/kubernetes/k8s-my-practice","title":"\u6211\u7684 K8S \u5B9E\u8DF5","description":"- \u4E00\u5B9A\u8282\u70B9\u89C4\u6A21\u540E\u6CE8\u610F\u8282\u70B9\u89D2\u8272\u5212\u5206","source":"@site/../notes/devops/kubernetes/k8s-my-practice.md","sourceDirName":"devops/kubernetes","slug":"/devops/kubernetes/my-practice","permalink":"/notes/devops/kubernetes/my-practice","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/k8s-my-practice.md","tags":[{"inline":true,"label":"Practices","permalink":"/notes/tags/practices"},{"inline":true,"label":"Thoughs","permalink":"/notes/tags/thoughs"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1664421654000,"frontMatter":{"title":"\u6211\u7684 K8S \u5B9E\u8DF5","tags":["Practices","Thoughs"]},"sidebar":"docs","previous":{"title":"Managed","permalink":"/notes/devops/kubernetes/managed"},"next":{"title":"Kubernetes Best Practices","permalink":"/notes/devops/kubernetes/practice"}}'),i=l(486106),r=l(917776);let t={title:"\u6211\u7684 K8S \u5B9E\u8DF5",tags:["Practices","Thoughs"]},c="\u6211\u7684 K8S \u5B9E\u8DF5",d={},h=[{value:"Disto \u9009\u62E9\u5F88\u91CD\u8981",id:"disto-\u9009\u62E9\u5F88\u91CD\u8981",level:2},{value:"\u4F18\u5148\u624B\u5199 Yaml",id:"\u4F18\u5148\u624B\u5199-yaml",level:2},{value:"\u670D\u52A1\u4E4B\u95F4\u8BB2\u6C42\u914D\u5408",id:"\u670D\u52A1\u4E4B\u95F4\u8BB2\u6C42\u914D\u5408",level:2},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:2},{value:"\u8D44\u6E90",id:"\u8D44\u6E90",level:2}];function a(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u6211\u7684-k8s-\u5B9E\u8DF5",children:"\u6211\u7684 K8S \u5B9E\u8DF5"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4E00\u5B9A\u8282\u70B9\u89C4\u6A21\u540E\u6CE8\u610F\u8282\u70B9\u89D2\u8272\u5212\u5206\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5B58\u50A8"}),"\n",(0,i.jsx)(n.li,{children:"\u8BA1\u7B97"}),"\n",(0,i.jsx)(n.li,{children:"\u8FB9\u7F18 - Ingress"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5982\u679C\u8981\u5206\u5E03\u5F0F\u5B58\u50A8\uFF0C\u53EF\u4F18\u5148\u8003\u8651 \u5206\u5E03\u5F0F \u6570\u636E \u800C\u4E0D\u662F \u5206\u5E03\u5F0F\u5B58\u50A8+\u6570\u636E\u5E93\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F18\u5148\u652F\u6301\u5206\u5E03\u5F0F\u7684\u6570\u636E\u5E93 \u5F39\u6027\u66F4\u597D\u3001\u6027\u80FD\u66F4\u597D"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u5E03\u5F0F\u5B58\u50A8+\u6570\u636E\u5E93 \u6027\u80FD\u5C34\u5C2C\uFF0C\u4E14\u9700\u8981\u7EF4\u62A4\u989D\u5916\u7684\u5206\u5E03\u5F0F\u5B58\u50A8\u670D\u52A1"}),"\n",(0,i.jsx)(n.li,{children:"\u901A\u7528\u7684 \u5206\u5E03\u5F0F\u5B58\u50A8\u670D\u52A1 \u5BF9 \u5E26\u5BBD\u548C\u78C1\u76D8\u8981\u6C42\u975E\u5E38\u9AD8"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"disto-\u9009\u62E9\u5F88\u91CD\u8981",children:"Disto \u9009\u62E9\u5F88\u91CD\u8981"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u57FA\u7840\u6295\u5165\uFF0C\u4F46\u6301\u7EED\u6536\u76CA"}),"\n",(0,i.jsx)(n.li,{children:"\u5982\u679C\u89C4\u6A21\u5C0F\u4F18\u5148\u9009\u62E9\u88C1\u526A\u8FC7\u7684 disto - k0s, k3s"}),"\n",(0,i.jsx)(n.li,{children:"\u786E\u5B9A\u597D\u6838\u5FC3\u72B6\u6001\u5982\u4F55\u5B58\u50A8\u3001\u5907\u4EFD\u3001\u6062\u590D"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4F18\u5148\u624B\u5199-yaml",children:"\u4F18\u5148\u624B\u5199 Yaml"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u624B\u5199 Yaml \u66F4\u66F4\u597D\u7406\u89E3\u90E8\u7F72\u903B\u8F91"}),"\n",(0,i.jsx)(n.li,{children:"\u8FD0\u7EF4\u9700\u8981\u5BF9\u8FD0\u7EF4\u7684\u670D\u52A1\u6709\u5145\u5206\u4E86\u89E3"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"\u4E3B\u8981\u96BE\u70B9",type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u77E5\u9053\u5F53\u524D Pod \u4FE1\u606F\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/notes/devops/kubernetes/faq#pod-fieldref",children:"\u4F7F\u7528 fieldRef \u83B7\u53D6"})}),"\n",(0,i.jsx)(n.li,{children:"\u901A\u8FC7 API \u83B7\u53D6"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u77E5\u9053\u591A\u8282\u70B9\u4FE1\u606F\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/wenerme/kube-stub-cluster/blob/d373937971ae53ea2d17f82b852e684058920234/citus/citus.sts.yaml#L46-L76",children:"citus.sts.yaml#L46-L76"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/wenerme/kube-stub-cluster/blob/d373937971ae53ea2d17f82b852e684058920234/keydb/keydb.sts.yaml#L22-L36",children:"keydb.sts.yaml#L22-L36"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u4F7F\u7528 init shell \u521D\u59CB\u5316\u73AF\u5883"}),"\n"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4E00\u5F00\u59CB\u4F7F\u7528 Helm \u53EF\u80FD\u80FD\u7528\uFF0C\u4F46\u5347\u7EA7\u7EF4\u62A4\u6709\u98CE\u9669 - \u4E0D\u6562\u968F\u610F\u52A8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u80FD\u8C03\u6574\u7684\u53C2\u6570\u6709\u9650"}),"\n",(0,i.jsx)(n.li,{children:"Helm \u4E0D\u4E00\u5B9A\u80FD\u6EE1\u8DB3\u9700\u6C42 - \u4F8B\u5982: \u4E00\u4E9B\u5BC6\u94A5\u4FE1\u606F\u8981\u660E\u6587"}),"\n",(0,i.jsx)(n.li,{children:"\u6EE1\u8DB3\u5C01\u88C5\u590D\u7528\u9700\u6C42"}),"\n",(0,i.jsx)(n.li,{children:"\u503E\u5411\u4E8E\u4E00\u4E2A Helm Chart \u4E00\u4E2A\u90E8\u7F72"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4E00\u5F00\u59CB\u4F7F\u7528 Operator \u4F1A\u9690\u85CF\u66F4\u591A\u7EC6\u8282\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5B8C\u5168\u9ED1\u76D2\uFF0C\u53EF\u63A7\u6027\u66F4\u4F4E"}),"\n",(0,i.jsx)(n.li,{children:"Operator \u53EF\u4EE5\u5C06\u90E8\u7F72\u53D8\u4E3A\u670D\u52A1 - \u4F8B\u5982: DBaaS"}),"\n",(0,i.jsx)(n.li,{children:"\u6EE1\u8DB3\u66F4\u9AD8\u9636\u9700\u6C42"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u83B7\u53D6 replicas\ncurl https://kubernetes/apis/apps/v1/namespaces/ \\\n  -H \"Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" < NAMESPACE > /statefulsets/ < STATEFULSET > -k \\\n  | jq '.spec.replicas'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u670D\u52A1\u4E4B\u95F4\u8BB2\u6C42\u914D\u5408",children:"\u670D\u52A1\u4E4B\u95F4\u8BB2\u6C42\u914D\u5408"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6240\u4EE5\u624D\u9700\u8981\u7F16\u6392"}),"\n",(0,i.jsx)(n.li,{children:"\u4F8B\u5982: \u503E\u5411\u4E8E nginx \u800C\u4E0D\u662F traeifk"}),"\n",(0,i.jsx)(n.li,{children:"\u4F8B\u5982: \u4F7F\u7528 cert-manager \u800C\u4E0D\u662F web server \u81EA\u5E26\u7684 acme"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u90E8\u7F72\u6DF7\u5408\u67B6\u6784\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6CE8\u610F\u90E8\u5206\u7EC4\u4EF6\u9650\u5B9A\u4E86 Linux\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"metallb"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u955C\u50CF\u9700\u8981\u652F\u6301\u591A\u67B6\u6784 - \u5927\u591A\u955C\u50CF\u90FD\u662F\u5355\u67B6\u6784"}),"\n",(0,i.jsx)(n.li,{children:"\u9664\u975E\u6709\u660E\u663E\u7684\u9700\u8981\uFF0C\u5426\u5219\u907F\u514D\u6DF7\u5408\u67B6\u6784"}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u8003\u8651\u90E8\u7F72\u4E00\u4E2A\u7EAF aarch64 \u67B6\u6784\u4E5F\u4E0D\u8981\u548C x86 \u6DF7\u5408"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5206\u5E03\u5F0F\u5B58\u50A8/\u975E\u672C\u5730\u5B58\u50A8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9664\u975E\u5FC5\u8981\u5426\u5219\u4E0D\u8981\u4F7F\u7528\u5206\u5E03\u5F0F\u5B58\u50A8"}),"\n",(0,i.jsx)(n.li,{children:"\u601D\u8003\u5206\u5E03\u5F0F\u5B58\u50A8\u7684\u76EE\u7684\u548C\u6536\u76CA"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u5E03\u5F0F\u5B58\u50A8\u90FD\u6709\u5341\u5206\u660E\u663E\u7684\u526F\u4F5C\u7528"}),"\n",(0,i.jsxs)(n.li,{children:["\u5F53\u9700\u8981\u72B6\u6001\u7684\u65F6\u5019\u53EF\u4EE5\u8003\u8651\u8D2D\u4E70\u670D\u52A1\u6216\u8005\u989D\u5916\u63D0\u4F9B\u76F8\u5173\u670D\u52A1\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6570\u636E\u5E93"}),"\n",(0,i.jsx)(n.li,{children:"\u5BF9\u8C61\u5B58\u50A8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["StatefulSet \u5176\u4ED6\u4F5C\u7528\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u7528\u4E8E\u83B7\u53D6\u7A33\u5B9A\u7684 Hostname \u548C IP - \u4E0D\u4E00\u5B9A\u662F\u56E0\u4E3A\u9700\u8981\u4F7F\u7528\u5B58\u50A8"}),"\n",(0,i.jsx)(n.li,{children:"Pod \u7684\u540D\u5B57\u53EF\u4EE5\u66F4\u77ED - \u907F\u514D\u8D85\u51FA\u9650\u5236\u6216\u88AB\u622A\u53D6"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u96C6\u7FA4\u5C0F\u7684\u65F6\u5019 mount \u4E3B\u673A\u76EE\u5F55\u6216\u8005\u4F7F\u7528 local pvc \u4E5F\u4E0D\u5931\u4E3A\u7BA1\u7406\u5B58\u50A8\u7684\u529E\u6CD5"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u8D44\u6E90",children:"\u8D44\u6E90"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Prometheus \u4F1A\u5360\u7528\u8F83\u591A\u5185\u5B58\u548C\u90E8\u5206 CPU\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5EFA\u8BAE\u5C3D\u91CF\u590D\u7528\uFF0C\u907F\u514D\u91CD\u590D\u90E8\u7F72"}),"\n",(0,i.jsx)(n.li,{children:"linkerd \u4F1A\u90E8\u7F72 prometheus"}),"\n",(0,i.jsx)(n.li,{children:"lens \u4F1A\u90E8\u7F72 prometheus"}),"\n",(0,i.jsx)(n.li,{children:"consul \u76F8\u5173\u670D\u52A1\u4E5F\u53EF\u4EE5\u96C6\u6210 prometheus"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5173\u6CE8 DaemonSet\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ingress \u90E8\u7F72\u4E3A DS \u65B9\u4FBF\u4F7F\u7528 - \u56E0\u4E3A\u662F nginx+controller\uFF0C \u5185\u5B58\u5927\u7EA6 100M - request 100m, 90Mi"}),"\n",(0,i.jsx)(n.li,{children:"consul \u90E8\u7F72\u4F1A\u6709\u4E00\u4E2A\u8282\u70B9 agent DS - limit 100\uFF0C100"}),"\n",(0,i.jsx)(n.li,{children:"node-exporter \u4F1A\u90E8\u7F72\u4E3A DS - \u8D44\u6E90\u5360\u7528\u975E\u5E38\u5C0F - r 10m, 24Mi, limit: 200m, 100Mi"}),"\n",(0,i.jsx)(n.li,{children:"metallb \u4F1A\u90E8\u7F72 DS \u4F5C\u4E3A speaker"}),"\n"]}),"\n"]}),"\n"]})]})}function x(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},917776:function(e,n,l){l.d(n,{R:()=>t,x:()=>c});var s=l(7378);let i={},r=s.createContext(i);function t(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);