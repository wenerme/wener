"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["54576"],{26162:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>d,toc:()=>h,default:()=>a,metadata:()=>i,assets:()=>c,contentTitle:()=>l});var i=JSON.parse('{"id":"voip/asterisk/chan_sip","title":"chan_sip","description":"- chan_sip \u662F\u4EC0\u4E48\uFF1F","source":"@site/../notes/voip/asterisk/chan_sip.md","sourceDirName":"voip/asterisk","slug":"/voip/asterisk/chan_sip","permalink":"/notes/voip/asterisk/chan_sip","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/voip/asterisk/chan_sip.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1623313312000,"frontMatter":{"title":"chan_sip"},"sidebar":"docs","previous":{"title":"chan_pjsip","permalink":"/notes/voip/asterisk/chan_pjsip"},"next":{"title":"DAHDI","permalink":"/notes/voip/asterisk/dahdi"}}'),r=s(86106),t=s(17776);let d={title:"chan_sip"},l="chan_sip",c={},h=[{value:"Dial \u8BED\u6CD5",id:"dial-\u8BED\u6CD5",level:2},{value:"\u547D\u4EE4",id:"\u547D\u4EE4",level:2},{value:"sip.conf",id:"sipconf",level:2},{value:"\u8BBE\u5907\u914D\u7F6E",id:"\u8BBE\u5907\u914D\u7F6E",level:3},{value:"\u901A\u7528\u914D\u7F6E",id:"\u901A\u7528\u914D\u7F6E",level:3},{value:"nat",id:"nat",level:2},{value:"chan_sip nat vs chan_pjsip",id:"chan_sip-nat-vs-chan_pjsip",level:3}];function o(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"chan_sip",children:"chan_sip"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["chan_sip \u662F\u4EC0\u4E48\uFF1F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"pjsip \u4E4B\u524D\u7684 sip \u901A\u9053\u5B9E\u73B0"}),"\n",(0,r.jsx)(e.li,{children:"\u529F\u80FD\u6EE1\u8DB3 VoIP"}),"\n",(0,r.jsx)(e.li,{children:"\u4E0D\u652F\u6301\u73B0\u4EE3\u5316\u901A\u8BAF - WebRTC, Websocket \u7B49"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"caution",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"chan_sip \u5DF2\u7ECF\u5E9F\u5F03\uFF0C\u5C3D\u91CF\u4F7F\u7528 chan_pjsip"}),"\n"]})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"modules.conf"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"autoload => no\nload => chan_sip\n\n# \u81EA\u52A8\u52A0\u8F7D\nautoload => yes\n# \u6392\u9664 pjsip\nnoload => chan_pjsip\nnoload => res_pjsip\nnoload => res_pjsip_exten_state\nnoload => res_pjsip_log_forwarder\nnoload => res_pjsip_pubsub\nnoload => res_pjsip_session\n"})}),"\n",(0,r.jsx)(e.h2,{id:"dial-\u8BED\u6CD5",children:"Dial \u8BED\u6CD5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"SIP/devicename"}),"\n",(0,r.jsx)(e.li,{children:"SIP/username@domain - SIP uri"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"SIP/username[:password[:md5secret[:authname[:transport]]]]@host[:port]"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u76F4\u63A5\u5B9A\u4E49\u5B8C\u6574\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"SIP/devicename/extension"}),"\n",(0,r.jsx)(e.li,{children:"SIP/devicename/extension/IPorHost"}),"\n",(0,r.jsx)(e.li,{children:"SIP/username@domain//IPorHost"}),"\n",(0,r.jsxs)(e.li,{children:["\u6DFB\u52A0 ",(0,r.jsx)(e.code,{children:"[![touser[@todomain]][![fromuser][@fromdomain]]]"})," \u4FEE\u6539 To: \u548C From:"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"devicename - \u5B9A\u4E49\u7684 peer \u540D\u5B57"}),"\n",(0,r.jsx)(e.li,{children:"username@domain - \u4E92\u8054\u7F51\u4E0A\u7684 SIP \u7528\u6237 - \u5EFA\u8BAE\u5F00\u542F DNS SRV"}),"\n",(0,r.jsxs)(e.li,{children:["devicename/extension - \u7528\u4E8E\u4EE3\u7406\u573A\u666F\u3001Trunk \u7EBF\u8DEF\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"SIP/proxyhostname/user"})," \u548C ",(0,r.jsx)(e.code,{children:"SIP/user@proxyhostname"})," \u76F8\u540C"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u547D\u4EE4",children:"\u547D\u4EE4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"cli"}),(0,r.jsx)(e.th,{children:"desc"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip notify"}),(0,r.jsx)(e.td,{children:"Send a notify packet to a SIP peer"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"`sip prune realtime [peer [< name >"}),(0,r.jsx)(e.td,{children:"all"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip qualify peer"}),(0,r.jsx)(e.td,{children:"Send an OPTIONS packet to a peer"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip reload"}),(0,r.jsx)(e.td,{children:"Reload SIP configuration"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"`sip set debug {on"}),(0,r.jsx)(e.td,{children:"off"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"`sip set history {on"}),(0,r.jsx)(e.td,{children:"off}`"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"`sip show {channels"}),(0,r.jsx)(e.td,{children:"subscriptions}`"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show bridged"}),(0,r.jsx)(e.td,{children:"List all SIP bridges"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show channelstats"}),(0,r.jsx)(e.td,{children:"List statistics for active SIP channels"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show channel"}),(0,r.jsx)(e.td,{children:"Show detailed SIP channel info"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show domains"}),(0,r.jsx)(e.td,{children:"List our local SIP domains"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show history"}),(0,r.jsx)(e.td,{children:"Show SIP dialog history"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show inuse"}),(0,r.jsx)(e.td,{children:"List all inuse/limits"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show mwi"}),(0,r.jsx)(e.td,{children:"Show MWI subscriptions"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show objects"}),(0,r.jsx)(e.td,{children:"List all SIP object allocations"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show peers"}),(0,r.jsx)(e.td,{children:"List defined SIP peers"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show peer"}),(0,r.jsx)(e.td,{children:"Show details on specific SIP peer"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show registry"}),(0,r.jsx)(e.td,{children:"List SIP registration status"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show sched"}),(0,r.jsx)(e.td,{children:"Present a report on the status of the scheduler queue"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show settings"}),(0,r.jsx)(e.td,{children:"Show SIP global settings"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show tcp"}),(0,r.jsx)(e.td,{children:"List TCP Connections"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show users"}),(0,r.jsx)(e.td,{children:"List defined SIP users"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip show user"}),(0,r.jsx)(e.td,{children:"Show details on specific SIP user"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sip unregister"}),(0,r.jsx)(e.td,{children:"Unregister (force expiration) a SIP peer from the registry"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"sipconf",children:"sip.conf"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/asterisk/asterisk/blob/master/configs/samples/sip.conf.sample",children:"configs/samples/sip.conf.sample"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u8BBE\u5907\u914D\u7F6E",children:"\u8BBE\u5907\u914D\u7F6E"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["type=peer\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5904\u7406\u547C\u5165\u547C\u51FA\uFF0C ip/port \u5339\u914D"}),"\n",(0,r.jsx)(e.li,{children:"host=dynamic"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["type=user\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5904\u7406\u547C\u5165 - user \u80FD\u547C\u53EB asterisk, asterisk \u4E0D\u80FD\u547C\u53EB user"}),"\n",(0,r.jsx)(e.li,{children:"\u901A\u8FC7\u6CE8\u518C\u4FE1\u606F\u5339\u914D - authname, secret"}),"\n",(0,r.jsx)(e.li,{children:"\u4E0D\u4F9D\u8D56 IP \u4FE1\u606F\uFF0C\u4E0D\u5173\u5FC3 host \u8BBE\u7F6E"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["type=friend\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4F1A\u521B\u5EFA friend \u548C user"}),"\n",(0,r.jsx)(e.li,{children:"\u4E00\u822C\u672C\u5730\u7535\u8BDD\u4F7F\u7528"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"remotesecret \u547C\u51FA\u8BA4\u8BC1, secret \u547C\u5165\u8BA4\u8BC1"}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"tip",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u63A8\u8350\u8BBE\u5907\u540D\u5B57 ",(0,r.jsx)(e.code,{children:"[0-9a-z_]"})]}),"\n",(0,r.jsxs)(e.li,{children:["\u5982\u679C\u7528\u5230\u4E86 nat \u786E\u4FDD ",(0,r.jsx)(e.code,{children:"qualify=yes"})]}),"\n"]})}),"\n",(0,r.jsx)(e.h3,{id:"\u901A\u7528\u914D\u7F6E",children:"\u901A\u7528\u914D\u7F6E"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5B89\u5168\u76F8\u5173\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"allowguest - \u9ED8\u8BA4\u5F00\u542F"}),"\n",(0,r.jsx)(e.li,{children:"permit/deny/acl - IP address filters"}),"\n",(0,r.jsx)(e.li,{children:"contactpermit/contactdeny/contactacl - IP address filters for registrations"}),"\n",(0,r.jsx)(e.li,{children:"context - Which set of services you offer various users"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-conf",children:"[general]\n; \u9ED8\u8BA4 context - \u9ED8\u8BA4\u4E3A default\ncontext=public\n; \u662F\u5426\u5141\u8BB8\u533F\u540D\u547C\u53EB\n;allowguest=no\n; \u5C1D\u8BD5\u4F7F\u7528\u6388\u6743\u4FE1\u606F\u91CC\u7684 username \u5339\u914D\u800C\u4E0D\u662F From \u5934\n;match_auth_username=yes\n\n; overlap dialing - use the Incomplete application to collect the needed digits from an ambiguous dialplan match.\n; \u9ED8\u8BA4 yes\n; yes - RFC3578 overlap dialing\n; dtmf - inband, RFC2833, SIP INFO\nallowoverlap=no\n\n; \u7981\u6B62 transfer\n;allowtransfer=no\n\n; digest \u6388\u6743 realm\n; \u9ED8\u8BA4 asterisk - \u5982\u679C asterisk.conf \u8BBE\u7F6E\u4E86\u7CFB\u7EDF\u540D\u5219\u9ED8\u8BA4\u4E3A\u7CFB\u7EDF\u540D\u5B57 - \u9700\u8981\u5168\u5C40\u552F\u4E00\n;realm=mydomain.tld\n; \u4F7F\u7528\u57DF\u540D\u5217\u8868\u4F5C\u4E3A\u57DF\n;domainsasrealm=no\n\n; \u5904\u7406 'Record: on' \u5934\u903B\u8F91 - \u9ED8\u8BA4 automon, \u8BBE\u7F6E\u4E3A \u7A7A \u7981\u7528\n;recordonfeature=automixmon\n; \u5904\u7406 'Record: off' \u5934\u903B\u8F91 - \u9ED8\u8BA4 automon, \u8BBE\u7F6E\u4E3A \u7A7A \u7981\u7528\n;recordofffeature=automixmon\n\nudpbindaddr=0.0.0.0\n;rtpbindaddr=172.16.42.1\n; disallowed_methods = UPDATE\n\ntcpenable=no\ntcpbindaddr=0.0.0.0\n\ntlsenable=no\ntlsbindaddr=0.0.0.0\n\n;tcpauthtimeout = 30\n; unauthenticated sessions limit\n;tcpauthlimit = 100\n\n; \u4E0E res_pjsip_transport_websockets \u51B2\u7A81\n;websocket_enabled = true\n; \u5355\u4F4D ms\n;websocket_write_timeout = 100\n\n\ntransport=udp\n; DNS SRV lookups on outbound\n; \u53EA\u4F1A\u7528 SRV \u8BB0\u5F55 - \u7981\u7528\u540E\u5916\u547C\u65E0\u6CD5\u53EA\u4F7F\u7528\u57DF\u540D\nsrvlookup=yes\n\n;pedantic=yes\n\n\n; https://wiki.asterisk.org/wiki/display/AST/IP+Quality+of+Service\n\n\n; \u5168\u5C40 outbound \u6388\u6743\u4FE1\u606F\n[authentication]\n; <user>:<secret>@<realm>\n; <user>#<md5secret>@<realm>\n;auth=mark:topsecret@digium.com\n"})}),"\n",(0,r.jsx)(e.h2,{id:"nat",children:"nat"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"conf"}),(0,r.jsx)(e.th,{children:"desc"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"nat"}),(0,r.jsx)(e.td,{children:"\u914D\u7F6E NAT \u5904\u7406\u903B\u8F91"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"qualify=yes"}),(0,r.jsx)(e.td,{children:"\u4FDD\u6301 NAT \u4F1A\u8BDD\u5F00\u542F"})]})]})]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Asterisk \u4E0D\u540C\u7248\u672C nat \u7684\u9009\u9879"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"asterisk"}),(0,r.jsx)(e.th,{children:"nat"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:">= 1.8"})}),(0,r.jsx)(e.td,{children:"no, force_rport, comedia, auto_force_rport, auto_comedia"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"< 1.8"})}),(0,r.jsx)(e.td,{children:"no, yes, never, route"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"chan_sip-nat-vs-chan_pjsip",children:"chan_sip nat vs chan_pjsip"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"chan_sip/nat"}),(0,r.jsx)(e.th,{children:"chan_pjsip/rtp_symmetric"}),(0,r.jsx)(e.th,{children:"chan_pjsip/force_rport"}),(0,r.jsx)(e.th,{children:"chan_pjsip/rewrite_contact"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"nat=yes"}),(0,r.jsx)(e.td,{children:"rtp_symmetric=yes"}),(0,r.jsx)(e.td,{children:"force_rport=yes"}),(0,r.jsx)(e.td,{children:"rewrite_contact=yes"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"nat=no"}),(0,r.jsx)(e.td,{children:"rtp_symmetric=no"}),(0,r.jsx)(e.td,{children:"force_rport=no"}),(0,r.jsx)(e.td,{children:"rewrite_contact=no"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"nat=never"}),(0,r.jsx)(e.td,{children:"rtp_symmetric=no"}),(0,r.jsx)(e.td,{children:"force_rport=no"}),(0,r.jsx)(e.td,{children:"rewrite_contact=no"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"nat=route"}),(0,r.jsx)(e.td,{children:"rtp_symmetric=no"}),(0,r.jsx)(e.td,{children:"force_rport=yes"}),(0,r.jsx)(e.td,{children:"rewrite_contact=yes"})]})]})]})]})}function a(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},17776:function(n,e,s){s.d(e,{R:()=>d,x:()=>l});var i=s(7378);let r={},t=i.createContext(r);function d(n){let e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);