"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["962617"],{49877:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>h,metadata:()=>i,assets:()=>l,contentTitle:()=>r});var i=JSON.parse('{"id":"ops/admin/monit","title":"Monit","description":"- Monit Documentation","source":"@site/../notes/ops/admin/monit.md","sourceDirName":"ops/admin","slug":"/ops/admin/monit","permalink":"/notes/ops/admin/monit","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/ops/admin/monit.md","tags":[{"inline":true,"label":"Ops","permalink":"/notes/tags/ops"},{"inline":true,"label":"Admin","permalink":"/notes/tags/admin"},{"inline":true,"label":"Monitoring","permalink":"/notes/tags/monitoring"},{"inline":true,"label":"Monit","permalink":"/notes/tags/monit"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Monit","tags":["Ops","Admin","Monitoring","Monit"]},"sidebar":"docs","previous":{"title":"gopaas","permalink":"/notes/ops/admin/gopaas"},"next":{"title":"MOSH","permalink":"/notes/ops/admin/mosh"}}'),s=t(486106),o=t(917776);let a={title:"Monit",tags:["Ops","Admin","Monitoring","Monit"]},r="Monit",l={},c=[];function d(e){let n={a:"a",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"monit",children:"Monit"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://mmonit.com/monit/documentation/monit.html",children:"Monit Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.cnblogs.com/kevingrace/p/6322324.html",children:"Monit Usage Guide"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Values:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"daemon processes"}),"\n",(0,s.jsx)(n.li,{children:"started at system boot time"}),"\n",(0,s.jsx)(n.li,{children:"act if an error situation should occur"}),"\n",(0,s.jsx)(n.li,{children:"too many resources"}),"\n",(0,s.jsx)(n.li,{children:"monitor process characteristics"}),"\n",(0,s.jsx)(n.li,{children:"how much memory or cpu cycles a process is using."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Monitor:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"files, directories and filesystems"}),"\n",(0,s.jsx)(n.li,{children:"changes"}),"\n",(0,s.jsx)(n.li,{children:"timestamps changes, checksum changes or size changes"}),"\n",(0,s.jsx)(n.li,{children:"d5 or sha1 checksum of files that should not change and get an alert or perform an action if they should change."}),"\n",(0,s.jsx)(n.li,{children:"network connections"}),"\n",(0,s.jsx)(n.li,{children:"TCP, UDP and Unix Domain Sockets"}),"\n",(0,s.jsx)(n.li,{children:"protocol level"}),"\n",(0,s.jsx)(n.li,{children:"HTTP, SMTP SIP"}),"\n",(0,s.jsx)(n.li,{children:"test programs or scripts at certain times - like cron"}),"\n",(0,s.jsx)(n.li,{children:"test the exit value of a program and perform an action or send an alert"}),"\n",(0,s.jsx)(n.li,{children:"system resources"}),"\n",(0,s.jsx)(n.li,{children:"CPU usage, Memory and System Load."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Installation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apk add monit\nbrew install monit\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# -I\nset init \u524D\u53F0\u8FD0\u884C\nset daemon \u540E\u53F0\n# /etc/inittab\n# Run Monit in standard run-levels\n# mo:2345:respawn:/usr/local/bin/monit -Ic /etc/monitrc\n"})}),"\n",(0,s.jsx)(n.p,{children:'check process foo with pidfile /run/foo.pid\nstop program = "rc-service foo stop"\nstart program = "rc-service foo restart"\nif 5 restarts within 10 cycles then alert\nif 10 restarts within 15 cycles then timeout'}),"\n",(0,s.jsx)(n.p,{children:'check process tincd-wenet with pidfile /run/tinc.wenet.pid\nstop program = "/sbin/rc-service tincd stop"\nstart program = "/sbin/rc-service tincd restart"\nif 5 restarts within 10 cycles then alert\nif 10 restarts within 15 cycles then timeout'}),"\n",(0,s.jsx)(n.p,{children:"sudo chmod 0700 /etc/monitrc"}),"\n",(0,s.jsx)(n.p,{children:"check program MyProgram with path \u201C/monit/MyProgram.py\u201D\nand with timeout 3600 seconds\nevery 1 cycles\nstart program = \u201C/monit/MyProgram.py\u201D with timeout 3600 seconds\nif status > 200 then restart\nif status < 201 then stop\nif 2 restart 5 cycles then exec \u201C/monit/custom_script.sh\u201D\nif 2 restart 5 cycles then stop"}),"\n",(0,s.jsx)(n.p,{children:"A process is a binary running in the background - a daemon (like an HTTPd, a DB Server, etc.). A process is not run by Monit. Monit does not really control those applications. It can, however, interact with the daemon-izer. Example: systemctl start nginx will not run a nginx in foreground (and block your bash), but will start a daemon in background (that keeps running even after you killed your session)."}),"\n",(0,s.jsx)(n.p,{children:"A program is a binary executed and controlled by Monit. This program should exit after some time and Monit reacts on how all that was going. Example: du -hd1 will run, create an output, and exit. You can then, based on status-code, contents, etc., react to the result/output of the execution."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"set daemon  30\nset log syslog\nset log /var/log/monit.log\n\ninclude /etc/monit.d/*\n\n; set httpd port 2812 and\n;     use address localhost\n;     allow localhost\n;     allow admin:monit\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:'###############################################################################\n## Monit control file\n###############################################################################\n##\n## Comments begin with a \'#\' and extend through the end of the line. Keywords\n## are case insensitive. All path\'s MUST BE FULLY QUALIFIED, starting with \'/\'.\n##\n## Below you will find examples of some frequently used statements. For\n## information about the control file and a complete list of statements and\n## options, please have a look in the Monit manual.\n##\n##\n###############################################################################\n## Global section\n###############################################################################\n##\n## Start Monit in the background (run as a daemon):\n#\nset daemon  30              # check services at 30 seconds intervals\n#   with start delay 240    # optional: delay the first check by 4-minutes (by\n#                           # default Monit check immediately after Monit start)\n#\n#\n## Set syslog logging. If you want to log to a standalone log file instead,\n## specify the full path to the log file\n#\nset log syslog\n\n#\n#\n## Set the location of the Monit lock file which stores the process id of the\n## running Monit instance. By default this file is stored in $HOME/.monit.pid\n#\n# set pidfile /var/run/monit.pid\n#\n## Set the location of the Monit id file which stores the unique id for the\n## Monit instance. The id is generated and stored on first Monit start. By\n## default the file is placed in $HOME/.monit.id.\n#\n# set idfile /var/.monit.id\n#\n## Set the location of the Monit state file which saves monitoring states\n## on each cycle. By default the file is placed in $HOME/.monit.state. If\n## the state file is stored on a persistent filesystem, Monit will recover\n## the monitoring state across reboots. If it is on temporary filesystem, the\n## state will be lost on reboot which may be convenient in some situations.\n#\n# set statefile /var/.monit.state\n#\n#\n\n## Set limits for various tests. The following example shows the default values:\n##\n# set limits {\n#     programOutput:     512 B,      # check program\'s output truncate limit\n#     sendExpectBuffer:  256 B,      # limit for send/expect protocol test\n#     fileContentBuffer: 512 B,      # limit for file content test\n#     httpContentBuffer: 1 MB,       # limit for HTTP content test\n#     networkTimeout:    5 seconds   # timeout for network I/O\n#     programTimeout:    300 seconds # timeout for check program\n#     stopTimeout:       30 seconds  # timeout for service stop\n#     startTimeout:      30 seconds  # timeout for service start\n#     restartTimeout:    30 seconds  # timeout for service restart\n# }\n\n## Set global SSL options (just most common options showed, see manual for\n## full list).\n#\n# set ssl {\n#     verify     : enable, # verify SSL certificates (disabled by default but STRONGLY RECOMMENDED)\n#     selfsigned : allow   # allow self signed SSL certificates (reject by default)\n# }\n#\n#\n## Set the list of mail servers for alert delivery. Multiple servers may be\n## specified using a comma separator. If the first mail server fails, Monit\n# will use the second mail server in the list and so on. By default Monit uses\n# port 25 - it is possible to override this with the PORT option.\n#\n# set mailserver mail.bar.baz,               # primary mailserver\n#                backup.bar.baz port 10025,  # backup mailserver on port 10025\n#                localhost                   # fallback relay\n#\n#\n## By default Monit will drop alert events if no mail servers are available.\n## If you want to keep the alerts for later delivery retry, you can use the\n## EVENTQUEUE statement. The base directory where undelivered alerts will be\n## stored is specified by the BASEDIR option. You can limit the queue size\n## by using the SLOTS option (if omitted, the queue is limited by space\n## available in the back end filesystem).\n#\n# set eventqueue\n#     basedir /var/monit  # set the base directory where events will be stored\n#     slots 100           # optionally limit the queue size\n#\n#\n## Send status and events to M/Monit (for more informations about M/Monit\n## see https://mmonit.com/). By default Monit registers credentials with\n## M/Monit so M/Monit can smoothly communicate back to Monit and you don\'t\n## have to register Monit credentials manually in M/Monit. It is possible to\n## disable credential registration using the commented out option below.\n## Though, if safety is a concern we recommend instead using https when\n## communicating with M/Monit and send credentials encrypted. The password\n## should be URL encoded if it contains URL-significant characters like\n## ":", "?", "@". Default timeout is 5 seconds, you can customize it by\n## adding the timeout option.\n#\n# set mmonit http://monit:monit@192.168.1.10:8080/collector\n#     # with timeout 30 seconds              # Default timeout is 5 seconds\n#     # and register without credentials     # Don\'t register credentials\n#\n#\n## Monit by default uses the following format for alerts if the mail-format\n## statement is missing::\n## --8<--\n## set mail-format {\n##   from:    Monit <monit@$HOST>\n##   subject: monit alert --  $EVENT $SERVICE\n##   message: $EVENT Service $SERVICE\n##                 Date:        $DATE\n##                 Action:      $ACTION\n##                 Host:        $HOST\n##                 Description: $DESCRIPTION\n##\n##            Your faithful employee,\n##            Monit\n## }\n## --8<--\n##\n## You can override this message format or parts of it, such as subject\n## or sender using the MAIL-FORMAT statement. Macros such as $DATE, etc.\n## are expanded at runtime. For example, to override the sender, use:\n#\n# set mail-format { from: monit@foo.bar }\n#\n#\n## You can set alert recipients whom will receive alerts if/when a\n## service defined in this file has errors. Alerts may be restricted on\n## events by using a filter as in the second example below.\n#\n# set alert sysadm@foo.bar                       # receive all alerts\n#\n## Do not alert when Monit starts, stops or performs a user initiated action.\n## This filter is recommended to avoid getting alerts for trivial cases.\n#\n# set alert your-name@your.domain not on { instance, action }\n#\n#\n## Monit has an embedded HTTP interface which can be used to view status of\n## services monitored and manage services from a web interface. The HTTP\n## interface is also required if you want to issue Monit commands from the\n## command line, such as \'monit status\' or \'monit restart service\' The reason\n## for this is that the Monit client uses the HTTP interface to send these\n## commands to a running Monit daemon. See the Monit Wiki if you want to\n## enable SSL for the HTTP interface.\n#\nset httpd port 2812 and\n    use address localhost  # only accept connection from localhost (drop if you use M/Monit)\n    allow localhost        # allow localhost to connect to the server and\n    allow admin:monit      # require user \'admin\' with password \'monit\'\n    #with ssl {            # enable SSL/TLS and set path to server certificate\n    #    pemfile: /etc/ssl/certs/monit.pem\n    #}\n\n###############################################################################\n## Services\n###############################################################################\n##\n## Check general system resources such as load average, cpu and memory\n## usage. Each test specifies a resource, conditions and the action to be\n## performed should a test fail.\n#\n#  check system $HOST\n#    if loadavg (1min) per core > 2 for 5 cycles then alert\n#    if loadavg (5min) per core > 1.5 for 10 cycles then alert\n#    if cpu usage > 95% for 10 cycles then alert\n#    if memory usage > 75% then alert\n#    if swap usage > 25% then alert\n#\n#\n## Check if a file exists, checksum, permissions, uid and gid. In addition\n## to alert recipients in the global section, customized alert can be sent to\n## additional recipients by specifying a local alert handler. The service may\n## be grouped using the GROUP option. More than one group can be specified by\n## repeating the \'group name\' statement.\n#\n#  check file apache_bin with path /usr/local/apache/bin/httpd\n#    if failed checksum and\n#       expect the sum 8f7f419955cefa0b33a2ba316cba3659 then unmonitor\n#    if failed permission 755 then unmonitor\n#    if failed uid "root" then unmonitor\n#    if failed gid "root" then unmonitor\n#    alert security@foo.bar on {\n#           checksum, permission, uid, gid, unmonitor\n#        } with the mail-format { subject: Alarm! }\n#    group server\n#\n#\n## Check that a process is running, in this case Apache, and that it respond\n## to HTTP and HTTPS requests. Check its resource usage such as cpu and memory,\n## and number of children. If the process is not running, Monit will restart\n## it by default. In case the service is restarted very often and the\n## problem remains, it is possible to disable monitoring using the TIMEOUT\n## statement. This service depends on another service (apache_bin) which\n## is defined above.\n#\n#  check process apache with pidfile /usr/local/apache/logs/httpd.pid\n#    start program = "/etc/init.d/httpd start" with timeout 60 seconds\n#    stop program  = "/etc/init.d/httpd stop"\n#    if cpu > 60% for 2 cycles then alert\n#    if cpu > 80% for 5 cycles then restart\n#    if totalmem > 200.0 MB for 5 cycles then restart\n#    if children > 250 then restart\n#    if disk read > 500 kb/s for 10 cycles then alert\n#    if disk write > 500 kb/s for 10 cycles then alert\n#    if failed host www.tildeslash.com port 80 protocol http and request "/somefile.html" then restart\n#    if failed port 443 protocol https with timeout 15 seconds then restart\n#    if 3 restarts within 5 cycles then unmonitor\n#    depends on apache_bin\n#    group server\n#\n#\n## Check filesystem permissions, uid, gid, space usage, inode usage and disk I/O.\n## Other services, such as databases, may depend on this resource and an automatically\n## graceful stop may be cascaded to them before the filesystem will become full and data\n## lost.\n#\n#  check filesystem datafs with path /dev/sdb1\n#    start program  = "/bin/mount /data"\n#    stop program  = "/bin/umount /data"\n#    if failed permission 660 then unmonitor\n#    if failed uid "root" then unmonitor\n#    if failed gid "disk" then unmonitor\n#    if space usage > 80% for 5 times within 15 cycles then alert\n#    if space usage > 99% then stop\n#    if inode usage > 30000 then alert\n#    if inode usage > 99% then stop\n#    if read rate > 1 MB/s for 5 cycles then alert\n#    if read rate > 500 operations/s for 5 cycles then alert\n#    if write rate > 1 MB/s for 5 cycles then alert\n#    if write rate > 500 operations/s for 5 cycles then alert\n#    if service time > 10 milliseconds for 3 times within 5 cycles then alert\n#    group server\n#\n#\n## Check a file\'s timestamp. In this example, we test if a file is older\n## than 15 minutes and assume something is wrong if its not updated. Also,\n## if the file size exceed a given limit, execute a script\n#\n#  check file database with path /data/mydatabase.db\n#    if failed permission 700 then alert\n#    if failed uid "data" then alert\n#    if failed gid "data" then alert\n#    if timestamp > 15 minutes then alert\n#    if size > 100 MB then exec "/my/cleanup/script" as uid dba and gid dba\n#\n#\n## Check directory permission, uid and gid.  An event is triggered if the\n## directory does not belong to the user with uid 0 and gid 0.  In addition,\n## the permissions have to match the octal description of 755 (see chmod(1)).\n#\n#  check directory bin with path /bin\n#    if failed permission 755 then unmonitor\n#    if failed uid 0 then unmonitor\n#    if failed gid 0 then unmonitor\n#\n#\n## Check a remote host availability by issuing a ping test and check the\n## content of a response from a web server. Up to three pings are sent and\n## connection to a port and an application level network check is performed.\n#\n#  check host myserver with address 192.168.1.1\n#    if failed ping then alert\n#    if failed port 3306 protocol mysql with timeout 15 seconds then alert\n#    if failed port 80 protocol http\n#       and request /some/path with content = "a string"\n#    then alert\n#\n#\n## Check a network link status (up/down), link capacity changes, saturation\n## and bandwidth usage.\n#\n#  check network public with interface eth0\n#    if failed link then alert\n#    if changed link then alert\n#    if saturation > 90% then alert\n#    if download > 10 MB/s then alert\n#    if total uploaded > 1 GB in last hour then alert\n#\n#\n## Check custom program status output.\n#\n#  check program myscript with path /usr/local/bin/myscript.sh\n#    if status != 0 then alert\n#\n#\n###############################################################################\n## Includes\n###############################################################################\n##\n## It is possible to include additional configuration parts from other files or\n## directories.\n#\n#  include /etc/monit.d/*\n#\n'})})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>r});var i=t(7378);let s={},o=i.createContext(s);function a(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);