"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["352725"],{21205:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>r,toc:()=>d,default:()=>u,metadata:()=>s,assets:()=>l,contentTitle:()=>o});var s=JSON.parse('{"id":"devops/storage/fs/ssd","title":"SSD Optimization & TRIM","description":"Detailed guides and notes on optimizing Solid State Drives (SSD) performance and longevity.","source":"@site/../notes/devops/storage/fs/ssd.md","sourceDirName":"devops/storage/fs","slug":"/devops/storage/fs/ssd","permalink":"/notes/devops/storage/fs/ssd","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/storage/fs/ssd.md","tags":[{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Storage","permalink":"/notes/tags/storage"},{"inline":true,"label":"SSD","permalink":"/notes/tags/ssd"},{"inline":true,"label":"TRIM","permalink":"/notes/tags/trim"},{"inline":true,"label":"Linux","permalink":"/notes/tags/linux"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"SSD Optimization & TRIM","tags":["DevOps","Storage","SSD","TRIM","Linux"]},"sidebar":"docs","previous":{"title":"NAS (Network Attached Storage)","permalink":"/notes/devops/storage/fs/nas"},"next":{"title":"FTP","permalink":"/notes/devops/storage/network/ftp"}}'),i=t(486106),a=t(917776);let r={title:"SSD Optimization & TRIM",tags:["DevOps","Storage","SSD","TRIM","Linux"]},o="SSD Optimization & TRIM",l={},d=[{value:"Resources",id:"resources",level:2},{value:"TRIM Overview",id:"trim-overview",level:2},{value:"Implementation Types",id:"implementation-types",level:3},{value:"Commands &amp; Verification",id:"commands--verification",level:2},{value:"fstab Example",id:"fstab-example",level:3},{value:"SSD Utility Scripts",id:"ssd-utility-scripts",level:2},{value:"smartctl -a ssd",id:"smartctl--a-ssd",level:3},{value:"hdparam -I",id:"hdparam--i",level:3}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ssd-optimization--trim",children:"SSD Optimization & TRIM"})}),"\n",(0,i.jsx)(n.p,{children:"Detailed guides and notes on optimizing Solid State Drives (SSD) performance and longevity."}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wiki.debian.org/SSDOptimization",children:"Debian Wiki - SSD Optimization"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/Solid-state_drive",children:"ArchWiki - Solid State Drive"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/TRIM",children:"Wikipedia - TRIM"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://unix.stackexchange.com/a/218083/47774",children:"Unix StackExchange - TRIM explanation"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"trim-overview",children:"TRIM Overview"}),"\n",(0,i.jsx)(n.p,{children:"TRIM does at least three things:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Minimize write amplification."}),"\n",(0,i.jsx)(n.li,{children:"Prevent long-term performance degradation."}),"\n",(0,i.jsx)(n.li,{children:"Irrecoverably delete your data."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"implementation-types",children:"Implementation Types"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Continuous TRIM"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Controlled by the filesystem."}),"\n",(0,i.jsxs)(n.li,{children:["Mount option: ",(0,i.jsx)(n.code,{children:"-o discard"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Periodic TRIM"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Run manually or via cron/systemd timer (e.g., once a week)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"commands--verification",children:"Commands & Verification"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Verify TRIM support\n# DISC-GRAN (discard granularity)\n# DISC-MAX (discard max bytes)\nlsblk --discard\n\n# Check features via hdparm\napk add hdparm\nhdparm -I /dev/sda | grep TRIM\n\n# Check drive health and attributes\napk add smartmontools\nsmartctl -a /dev/sda\n\n# Enable discard option on ext4\ntune2fs -o discard /dev/sdXY\n\n# Securely wipe data (requires unmount)\n# blkdiscard /dev/sdX\n"})}),"\n",(0,i.jsx)(n.h3,{id:"fstab-example",children:"fstab Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-fstab",children:"/dev/sda1  /           ext4  defaults,discard   0  1\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ssd-utility-scripts",children:"SSD Utility Scripts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://askubuntu.com/a/865793/267103",children:"Script source (AskUbuntu)"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'cat << \'SHELL\' > ssh-info.sh\n#!/bin/bash\n\n#######################################\n# Variables                           #\n#######################################\n\nSSD_DEVICE=${1:-/dev/sda}\n\nON_TIME_TAG="Power_On_Hours"\nWEAR_COUNT_TAG="Wear_Leveling_Count"\nLBAS_WRITTEN_TAG="Total_LBAs_Written"\nLBA_SIZE=512 # Value in bytes\n\nBYTES_PER_MB=1048576\nBYTES_PER_GB=1073741824\nBYTES_PER_TB=1099511627776\n\n#######################################\n# Get total data written...           #\n#######################################\n\n# Get SMART attributes\nSMART_INFO=$(sudo /usr/sbin/smartctl -A "$SSD_DEVICE")\n\n# Extract required attributes\nON_TIME=$(echo "$SMART_INFO" | grep "$ON_TIME_TAG" | awk \'{print $10}\')\nWEAR_COUNT=$(echo "$SMART_INFO" | grep "$WEAR_COUNT_TAG" | awk \'{print $4}\' | sed \'s/^0*//\')\nLBAS_WRITTEN=$(echo "$SMART_INFO" | grep "$LBAS_WRITTEN_TAG" | awk \'{print $10}\')\n\n# Convert LBAs -> bytes\nBYTES_WRITTEN=$(echo "$LBAS_WRITTEN * $LBA_SIZE" | bc)\nMB_WRITTEN=$(echo "scale=3; $BYTES_WRITTEN / $BYTES_PER_MB" | bc)\nGB_WRITTEN=$(echo "scale=3; $BYTES_WRITTEN / $BYTES_PER_GB" | bc)\nTB_WRITTEN=$(echo "scale=3; $BYTES_WRITTEN / $BYTES_PER_TB" | bc)\n\n# Output results...\necho "------------------------------"\necho " SSD Status:   $SSD_DEVICE"\necho "------------------------------"\necho " On time:      $(echo $ON_TIME | sed \':a;s/\\B[0-9]\\{3\\}\\>/,&/;ta\') hr"\necho "------------------------------"\necho " Data written:"\necho "           MB: $(echo $MB_WRITTEN | sed \':a;s/\\B[0-9]\\{3\\}\\>/,&/;ta\')"\necho "           GB: $(echo $GB_WRITTEN | sed \':a;s/\\B[0-9]\\{3\\}\\>/,&/;ta\')"\necho "           TB: $(echo $TB_WRITTEN | sed \':a;s/\\B[0-9]\\{3\\}\\>/,&/;ta\')"\necho "------------------------------"\necho " Mean write rate:"\necho "        MB/hr: $(echo "scale=3; $MB_WRITTEN / $ON_TIME" | bc | sed \':a;s/\\B[0-9]\\{3\\}\\>/,&/;ta\')"\necho "------------------------------"\necho " Drive health: ${WEAR_COUNT} %"\necho "------------------------------"\nSHELL\n\nchmod +x ssh-info.sh\nsudo ./ssh-info.sh /dev/sda\n'})}),"\n",(0,i.jsx)(n.h3,{id:"smartctl--a-ssd",children:"smartctl -a ssd"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.4.43-1-lts] (local build)\nCopyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org\n\n=== START OF INFORMATION SECTION ===\nModel Family:     Samsung based SSDs\nDevice Model:     Samsung SSD 750 EVO 120GB\nSerial Number:    S2TTNDAH131915J\nLU WWN Device Id: 5 002538 da03bb229\nFirmware Version: MAT01B6Q\nUser Capacity:    120,034,123,776 bytes [120 GB]\nSector Size:      512 bytes logical/physical\nRotation Rate:    Solid State Device\nDevice is:        In smartctl database [for details use: -P show]\nATA Version is:   ACS-2, ATA8-ACS T13/1699-D revision 4c\nSATA Version is:  SATA 3.1, 6.0 Gb/s (current: 6.0 Gb/s)\nLocal Time is:    Fri Aug 21 16:57:08 2020 CST\nSMART support is: Available - device has SMART capability.\nSMART support is: Enabled\n\n=== START OF READ SMART DATA SECTION ===\nSMART overall-health self-assessment test result: PASSED\n\nGeneral SMART Values:\nOffline data collection status:  (0x00)	Offline data collection activity\n					was never started.\n					Auto Offline Data Collection: Disabled.\nSelf-test execution status:      (   0)	The previous self-test routine completed\n					without error or no self-test has ever\n					been run.\nTotal time to complete Offline\ndata collection: 		(    0) seconds.\nOffline data collection\ncapabilities: 			 (0x53) SMART execute Offline immediate.\n					Auto Offline data collection on/off support.\n					Suspend Offline collection upon new\n					command.\n					No Offline surface scan supported.\n					Self-test supported.\n					No Conveyance Self-test supported.\n					Selective Self-test supported.\nSMART capabilities:            (0x0003)	Saves SMART data before entering\n					power-saving mode.\n					Supports SMART auto save timer.\nError logging capability:        (0x01)	Error logging supported.\n					General Purpose Logging supported.\nShort self-test routine\nrecommended polling time: 	 (   2) minutes.\nExtended self-test routine\nrecommended polling time: 	 (  64) minutes.\nSCT capabilities: 	       (0x003d)	SCT Status supported.\n					SCT Error Recovery Control supported.\n					SCT Feature Control supported.\n					SCT Data Table supported.\n\nSMART Attributes Data Structure revision number: 1\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  9 Power_On_Hours          0x0032   098   098   000    Old_age   Always       -       6710\n 12 Power_Cycle_Count       0x0032   098   098   000    Old_age   Always       -       1517\n177 Wear_Leveling_Count     0x0013   094   094   000    Pre-fail  Always       -       30\n179 Used_Rsvd_Blk_Cnt_Tot   0x0013   100   100   010    Pre-fail  Always       -       0\n181 Program_Fail_Cnt_Total  0x0032   100   100   010    Old_age   Always       -       0\n182 Erase_Fail_Count_Total  0x0032   100   100   010    Old_age   Always       -       0\n183 Runtime_Bad_Block       0x0013   100   099   010    Pre-fail  Always       -       0\n187 Uncorrectable_Error_Cnt 0x0032   100   100   000    Old_age   Always       -       0\n190 Airflow_Temperature_Cel 0x0032   059   046   000    Old_age   Always       -       41\n195 ECC_Error_Rate          0x001a   200   200   000    Old_age   Always       -       0\n199 CRC_Error_Count         0x003e   099   099   000    Old_age   Always       -       49\n235 POR_Recovery_Count      0x0012   099   099   000    Old_age   Always       -       109\n241 Total_LBAs_Written      0x0032   099   099   000    Old_age   Always       -       7409347670\n\nSMART Error Log Version: 1\nNo Errors Logged\n\nSMART Self-test log structure revision number 1\nNo self-tests have been logged.  [To run self-tests, use: smartctl -t]\n\nSMART Selective self-test log data structure revision number 1\n SPAN  MIN_LBA  MAX_LBA  CURRENT_TEST_STATUS\n    1        0        0  Not_testing\n    2        0        0  Not_testing\n    3        0        0  Not_testing\n    4        0        0  Not_testing\n    5        0        0  Not_testing\n  255        0    65535  Read_scanning was never started\nSelective self-test flags (0x0):\n  After scanning selected spans, do NOT read-scan remainder of disk.\nIf Selective self-test is pending on power-up, resume after 0 minute delay.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hdparam--i",children:"hdparam -I"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ATA device, with non-removable media\n	Model Number:       Samsung SSD 750 EVO 120GB\n	Serial Number:      S2TTNDAH131915J\n	Firmware Revision:  MAT01B6Q\n	Transport:          Serial, ATA8-AST, SATA 1.0a, SATA II Extensions, SATA Rev 2.5, SATA Rev 2.6, SATA Rev 3.0\nStandards:\n	Used: unknown (minor revision code 0x0039)\n	Supported: 9 8 7 6 5\n	Likely used: 9\nConfiguration:\n	Logical		max	current\n	cylinders	16383	16383\n	heads		16	16\n	sectors/track	63	63\n	--\n	CHS current addressable sectors:    16514064\n	LBA    user addressable sectors:   234441648\n	LBA48  user addressable sectors:   234441648\n	Logical  Sector size:                   512 bytes\n	Physical Sector size:                   512 bytes\n	Logical Sector-0 offset:                  0 bytes\n	device size with M = 1024*1024:      114473 MBytes\n	device size with M = 1000*1000:      120034 MBytes (120 GB)\n	cache/buffer size  = unknown\n	Nominal Media Rotation Rate: Solid State Device\nCapabilities:\n	LBA, IORDY(can be disabled)\n	Queue depth: 32\n	Standby timer values: spec'd by Standard, no device specific minimum\n	R/W multiple sector transfer: Max = 1	Current = 1\n	DMA: mdma0 mdma1 mdma2 udma0 udma1 udma2 udma3 udma4 udma5 *udma6\n	     Cycle time: min=120ns recommended=120ns\n	PIO: pio0 pio1 pio2 pio3 pio4\n	     Cycle time: no flow control=120ns  IORDY flow control=120ns\nCommands/features:\n	Enabled	Supported:\n	   *	SMART feature set\n	    	Security Mode feature set\n	   *	Power Management feature set\n	   *	Write cache\n	   *	Look-ahead\n	   *	Host Protected Area feature set\n	   *	WRITE_BUFFER command\n	   *	READ_BUFFER command\n	   *	NOP cmd\n	   *	DOWNLOAD_MICROCODE\n	    	SET_MAX security extension\n	   *	48-bit Address feature set\n	   *	Device Configuration Overlay feature set\n	   *	Mandatory FLUSH_CACHE\n	   *	FLUSH_CACHE_EXT\n	   *	SMART error logging\n	   *	SMART self-test\n	   *	General Purpose Logging feature set\n	   *	WRITE_{DMA|MULTIPLE}_FUA_EXT\n	   *	64-bit World wide name\n	    	Write-Read-Verify feature set\n	   *	WRITE_UNCORRECTABLE_EXT command\n	   *	{READ,WRITE}_DMA_EXT_GPL commands\n	   *	Segmented DOWNLOAD_MICROCODE\n	   *	Gen1 signaling speed (1.5Gb/s)\n	   *	Gen2 signaling speed (3.0Gb/s)\n	   *	Gen3 signaling speed (6.0Gb/s)\n	   *	Native Command Queueing (NCQ)\n	   *	Phy event counters\n	   *	READ_LOG_DMA_EXT equivalent to READ_LOG_EXT\n	   *	DMA Setup Auto-Activate optimization\n	   *	Device-initiated interface power management\n	   *	Asynchronous notification (eg. media change)\n	   *	Software settings preservation\n	    	Device Sleep (DEVSLP)\n	   *	SMART Command Transport (SCT) feature set\n	   *	SCT Write Same (AC2)\n	   *	SCT Error Recovery Control (AC3)\n	   *	SCT Features Control (AC4)\n	   *	SCT Data Tables (AC5)\n	   *	reserved 69[4]\n	   *	DOWNLOAD MICROCODE DMA command\n	   *	SET MAX SETPASSWORD/UNLOCK DMA commands\n	   *	WRITE BUFFER DMA command\n	   *	READ BUFFER DMA command\n	   *	Data Set Management TRIM supported (limit 8 blocks)\nSecurity:\n	Master password revision code = 65534\n		supported\n	not	enabled\n	not	locked\n		frozen\n	not	expired: security count\n		supported: enhanced erase\n	2min for SECURITY ERASE UNIT. 8min for ENHANCED SECURITY ERASE UNIT.\nLogical Unit WWN Device Identifier: 5002538da03bb229\n	NAA		: 5\n	IEEE OUI	: 002538\n	Unique ID	: da03bb229\nDevice Sleep:\n	DEVSLP Exit Timeout (DETO): 50 ms (drive)\n	Minimum DEVSLP Assertion Time (MDAT): 30 ms (drive)\nChecksum: correct\n"})})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},917776:function(e,n,t){t.d(n,{R:()=>r,x:()=>o});var s=t(7378);let i={},a=s.createContext(i);function r(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);