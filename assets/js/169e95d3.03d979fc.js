"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["512618"],{132214:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>l,toc:()=>h,default:()=>o,metadata:()=>t,assets:()=>c,contentTitle:()=>d});var t=JSON.parse('{"id":"os/virt/ksm","title":"KSM","description":"- \u662F\u4EC0\u4E48\uFF1F","source":"@site/../notes/os/virt/ksm.md","sourceDirName":"os/virt","slug":"/os/virt/ksm","permalink":"/notes/os/virt/ksm","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/virt/ksm.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1660268591000,"frontMatter":{"title":"KSM"},"sidebar":"docs","previous":{"title":"ignite","permalink":"/notes/os/virt/ignite"},"next":{"title":"Libvirt","permalink":"/notes/os/virt/libvirt/"}}'),r=s(486106),i=s(917776);let l={title:"KSM"},d="KSM",c={},h=[];function a(n){let e={a:"a",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"ksm",children:"KSM"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u662F\u4EC0\u4E48\uFF1F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Kernel Same page Mergeing - \u5185\u6838\u76F8\u540C\u9875\u5408\u5E76"}),"\n",(0,r.jsx)(e.li,{children:"Linux 2.6.32+ - CONFIG_KSM=y"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u4F7F\u7528\u573A\u666F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u865A\u62DF\u673A\u591A\u5F00 - \u5927\u90E8\u5206\u6267\u884C\u5185\u5BB9\u90FD\u5DEE\u4E0D\u591A, \u5408\u5E76\u540E\u76F8\u540C\u5185\u5BB9\u53EA\u5360\u4E00\u4EFD\u5185\u5B58"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.linux-kvm.org/page/KSM",children:"https://www.linux-kvm.org/page/KSM"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/Kernel_same-page_merging",children:"https://en.wikipedia.org/wiki/Kernel_same-page_merging"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.kernel.org/doc/Documentation/vm/ksm.txt",children:"https://www.kernel.org/doc/Documentation/vm/ksm.txt"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6CE8\u610F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ksm \u626B\u63CF page \u662F\u5FAA\u5E8F\u6E10\u8FDB\u7684\u8FC7\u7A0B\uFF0C\u9700\u8981\u6BD4\u8F83\u957F\u7684\u65F6\u95F4\uFF0C\u56E0\u6B64\u6548\u679C\u4E0D\u662F\u7ACB\u5373\u770B\u5F97\u5230"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u5728 Host \u542F\u7528\necho 1 > /sys/kernel/mm/ksm/run\n# \u5728\u5BBF\u4E3B\u673A\u4E0A\u67E5\u770B KSM \u72B6\u6001\n# \u5982\u679C\u6709\u5408\u5E76\u5219 pages_shared \u4E0D\u4E3A 0\ngrep . /sys/kernel/mm/ksm/*\n\n# \u9875\u5927\u5C0F\uFF0C\u9ED8\u8BA4 4k\ngetconf PAGE_SIZE\n\n# \u5B9E\u9645\u8282\u7701 page\necho $(($(sysctl -n /sys/kernel/mm/ksm/pages_sharing) - $(sysctl -n /sys/kernel/mm/ksm/pages_shared)))\n# \u8282\u7701\u5185\u5B58\n# numfmt \u7531 coreutils \u63D0\u4F9B\necho $((($(cat /sys/kernel/mm/ksm/pages_sharing) - $(cat /sys/kernel/mm/ksm/pages_shared)) * $(getconf PAGE_SIZE))) | numfmt --to=iec-i\n\necho $(($(cat /sys/kernel/mm/ksm/pages_sharing) * $(getconf PAGE_SIZE))) | numfmt --to=iec-i\necho $(($(cat /sys/kernel/mm/ksm/pages_volatile) * $(getconf PAGE_SIZE))) | numfmt --to=iec-i\necho $(($(cat /sys/kernel/mm/ksm/pages_unshared) * $(getconf PAGE_SIZE))) | numfmt --to=iec-i\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"item"}),(0,r.jsx)(e.th,{children:"desc"}),(0,r.jsx)(e.th,{children:"default"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pages_shared"}),(0,r.jsx)(e.td,{children:"\u5408\u5E76\u540E\u9875"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pages_sharing"}),(0,r.jsx)(e.td,{children:"\u5B9E\u9645\u9875"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pages_unshared"}),(0,r.jsx)(e.td,{children:"\u672A\u80FD\u5408\u5E76\u9875"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pages_volatile"}),(0,r.jsx)(e.td,{children:"\u53D8\u5316\u592A\u5FEB\u672A\u80FD\u653E\u5230\u6811\u4E2D\u8DDF\u8E2A"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"full_scans"}),(0,r.jsx)(e.td,{children:"\u5168\u626B\u63CF\u6B21\u6570"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"max_page_sharing"}),(0,r.jsx)(e.td,{children:"\u6700\u591A\u5171\u4EAB\u6B21\u6570"}),(0,r.jsx)(e.td,{children:"256"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pages_to_scan"}),(0,r.jsx)(e.td,{children:"\u4E00\u6B21 sleep \u626B\u63CF\u591A\u5C11\u9875"}),(0,r.jsx)(e.td,{children:"100"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"sleep_millisecs"}),(0,r.jsx)(e.td,{children:"\u626B\u63CF\u95F4\u9694"}),(0,r.jsx)(e.td,{children:"20"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"run"}),(0,r.jsx)(e.td,{children:"0 stop keep merged, 1 run, 2 stop & unmerge"}),(0,r.jsx)(e.td,{})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"pages_sharing \u9AD8\u610F\u5473\u7740\u6548\u679C\u8F83\u597D"}),"\n",(0,r.jsx)(e.li,{children:"pages_unshared \u9AD8\u610F\u5473\u7740\u6548\u679C\u4E0D\u597D - \u53EF\u8003\u8651\u5173\u95ED"}),"\n",(0,r.jsx)(e.li,{children:"max_page_sharing \u9650\u5236\u4E86\u6700\u591A\u53EF\u5171\u4EAB\u9875 - \u53EF\u8C03\u6574"}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},917776:function(n,e,s){s.d(e,{R:()=>l,x:()=>d});var t=s(7378);let r={},i=t.createContext(r);function l(n){let e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);