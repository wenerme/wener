"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["852919"],{374658:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>a,default:()=>o,metadata:()=>s,assets:()=>d,contentTitle:()=>c});var s=JSON.parse('{"id":"web/react/react-query","title":"React Query","description":"- TanStack/query","source":"@site/../notes/web/react/react-query.md","sourceDirName":"web/react","slug":"/web/react/query","permalink":"/notes/web/react/query","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/react/react-query.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"React Query"},"sidebar":"docs","previous":{"title":"React Practice","permalink":"/notes/web/react/practice"},"next":{"title":"react-querybuilder","permalink":"/notes/web/react/querybuilder"}}'),t=r(486106),i=r(917776);let l={title:"React Query"},c="React Query",d={},a=[{value:"QueryClient",id:"queryclient",level:2},{value:"useQuery",id:"usequery",level:2},{value:"Persist",id:"persist",level:2},{value:"broadcast",id:"broadcast",level:2},{value:"React Query v5",id:"react-query-v5",level:2},{value:"React Query v4",id:"react-query-v4",level:2},{value:"React Query v3",id:"react-query-v3",level:2},{value:"React Query v2.x",id:"react-query-v2x",level:2},{value:"useMutation",id:"usemutation",level:3},{value:"isLoading vs isFetching",id:"isloading-vs-isfetching",level:2}];function u(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"react-query",children:"React Query"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/TanStack/query",children:"TanStack/query"})}),"\n",(0,t.jsxs)(n.li,{children:["\u9ED8\u8BA4\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5F00\u542F refetchOnMount, refetchOnWindowFocus, refetchOnReconnect"}),"\n",(0,t.jsx)(n.li,{children:"cacheTime 5 \u5206\u949F - \u4E0D\u518D\u4F7F\u7528\u7684\u7684\u6570\u636E\u4FDD\u7559 5 \u5206\u949F"}),"\n",(0,t.jsx)(n.li,{children:"retry=3, retryDelay exponential"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://react-query.tanstack.com/docs/comparison",children:"vs SWR vs Apollo Client"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"vs SWR - \u652F\u6301\u4FEE\u6539\uFF0C\u66F4\u597D\u7684\u7F13\u5B58\u72B6\u6001\u7BA1\u7406"}),"\n",(0,t.jsx)(n.li,{children:"vs Apollo - \u652F\u6301 GraphQL \u548C \u4E00\u822C\u8BF7\u6C42\uFF0C\u9488\u5BF9 GraphQL \u7684 entity \u7F13\u5B58\u6CA1\u6709 apollo \u5F3A"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/dano-inc/react-query-helper",children:"dano-inc/react-query-helper"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tkdodo.eu/blog/practical-react-query",children:"Practical React Query"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react-query.tanstack.com/guides/important-defaults",children:"Important Defaults"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"-"}),(0,t.jsx)(n.th,{children:"condition"}),(0,t.jsx)(n.th,{children:"note"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"status"})}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"idle"}),(0,t.jsx)(n.td,{children:"isIdle"}),(0,t.jsx)(n.td,{children:"enabled:false \u6216 mutation \u672A\u6267\u884C"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"loading"}),(0,t.jsx)(n.td,{children:"isLoading"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"error"}),(0,t.jsx)(n.td,{children:"isError,isLoadingError,isRefetchError"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"success"}),(0,t.jsx)(n.td,{children:"isSuccess"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"initialData"}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"isFetching"}),(0,t.jsx)(n.td,{children:"loading \u6216 \u540E\u53F0\u8BF7\u6C42"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"isFetched"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"isFetchedAfterMount"}),(0,t.jsx)(n.td,{children:"\u907F\u514D\u663E\u793A\u7F13\u5B58\u6570\u636E"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"isRefetching"}),(0,t.jsx)(n.td,{children:"isFetching && !isLoading"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"options"})}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"staleTime"}),(0,t.jsx)(n.td,{children:"isStale"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"isPlaceholderData"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keepPreviousData"}),(0,t.jsx)(n.td,{children:"isPreviousData"}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"queryclient",children:"QueryClient"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6846\u67B6\u65E0\u5173\u5BA2\u6237\u7AEF"}),"\n",(0,t.jsx)(n.li,{children:"\u64CD\u4F5C\u6570\u636E\u9700\u8981 queryKey"}),"\n",(0,t.jsx)(n.li,{children:"\u6267\u884C\u67E5\u8BE2\u9700\u8981 queryFn"}),"\n",(0,t.jsx)(n.li,{children:"fetchQuery - \u4F1A\u8FD4\u56DE\u6570\u636E"}),"\n",(0,t.jsx)(n.li,{children:"prefetchQuery - \u4E0D\u4F1A\u8FD4\u56DE\u6570\u636E"}),"\n",(0,t.jsx)(n.li,{children:"getQueryData"}),"\n",(0,t.jsx)(n.li,{children:"setQueryData"}),"\n",(0,t.jsx)(n.li,{children:"getQueriesData"}),"\n",(0,t.jsx)(n.li,{children:"setQueriesData"}),"\n",(0,t.jsxs)(n.li,{children:["Queries\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"invalidate"}),"\n",(0,t.jsx)(n.li,{children:"refetch"}),"\n",(0,t.jsx)(n.li,{children:"cancel"}),"\n",(0,t.jsx)(n.li,{children:"remove"}),"\n",(0,t.jsx)(n.li,{children:"reset"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"getQueryState"}),"\n",(0,t.jsx)(n.li,{children:"isFetching"}),"\n",(0,t.jsx)(n.li,{children:"isMutating"}),"\n",(0,t.jsx)(n.li,{children:"getLogger"}),"\n",(0,t.jsx)(n.li,{children:"getDefaultOptions"}),"\n",(0,t.jsx)(n.li,{children:"setDefaultOptions"}),"\n",(0,t.jsx)(n.li,{children:"setQueryDefaults"}),"\n",(0,t.jsx)(n.li,{children:"getMutationDefaults"}),"\n",(0,t.jsx)(n.li,{children:"setMutationDefaults"}),"\n",(0,t.jsx)(n.li,{children:"getQueryCache"}),"\n",(0,t.jsx)(n.li,{children:"getMutationCache"}),"\n",(0,t.jsx)(n.li,{children:"clear"}),"\n",(0,t.jsx)(n.li,{children:"resumePausedMutations"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usequery",children:"useQuery"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u901A\u8FC7 QueryObserver \u76D1\u542C\u67E5\u8BE2\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u76D1\u542C client + options"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u7531 useQuery \u5904\u7406\u7684\u9009\u9879 - \u7531 QueryObserver \u5904\u7406\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"enabled, refetchInterval, refetchIntervalInBackground, refetchOnWindowFocus, refetchOnReconnect, notifyOnChangeProps, onSuccess, onError, onSettled, useErrorBoundary, select, suspense, keepPreviousData, placeholderData"}),"\n",(0,t.jsxs)(n.li,{children:["notifyOnChangeProps\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u54EA\u4E9B\u89E6\u53D1 rerender"}),"\n",(0,t.jsxs)(n.li,{children:["\u4F8B\u5982: ",(0,t.jsx)(n.code,{children:"['data', 'error']"})," \u5728 date \u548C error \u53D8\u5316\u65F6\u89E6\u53D1"]}),"\n",(0,t.jsx)(n.li,{children:"\u8BBE\u7F6E\u4E3A all \u5219\u6240\u6709\u72B6\u6001\u53D8\u5316\u90FD\u4F1A rerender"}),"\n",(0,t.jsxs)(n.li,{children:["\u9ED8\u8BA4\u4F7F\u7528 getter \u8DDF\u8E2A\u4F7F\u7528\u60C5\u51B5\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Object.defineProperty(trackedResult, key, {configurable: false,enumerable: true,get:()=>{/* \u6DFB\u52A0\u8DDF\u8E2A key */}})"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u7531 QueryObserver \u5B9E\u73B0\u76D1\u542C\u903B\u8F91"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u76D1\u542C\u6570\u636E\nconst observer = new QueryObserver(queryClient, { queryKey: ['posts'] });\n\nconst unsubscribe = observer.subscribe((result) => {\n  console.log(result);\n  unsubscribe();\n});\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/TanStack/query/blob/main/packages/query-core/src/queryObserver.ts",children:"queryObserver.ts"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"persist",children:"Persist"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6574\u4F53 persist \u800C\u4E0D\u662F\u5355\u6761\u8BB0\u5F55\u7EF4\u5EA6 - ",(0,t.jsx)(n.a,{href:"https://github.com/TanStack/query/discussions/2649",children:"#2649"})]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["PersistQueryClientProvider\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F1A\u4ECE persistQueryClient unsubscribe"}),"\n",(0,t.jsx)(n.li,{children:"\u4F1A\u5904\u7406 restore - persistQueryClient \u8FD4\u56DE\u7684 promise \u88AB resolve"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { PersistQueryClientProvider } from '@tanstack/react-query-persist-client';\nimport { createSyncStoragePersister } from '@tanstack/query-sync-storage-persister';\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      cacheTime: 1000 * 60 * 60 * 24, // 24 hours\n    },\n  },\n});\n\nconst persister = createSyncStoragePersister({\n  storage: window.localStorage,\n});\n\nReactDOM.createRoot(rootElement).render(\n  <PersistQueryClientProvider client={queryClient} persistOptions={{ persister }}>\n    <App />\n  </PersistQueryClientProvider>,\n);\n\n//\nconst [unsubscribe, promise] = persistQueryClient({\n  queryClient,\n  persister: localStoragePersister,\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"broadcast",children:"broadcast"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5B9E\u73B0\u57FA\u4E8E broadcast-channel"}),"\n",(0,t.jsx)(n.li,{children:"\u76D1\u542C Cache \u4E8B\u4EF6\uFF0C\u5E7F\u64AD\u5230\u5176\u4ED6 tab"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"version",children:"Version"}),"\n",(0,t.jsx)(n.h2,{id:"react-query-v5",children:"React Query v5"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4F18\u5316 Typescript \u4F7F\u7528\u4F53\u9A8C\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5355\u5BF9\u8C61 option \u80FD\u83B7\u53D6\u5230\u6B63\u5E38\u7C7B\u578B\uFF0C\u4E4B\u524D queryKey \u4E3A\u72EC\u7ACB\u53C2\u6570"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"import { queryOptions } from '@tanstack/react-query'"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9884\u5148\u5B9A\u4E49\u597D\u67E5\u8BE2"}),"\n",(0,t.jsx)(n.li,{children:"\u6301\u6709\u7C7B\u578B\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u79FB\u9664 onSuccess \u548C onError\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4ECE cache \u8FD4\u56DE\u65F6\u4E0D\u4F1A\u89E6\u53D1"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose",children:"Breaking React Query's API on purpose"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/TanStack/query/discussions/5279",children:"RFC: remove callbacks from useQuery #5279"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"cacheTime -> gcTime"}),"\n",(0,t.jsx)(n.li,{children:"keepPreviousData -> placeholderData"}),"\n",(0,t.jsx)(n.li,{children:"loading -> pending"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"useMutationState"})}),"\n",(0,t.jsxs)(n.li,{children:["suspense\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"useSuspenseQuery"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"useSuspenseInfiniteQuery"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"useSuspenseQueries"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["createPersister\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53EF\u5355\u72EC\u7F13\u5B58 Query - \u4E4B\u524D\u53EA\u80FD\u5168\u91CF\u7F13\u5B58"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tanstack.com/query/v5/docs/react/plugins/createPersister",children:"createPersister"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tanstack.com/blog/announcing-tanstack-query-v5",children:"Announcing TanStack Query v5"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"react-query-v4",children:"React Query v4"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"@tanstack/react-query"})}),"\n",(0,t.jsx)(n.li,{children:"Keys \u5FC5\u987B\u4E3A\u6570\u7EC4"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react-query-alpha.tanstack.com/guides/migrating-to-react-query-4",children:"Migrating to React Query 4"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"react-query-v3",children:"React Query v3"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u62C6\u5206 QueryCache \u4E3A QueryClient \u548C\u66F4\u5E95\u5C42\u7684 MutationCache, QueryCache"}),"\n",(0,t.jsx)(n.li,{children:"useQueryCache -> useQueryClient"}),"\n",(0,t.jsx)(n.li,{children:"QueryClientProvider \u53D6\u4EE3 ReactQueryConfigProvider \u548C ReactQueryCacheProvider"}),"\n",(0,t.jsx)(n.li,{children:"\u65B0\u589E useQueries"}),"\n",(0,t.jsxs)(n.li,{children:["\u5305\u542B devtools - ",(0,t.jsx)(n.code,{children:"react-query/devtools"})]}),"\n",(0,t.jsxs)(n.li,{children:["useQuery \u53C2\u6570\u4E0D\u518D\u662F key\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u63A8\u8350\u901A\u8FC7 lambada \u4F20\u9012\u53C2\u6570"}),"\n",(0,t.jsxs)(n.li,{children:["\u5982\u679C\u8FD8\u662F\u8981 key ",(0,t.jsx)(n.code,{children:"useQuery(['post', id], context => fetchPost(context.queryKey[1]))"})]}),"\n",(0,t.jsx)(n.li,{children:"enabled \u9009\u9879\u5FC5\u987B\u4E3A boolean - \u5426\u5219\u4F1A\u8B66\u544A"}),"\n",(0,t.jsxs)(n.li,{children:["\u652F\u6301 select \u90E8\u5206\u6570\u636E - \u51CF\u5C11\u91CD\u65B0\u6E32\u67D3\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"useQuery('user',fetchUser,{select:user=>user.username})"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5E9F\u5F03 usePaginatedQuery, \u6DFB\u52A0 ",(0,t.jsx)(n.code,{children:"keepPreviousData: true"})," \u5B9E\u73B0\u7C7B\u4F3C\u529F\u80FD"]}),"\n",(0,t.jsx)(n.li,{children:"useInfiniteQuery \u652F\u6301\u524D\u540E\u53CC\u5411\u67E5\u8BE2"}),"\n",(0,t.jsxs)(n.li,{children:["useMutation\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u8FD4\u56DE\u5BF9\u8C61\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4E4B\u524D ",(0,t.jsx)(n.code,{children:"const [mutate, { status, reset }] = useMutation()"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u73B0\u5728 ",(0,t.jsx)(n.code,{children:"const { mutate, mutateAsync, status, reset } = useMutation()"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"mutate \u4E0D\u8FD4\u56DE promise, mutateAsync \u8FD4\u56DE promise"}),"\n",(0,t.jsxs)(n.li,{children:["mutate \u652F\u6301\u56DE\u8C03 ",(0,t.jsx)(n.code,{children:"mutate('todo',{onSuccess(){},onError(){},onSettled(){}})"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u652F\u6301 retry - \u65AD\u7EBF\u91CD\u8054\u4F1A\u91CD\u8BD5\uFF0C\u9ED8\u8BA4\u5931\u8D25\u4E0D\u4F1A\u91CD\u8BD5"}),"\n",(0,t.jsx)(n.li,{children:"\u652F\u6301\u6301\u4E45\u5316\u7136\u540E\u6062\u590D"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"QueryObserver, InfiniteQueryObserver, QueriesObserver - \u53EF\u7528\u4E8E\u76D1\u542C\u6570\u636E\u53D8\u5316"}),"\n",(0,t.jsx)(n.li,{children:"useIsFetching - \u652F\u6301 key \u53C2\u6570"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://react-query.tanstack.com/guides/migrating-to-react-query-3",children:"v3"})," - 2020-12-15"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"react-query-v2x",children:"React Query v2.x"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { useQuery, QueryCache, ReactQueryCacheProvider } from 'react-query';\nimport { ReactQueryDevtools } from 'react-query-devtools';\n\nconst queryCache = new QueryCache();\n\nexport default function App() {\n  return (\n    <>\n      {/* \u7F13\u5B58 */}\n      <ReactQueryCacheProvider queryCache={queryCache}>\n        <Example />\n      </ReactQueryCacheProvider>\n      {/* \u5F00\u53D1\u5DE5\u5177 */}\n      <ReactQueryDevtools initialIsOpen />\n    </>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const key = '';\nconst {\n  data, // \u83B7\u53D6\u5230\u7684\u6570\u636E\u6216\u8005\u662F\u4E0A\u6B21\u7F13\u5B58\u7684\u6570\u636E\n  error, // \u9519\u8BEF\n  failureCount,\n  status, // \u72B6\u6001 - idle, loading, error, success\n  isError = status == 'error',\n  isIdle = status == 'idle',\n  isLoading = status == 'loading',\n  isSuccess = status == 'success',\n  isFetched, // \u5DF2\u7ECF\u83B7\u53D6\n  isFetchedAfterMount, // \u662F\u5426\u5728 mount \u540E\u83B7\u53D6\u8FC7\n  isFetching, // \u662F\u5426\u6B63\u5728\u83B7\u53D6\n  isStale, // \u6570\u636E\u5DF2\u5931\u6548\n  isPreviousData, // \u4F7F\u7528\u7684\u4E0A\u6B21\u6570\u636E\n  isPlaceholderData, // \u4F7F\u7528\u7684\u5360\u4F4D\u6570\u636E\n  refetch, // \u4ECE\u65B0\u83B7\u53D6 - \u9664\u975E throwOnError \u5426\u5219\u5F02\u5E38\u53EA\u4F1A log\n  remove, // \u4ECE\u7F13\u5B58\u79FB\u9664\u67E5\u8BE2\n} = useQuery(\n  key,\n  /* fetcher */ (...key) => fetch(key.join()).then((v) => v.json()),\n  /* config */ {\n    enabled: true, // \u662F\u5426\u67E5\u8BE2\n\n    // \u5931\u6548\u63A7\u5236\n    cacheTime: 1000 * 6 * 5, // 5m\n    staleTime: 0, // \u5931\u6548\u65F6\u95F4 - \u9ED8\u8BA4\u8FD4\u56DE\u5373\u5931\u6548 - \u8BBE\u7F6E\u5931\u6548\u65F6\u95F4\u53EF\u51CF\u5C11\u8BF7\u6C42 - \u8BBE\u7F6E\u4E3A Infinity \u4E0D\u5931\u6548\n    // \u91CD\u8BD5\u63A7\u5236\n    retry: 3, // \u91CD\u8BD5\u5224\u65AD - Boolean | Int | Function(failureCount, error) => shouldRetry | Boolean\n    retryDelay: (attempt) => Math.min(attempt > 1 ? 2 ** attempt * 1000 : 1000, 30 * 1000), // \u91CD\u8BD5\u5EF6\u8FDF - Function(retryAttempt: Int) => Int\n    // \u5237\u65B0\u63A7\u5236\n    refetchInterval: false, // \u5237\u65B0\u95F4\u9694 - Boolean | Integer\n    refetchIntervalInBackground: false, // \u540E\u53F0\u5237\u65B0 - Boolean\n    refetchOnMount: true, // \u5728 mount \u65F6\u5237\u65B0 - boolean | 'always'\n    refetchOnReconnect: true, // \u7F51\u7EDC\u6062\u590D\u65F6\u5237\u65B0\n    refetchOnWindowFocus: true, // \u7A97\u53E3\u83B7\u53D6\u7126\u70B9\u65F6\u5237\u65B0\n\n    // \u521D\u59CB\n    initialData: undefined, // \u521D\u59CB\u6570\u636E - any | ()=>any\n    initialStale: true, //  \u521D\u59CB\u5931\u6548 - \u5982\u679C\u8BBE\u7F6E\u4E86\u5219\u521D\u59CB\u6570\u636E\u8BA4\u4E3A\u662F\u6709\u6548\u6570\u636E - \u4F1A\u88AB\u7F13\u5B58 - boolean | ()=>boolean\n    placeholderData: undefined, // \u5360\u4F4D\u6570\u636E - loading \u7684\u65F6\u5019\u7528 - any | ()=>any\n\n    // \u72B6\u6001\u53D8\u5316\u56DE\u8C03\n    notifyOnStatusChange: true, // \u72B6\u6001\u53D8\u5316 rerender - \u8BBE\u7F6E\u4E3A false \u5219 data \u6216 error \u53D8\u5316\u65F6\u624D rerender\n    onSuccess: undefined, // \u6210\u529F\u56DE\u8C03 - (data)=>data\n    onError: undefined, // \u9519\u8BEF\u56DE\u8C03 - (error)=>void\n    onSettled: undefined, // \u5B8C\u6210\u56DE\u8C03 - (data,error)=>data\n    suspense: false, // \u542F\u7528 react suspense \u6A21\u5F0F - loading \u548C error \u65F6\u4F1A suspense\n\n    queryFnParamsFilter: undefined, // \u67E5\u8BE2\u53C2\u6570\u8FC7\u6EE4 - args=>filteredArgs\n    queryKeySerializerFn: undefined,\n    isDataEqual: undefined, // \u81EA\u5B9A\u4E49\u6BD4\u8F83\u64CD\u4F5C\n    keepPreviousData: false, // \u4FDD\u7559\u4E0A\u6B21\u6570\u636E - key \u53D8\u5316\u65F6\n    structuralSharing: true, // \u7ED3\u6784\u5316\u5171\u4EAB - \u8DE8\u67E5\u8BE2\u7F13\u5B58\u5171\u4EAB\n    useErrorBoundary: false,\n  },\n);\n\n// \u5206\u9875\u67E5\u8BE2\nconst {\n  data = undefined,\n  resolvedData, // \u4E0A\u6B21\u6210\u529F\u6570\u636E - \u5FFD\u7565 key\n  latestData, // \u672C\u6B21\u67E5\u8BE2\u6570\u636E\n  ...queryInfo\n} = usePaginatedQuery(queryKey, queryFn, options);\n\n// \u7011\u5E03\u6D41 - queryFn \u4F1A\u591A\u63A5\u53D7\u4E00\u4E2A fetchMoreVariable\nconst {\n  isFetchingMore, // false | 'next' | 'previous'\n  fetchMore, // Function(fetchMoreVariableOverride) => Promise<TResult | undefined>\n  canFetchMore,\n  ...queryInfo\n} = useInfiniteQuery(queryKey, queryFn, {\n  ...queryOptions,\n  getFetchMore: (lastPage, allPages) => fetchMoreVariable,\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usemutation",children:"useMutation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [\n  mutate, // \u4FEE\u6539\u64CD\u4F5C\n  { status, isIdle, isLoading, isSuccess, isError, data, error, reset },\n] = useMutation(mutationFn, {\n  onMutate,\n  onSuccess,\n  onError,\n  onSettled,\n  throwOnError,\n  useErrorBoundary,\n});\n\nconst promise = mutate(variables, {\n  onSuccess,\n  onSettled,\n  onError,\n  throwOnError,\n});\n"})}),"\n",(0,t.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(n.h2,{id:"isloading-vs-isfetching",children:"isLoading vs isFetching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["isLoading \u662F status=loading\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9002\u7528\u4E8E\u7B2C\u4E00\u6B21 loading \u5224\u65AD"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["isFetching \u662F\u540E\u53F0\u6B63\u5728\u83B7\u53D6\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5373\u4FBF\u662F\u6B63\u5728\u83B7\u53D6\uFF0CisLoading \u4E5F\u53EF\u80FD\u4E3A false - \u56E0\u4E3A\u6709\u4E0A\u6B21\u6570\u636E"}),"\n",(0,t.jsx)(n.li,{children:"\u9002\u7528\u4E8E\u6570\u636E\u52A0\u8F7D\u5224\u65AD - \u5237\u65B0\u52A0\u8F7D\u8FC7\u7A0B\u663E\u793A"}),"\n"]}),"\n"]}),"\n"]})]})}function o(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},917776:function(e,n,r){r.d(n,{R:()=>l,x:()=>c});var s=r(7378);let t={},i=s.createContext(t);function l(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);