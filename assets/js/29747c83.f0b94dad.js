"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["1401"],{29863:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>o,toc:()=>c,default:()=>h,metadata:()=>l,assets:()=>d,contentTitle:()=>s});var l=JSON.parse('{"id":"web/editor/lexical","title":"lexical","description":"- facebook/lexical","source":"@site/../notes/web/editor/lexical.md","sourceDirName":"web/editor","slug":"/web/editor/lexical","permalink":"/notes/web/editor/lexical","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/editor/lexical.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1698118598000,"frontMatter":{"title":"lexical"},"sidebar":"docs","previous":{"title":"hocus","permalink":"/notes/web/editor/hocus"},"next":{"title":"Low Code Design","permalink":"/notes/web/editor/low-code/"}}'),t=i(86106),r=i(17776);let o={title:"lexical"},s="lexical",d={},c=[{value:"Notes",id:"notes",level:2},{value:"Node",id:"node",level:3},{value:"Node Transform",id:"node-transform",level:3},{value:"Command",id:"command",level:3},{value:"Listener",id:"listener",level:3},{value:"Selection",id:"selection",level:3},{value:"EditorState",id:"editorstate",level:3}];function a(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lexical",children:"lexical"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/facebook/lexical",children:"facebook/lexical"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MIT, FlowJS"}),"\n",(0,t.jsx)(n.li,{children:"by Facebook"}),"\n",(0,t.jsx)(n.li,{children:"React \u4F53\u9A8C"}),"\n",(0,t.jsxs)(n.li,{children:["EditorState single source of truth\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"reconcile DOM"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u7EAF JS \u53EF\u4F7F\u7528"}),"\n",(0,t.jsx)(n.li,{children:"\u57FA\u4E8E contentEditable"}),"\n",(0,t.jsx)(n.li,{children:"\u66FF\u4EE3 Draft.js"}),"\n",(0,t.jsxs)(n.li,{children:["\u6027\u80FD\u597D\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"queueMicrotask"}),"\n",(0,t.jsx)(n.li,{children:"React 18+ concurrent \u652F\u6301"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u652F\u6301 yjs \u96C6\u6210"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["adopted by\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"payloadcms"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.img,{src:"https://badgen.net/bundlephobia/min/lexical?label=lexical",alt:"lexical"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"0 \u4F9D\u8D56"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://playground.lexical.dev/",children:"https://playground.lexical.dev/"})}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u76EE\u524D\u8FD8\u76F8\u5F53\u4E0D\u6210\u719F - \u8FD8\u5904\u4E8E\u5FEB\u901F\u5F00\u53D1\u9636\u6BB5\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u76EE\u524D\u66F4\u5EFA\u8BAE\u4F7F\u7528 Tiptap"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u8282\u70B9\u8026\u5408\u63D2\u4EF6 - ",(0,t.jsx)(n.a,{href:"https://github.com/facebook/lexical/issues/1262",children:"#1262"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u65E0\u6CD5\u6269\u5C55\u5DF2\u6709\u8282\u70B9 - \u505A\u4E0D\u5230 Tiptap \u7684 Extension \u6548\u679C"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# react -> list,link,code,overflow,history,markdown,mark,hashtag,selection,dragon,utils,table,clipboard,rich-text,plain-text\nnpm add lexical @lexical/react\n\nnpm add @lexical/file\n\nnpm add y-websocket yjs @lexical/yjs\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"link-preview-generator"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsx)(n.h3,{id:"node",children:"Node"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RootNode"}),"\n",(0,t.jsxs)(n.li,{children:["LineBreakNode - ",(0,t.jsx)(n.code,{children:"\\n"})]}),"\n",(0,t.jsx)(n.li,{children:"ElementNode - \u57FA\u7840\u7C7B"}),"\n",(0,t.jsxs)(n.li,{children:["TextNode\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"format - bold, italic, underline, strikethrough, code, subscript, superscript"}),"\n",(0,t.jsxs)(n.li,{children:["mode\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"token - \u5185\u5BB9\u4E0D\u53EF\u7F16\u8F91\uFF0C\u4F5C\u4E3A\u6574\u4F53\u5220\u9664 - tiptap atom"}),"\n",(0,t.jsx)(n.li,{children:"inert - \u7C7B\u4F3C token\uFF0C\u4F1A\u8BBE\u7F6E contenteditable=false"}),"\n",(0,t.jsx)(n.li,{children:"segmented"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"style - CSS \u6837\u5F0F"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"DecoratorNode - \u4FEE\u9970\u73B0\u6709\u8282\u70B9 - tiptap NodeView"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface Node {\n  static getType();\n  static clone(node: typeof this);\n\n  // ElementNode \u6CA1\u6709 EditorConfig\n  // TextNode \u6709 EditorConfig\n\n  createDOM(config: EditorConfig): HTMLElement;\n  // true - replace with createDOM\n  updateDOM(prevNode: CustomParagraph, dom: HTMLElement, config: EditorConfig): boolean;\n\n  // for DecoratorNode<React$Node>\n  decorate(): React$Node;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"node-transform",children:"Node Transform"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"editor.registerNodeTransform(TextNode, (textNode) => {\n  //\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"command",children:"Command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// payload\nconst HELLO_WORLD_COMMAND: LexicalCommand<string> = createCommand();\n\neditor.dispatchCommand(HELLO_WORLD_COMMAND, 'Hello World!');\n\neditor.registerCommand(\n  HELLO_WORLD_COMMAND,\n  (payload: string) => {\n    console.log(payload); // Hello World!\n    return false;\n  },\n  LowPriority,\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"listener",children:"Listener"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const removeUpdateListener = editor.registerUpdateListener(({ editorState }) => {\n  editorState.read(() => {\n    // \u901A\u8FC7 $ \u524D\u7F00\u51FD\u6570 \u8BBF\u95EE\u4E0A\u4E0B\u6587\u72B6\u6001\n  });\n  editor.update(() => {\n    // transaction\n  });\n});\n\nremoveUpdateListener();\n\n// \u76D1\u542C\u5185\u5BB9\u53D8\u5316\neditor.registerTextContentListener((textContent) => {\n  console.log(textContent);\n});\n\n// \u76D1\u542C\u8282\u70B9\u4FEE\u6539\neditor.registerMutationListener(MyCustomNode, (mutatedNodes) => {\n  // mutation: created, destroyed, updated\n  for (let [nodeKey, mutation] of mutatedNodes) {\n    console.log(nodeKey, mutation);\n  }\n});\n// \u53EA\u8BFB\u72B6\u6001\u53D8\u5316\neditor.registerReadOnlyListener((readOnly) => {\n  console.log(readOnly);\n});\n//\neditor.registerDecoratorListener((decorators) => {\n  console.log(decorators);\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"selection",children:"Selection"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RangeSelection"}),"\n",(0,t.jsx)(n.li,{children:"NodeSelection"}),"\n",(0,t.jsx)(n.li,{children:"GridSelection"}),"\n",(0,t.jsx)(n.li,{children:"null"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"editorstate",children:"EditorState"})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},17776:function(e,n,i){i.d(n,{R:()=>o,x:()=>s});var l=i(7378);let t={},r=l.createContext(t);function o(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);