"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["75252"],{94884:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>t,toc:()=>a,default:()=>h,metadata:()=>i,assets:()=>c,contentTitle:()=>o});var i=JSON.parse('{"id":"service/workflow/temporal/README","title":"temporal","description":"- temporalio/temporal","source":"@site/../notes/service/workflow/temporal/README.md","sourceDirName":"service/workflow/temporal","slug":"/service/workflow/temporal/","permalink":"/notes/service/workflow/temporal/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/workflow/temporal/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1732517778000,"frontMatter":{"title":"temporal"},"sidebar":"docs","previous":{"title":"pg-boss","permalink":"/notes/service/workflow/pg-boss"},"next":{"title":"Development","permalink":"/notes/service/workflow/temporal/dev"}}'),s=l(86106),r=l(17776);let t={title:"temporal"},o="temporal",c={},a=[{value:"tctl",id:"tctl",level:2},{value:"\u90E8\u7F72",id:"\u90E8\u7F72",level:2},{value:"Server",id:"server",level:2},{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:3},{value:"Auth",id:"auth",level:2},{value:"Bootstrap",id:"bootstrap",level:2},{value:"temporal-web",id:"temporal-web",level:2}];function d(e){let n={a:"a",admonition:"admonition",annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"temporal",children:"temporal"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal",children:"temporalio/temporal"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"MIT, Go"}),"\n",(0,s.jsx)(n.li,{children:"cadence fork, \u5305\u542B\u539F\u59CB\u56E2\u961F\u4EBA\u5458"}),"\n",(0,s.jsx)(n.li,{children:"Persistence - Cassandra, PostgreSQL, MySQL"}),"\n",(0,s.jsx)(n.li,{children:"Workflow search - Elasticsearch v6.8+ - \u9AD8\u7EA7\u641C\u7D22"}),"\n",(0,s.jsxs)(n.li,{children:["\u66F4\u9002\u5408\u4E2D\u5C0F\u89C4\u6A21\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528\u66F4\u65B9\u4FBF"}),"\n",(0,s.jsx)(n.li,{children:"\u652F\u6301\u66F4\u591A SDK - Go, Java, PHP, Typescript"}),"\n",(0,s.jsx)(n.li,{children:"\u6CA1\u6709 uber \u5305\u88B1 - \u73AF\u5883\u3001rpc\u3001\u5386\u53F2\u5B9E\u73B0"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/notes/service/workflow/temporal/temporalite",children:"temporalite"})," \u652F\u6301 SQLite"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/temporalio/sdk-core",children:"temporalio/sdk-core"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"MIT, Rust"}),"\n",(0,s.jsx)(n.li,{children:"Core Temporal SDK"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# https://github.com/temporalio/docker-compose\n# Elasticsearch + PostgreSQL + Web + UI\n# temporal-web http://localhost:8088/namespaces\n# temporal-ui http://localhost:8080/\n# temporal :7233\n# postgresql :5432\n# elasticsearch :9200\ncurl -o docker-compose.yml https://raw.githubusercontent.com/temporalio/docker-compose/main/docker-compose-ui-experimental.yml\ncurl --create-dirs -LO --output-dir dynamicconfig https://raw.githubusercontent.com/temporalio/docker-compose/main/dynamicconfig/development_es.yaml\ncurl -O --output-dir dynamicconfig https://raw.githubusercontent.com/temporalio/docker-compose/main/dynamicconfig/development.yaml\ndocker-compose up\n\n# tctl in docker\nalias tctl="docker exec --env TEMPORAL_CLI_ADDRESS=host.docker.internal:7233 temporal-admin-tools tctl"\ntctl namespace describe\n\n# temporalite\ntemporalite start -f temporalite.db\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["sqlite in production ",(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/issues/3366",children:"#3366"})]}),"\n",(0,s.jsxs)(n.li,{children:["Replace elastic with zinc ",(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/issues/2380",children:"#2380"})]}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"tctl",children:"tctl"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/tctl",children:"https://github.com/temporalio/tctl"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"env"}),(0,s.jsx)(n.th,{children:"default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TEMPORAL_CLI_ADDRESS"}),(0,s.jsx)(n.td,{children:"127.0.0.1:7233"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TEMPORAL_CLI_NAMESPACE"}),(0,s.jsx)(n.td,{children:"default"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# install on Host\nbrew install tctl\n# run in Docker\ndocker run --rm -it --entrypoint tctl --env TEMPORAL_CLI_ADDRESS=host.docker.internal:7233 temporalio/admin-tools\n\n# \u5065\u5EB7\u72B6\u6001 - \u6B63\u5E38\u4E3A SERVING\ntctl cluster health\ntctl --ns default namespace register --rd 7 --desc "Default namespace for Temporal Server."\n# \u53EF\u80FD\u9700\u8981\u7B49\u4E00\u4F1A\u513F\ntctl --ns default namespace describe\n\n# \u7BA1\u7406: workflow/wf, shard/shar, history_host/hist, taskqueue/tq, membership, cluster/cl, dlq, db, decode\ntctl admin\n# \u96C6\u7FA4\u7BA1\u7406 - \u641C\u7D22\u5C5E\u6027\u3001remote-cluster\ntctl admin cluster\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u90E8\u7F72",children:"\u90E8\u7F72"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Persistence\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cassandra, PostgreSQL, MySQL"}),"\n",(0,s.jsx)(n.li,{children:"SQLite WIP"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Workflow search\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Elasticsearch v6.8+"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Helm ",(0,s.jsx)(n.a,{href:"https://github.com/temporalio/helm-charts",children:"https://github.com/temporalio/helm-charts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5B98\u65B9\u4E0D\u63A8\u8350\u751F\u4EA7\u76F4\u63A5\u4F7F\u7528 Helm \u90E8\u7F72"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/blog/temporal-and-kubernetes/",children:"https://docs.temporal.io/blog/temporal-and-kubernetes/"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u9650\u5236 - ",(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/server/production-deployment/#server-limits",children:"Server limits"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"gRPC 4MB"}),"\n",(0,s.jsx)(n.li,{children:"TransactionSizeLimit 4MB - \u4E8B\u52A1\u5927\u5C0F\u9650\u5236"}),"\n",(0,s.jsxs)(n.li,{children:["Blob size limit - \u8BF7\u6C42\u5305\u5927\u5C0F\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"BlobSizeLimitWarn 512KB"}),"\n",(0,s.jsx)(n.li,{children:"BlobSizeLimitError 2MB"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["History total size limit - \u5386\u53F2\u5927\u5C0F\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HistorySizeLimitWarn 10MB"}),"\n",(0,s.jsx)(n.li,{children:"HistorySizeLimitError 50MB"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["History total count limit - \u5386\u53F2\u4E8B\u4EF6\u6570\u91CF\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HistoryCountLimitWarn 10000"}),"\n",(0,s.jsxs)(n.li,{children:["HistoryCountLimitError ",(0,s.jsx)(n.strong,{children:"50000"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Search Attributes\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SearchAttributesNumberOfKeysLimit 100 - \u6570\u91CF"}),"\n",(0,s.jsx)(n.li,{children:"SearchAttributesTotalSizeLimit 2KB - \u5355\u4E2A\u5C5E\u6027\u5927\u5C0F"}),"\n",(0,s.jsx)(n.li,{children:"SearchAttributesSizeOfValueLimit 40KB - \u4E2D\u5927\u5C0F"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Child Workflow - History \u72EC\u7ACB\u4E8E Parent - \u53EF\u7528\u4E8E Partition History \u538B\u529B\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6BCF\u4E2A Workflow \u6700\u591A 1000 Child Workflow\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Child Workflow \u7684 Child Workflow \u4E0D\u53D7\u5F71\u54CD"}),"\n",(0,s.jsx)(n.li,{children:"\u53EF\u4EE5\u591A\u5C42\u7EA7"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5C3D\u91CF\u5728\u5355\u5C42 Workflow History \u6709\u538B\u529B\u7684\u65F6\u5019\u518D\u4F7F\u7528\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5C3D\u91CF Activities \u90FD\u5728\u4E00\u5C42 Workflow"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"ContinueAsNew - \u4ECE\u65B0\u8BA1 History - \u7528\u4E8E\u51CF\u7F13 History \u538B\u529B"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/server/production-deployment#further-things-to-consider",children:"Antipatterns & Best practices"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"server",children:"Server"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/server/options",children:"Temporal Server options"})}),"\n",(0,s.jsxs)(n.li,{children:["authorization.Authorizer\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5224\u65AD\u662F\u5426\u6709\u6743\u9650\u64CD\u4F5C"}),"\n",(0,s.jsx)(n.li,{children:"\u57FA\u4E8E\u5F53\u524D Claim \u7684 Role"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["authorization.ClaimMapper\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AuthInfo -> Claims -> Namespace&Role"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["authorization.TokenKeyProvider\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"alg+kid -> Key"}),"\n",(0,s.jsx)(n.li,{children:"\u4E0D\u80FD\u83B7\u53D6\u5230\u5F53\u524D Claim \u4FE1\u606F"}),"\n",(0,s.jsx)(n.li,{children:"\u652F\u6301\u914D\u7F6E RefreshInterval \u66F4\u65B0"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["fx - temporal \u4F7F\u7528 fx \u505A IoC\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6BCF\u4E2A Service \u6709\u81EA\u5DF1\u7684 fx \u4E0A\u4E0B\u6587"}),"\n",(0,s.jsx)(n.li,{children:"ServerFx - root fx.App - Bootstrap"}),"\n",(0,s.jsx)(n.li,{children:"ServerImpl.Start \u4F1A\u542F\u52A8\u6240\u6709\u7684 ServicesMetadata"}),"\n",(0,s.jsx)(n.li,{children:"resource.BootstrapParams Service \u542F\u52A8\u4E0A\u4E0B\u6587"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Workflow\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Workflow Task Timeout - 10s"}),"\n",(0,s.jsxs)(n.li,{children:["ChildWorkflow\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["ParentClosePolicy\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ABANDON - Parent \u7ED3\u675F, Child \u4E0D\u53D7\u5F71\u54CD"}),"\n",(0,s.jsx)(n.li,{children:"TERMINATE - \u7ACB\u5373\u7EC8\u6B62"}),"\n",(0,s.jsx)(n.li,{children:"REQUEST_CANCEL - \u8BF7\u6C42\u53D6\u6D88"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Activity\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u72B6\u6001\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Scheduled -> Started -> Completed"}),"\n",(0,s.jsx)(n.li,{children:"Scheduled -> Started -> Retry Backoff -> Scheduled"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u8D85\u65F6\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["ScheduleToStart - \u9ED8\u8BA4 \u221E\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6BCF\u6B21 Scheduled -> Started"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["StartToClose - \u9ED8\u8BA4=ScheduleToStart\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6BCF\u6B21 Started -> Completed"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["ScheduleToClose - \u9ED8\u8BA4 \u221E - \u603B\u4F53\u7EDD\u5BF9\u65F6\u95F4\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Scheduled -> * -> Completed"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["LocalActivity\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7528\u4E8E\u672C\u5730\u5FEB\u901F\u6267\u884C\u7684\u51FD\u6570 - < 10s"}),"\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528\u66F4\u5C11\u7684 Temporal \u670D\u52A1\u8D44\u6E90 - \u4E0D\u8BB0\u5F55"}),"\n",(0,s.jsx)(n.li,{children:"\u672C\u5730\u6267\u884C - \u65E0 \u961F\u5217\u3001\u6D41\u63A7\u3001\u9650\u6D41\u3001\u8DEF\u7531 \u80FD\u529B"}),"\n",(0,s.jsx)(n.li,{children:"\u4E0D\u9700\u8981 Heartbeating"}),"\n",(0,s.jsx)(n.li,{children:"\u66F4\u4F4E\u5EF6\u65F6"}),"\n",(0,s.jsxs)(n.li,{children:["\u5C3D\u91CF\u4F7F\u7528 \u6B63\u5E38 Activity - ",(0,s.jsx)(n.a,{href:"https://community.temporal.io/t/local-activity-vs-activity/290/3",children:"LocalActivity vs Activity"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["TaskQueue\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Sticky Execution - \u9ED8\u8BA4\u5F00\u542F - DisableStickyExecution\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Worker \u5B8C\u6210\u4E86 Workflow \u7684\u7B2C\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u5219\u4F1A\u5F00\u59CB\u62C9\u53D6\u4E4B\u540E\u7684\u66F4\u65B0"}),"\n",(0,s.jsx)(n.li,{children:"\u96C6\u7FA4\u6682\u65F6\u4E0D\u9700\u8981\u8FDB\u884C\u8C03\u5EA6"}),"\n",(0,s.jsx)(n.li,{children:"StickyScheduleToStartTimeout=5s - \u5F53\u7C98\u6027 \u6267\u884C/Pull \u8D85\u65F6\u540E\uFF0C\u96C6\u7FA4\u6062\u590D\u8C03\u5EA6 Workflow"}),"\n",(0,s.jsx)(n.li,{children:"StickyWorkflowCacheSize=10,000"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Signal\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Recipient - WorkflowExecution=Namespace + Workflow Id"}),"\n",(0,s.jsx)(n.li,{children:"Id"}),"\n",(0,s.jsx)(n.li,{children:"Name - queue"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["AdvancedVisibility\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/content/what-is-a-list-filter/",children:"ListFilter"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/temporal-explained/visibility#default-search-attributes",children:"\u9ED8\u8BA4\u641C\u7D22\u5C5E\u6027"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u7EC4\u4EF6\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["frontend - \u7F51\u5173\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9650\u6D41\u3001\u8DEF\u7531\u3001\u8BA4\u8BC1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["history\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7EF4\u62A4\u6570\u636E - \u72B6\u6001\u3001\u961F\u5217\u3001\u8BA1\u65F6\u5668"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["matching\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5206\u53D1\u4EFB\u52A1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["worker\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6267\u884C\u5185\u90E8\u540E\u53F0\u4EFB\u52A1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u547D\u540D\u7A7A\u95F4\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"temporal-system - \u5185\u90E8\u547D\u540D\u7A7A\u95F4 - retention=7d"}),"\n",(0,s.jsx)(n.li,{children:"defaulr - \u9ED8\u8BA4\u547D\u540D\u7A7A\u95F4"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u67E5\u8BE2\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"__stack_trace"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"__open_sessions"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6388\u6743\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Claim ",(0,s.jsx)(n.code,{children:'{"permission":["<namespace>:"permission""]}'})]}),"\n",(0,s.jsx)(n.li,{children:"namespace=system - \u7279\u6B8A namespace"}),"\n",(0,s.jsxs)(n.li,{children:["permission <-> role\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"read - Reader"}),"\n",(0,s.jsx)(n.li,{children:"write - Writer"}),"\n",(0,s.jsx)(n.li,{children:"admin - Admin"}),"\n",(0,s.jsx)(n.li,{children:"worker - Worker"}),"\n",(0,s.jsx)(n.li,{children:"\u5176\u4ED6 - Undefined"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"role \u6709\u7EE7\u627F\u903B\u8F91"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5B9E\u9645\u4F1A\u8FD0\u884C\u7684\u670D\u52A1\ntemporal-server start --service=history\ntemporal-server start --service=frontend\ntemporal-server start --service=matching\ntemporal-server start --service=worker\n# \u53EF\u4EE5\u4E00\u6B21\u6027\u542F\u52A8\ntemporal-server start --service=history --service=frontend --service=matching --service=worker\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u76EE\u5F55\u7ED3\u6784\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["./ - ",(0,s.jsxs)(n.span,{className:"katex",children:[(0,s.jsx)(n.span,{className:"katex-mathml",children:(0,s.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,s.jsxs)(n.semantics,{children:[(0,s.jsxs)(n.mrow,{children:[(0,s.jsx)(n.mi,{children:"P"}),(0,s.jsx)(n.mi,{children:"W"}),(0,s.jsx)(n.mi,{children:"D"}),(0,s.jsx)(n.mo,{children:"\u2212"})]}),(0,s.jsx)(n.annotation,{encoding:"application/x-tex",children:"PWD - "})]})})}),(0,s.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,s.jsxs)(n.span,{className:"base",children:[(0,s.jsx)(n.span,{className:"strut",style:{height:"0.7667em",verticalAlign:"-0.0833em"}}),(0,s.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"}),(0,s.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"W"}),(0,s.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"D"}),(0,s.jsx)(n.span,{className:"mord",children:"\u2212"})]})})]}),"TEMPORAL_ROOT - \u6839\u76EE\u5F55"]}),"\n",(0,s.jsxs)(n.li,{children:["config/ - $TEMPORAL_CONFIG_DIR - \u914D\u7F6E\u76EE\u5F55\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"development.yaml - $TEMPORAL_ENVIRONMENT.yaml - \u73AF\u5883\u914D\u7F6E"}),"\n",(0,s.jsx)(n.li,{children:"dynamicconfig/ - \u52A8\u6001\u914D\u7F6E - dynamicConfigClient.dynamicconfig"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/docs/server/configuration/",children:"https://docs.temporal.io/docs/server/configuration/"})}),"\n",(0,s.jsxs)(n.li,{children:["\u914D\u7F6E\u5BF9\u8C61 ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/go.temporal.io/server/common/config#Config",children:"go.temporal.io/server/common/config#Config"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"log:\n  stdout: true\n  # debug, info, warn, error or fatal, info.\n  level: info\n  outputFile:\n# \u6301\u4E45\u5316\u914D\u7F6E\npersistence:\n  numHistoryShards: 1000\n  defaultStore: default\n  visibilityStore: visibility\n  advancedVisibilityStore: es-visibility\n  datastores:\n    default:\n      sql:\n        pluginName: postgres\n        databaseName:\n        connectAddr: 127.0.0.1:5432\n        # tcp,unix\n        connectProtocol: tcp\n        user:\n        password:\n        maxConns:\n        maxIdleConns:\n        maxConnLifetime: 1h\n        tls:\n          enabled: true\n          enableHostVerification: false\n        connectAttributes:\n          search_path: temporal\n\n# \u5168\u5C40\u914D\u7F6E\nglobal:\n  membership:\n    maxJoinDuration: 30s\n  authorization:\n    jwtKeyProvider:\n      keySourceURIs: []\n      refreshInterval: 1m\n    permissionsClaimName: permissions\n    authorizer:\n    claimMapper:\n\n# \u96C6\u7FA4\u5143\u6570\u636E - \u7528\u4E8E\u591A\u96C6\u7FA4\u590D\u5236\nclusterMetadata:\n  # \u662F\u5426\u5141\u8BB8\u5168\u5C40\u547D\u540D\u7A7A\u95F4\n  enableGlobalNamespace: false\n  failoverVersionIncrement: 10\n  masterClusterName: 'active'\n  # \u96C6\u7FA4\u540D\u5B57 - \u542F\u52A8\u540E\u4FBF\u4E0D\u53EF\u53D8\n  currentClusterName: 'active'\n  clusterInformation:\n    active:\n      enabled: true\n      initialFailoverVersion: 0\n      # \u652F\u6301 DNS dns:///\n      rpcAddress: '127.0.0.1:7233'\n  replicationConsumer:\n    # kafka,rpc\n    type: rpc\n"})}),"\n",(0,s.jsx)(n.h2,{id:"auth",children:"Auth"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/temporalio/samples-server",children:"https://github.com/temporalio/samples-server"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Authorizer\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5B9E\u73B0\u81EA\u5B9A\u4E49\u7684 auth \u903B\u8F91"}),"\n",(0,s.jsx)(n.li,{children:"\u5C01\u88C5 temporal.NewServer"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "permissions": ["namespace:permission"]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"bootstrap",children:"Bootstrap"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["install schema\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/v1.22.7/Makefile#L384-L404",children:"https://github.com/temporalio/temporal/blob/v1.22.7/Makefile#L384-L404"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["docker \u542F\u52A8\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/master/docker/auto-setup.sh",children:"docker/auto-setup.sh"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/master/docker/entrypoint.sh",children:"docker/entrypoint.sh"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4F7F\u7528 ",(0,s.jsx)(n.a,{href:"https://github.com/jwilder/dockerize",children:"dockerize"})," \u751F\u6210\u914D\u7F6E"]}),"\n",(0,s.jsxs)(n.li,{children:["/etc/temporal/config/config_template.yaml -> /etc/temporal/config/docker.yaml\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/master/docker/config_template.yaml",children:"config_template.yaml"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/master/docker/start-temporal.sh",children:"docker/start-temporal.sh"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["auto-setup\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.temporal.io/blog/auto-setup/",children:"https://docs.temporal.io/blog/auto-setup/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  -e DB=postgresql \\\n  -e DB_PORT=5432 \\\n  -e POSTGRES_USER=temporal \\\n  -e POSTGRES_PWD=temporal \\\n  -e POSTGRES_SEEDS=postgresql \\\n  --entrypoint bash \\\n  temporalio/auto-setup:1.14.2\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PostgresSQL \u652F\u6301 search_path, tls\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"--ca search_path=visibility --tls --tls-disable-host-verification"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"temporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres create --db temporal\ntemporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres --db temporal setup -v 0.0\ntemporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres --db temporal update-schema -d ./schema/postgresql/v96/temporal/versioned\ntemporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres create --db temporal_visibility\ntemporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres --db temporal_visibility setup-schema -v 0.0\ntemporal-sql-tool --ep 127.0.0.1 -p 5432 -u temporal -pw temporal --pl postgres --db temporal_visibility update-schema -d ./schema/postgresql/v96/visibility/versioned\n"})}),"\n",(0,s.jsx)(n.h2,{id:"temporal-web",children:"temporal-web"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/temporalio/web",children:"temporalio/web"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"JS+Vue"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  -v $PWD/config.yml:/usr/app/server/config.yml \\\n  -p 8088:8088 \\\n  temporalio/web:latest\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yml"',children:"auth:\n  enabled: true # Temporal Web checks this first before reading your provider config\n  providers:\n    - label: 'Auth0 oidc' # for internal use; in future may expose as button text\n      type: oidc # for futureproofing; only oidc is supported today\n      issuer: https://myorg.us.auth0.com\n      client_id: xxxxxxxxxxxxxxxxxxxx\n      client_secret: xxxxxxxxxxxxxxxxxxxx\n      scope: openid profile email\n      audience: # identifier of the audience for an issued token (optional)\n      callback_base_uri: http://localhost:8088\n      pass_id_token: false # adds ID token as 'authorization-extras' header with every request to server\n"})}),"\n",(0,s.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Temporal Nexus\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTP 7243"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"/namespaces/{namespace}/task-queues/{task_queue}/nexus-services"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"/nexus/endpoints/{endpoint}/services"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"/namespaces/{namespace}/nexus/callback"})}),"\n",(0,s.jsx)(n.li,{children:"\u9762\u5411 \u957F\u65F6\u95F4\u8FD0\u884C\u7684\u670D\u52A1"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/temporalio/temporal/blob/main/docs/architecture/nexus.md",children:"https://github.com/temporalio/temporal/blob/main/docs/architecture/nexus.md"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/nexus-rpc/sdk-go",children:"nexus-rpc/sdk-go"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},17776:function(e,n,l){l.d(n,{R:()=>t,x:()=>o});var i=l(7378);let s={},r=i.createContext(s);function t(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);