"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["938859"],{375530:function(e,n,a){a.r(n),a.d(n,{frontMatter:()=>s,toc:()=>c,default:()=>h,metadata:()=>r,assets:()=>o,contentTitle:()=>i});var r=JSON.parse('{"id":"dev/build/bazel/bazel-java","title":"Bazel Java","description":"- _deploy.jar","source":"@site/../notes/dev/build/bazel/bazel-java.md","sourceDirName":"dev/build/bazel","slug":"/dev/build/bazel/java","permalink":"/notes/dev/build/bazel/java","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/dev/build/bazel/bazel-java.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1642521786000,"frontMatter":{"title":"Bazel Java"},"sidebar":"docs","previous":{"title":"Brazel Go","permalink":"/notes/dev/build/bazel/go"},"next":{"title":"Build Awesome","permalink":"/notes/dev/build/awesome"}}'),l=a(486106),t=a(917776);let s={title:"Bazel Java"},i="Bazel Java",o={},c=[{value:"Maven",id:"maven",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"bazel-java",children:"Bazel Java"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_deploy.jar"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5305\u542B\u6240\u6709\u4F9D\u8D56"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5E94\u7528\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/google/dagger",children:"google/dagger"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/angular/angular/blob/master/BUILD.bazel",children:"angular/angular/BUILD.bazel"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://medium.com/wix-engineering/a58a8142c549",children:"How to choose the right build unit granularity"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://medium.com/wix-engineering/be561f455c37",children:"How to Decide on CI Server and remote execution / caching"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/bazelbuild/rules_gwt",children:"bazelbuild/rules_gwt"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/johnynek/bazel-deps",children:"johnynek/bazel-deps"})," - Generate bazel dependencies for maven artifacts"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/wix/exodus",children:"wix/exodus"})," - Easily migrate your JVM code from Maven to Bazel"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"bazel build //:java-maven\n# \u6784\u5EFA\u5B8C\u6574\u7684\u5305\uFF0C\u5305\u542B\u6240\u6709\u4F9D\u8D56\uFF0C\u53EF\u90E8\u7F72\u6267\u884C\nbazel build //:java-maven_deploy.jar\n\n# Maven \u8FC1\u79FB\ngit clone https://github.com/bazelbuild/migration-tooling.git\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-py",children:'# \u5B9A\u4E49\u6267\u884C\u6587\u4EF6\njava_binary(\n    name = "ProjectRunner",\n    srcs = glob(["src/main/java/com/example/ProjectRunner.java"]),\n    # \u4F9D\u8D56\n    deps = [":greeter"],\n    main_class = "com.example.ProjectRunner",\n)\n\n# \u5B9A\u4E49\u5E93\njava_library(\n    name = "greeter",\n    srcs = ["src/main/java/com/example/Greeting.java"],\n    # \u9ED8\u8BA4\u5F53\u524D BUILD \u6587\u4EF6\u53EF\u89C1\n    visibility = ["//src/main/java/com/example/cmdline:__pkg__"],\n)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"maven",children:"Maven"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/bazelbuild/rules_jvm_external",children:"rules_jvm_external"})," - Java \u6784\u5EFA\u5916\u90E8\u4F9D\u8D56\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Maven"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/google/bazel-common/tree/master/tools/maven",children:"google/bazel-common/maven"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u652F\u6301\u751F\u6210 pom.xml"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u67E5\u770B\u6240\u6709\u4F9D\u8D56\uFF0C\u8F93\u51FA\u4E3A BUILD\nbazel query @maven//:all --output=build\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'load("@rules_jvm_external//:defs.bzl", "maven_install", "artifact")\n\nload("@rules_jvm_external//:defs.bzl", "artifact")\n# \u53EF\u4EE5\u4F7F\u7528 artifact("junit:junit") \u800C\u4E0D\u662F @maven//:junit_junit\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"WORKSPACE"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-py",children:'load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")\n\nRULES_JVM_EXTERNAL_TAG = "2.6.1"\nRULES_JVM_EXTERNAL_SHA = "45203b89aaf8b266440c6b33f1678f516a85b3e22552364e7ce6f7c0d7bdc772"\n\n# \u4E0B\u8F7D\u89C4\u5219\u4F9D\u8D56\nhttp_archive(\n    name = "rules_jvm_external",\n    strip_prefix = "rules_jvm_external-%s" % RULES_JVM_EXTERNAL_TAG,\n    sha256 = RULES_JVM_EXTERNAL_SHA,\n    url = "https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip" % RULES_JVM_EXTERNAL_TAG,\n)\n\n# \u5BFC\u5165\nload("@rules_jvm_external//:defs.bzl", "maven_install")\n\n# \u5B9A\u4E49 Maven \u4ED3\u5E93\u548C\u4F7F\u7528\u7684\u5305\nmaven_install(\n    artifacts = [\n        "junit:junit:4.12",\n        "androidx.test.espresso:espresso-core:3.1.1",\n        "org.hamcrest:hamcrest-library:1.3",\n    ],\n    repositories = [\n        # Private repositories are supported through HTTP Basic auth\n        "http://username:password@localhost:8081/artifactory/my-repository",\n        "https://jcenter.bintray.com/",\n        "https://maven.google.com",\n        "https://repo1.maven.org/maven2",\n    ],\n)\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"BUILD"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-py",children:'java_library(\n    name = "java_test_deps",\n    exports = [\n        "@maven//:junit_junit"\n        "@maven//:org_hamcrest_hamcrest_library",\n    ],\n)\n\nandroid_library(\n    name = "android_test_deps",\n    exports = [\n        "@maven//:junit_junit"\n        "@maven//:androidx_test_espresso_espresso_core",\n    ],\n)\n'})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},917776:function(e,n,a){a.d(n,{R:()=>s,x:()=>i});var r=a(7378);let l={},t=r.createContext(l);function s(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);