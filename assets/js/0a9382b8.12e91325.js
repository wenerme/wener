"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["46019"],{8785:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>c,toc:()=>h,default:()=>o,metadata:()=>i,assets:()=>t,contentTitle:()=>d});var i=JSON.parse('{"id":"os/windows/mingw/msys2","title":"msys2","description":"- https://www.msys2.org/","source":"@site/../notes/os/windows/mingw/msys2.md","sourceDirName":"os/windows/mingw","slug":"/os/windows/mingw/msys2","permalink":"/notes/os/windows/mingw/msys2","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/windows/mingw/msys2.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1729657938000,"frontMatter":{"title":"msys2"},"sidebar":"docs","previous":{"title":"MinGW","permalink":"/notes/os/windows/mingw/"},"next":{"title":"Nano Server","permalink":"/notes/os/windows/nano-server"}}'),r=s(86106),l=s(17776);let c={title:"msys2"},d="msys2",t={},h=[{value:"env",id:"env",level:2},{value:"pacman \u5E38\u7528\u547D\u4EE4",id:"pacman-\u5E38\u7528\u547D\u4EE4",level:2},{value:"\u955C\u50CF",id:"\u955C\u50CF",level:2},{value:".profile",id:"profile",level:2},{value:"\u4FEE\u6539 Home \u76EE\u5F55",id:"\u4FEE\u6539-home-\u76EE\u5F55",level:2},{value:"SSHd",id:"sshd",level:2},{value:"Gitlab Runner",id:"gitlab-runner",level:2},{value:"Python",id:"python",level:2},{value:"CI",id:"ci",level:2},{value:"GCC vs LLVM/Clang",id:"gcc-vs-llvmclang",level:2},{value:"MSVCRT vs UCRT",id:"msvcrt-vs-ucrt",level:2},{value:"Node Must load N-API bindings",id:"node-must-load-n-api-bindings",level:2},{value:"static nodejs",id:"static-nodejs",level:2},{value:"pacman hang on GPG",id:"pacman-hang-on-gpg",level:2}];function a(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"msys2",children:"msys2"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.msys2.org/",children:"https://www.msys2.org/"})}),"\n",(0,r.jsx)(e.li,{children:"msys -> Minimal System"}),"\n",(0,r.jsx)(e.li,{children:"MinGW -> Minimalist GNU for Windows"}),"\n",(0,r.jsx)(e.li,{children:"mingw/cygwin+\u5305"}),"\n",(0,r.jsx)(e.li,{children:"pacman \u5305\u7BA1\u7406\u5668"}),"\n",(0,r.jsx)(e.li,{children:"\u63D0\u4F9B\u7C7B\u4F3C sudo"}),"\n",(0,r.jsxs)(e.li,{children:["\u63A8\u8350\u672C\u5730 bin \u4F4D\u7F6E ",(0,r.jsx)(e.code,{children:"C:\\msys64\\usr\\local\\bin"})]}),"\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://stackoverflow.com/questions/45836650",children:"VSC \u96C6\u6210"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/imachug/win-sudo",children:"imachug/win-sudo"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://packages.msys2.org/package/",children:"\u5305\u7D22\u5F15"})}),"\n",(0,r.jsxs)(e.li,{children:["archlinux ",(0,r.jsx)(e.a,{href:"https://wiki.archlinux.org/title/Pacman",children:"Pacman"})]}),"\n",(0,r.jsxs)(e.li,{children:["archlinux ",(0,r.jsx)(e.a,{href:"https://wiki.archlinux.org/title/Pacman/Tips_and_tricks",children:"Pacman tips"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"MSYS2 requires 64 bit Windows 10 or newer."}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"~"})," -> ",(0,r.jsx)(e.code,{children:"cygpath -w ~"})," -> ",(0,r.jsx)(e.code,{children:"C:\\msys64\\home\\$USER"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"C:\\Users\\$USER"})," -> ",(0,r.jsx)(e.code,{children:"/c/Users/$USER"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Windows \u6B63\u5E38\u7684\u7528\u6237\u76EE\u5F55"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"tip",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5EFA\u8BAE\u5C06 ",(0,r.jsx)(e.code,{children:"C:\\msys64"})," \u76EE\u5F55\u4ECE\u5B89\u5168\u626B\u63CF\u6392\u9664"]}),"\n",(0,r.jsx)(e.li,{children:"\u63A8\u8350\u4F7F\u7528 ucrt64"}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"cmd"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -S PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u5B89\u88C5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -R PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u5378\u8F7D"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Q PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Syu PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u5B89\u88C5 & \u66F4\u65B0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Syu"})}),(0,r.jsx)(e.td,{children:"\u66F4\u65B0\u6240\u6709"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u67E5\u8BE2"})}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Qe"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2\u6240\u6709\u5B89\u88C5\u7684\u5305"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Ql PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2\u5305\u5185\u5BB9"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Qii PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2\u5305\u4FE1\u606F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Qo FILE"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2\u6587\u4EF6\u5F52\u5C5E\u5305"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Qs PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u641C\u7D22 \u5DF2\u7ECF\u5B89\u88C5 \u7684\u5305"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"MISC"})}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Qdt"})}),(0,r.jsx)(e.td,{children:"\u67E5\u8BE2\u5B64\u7ACB\u7684\u5305"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pacman -Rns $(pacman -Qdtq)"})}),(0,r.jsx)(e.td,{children:"\u5220\u9664\u5B64\u7ACB\u7684\u5305"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pactree PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u5305\u4F9D\u8D56\u6811"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"pactree -r PACKAGE"})}),(0,r.jsx)(e.td,{children:"\u8C01\u4F9D\u8D56\u8FD9\u4E2A\u5305"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://wiki.archlinux.org/title/pacman",children:"https://wiki.archlinux.org/title/pacman"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u66F4\u65B0 index\npacman -Syu\n# \u4ECE\u65B0\u542F\u52A8\u518D\u66F4\u65B0\npacman -Su\n\n# \u57FA\u7840\u5F00\u53D1\u5DE5\u5177\n# \u524D\u7F00 mingw-w64-SUBSYSTEM-ARCH\n# \u524D\u7F00 mingw-w64-${MSYSTEM,,}-$(uname -m)\npacman -Sy --needed base-devel git mingw-w64-x86_64-toolchain mingw-w64-x86_64-gcc\npacman -Sy gcc unzip zip rsync\npacman -Sy procps-ng # provide top\n\n# Go\n# ==========\npacman -S mingw-w64-ucrt-x86_64-go\n# export GOROOT=/mingw64/lib/go\n# export GOPATH=/mingw64\n# \u6CE8\u610F\u4E0D\u662F ~/go \u662F C:\\Users\\$USER\\go\nls $(go env GOPATH)/bin\nexport PATH="$PATH:$(go env GOPATH)/bin"\n\n# mingw-w64-x86_64-nsis - nsis \u811A\u672C\u5B89\u88C5\u5DE5\u5177\n\n# \u5B89\u88C5 win-sudo\ncurl -s https://raw.githubusercontent.com/imachug/win-sudo/master/install.sh | sh\n\npacman -S mingw-w64-ucrt-x86_64-fastfetch\nfastfetch\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# Explorer \u6253\u5F00\u76EE\u5F55\nstart "$(cygpath -d $PWD)"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"env",children:"env"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"echo $MSYSTEM\n# \u67E5\u770B gcc \u641C\u7D22\u8DEF\u5F84  - \u5F71\u54CD\u6784\u5EFA\u73AF\u5883\ngcc --print-search-dirs\n"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u63A8\u8350 UCRT64"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Name"}),(0,r.jsx)(e.th,{children:"Prefix"}),(0,r.jsx)(e.th,{children:"Toolchain"}),(0,r.jsx)(e.th,{children:"Architecture"}),(0,r.jsx)(e.th,{children:"C Library"}),(0,r.jsx)(e.th,{children:"C++ Library"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"MSYS"}),(0,r.jsx)(e.td,{children:"/usr"}),(0,r.jsx)(e.td,{children:"gcc"}),(0,r.jsx)(e.td,{children:"x86_64"}),(0,r.jsx)(e.td,{children:"cygwin"}),(0,r.jsx)(e.td,{children:"libstdc++"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"MINGW64"}),(0,r.jsx)(e.td,{children:"/mingw64"}),(0,r.jsx)(e.td,{children:"gcc"}),(0,r.jsx)(e.td,{children:"x86_64"}),(0,r.jsx)(e.td,{children:"msvcrt"}),(0,r.jsx)(e.td,{children:"libstdc++"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"UCRT64"}),(0,r.jsx)(e.td,{children:"/ucrt64"}),(0,r.jsx)(e.td,{children:"gcc"}),(0,r.jsx)(e.td,{children:"x86_64"}),(0,r.jsx)(e.td,{children:"ucrt"}),(0,r.jsx)(e.td,{children:"libstdc++"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"CLANG64"}),(0,r.jsx)(e.td,{children:"/clang64"}),(0,r.jsx)(e.td,{children:"llvm"}),(0,r.jsx)(e.td,{children:"x86_64"}),(0,r.jsx)(e.td,{children:"ucrt"}),(0,r.jsx)(e.td,{children:"libc++"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"MINGW32"}),(0,r.jsx)(e.td,{children:"/mingw32"}),(0,r.jsx)(e.td,{children:"gcc"}),(0,r.jsx)(e.td,{children:"i686"}),(0,r.jsx)(e.td,{children:"msvcrt"}),(0,r.jsx)(e.td,{children:"libstdc++"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"CLANG32"}),(0,r.jsx)(e.td,{children:"/clang32"}),(0,r.jsx)(e.td,{children:"llvm"}),(0,r.jsx)(e.td,{children:"i686"}),(0,r.jsx)(e.td,{children:"ucrt"}),(0,r.jsx)(e.td,{children:"libc++"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["MSYS\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5305\u542B\u4E00\u4E9B unix-like/cygwin \u7684\u5DE5\u5177"}),"\n",(0,r.jsx)(e.li,{children:"\u6240\u6709\u5176\u4ED6\u73AF\u5883\u7EE7\u627F MSYS"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["target - infix\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ucrt64 - ucrt-x86_64"}),"\n",(0,r.jsx)(e.li,{children:"clang64 - clang-x86_64"}),"\n",(0,r.jsx)(e.li,{children:"clangarm64 - clang-aarch64"}),"\n",(0,r.jsx)(e.li,{children:"mingw64 - x86_64"}),"\n",(0,r.jsx)(e.li,{children:"mingw32 - i686"}),"\n",(0,r.jsx)(e.li,{children:"clang32 - clang-i686"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.msys2.org/docs/environments/",children:"https://www.msys2.org/docs/environments/"})}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u9488\u5BF9 SSHd \u4FEE\u6539"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'if [ -n "$SSH_CONNECTION" ]; then\n  export MSYSTEM=MINGW32\n  source /etc/profile\nfi\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u624B\u52A8\u4FEE\u6539"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"export MSYSTEM=UCRT64\nsource /etc/profile\necho $PATH\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"export MSYSTEM=MINGW64\nsource /etc/profile\necho $PATH\n"})}),"\n",(0,r.jsx)(e.h2,{id:"pacman-\u5E38\u7528\u547D\u4EE4",children:"pacman \u5E38\u7528\u547D\u4EE4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pacman -Ss nano     # \u641C\u7D22\npacman -Qs nano     # \u641C\u7D22\u5DF2\u7ECF\u5B89\u88C5\u7684\u5305\npacman -S nano      # \u5B89\u88C5\npacman -R nano      # \u5378\u8F7D\npacman -Ql nano     # \u663E\u793A\u5305\u5185\u5BB9\npactree nano        # \u5305\u4F9D\u8D56\u6811\npacman -Qi nano     # \u76F4\u63A5\u4F9D\u8D56\npacman -Qo nano.exe # \u6587\u4EF6\u5F52\u5C5E\u5305\npacman -F vim.exe   # \u5305\u542B\u6587\u4EF6\u7684\u5305 - \u4F1A\u4E0B\u8F7D\u6570\u636E\u5E93\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u955C\u50CF",children:"\u955C\u50CF"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["mirror ",(0,r.jsx)(e.a,{href:"https://mirrors.tuna.tsinghua.edu.cn/help/msys2/",children:"https://mirrors.tuna.tsinghua.edu.cn/help/msys2/"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/pacman.d/mirrorlist.mingw32 - i686"}),"\n",(0,r.jsx)(e.li,{children:"/etc/pacman.d/mirrorlist.mingw64 - x86_64"}),"\n",(0,r.jsx)(e.li,{children:"/etc/pacman.d/mirrorlist.msys"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u76EE\u524D\u5B98\u65B9\u4ED3\u5E93\u901F\u5EA6\u8FD8\u53EF\u4EE5"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# backup\nmv -t . /etc/pacman.d/mirrorlist.mingw32 /etc/pacman.d/mirrorlist.mingw64 /etc/pacman.d/mirrorlist.msys\necho "Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/i686" > /etc/pacman.d/mirrorlist.mingw32\necho "Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/x86_64" > /etc/pacman.d/mirrorlist.mingw64\necho \'Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/msys/$arch\' > /etc/pacman.d/mirrorlist.msys\n'})}),"\n",(0,r.jsx)(e.h2,{id:"profile",children:".profile"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# /c/GO/bin \u770B\u60C5\u51B5 - pacman go \u548C\u5B98\u65B9\u5DEE\u8DDD\u4E0D\u5927\n# export GOPATH=$HOME/go\nexport PATH="$PATH:$HOME/.local/bin:$HOME/go/bin"\nexport GO111MODULE=on\nexport GOPROXY=https://goproxy.io\n\nfunction o() {\n  if [ $# -eq 0 ]; then\n    local opath=.\n  else\n    local opath="$@"\n  fi\n  # Windows\n  command -v cygstart > /dev/null && cygstart "$opath" && return\n  command -v cygpath > /dev/null && start "$(cygpath -d $opath)" && return\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u4FEE\u6539-home-\u76EE\u5F55",children:"\u4FEE\u6539 Home \u76EE\u5F55"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u9ED8\u8BA4 home \u4E3A\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"/home/$USER"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"/msys64/home/$USER"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"/msys32/home/$USER"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"/etc/nsswitch.conf"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"db_home: windows\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679C\u4E0D\u884C\u5219\u5C1D\u8BD5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"db_home: windows cygwin desc\ndb_home: env windows /c/User/Administrator\n"})}),"\n",(0,r.jsx)(e.h2,{id:"sshd",children:"SSHd"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.msys2.org/wiki/Setting-up-SSHd/",children:"Setting up SSHd"})}),"\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://gist.github.com/samhocevar/00eec26d9e9988d080ac",children:"https://gist.github.com/samhocevar/00eec26d9e9988d080ac"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pacman -Sy openssh cygrunsrv mingw-w64-x86_64-editrights\n\n# \u521B\u5EFA sshd \u7528\u6237\u9700\u8981\u7BA1\u7406\u5458\u6743\u9650\n# win-sudo\nsudo sh ./msys2-sshd-setup.sh\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"msys2-sshd-setup.sh"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'#!/bin/sh\n# from https://www.msys2.org/wiki/Setting-up-SSHd/\n\nset -e\n\nUNPRIV_USER=sshd # DO NOT CHANGE; this username is hardcoded in the openssh code\nUNPRIV_NAME="Privilege separation user for sshd"\n\nEMPTY_DIR=/var/empty\n\nif ! /mingw64/bin/editrights -h > /dev/null; then\n  echo "ERROR: Missing \'editrights\'. Try: pacman -S mingw-w64-x86_64-editrights."\n  exit 1\nfi\n\nif ! cygrunsrv -v > /dev/null; then\n  echo "ERROR: Missing \'cygrunsrv\'. Try: pacman -S cygrunsrv."\n  exit 1\nfi\n\nif ! ssh-keygen -A; then\n  echo "ERROR: Missing \'ssh-keygen\'. Try: pacman -S openssh."\n  exit 1\nfi\n\n#\n# The unprivileged sshd user (for privilege separation)\n#\nadd="$(if ! net user "${UNPRIV_USER}" > /dev/null; then echo "//add"; fi)"\nif ! net user "${UNPRIV_USER}" ${add} //fullname:"${UNPRIV_NAME}" \\\n  //homedir:"$(cygpath -w ${EMPTY_DIR})" //active:no; then\n  echo "ERROR: Unable to create Windows user ${UNPRIV_USER}"\n  exit 1\nfi\n\n#\n# Add or update /etc/passwd entries\n#\nif test -f /etc/passwd; then\n  sed -i -e \'/^\'"${UNPRIV_USER}"\':/d\' /etc/passwd\n  SED=\'/^\'"${UNPRIV_USER}"\':/s?^\\(\\([^:]*:\\)\\{5\\}\\).*?\\1\'"${EMPTY_DIR}"\':/bin/false?p\'\n  mkpasswd -l -u "${UNPRIV_USER}" | sed -e \'s/^[^:]*+//\' | sed -ne "${SED}" \\\n    >> /etc/passwd\n  mkgroup.exe -l > /etc/group\nfi\n\n#\n# Finally, register service with cygrunsrv and start it\n#\ncygrunsrv -R msys2_sshd || true\ncygrunsrv -I msys2_sshd -d "MSYS2 sshd" -p /usr/bin/sshd.exe -a "-D -e" -y tcpip\n\n# The SSH service should start automatically when Windows is rebooted. You can\n# manually restart the service by running `net stop msys2_sshd` + `net start msys2_sshd`\nif ! net start msys2_sshd; then\n  echo "ERROR: Unable to start msys2_sshd service"\n  exit 1\nfi\n'})}),"\n",(0,r.jsx)(e.h2,{id:"gitlab-runner",children:"Gitlab Runner"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# --create-file-mode 0744\ncurl -LO https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-windows-amd64.exe\nchmod +x gitlab-runner-windows-amd64.exe\n\nmkdir -p /opt/bin\nmv gitlab-runner-windows-amd64.exe /opt/bin/gitlab-runner.exe\n\nmkdir -p runner && cd runner\n# gitlab token env\nREGISTRATION_TOKEN=\ngitlab-runner register \\\n  --non-interactive \\\n  --executor shell \\\n  --shell bash \\\n  --url "https://gitlab.com/" \\\n  --registration-token "$REGISTRATION_TOKEN" \\\n  --description windows-shell-runner \\\n  --tag-list "windows,shell,bash" \\\n  --run-untagged=false \\\n  --locked=false \\\n  --access-level=not_protected \\\n  --builds-dir ./build \\\n  --cache-dir ./cache\n# \u751F\u6210\u7684\u914D\u7F6E\ncat config.toml\n# \u4E0D\u80FD\u901A\u8FC7 SSH \u6267\u884C - FATAL: Failed to start gitlab-runner: The specified service does not exist as an installed service.\ngitlab-runner run -c ./config.toml -d .\n\n# service\ncygrunsrv -R gitlab_shell_runner\ncygrunsrv -I gitlab_shell_runner -d "Gitlab Shell Runner" -p /opt/bin/gitlab-runner.exe -c $PWD -a "run -c ./config.toml -d ." -y tcpip\n'})}),"\n",(0,r.jsx)(e.h2,{id:"python",children:"Python"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5E94\u8BE5\u53EA\u6709 mingw \u597D\u7528"}),"\n",(0,r.jsxs)(e.li,{children:["\u907F\u514D ",(0,r.jsx)(e.code,{children:"python3 -m pip install --upgrade pip"})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# mingw-w64-ucrt-x86_64-python\n# mingw-w64-x86_64-python\n# python\npacman -Q | grep "python"\n\n# ucrt\n# mingw-w64-ucrt-x86_64-python mingw-w64-ucrt-x86_64-python-pip\n\n# mingw\n# libpython3.11.dll libgcc_s_seh-1.dll libwinpthread-1.dll\n# mingw-w64-x86_64-python-poetry mingw-w64-x86_64-python-pip\n\n# msys\n# \u4F9D\u8D56 msys-*.dll\n# python python3-pip\n'})}),"\n",(0,r.jsx)(e.h2,{id:"ci",children:"CI"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.msys2.org/docs/ci/",children:"https://www.msys2.org/docs/ci/"})}),"\n"]}),"\n",(0,r.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"cygpath -w '/'\n\n# \u4ECE Windows Defender \u6392\u9664\u76EE\u5F55\npowershell.exe -Command \"Add-MpPreference -ExclusionPath $(cygpath -w '/')\"\n# \u5F53\u524D\u7684\u6392\u9664\u5217\u8868\npowershell.exe -Command \"Get-MpPreference | Select-Object -ExpandProperty ExclusionPath\"\npowershell.exe -Command 'Set-MpPreference -DisableRealtimeMonitoring $true'\n"})}),"\n",(0,r.jsx)(e.h2,{id:"gcc-vs-llvmclang",children:"GCC vs LLVM/Clang"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["GCC\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4F7F\u7528\u66F4\u591A"}),"\n",(0,r.jsx)(e.li,{children:"\u652F\u6301 Fortran"}),"\n",(0,r.jsx)(e.li,{children:"\u5305\u53EF\u80FD\u4F7F\u7528 Clang \u6784\u5EFA"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["LLVM/Clang\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u53EA\u4F7F\u7528 LLVM \u5DE5\u5177 - LLD linker, LIBC++"}),"\n",(0,r.jsx)(e.li,{children:"Clang \u652F\u6301 ASAN"}),"\n",(0,r.jsx)(e.li,{children:"\u539F\u751F\u652F\u6301 TLS/Thread-local storage"}),"\n",(0,r.jsx)(e.li,{children:"LLD \u6BD4 LD \u66F4\u5FEB \u4F46\u529F\u80FD\u7279\u6027\u66F4\u5C11"}),"\n",(0,r.jsx)(e.li,{children:"\u7F3A\u5C11\u90E8\u5206 GNU \u4E0B\u5DE5\u5177"}),"\n",(0,r.jsx)(e.li,{children:"Windows 10 \u652F\u6301 ARM64/AArch64 \u67B6\u6784"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"msvcrt-vs-ucrt",children:"MSVCRT vs UCRT"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["MSVCRT - Microsoft Visual C++ Runtime\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Windows \u9ED8\u8BA4\uFF0C\u540E\u5411\u517C\u5BB9\uFF0C\u975E C99 \u517C\u5BB9"}),"\n",(0,r.jsx)(e.li,{children:"\u4E0D\u652F\u6301 UTF-8 locale"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["UCRT - Universal C Runtime\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u65B0\u7248\u672C Microsoft Visual Studio \u9ED8\u8BA4"}),"\n",(0,r.jsx)(e.li,{children:"Windows 10 \u9ED8\u8BA4\u5E26"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["vcruntime\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"CRT \u5206\u4E3A vcruntime \u548C UCRT"}),"\n",(0,r.jsx)(e.li,{children:"ucrt for non-Microsoft compiler - Clang / GCC"}),"\n",(0,r.jsx)(e.li,{children:"vcruntime for Microsoft compiler - MSVC"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/cpp/porting/upgrade-your-code-to-the-universal-crt",children:"https://learn.microsoft.com/en-us/cpp/porting/upgrade-your-code-to-the-universal-crt"})}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"node-must-load-n-api-bindings",children:"Node Must load N-API bindings"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Must load N-API bindings\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pacman -S mingw-w64-ucrt-x86_64-rust\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"swc.win32-x64-msvc.node \u548C msys \u4E0D\u517C\u5BB9"}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/napi-rs/napi-rs/pull/2026",children:"https://github.com/napi-rs/napi-rs/pull/2026"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/msys2/MINGW-packages/issues/17782",children:"https://github.com/msys2/MINGW-packages/issues/17782"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/msys2/MINGW-packages/issues/20407",children:"https://github.com/msys2/MINGW-packages/issues/20407"})}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"static-nodejs",children:"static nodejs"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ldd /ucrt64/bin/node.exe | grep -vi 'Windows/SYSTEM32'\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"libstdc++-6.dll => /ucrt64/bin/libstdc++-6.dll\nlibgcc_s_seh-1.dll => /ucrt64/bin/libgcc_s_seh-1.dll\nlibwinpthread-1.dll => /ucrt64/bin/libwinpthread-1.dll\nlibnode.dll => /ucrt64/bin/libnode.dll\nlibcares-2.dll => /ucrt64/bin/libcares-2.dll\nlibcrypto-3-x64.dll => /ucrt64/bin/libcrypto-3-x64.dll\nlibicuin75.dll => /ucrt64/bin/libicuin75.dll\nlibicuuc75.dll => /ucrt64/bin/libicuuc75.dll\nlibssl-3-x64.dll => /ucrt64/bin/libssl-3-x64.dll\nlibicudt75.dll => /ucrt64/bin/libicudt75.dll\nzlib1.dll => /ucrt64/bin/zlib1.dll\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"curl -LO https://nodejs.org/download/release/latest-v20.x/win-x64/node.exe\n# \u6CA1\u6709\u5916\u90E8\u4F9D\u8D56\nldd node.exe | grep -vi 'Windows/SYSTEM32'\n"})}),"\n",(0,r.jsx)(e.h2,{id:"pacman-hang-on-gpg",children:"pacman hang on GPG"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"pstree -lp\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/msys2/setup-msys2/issues/358",children:"https://github.com/msys2/setup-msys2/issues/358"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/msys2/MSYS2-packages/issues/2752",children:"https://github.com/msys2/MSYS2-packages/issues/2752"})}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>c,x:()=>d});var i=s(7378);let r={},l=i.createContext(r);function c(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);