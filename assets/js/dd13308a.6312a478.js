"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["363432"],{850772:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>l,default:()=>p,metadata:()=>r,assets:()=>c,contentTitle:()=>o});var r=JSON.parse('{"id":"web/script/js/js-decorator","title":"Decorator","description":"- esbuild 0.21+ - 2024-05","source":"@site/../notes/web/script/js/js-decorator.md","sourceDirName":"web/script/js","slug":"/web/script/js/decorator","permalink":"/notes/web/script/js/decorator","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/script/js/js-decorator.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1772243505000,"frontMatter":{"title":"Decorator"},"sidebar":"docs","previous":{"title":"JS Cookbook","permalink":"/notes/web/script/js/cookbook"},"next":{"title":"JavaScript \u5E38\u89C1\u95EE\u9898","permalink":"/notes/web/script/js/faq"}}'),i=t(486106),s=t(917776);let a={title:"Decorator"},o="Decorator",c={},l=[{value:"Typescript legacy",id:"typescript-legacy",level:2},{value:"Typescript next",id:"typescript-next",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"decorator",children:"Decorator"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"esbuild 0.21+ - 2024-05"}),"\n",(0,i.jsx)(n.li,{children:"TS 5.0+ - 2023-03"}),"\n",(0,i.jsx)(n.li,{children:"Stage 3 - 2022-03"}),"\n",(0,i.jsxs)(n.li,{children:["Firefox ",(0,i.jsx)(n.a,{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1781212",children:"#1781212"})]}),"\n",(0,i.jsxs)(n.li,{children:["Chromium ",(0,i.jsx)(n.a,{href:"https://issues.chromium.org/issues/42202709",children:"#42202709"})]}),"\n"]})}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u52A8\u6001\u7C7B\u4E0D\u652F\u6301 Decorator \u8BED\u6CD5, \u4F9D\u8D56\u4EE3\u7801\u751F\u6210"}),"\n",(0,i.jsxs)(n.li,{children:["emitDecoratorMetadata & experimentalDecorators \u662F\u4E0D\u540C\u7684\u529F\u80FD\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u540C\u65F6\u5173\u95ED"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["kind\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"class"}),"\n",(0,i.jsx)(n.li,{children:"method"}),"\n",(0,i.jsx)(n.li,{children:"getter"}),"\n",(0,i.jsx)(n.li,{children:"setter"}),"\n",(0,i.jsx)(n.li,{children:"field"}),"\n",(0,i.jsx)(n.li,{children:"accessor"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Symbol.annotations"})}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"github.com/tc39/proposal-decorator-metadata",children:"proposal-decorator-metadata"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TS 5.2"}),"\n",(0,i.jsx)(n.li,{children:"\u5143\u6570\u636E"}),"\n",(0,i.jsx)(n.li,{children:"Symbol.metadata"}),"\n",(0,i.jsx)(n.li,{children:"context.metadata"}),"\n",(0,i.jsx)(n.li,{children:"\u4E00\u822C\u7528\u4E8E\u81EA\u5B9A\u4E49 decorator \u9644\u52A0\u989D\u5916\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tc39/proposal-decorators",children:"proposal-decorators"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"2023-08 \u2013 TS 5.2 \u652F\u6301 Decorator Metadata"}),"\n",(0,i.jsx)(n.li,{children:"2023-05 \u2013 Angular v16"}),"\n",(0,i.jsx)(n.li,{children:"2023-03 \u2013 Deno 1.32"}),"\n",(0,i.jsx)(n.li,{children:"2023-03 - TS 5.0"}),"\n",(0,i.jsx)(n.li,{children:"2022-09 \u2013 Babel 7.19.0. Stage 3"}),"\n",(0,i.jsx)(n.li,{children:"2022-08 \u2013 SpiderMonkey \u652F\u6301"}),"\n",(0,i.jsx)(n.li,{children:"2022-03 \u2013 Stage 3"}),"\n",(0,i.jsx)(n.li,{children:"2016-07 \u2013 Stage 2"}),"\n",(0,i.jsx)(n.li,{children:"2015-03 \u2013 Stage 1 - TS 1.5, --experimentalDecorators"}),"\n",(0,i.jsx)(n.li,{children:"2014-04 \u2013 Stage 0"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://caniuse.com/decorators",children:"https://caniuse.com/decorators"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/tc39/proposal-class-method-parameter-decorators",children:"proposal-class-method-parameter-decorators"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53C2\u6570"}),"\n",(0,i.jsx)(n.li,{children:"\u5BF9 nestjs \u8FD9\u79CD IoC \u5F71\u54CD\u5927"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-5-0/#decorators",children:"typescript 5.0 decorators"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6CA1\u6709 ",(0,i.jsx)(n.code,{children:"--experimentalDecorators"})," flag\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E5F\u80FD\u7528"}),"\n",(0,i.jsx)(n.li,{children:"\u751F\u6210\u903B\u8F91\u4E0D\u540C"}),"\n",(0,i.jsx)(n.li,{children:"\u6709\u7C7B\u578B\u68C0\u67E5"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u65B0\u7684\u903B\u8F91\u4E0D\u652F\u6301 ",(0,i.jsx)(n.code,{children:"--emitDecoratorMetadata"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/evanw/esbuild/issues/104",children:"esbuild#104"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/nestjs/nest/issues/11414",children:"nestjs/nest#11414"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u77ED\u65F6\u95F4\u5185\u8FD8\u4E0D\u4F1A\u652F\u6301"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'type Decorator = (value: Input, context: {\n  kind: string;\n  name: string | symbol;\n  access: {\n    get?(): unknown;\n    set?(value: unknown): void;\n  };\n  private?: boolean;\n  static?: boolean;\n  addInitializer?(initializer: () => void): void;\n  // TS 5.2\n  metadata?: Record<string | number | symbol, unknown>;\n}) => Output | void;\n\ntype ClassMethodDecorator = (value: Function, context: {\n  kind: "method";\n  name: string | symbol;\n  access: { get(): unknown };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassGetterDecorator = (value: Function, context: {\n  kind: "getter";\n  name: string | symbol;\n  access: { get(): unknown };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassSetterDecorator = (value: Function, context: {\n  kind: "setter";\n  name: string | symbol;\n  access: { set(value: unknown): void };\n  static: boolean;\n  private: boolean;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassFieldDecorator = (value: undefined, context: {\n  kind: "field";\n  name: string | symbol;\n  access: { get(): unknown, set(value: unknown): void };\n  static: boolean;\n  private: boolean;\n}) => (initialValue: unknown) => unknown | void;\n\ntype ClassDecorator = (value: Function, context: {\n  kind: "class";\n  name: string | undefined;\n  addInitializer(initializer: () => void): void;\n}) => Function | void;\n\ntype ClassAutoAccessorDecorator = (\n  value: {\n    get: () => unknown;\n    set: (value: unknown) => void;\n  },\n  context: {\n    kind: "accessor";\n    name: string | symbol;\n    access: { get(): unknown, set(value: unknown): void };\n    static: boolean;\n    private: boolean;\n    addInitializer(initializer: () => void): void;\n  }\n) => {\n  get?: () => unknown;\n  set?: (value: unknown) => void;\n  init?: (initialValue: unknown) => unknown;\n} | void;\n'})}),"\n",(0,i.jsx)(n.h2,{id:"typescript-legacy",children:"Typescript legacy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"declare type ClassDecorator = <TFunction extends Function>(target: TFunction) => TFunction | void;\ndeclare type PropertyDecorator = (target: Object, propertyKey: string | symbol) => void;\ndeclare type MethodDecorator = <T>(\n  target: Object,\n  propertyKey: string | symbol,\n  descriptor: TypedPropertyDescriptor<T>,\n) => TypedPropertyDescriptor<T> | void;\ndeclare type ParameterDecorator = (\n  target: Object,\n  propertyKey: string | symbol | undefined,\n  parameterIndex: number,\n) => void;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const ExposeService = (): ClassDecorator => (target) => target;\nconst ExposeMethod = (): MethodDecorator => (target) => target;\nconst ExposeField = (): PropertyDecorator => (target) => target;\n\n@ExposeService()\nclass MyService {\n  @ExposeField()\n  url: string = 'https://wener.me';\n\n  @ExposeMethod()\n  hello(name: string): string | undefined {\n    return '';\n  }\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"'use strict';\nvar __decorate =\n  (this && this.__decorate) ||\n  function (decorators, target, key, desc) {\n    var c = arguments.length,\n      r = c < 3 ? target : desc === null ? (desc = Object.getOwnPropertyDescriptor(target, key)) : desc,\n      d;\n    if (typeof Reflect === 'object' && typeof Reflect.decorate === 'function')\n      r = Reflect.decorate(decorators, target, key, desc);\n    else\n      for (var i = decorators.length - 1; i >= 0; i--)\n        if ((d = decorators[i])) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return (c > 3 && r && Object.defineProperty(target, key, r), r);\n  };\nvar __metadata =\n  (this && this.__metadata) ||\n  function (k, v) {\n    if (typeof Reflect === 'object' && typeof Reflect.metadata === 'function') return Reflect.metadata(k, v);\n  };\nconst ExposeService = () => (target) => target;\nconst ExposeMethod = () => (target) => target;\nconst ExposeField = () => (target) => target;\nlet MyService = class MyService {\n  constructor() {\n    this.url = 'https://wener.me';\n  }\n  hello(name) {\n    return '';\n  }\n};\n__decorate([ExposeField(), __metadata('design:type', String)], MyService.prototype, 'url', void 0);\n__decorate(\n  [\n    ExposeMethod(),\n    __metadata('design:type', Function),\n    __metadata('design:paramtypes', [String]),\n    __metadata('design:returntype', Object),\n  ],\n  MyService.prototype,\n  'hello',\n  null,\n);\nMyService = __decorate([ExposeService()], MyService);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"emitDecoratorMetadata"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/play?experimentalDecorators=true&emitDecoratorMetadata=true&target=99&ts=5.2.2#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUAXAMIA2AhhBACJqjaNQjYkB85KI2wBzNFEoDhYiQG4AsAChlAAUQp0WPITRVlwJixgBZAJ7aCRAN4BfZUA",children:"Playground"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"typescript-next",children:"Typescript next"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const ExposeService = () => (value: any, ctx: ClassDecoratorContext) => {};\nconst ExposeMethod = () => (value: any, ctx: ClassMethodDecoratorContext) => {};\nconst ExposeField = () => (value: any, ctx: ClassFieldDecoratorContext) => {};\n\n@ExposeService()\nclass MyService {\n  @ExposeField()\n  url: string = 'https://wener.me';\n\n  @ExposeMethod()\n  hello(name: string): string | undefined {\n    return '';\n  }\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"'use strict';\nvar __esDecorate =\n  (this && this.__esDecorate) ||\n  function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n    function accept(f) {\n      if (f !== void 0 && typeof f !== 'function') throw new TypeError('Function expected');\n      return f;\n    }\n    var kind = contextIn.kind,\n      key = kind === 'getter' ? 'get' : kind === 'setter' ? 'set' : 'value';\n    var target = !descriptorIn && ctor ? (contextIn['static'] ? ctor : ctor.prototype) : null;\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n    var _,\n      done = false;\n    for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === 'access' ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) {\n        if (done) throw new TypeError('Cannot add initializers after decoration has completed');\n        extraInitializers.push(accept(f || null));\n      };\n      var result = (0, decorators[i])(\n        kind === 'accessor' ? { get: descriptor.get, set: descriptor.set } : descriptor[key],\n        context,\n      );\n      if (kind === 'accessor') {\n        if (result === void 0) continue;\n        if (result === null || typeof result !== 'object') throw new TypeError('Object expected');\n        if ((_ = accept(result.get))) descriptor.get = _;\n        if ((_ = accept(result.set))) descriptor.set = _;\n        if ((_ = accept(result.init))) initializers.unshift(_);\n      } else if ((_ = accept(result))) {\n        if (kind === 'field') initializers.unshift(_);\n        else descriptor[key] = _;\n      }\n    }\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\n    done = true;\n  };\nvar __runInitializers =\n  (this && this.__runInitializers) ||\n  function (thisArg, initializers, value) {\n    var useValue = arguments.length > 2;\n    for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n    }\n    return useValue ? value : void 0;\n  };\nconst ExposeService = () => (value, ctx) => {};\nconst ExposeMethod = () => (value, ctx) => {};\nconst ExposeField = () => (value, ctx) => {};\nlet MyService = (() => {\n  let _classDecorators = [ExposeService()];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  let _instanceExtraInitializers = [];\n  let _url_decorators;\n  let _url_initializers = [];\n  let _hello_decorators;\n  var MyService = class {\n    static {\n      _classThis = this;\n    }\n    constructor() {\n      this.url =\n        (__runInitializers(this, _instanceExtraInitializers),\n        __runInitializers(this, _url_initializers, 'https://wener.me'));\n    }\n    static {\n      const _metadata = typeof Symbol === 'function' && Symbol.metadata ? Object.create(null) : void 0;\n      _url_decorators = [ExposeField()];\n      _hello_decorators = [ExposeMethod()];\n      __esDecorate(\n        this,\n        null,\n        _hello_decorators,\n        {\n          kind: 'method',\n          name: 'hello',\n          static: false,\n          private: false,\n          access: { has: (obj) => 'hello' in obj, get: (obj) => obj.hello },\n          metadata: _metadata,\n        },\n        null,\n        _instanceExtraInitializers,\n      );\n      __esDecorate(\n        null,\n        null,\n        _url_decorators,\n        {\n          kind: 'field',\n          name: 'url',\n          static: false,\n          private: false,\n          access: {\n            has: (obj) => 'url' in obj,\n            get: (obj) => obj.url,\n            set: (obj, value) => {\n              obj.url = value;\n            },\n          },\n          metadata: _metadata,\n        },\n        _url_initializers,\n        _instanceExtraInitializers,\n      );\n      __esDecorate(\n        null,\n        (_classDescriptor = { value: _classThis }),\n        _classDecorators,\n        { kind: 'class', name: _classThis.name, metadata: _metadata },\n        null,\n        _classExtraInitializers,\n      );\n      MyService = _classThis = _classDescriptor.value;\n      if (_metadata)\n        Object.defineProperty(_classThis, Symbol.metadata, {\n          enumerable: true,\n          configurable: true,\n          writable: true,\n          value: _metadata,\n        });\n      __runInitializers(_classThis, _classExtraInitializers);\n    }\n    hello(name) {\n      return '';\n    }\n  };\n  return (MyService = _classThis);\n})();\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/play?target=99&ts=5.2.2&ssl=15&ssc=1&pln=1&pc=1&emitDecoratorMetadata=true&experimentalDecorators=true#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUJAfObgIYA2ArmgFwNgCeANMFATsAwkwYQIAETShsDKCGzDwUNAijUaAbwC+AbgCwAKFCRYiFOgCyaKAAsQAE1IVN9Zm049+gkWIk29k7SsvKKymCq6pq6hibg0PDIqGgAYvhoTM5kVLTurBxcfAJCouIQ6ZmOIYphSipqGrSxxsYAAhYpWHiEaFTGwP4QMFbc3QREWsYwMzAdyeiVWf1GszAs2Ezs0Nj4YADmLgDkdlBQSBDsAPRXAO5oYDgAdAC2aEetq7PzlmiBDo4Vms7JkmCByGAGG9tlBdgdKDC4fsAD4sMCONAAMz2aEcUy+axm2FsGzAMCOHwJMB0xhpRiAA",children:"https://www.typescriptlang.org/play?target=99&ts=5.2.2&ssl=15&ssc=1&pln=1&pc=1&emitDecoratorMetadata=true&experimentalDecorators=true#code/MYewdgzgLgBAogDwA4ggUwMpoE4DcCWwaMAvDABQCUJAfObgIYA2ArmgFwNgCeANMFATsAwkwYQIAETShsDKCGzDwUNAijUaAbwC+AbgCwAKFCRYiFOgCyaKAAsQAE1IVN9Zm049+gkWIk29k7SsvKKymCq6pq6hibg0PDIqGgAYvhoTM5kVLTurBxcfAJCouIQ6ZmOIYphSipqGrSxxsYAAhYpWHiEaFTGwP4QMFbc3QREWsYwMzAdyeiVWf1GszAs2Ezs0Nj4YADmLgDkdlBQSBDsAPRXAO5oYDgAdAC2aEetq7PzlmiBDo4Vms7JkmCByGAGG9tlBdgdKDC4fsAD4sMCONAAMz2aEcUy+axm2FsGzAMCOHwJMB0xhpRiAA"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>o});var r=t(7378);let i={},s=r.createContext(i);function a(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);