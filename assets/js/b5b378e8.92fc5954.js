"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["97092"],{32523:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>c,toc:()=>d,default:()=>u,metadata:()=>r,assets:()=>h,contentTitle:()=>t});var r=JSON.parse('{"id":"java/spring/security-oauth2","title":"Spring Security OAuth2","description":"Tips","source":"@site/../notes/java/spring/spring-security-oauth2.md","sourceDirName":"java/spring","slug":"/java/spring/security-oauth2","permalink":"/notes/java/spring/security-oauth2","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/java/spring/spring-security-oauth2.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1602516815000,"frontMatter":{"id":"security-oauth2","title":"Spring Security OAuth2"},"sidebar":"docs","previous":{"title":"metrics","permalink":"/notes/java/spring/metrics"},"next":{"title":"Spring Security","permalink":"/notes/java/spring/security"}}'),s=i(86106),l=i(17776);let c={id:"security-oauth2",title:"Spring Security OAuth2"},t="Spring Security OAuth2",h={},d=[{value:"Tips",id:"tips",level:2},{value:"Notes",id:"notes",level:2}];function o(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"spring-security-oauth2",children:"Spring Security OAuth2"})}),"\n",(0,s.jsx)(e.h2,{id:"tips",children:"Tips"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["OAuth2 ",(0,s.jsx)(e.a,{href:"https://tools.ietf.org/html/rfc6749",children:"rfc6749"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://jmnarloch.wordpress.com/2015/10/07/spring-cloud-feign-spdyhttp2/",children:"Spring Cloud: Feign SPDY/HTTP2"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://jmnarloch.wordpress.com/2015/10/14/spring-cloud-feign-oauth2-authentication/",children:"Spring Cloud: Feign OAuth2 authentication"})}),"\n",(0,s.jsxs)(e.li,{children:["Spring ",(0,s.jsx)(e.a,{href:"http://projects.spring.io/spring-security-oauth/docs/oauth2.html",children:"OAuth 2 Developers Guide"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"http://www.baeldung.com/spring-security-oauth-jwt",children:"spring-security-oauth-jwt"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/spring-projects/spring-security-oauth",children:"spring-projects/spring-security-oauth"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"http://www.baeldung.com/spring-security-oauth-jwt",children:"Using JWT with Spring Security OAuth"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"AS \u9881\u53D1 JWT"}),"\n",(0,s.jsx)(e.li,{children:"RS \u63A5\u6536 JWT"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://www.oauth.com/oauth2-servers/authorization/requiring-user-login",children:"Requiring User Login"})}),"\n",(0,s.jsx)(e.li,{children:"Access Token \u9ED8\u8BA4\u5931\u6548\u65F6\u95F4\u4E3A 12h"}),"\n",(0,s.jsx)(e.li,{children:"Refresh Token \u9ED8\u8BA4\u5931\u6548\u65F6\u95F4\u4E3A 30d"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"curl acme:acmesecret@localhost:8080/oauth/token -d grant_type=client_credentials\ncurl acme:acmesecret@localhost:8080/oauth/token -d grant_type=password -d username=user -d password=...\n\nhttp://localhost:8080/oauth/authorize?response_type=code&client_id=cli&scope=read&state=yes&redirect_uri=http://localhost:8080/cb\nhttp://localhost:8080/oauth/authorize?response_type=token&client_id=cli&scope=read&state=yes&redirect_uri=http://localhost:8080/cb\n"})}),"\n",(0,s.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"OAuth2"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"@EnableAuthorizationServer"})," / AS / \u6388\u6743\u670D\u52A1\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"AuthorizationServerEndpointsConfiguration"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"AuthorizationServerSecurityConfiguration"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ClientDetailsServiceConfiguration"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"ClientDetailsServiceConfigurer"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"AuthorizationServerConfigurer"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"AuthorizationServerSecurityConfigurer"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"@EnableOAuth2Client"})," / Client / \u5BA2\u6237\u7AEF\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E3B\u8981\u7528\u4E8E\u7B80\u5316\u53D1\u8D77 OAuth2 \u7684\u8BF7\u6C42"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"@EnableResourceServer"})," / RS / \u8D44\u6E90\u670D\u52A1\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ResourceServerConfiguration"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"ResourceServerConfigurer"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"DefaultTokenServices"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5B9E\u73B0\u4E86\u6838\u5FC3\u7684\u51E0\u4E2A\u63A5\u53E3 ",(0,s.jsx)(e.code,{children:"AuthorizationServerTokenServices"}),", ",(0,s.jsx)(e.code,{children:"ResourceServerTokenServices"}),", ",(0,s.jsx)(e.code,{children:"ConsumerTokenServices"})]}),"\n",(0,s.jsxs)(e.li,{children:["Token \u5B58\u50A8\u4EA4\u7531 ",(0,s.jsx)(e.code,{children:"TokenStore"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"AuthorizationServerEndpointsConfigurer"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6838\u5FC3\u914D\u7F6E\u5BF9\u8C61, \u6240\u6709\u7684\u76F8\u5173\u63A5\u53E3\u548C\u914D\u7F6E"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"AuthorizationServerConfigurer"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"OAUth2 Authorization Server \u914D\u7F6E\u63A5\u53E3"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"ApprovalStore"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5B58\u50A8\u7528\u6237\u6279\u51C6\u7684\u4FE1\u606F"}),"\n",(0,s.jsx)(e.li,{children:"\u6BCF\u4E2A\u7528\u6237,\u6BCF\u4E2A\u5BA2\u6237\u7AEF"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"OAuth2RequestFactory"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7BA1\u7406 OAuth2 \u8BF7\u6C42"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"ClientDetails"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"OAuth2 \u7684\u5BA2\u6237\u7AEF\u4FE1\u606F"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ClientDetailsService"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u83B7\u53D6\u5BA2\u6237\u7AEF\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ClientRegistrationService"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6DFB\u52A0\u4FEE\u6539\u548C\u5220\u9664\u5BA2\u6237\u7AEF\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"OAuth2SecurityExpressionMethods"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u8868\u8FBE\u5F0F\u4E2D\u7684 ",(0,s.jsx)(e.code,{children:"oauth2"})," \u65B9\u6CD5"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"OAuth2AccessToken"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"TokenEnhancer"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5BF9 Token \u5BF9\u8C61\u8FDB\u884C\u589E\u5F3A"}),"\n",(0,s.jsx)(e.li,{children:"\u4F8B\u5982\u5B9E\u73B0 JWT \u6DFB\u52A0\u81EA\u5B9A\u4E49 Claims"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"TokenEnhancerChain"})," \u5B9E\u73B0\u4E00\u7EC4\u589E\u5F3A"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"TokenStore"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5B58\u50A8 OAuth2 Token"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ConsumerTokenServices"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7528\u4E8E\u56DE\u6536 Token"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"TokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5BF9\u5E94 OAuth2 \u4E2D\u7684\u4E0D\u540C\u6388\u6743\u7C7B\u578B"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"AuthorizationCodeServices"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u751F\u6210\u548C\u5B58\u50A8 authorization_code"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u8D26\u53F7\u5BC6\u7801\u7684\u6388\u6743\u4F1A\u4F7F\u7528 Spring Security \u4E2D\u7684 ",(0,s.jsx)(e.code,{children:"AuthenticationManager"})," \u6765\u5224\u65AD\u662F\u5426\u6388\u6743\u6210\u529F"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"TokenGranter"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u751F\u6210\u4E0D\u540C\u7C7B\u578B\u7684 Token"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ImplicitTokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"implicit"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"RefreshTokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"refresh_token"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"AuthorizationCodeTokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"authorization_code"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ResourceOwnerPasswordTokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"password"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ClientCredentialsTokenGranter"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"client_credentials"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"AuthorizationEndpoint\n/oauth2/authorize"}),"\n",(0,s.jsx)(e.p,{children:"AuthorizationEndpoint\n/oauth2/token"}),"\n",(0,s.jsx)(e.p,{children:"/oauth/confirm_access\n/oauth/error"})]})}function u(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},17776:function(n,e,i){i.d(e,{R:()=>c,x:()=>t});var r=i(7378);let s={},l=r.createContext(s);function c(n){let e=r.useContext(l);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);