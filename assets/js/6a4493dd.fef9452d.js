"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["29142"],{65216:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>u,metadata:()=>s,assets:()=>o,contentTitle:()=>a});var s=JSON.parse('{"id":"devops/kubernetes/distro/k3s/k3s-conf","title":"K3S \u914D\u7F6E","description":"- \u81EA v1.19 \u652F\u6301 yaml \u914D\u7F6E","source":"@site/../notes/devops/kubernetes/distro/k3s/k3s-conf.md","sourceDirName":"devops/kubernetes/distro/k3s","slug":"/devops/kubernetes/distro/k3s/conf","permalink":"/notes/devops/kubernetes/distro/k3s/conf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/distro/k3s/k3s-conf.md","tags":[{"inline":true,"label":"Configuration","permalink":"/notes/tags/configuration"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1689238697000,"frontMatter":{"title":"K3S \u914D\u7F6E","tags":["Configuration"]},"sidebar":"docs","previous":{"title":"Centos","permalink":"/notes/devops/kubernetes/distro/k3s/centos"},"next":{"title":"K3S Cookbook","permalink":"/notes/devops/kubernetes/distro/k3s/cookbook"}}'),t=r(86106),i=r(17776);let l={title:"K3S \u914D\u7F6E",tags:["Configuration"]},a="K3S \u914D\u7F6E",o={},c=[{value:"registries.yaml",id:"registriesyaml",level:2},{value:"config.yaml",id:"configyaml",level:2},{value:"server",id:"server",level:3},{value:"agent",id:"agent",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"k3s-\u914D\u7F6E",children:"K3S \u914D\u7F6E"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u81EA v1.19 \u652F\u6301 yaml \u914D\u7F6E"}),"\n",(0,t.jsxs)(n.li,{children:["/etc/rancher/k3s/config.yaml - K3S_CONFIG_FILE, --config, -c\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"yaml \u914D\u7F6E"}),"\n",(0,t.jsx)(n.li,{children:"\u53C2\u6570\u57FA\u672C\u4E0E\u547D\u4EE4\u884C\u53C2\u6570\u4E00\u81F4"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/etc/rancher/k3s/config.yaml.d/*.yaml"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["key \u524D\u9762\u52A0 ",(0,t.jsx)(n.code,{children:"+"})," \u53EF\u7528\u4E8E\u9644\u52A0\u5185\u5BB9"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"/etc/rancher/k3s/k3s.yaml - KUBECONFIG"}),"\n",(0,t.jsx)(n.li,{children:"/etc/rancher/k3s/registries.yaml - \u5BB9\u5668\u955C\u50CF\u4ED3\u5E93\u914D\u7F6E"}),"\n",(0,t.jsx)(n.li,{children:"\u73AF\u5883\u53D8\u91CF K3S_DATASTORE_ENDPOINT \u6620\u5C04\u4E3A datastore-endpoint"}),"\n",(0,t.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.k3s.io/installation/configuration",children:"https://docs.k3s.io/installation/configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.k3s.io/reference/env-variables",children:"https://docs.k3s.io/reference/env-variables"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"registriesyaml",children:"registries.yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'mirrors:\n  # \u9488\u5BF9 docker.io \u7684\u955C\u50CF\u4ED3\u5E93\n  docker.io:\n    endpoint:\n      - https://fogjl973.mirror.aliyuncs.com\n      - https://8x40wsit.mirror.aliyuncs.com\n      - https://docker.mirrors.ustc.edu.cn\n      - https://registry-1.docker.io\n# \u79C1\u6709\u4ED3\u5E93\u8FD8\u9700\u8981\u914D\u7F6E\u8BA4\u8BC1\u4FE1\u606F\n# configs:\n#   # \u6DFB\u52A0\u6388\u6743\u548C\u8BC1\u4E66\n#   "mycustomreg:5000":\n#     auth:\n#       username: xxxxxx\n#       password: xxxxxx\n#     tls:\n#       cert_file:\n#       key_file:\n#       ca_file:\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.k3s.io/installation/private-registry",children:"https://docs.k3s.io/installation/private-registry"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configyaml",children:"config.yaml"}),"\n",(0,t.jsx)(n.h3,{id:"server",children:"server"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# \u6570\u636E\u5E93\u914D\u7F6E\ndatastore-endpoint:\n# TLS \u8FDE\u63A5 - \u6BD4\u5982 PG\ndatastore-cafile:\ndatastore-certfile:\ndatastore-keyfile:\n\n# \u52A0\u5165 server \u548C agent\ntoken:\ntoken-file:\n\nagent-token:\nagent-token-file:\n\n# \u5199\u5165 kubeconfig\nwrite-kubeconfig: /etc/rancher/k3s/k3s.yml\nwrite-kubeconfig-mode: '0644'\n\n# Agent \u914D\u7F6E - server \u4E5F\u4F1A\u8FD0\u884C agent\uFF0C\u914D\u7F6E\u540C agent \u914D\u7F6E\n#\n\n# \u76D1\u542C\u914D\u7F6E\nbind-address: 0.0.0.0\nhttps-listen-port: 6443\nadvertise-address: #node-external-ip/node-ip\nadvertise-port:\n# \u5982\u679C\u5E0C\u671B\u8BC1\u4E66\u5728\u67D0\u4E2A\u57DF\u540D\u4E0B\u53EF\u4F7F\u7528\u5219\u9700\u8981\u6DFB\u52A0 SAN\ntls-san:\n  - k3s.example.com\n\n# \u5982\u679C\u975E ROOT ${HOME}/.rancher/k3s\ndata-dir: /var/lib/rancher/k3s\n\n# \u7F51\u7EDC\ncluster-cidr: 10.42.0.0/16\nservice-cidr: 10.43.0.0/16\n# CoreDNS\ncluster-dns: 10.43.0.10\ncluster-domain: cluster.local\n# none,vxlan,ipsec,host-gw,wireguard\nflannel-backend: vxlan\n\n# \u81EA\u5B9A\u4E49\nkube-apiserver-arg:\nkube-scheduler-arg:\nkube-controller-manager-arg:\nkube-cloud-controller-manager-arg:\n\nkubelet-arg:\nkube-proxy-arg:\n\n# \u9ED8\u8BA4\u672C\u5730\u57FA\u4E8E path \u7684 sc \u5B58\u50A8\u8DEF\u5F84\ndefault-local-storage-path:\n\n# \u7EC4\u4EF6\n# coredns, servicelb, traefik, local-storage, metrics-server\ndisable:\n  - servicelb\n  - traefik\ndisable-scheduler: false\ndisable-cloud-controller: false\ndisable-network-policy: false\n\n# \u5B9E\u9A8C\u9636\u6BB5\nrootless: false\nserver:\n\n# --cluster-init\n# --cluster-reset\n\n# Secret encryption at rest\nsecrets-encryption: false\n"})}),"\n",(0,t.jsx)(n.h3,{id:"agent",children:"agent"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.k3s.io/cli/agent",children:"https://docs.k3s.io/cli/agent"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"token: value\ntoken-file: k3s-agent.token\nserver: value\n\ndata-dir: /var/lib/rancher/k3s\n\n# Note\nnode-name: hostname\n# with-node-id: true\n# node-label\n# node-taint\n\n# Runtime\n# docker: true\ncontainer-runtime-endpoint:\npause-image: docker.io/rancher/pause:3.1\nprivate-registry: /etc/rancher/k3s/registries.yaml\n\n# Networking\n# node-ip:\n# node-external-ip:\n# resolv-conf\nflannel-iface:\nflannel-conf:\n\nkubelet-arg:\nkube-proxy-arg:\n\nrootless: true\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},17776:function(e,n,r){r.d(n,{R:()=>l,x:()=>a});var s=r(7378);let t={},i=s.createContext(t);function l(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);