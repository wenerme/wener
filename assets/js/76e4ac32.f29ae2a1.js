"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["284861"],{377881:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>h,metadata:()=>i,assets:()=>c,contentTitle:()=>a});var i=JSON.parse('{"id":"service/auth/kb-x","title":"Kerberos & LDAP","description":"Kerberos","source":"@site/../notes/service/auth/kb-x.md","sourceDirName":"service/auth","slug":"/service/auth/kb-x","permalink":"/notes/service/auth/kb-x","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/auth/kb-x.md","tags":[{"inline":true,"label":"Service","permalink":"/notes/tags/service"},{"inline":true,"label":"Auth","permalink":"/notes/tags/auth"},{"inline":true,"label":"Kerberos","permalink":"/notes/tags/kerberos"},{"inline":true,"label":"LDAP","permalink":"/notes/tags/ldap"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Kerberos & LDAP","tags":["Service","Auth","Kerberos","LDAP"]},"sidebar":"docs","previous":{"title":"Hydra","permalink":"/notes/service/auth/hydra"},"next":{"title":"Kerberos","permalink":"/notes/service/auth/kerberos/"}}'),s=r(486106),t=r(917776);let l={title:"Kerberos & LDAP",tags:["Service","Auth","Kerberos","LDAP"]},a="Kerberos & LDAP (X.500)",c={},d=[{value:"Kerberos",id:"kerberos",level:2},{value:"Packages",id:"packages",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Concepts",id:"concepts",level:3},{value:"macOS Issues",id:"macos-issues",level:3},{value:"LDAP",id:"ldap",level:2},{value:"LDAP Attribute Types",id:"ldap-attribute-types",level:3},{value:"KDC Tracing",id:"kdc-tracing",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Pre-authentication required",id:"pre-authentication-required",level:3},{value:"AES256 Support",id:"aes256-support",level:3},{value:"weak encryption",id:"weak-encryption",level:3},{value:"Server not found",id:"server-not-found",level:3},{value:"Example LDIF",id:"example-ldif",level:3},{value:"Advanced krb5.conf",id:"advanced-krb5conf",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"kerberos--ldap-x500",children:"Kerberos & LDAP (X.500)"})}),"\n",(0,s.jsx)(n.h2,{id:"kerberos",children:"Kerberos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/Kerberos",children:"Kerberos - ArchWiki"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://web.mit.edu/kerberos/kfw-4.1/kfw-4.1/kfw-4.1-help/html/getting_started.htm",children:"Getting Started with Kerberos"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://directory.apache.org/apacheds/kerberos-ug/1.1.8-tickets.html",children:"Managing Kerberos Tickets"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/a/38664954/1870054",children:"Curl Kerberos Info"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"packages",children:"Packages"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Server"}),": ",(0,s.jsx)(n.a,{href:"https://pkgs.alpinelinux.org/contents?file=&path=&name=krb5-server&branch=edge&repo=main&arch=x86_64",children:"krb5-server"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Client"}),": ",(0,s.jsx)(n.a,{href:"https://pkgs.alpinelinux.org/contents?branch=edge&name=krb5&arch=x86_64&repo=main",children:"krb5"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"krb5.conf"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[libdefaults]\ndefault_realm = EXAMPLE.COM\n\n[realms]\nEXAMPLE.COM = {\n  admin_server = kerberos.example.com\n  # Support DNS SRV\n  kdc = kerberos.example.com\n  # Not compatible with krb4 but more secure\n  default_principal_flags = +preauth\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Initialize principal\nkinit wener\n\n# Initialize with keytab\nkinit -V -k -t /etc/krb5.keytab HTTP/vmproxy.mydomain.com@MYDOMAIN.COM\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://web.mit.edu/kerberos/krb5-1.6/krb5-1.6.1/doc/krb5-admin.html#Using%20DNS",children:"Using DNS for Kerberos"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"KRB5_CONFIG"}),", ",(0,s.jsx)(n.code,{children:"keytab"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ktpass -princ host/hostA.subdomain.com@SUBDOMAIN.COM -mapuser host-hostA -pass xxxxxx -crypto RC4-HMAC -out krb5.keytab"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"concepts",children:"Concepts"}),"\n",(0,s.jsx)(n.p,{children:"The Kerberos server of Apache Directory implements RFC 1510 and RFC 4120, the Kerberos V5 Network Authentication Service. The purpose of Kerberos is to verify the identities of principals (users or services) on an unprotected network."}),"\n",(0,s.jsx)(n.p,{children:"While generally thought of as a single-sign-on technology, Kerberos's true strength is in authenticating users without ever sending their passwords over the network. Kerberos is designed for use in open (untrusted) networks and, therefore, operates under the assumption that packets traveling along the network can be read, modified, and inserted at will."}),"\n",(0,s.jsx)(n.p,{children:"Kerberos is named after the three-headed dog that guards the gates to Hades. The three heads are the client, the Kerberos server, and the network service being accessed."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Principals"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Users (e.g., ",(0,s.jsx)(n.code,{children:"john@APACHE.ORG"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Services (e.g., ",(0,s.jsx)(n.code,{children:"ldap/www.apache.org@APACHE.ORG"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Hosts (e.g., ",(0,s.jsx)(n.code,{children:"host/www.apache.org/apache.org@APACHE.ORG"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"macos-issues",children:"macOS Issues"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://web.mit.edu/macdev/KfM/Common/Documentation/preferences-osx.html",children:"macOS krb5 Client Preferences"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://apple.stackexchange.com/questions/63122/kinit-krb5-get-init-creds-unable-to-reach-any-kdc-in-realm-local",children:"Unable to reach any KDC in realm"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["On macOS, the default client does not fall back to TCP. In your ",(0,s.jsx)(n.code,{children:"krb.conf"}),", prefix your ",(0,s.jsx)(n.code,{children:"kdc"})," value with ",(0,s.jsx)(n.code,{children:"tcp/"})," to force TCP:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"kdc = tcp/realm.example.com:88\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ldap",children:"LDAP"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.ldap.com/basic-ldap-concepts",children:"Basic LDAP Concepts"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://archive.oreilly.com/pub/a/perl/excerpts/system-admin-with-perl/ten-minute-ldap-utorial.html",children:"Ten Minute LDAP Tutorial"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.manageengine.com/products/ad-manager/help/csv-import-management/active-directory-ldap-attributes.html",children:"Active Directory LDAP Attributes"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://www.kouti.com/tables/userattributes.htm",children:"User Attributes Table"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/LDAP_Data_Interchange_Format",children:"LDAP Data Interchange Format (LDIF)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.ietf.org/rfc/rfc2253.txt",children:"RFC 2253 - UTF-8 String Representation of Distinguished Names"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ldap-attribute-types",children:"LDAP Attribute Types"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"String"}),(0,s.jsx)(n.th,{children:"X.500 AttributeType"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CN"}),(0,s.jsx)(n.td,{children:"commonName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"L"}),(0,s.jsx)(n.td,{children:"localityName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ST"}),(0,s.jsx)(n.td,{children:"stateOrProvinceName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"O"}),(0,s.jsx)(n.td,{children:"organizationName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"OU"}),(0,s.jsx)(n.td,{children:"organizationalUnitName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"C"}),(0,s.jsx)(n.td,{children:"countryName"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"STREET"}),(0,s.jsx)(n.td,{children:"streetAddress"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DC"}),(0,s.jsx)(n.td,{children:"domainComponent"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"UID"}),(0,s.jsx)(n.td,{children:"userid"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ldapmodify -h localhost -p 10389 -D "uid=admin,ou=system" -w secret -a -f marmoser-partition.ldif\n'})}),"\n",(0,s.jsx)(n.h3,{id:"kdc-tracing",children:"KDC Tracing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"KRB5_TRACE=/dev/stdout kpasswd\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"pre-authentication-required",children:"Pre-authentication required"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[21:39:17] ERROR [org.apache.directory.server.KERBEROS_LOG] - No timestamp found\n[21:39:17] WARN [org.apache.directory.server.kerberos.protocol.KerberosProtocolHandler] - Additional pre-authentication required (25)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://issues.apache.org/jira/browse/DIRKRB-99",children:"DIRKRB-99"})}),"\n",(0,s.jsx)(n.h3,{id:"aes256-support",children:"AES256 Support"}),"\n",(0,s.jsx)(n.p,{children:"AES256 is not included by default in standard J2SE installation. You have to install JCE."}),"\n",(0,s.jsx)(n.h3,{id:"weak-encryption",children:"weak encryption"}),"\n",(0,s.jsx)(n.p,{children:"If ApacheDS uses weak encryption:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enable ",(0,s.jsx)(n.code,{children:"allow_weak_crypto = true"})," in ",(0,s.jsx)(n.code,{children:"libdefaults"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Or modify ",(0,s.jsx)(n.code,{children:"ads-krbEncryptionTypes"})," in ApacheDS configuration."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"server-not-found",children:"Server not found"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Server not found in Kerberos database while getting initial credentials\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check if the principal exists."}),"\n",(0,s.jsx)(n.h3,{id:"example-ldif",children:"Example LDIF"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ldif",children:"dn: uid=keycloak,ou=services,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nobjectClass: krb5KDCEntry\nobjectClass: uidObject\nobjectClass: krb5Principal\nkrb5KeyVersionNumber: 0\nkrb5PrincipalName: HTTP/keycloak@EXAMPLE.COM\nuid: kpasswd\nuserPassword:: randomkey\nou: Keycloak\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-krb5conf",children:"Advanced krb5.conf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[logging]\n# default = FILE:/var/log/krb5libs.log\n# kdc = FILE:/var/log/krb5kdc.log\n# admin_server = FILE:/var/log/kadmind.log\n\n[libdefaults]\n dns_lookup_realm = false\n ticket_lifetime = 24h\n renew_lifetime = 7d\n forwardable = true\n rdns = false\ndefault_realm = EXAMPLE.COM\nallow_weak_crypto = true\n\n[realms]\nEXAMPLE.COM = {\n  kdc = 192.168.36.8:60088\n  kpasswd_server = 192.168.36.8:60464\n}\n\n[domain_realm]\n .example.com = EXAMPLE.COM\n example.com = EXAMPLE.COM\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},917776:function(e,n,r){r.d(n,{R:()=>l,x:()=>a});var i=r(7378);let s={},t=i.createContext(s);function l(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);