"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["62179"],{26193:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>h,default:()=>a,metadata:()=>i,assets:()=>o,contentTitle:()=>d});var i=JSON.parse('{"id":"os/linux/fs/zfs/README","title":"ZFS","description":"- ZFS 2.2 \u652F\u6301 Overlay","source":"@site/../notes/os/linux/fs/zfs/README.md","sourceDirName":"os/linux/fs/zfs","slug":"/os/linux/fs/zfs/","permalink":"/notes/os/linux/fs/zfs/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/fs/zfs/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1678946104000,"frontMatter":{"title":"ZFS"},"sidebar":"docs","previous":{"title":"SMB","permalink":"/notes/os/linux/fs/smb"},"next":{"title":"sanoid","permalink":"/notes/os/linux/fs/zfs/sanoid"}}'),l=s(86106),r=s(17776);let t={title:"ZFS"},d="ZFS",o={},h=[{value:"Tips",id:"tips",level:2},{value:"Why ZFS",id:"why-zfs",level:2},{value:"NOTES",id:"notes",level:2},{value:"\u6570\u636E\u5197\u4F59",id:"\u6570\u636E\u5197\u4F59",level:2},{value:"\u786C\u4EF6",id:"\u786C\u4EF6",level:2},{value:"Tutor",id:"tutor",level:2},{value:"\u51C6\u5907\u5DE5\u4F5C",id:"\u51C6\u5907\u5DE5\u4F5C",level:3},{value:"zpool",id:"zpool",level:3},{value:"zfs",id:"zfs-1",level:3},{value:"share",id:"share",level:2},{value:"\u7BA1\u7406\u8FD0\u7EF4",id:"\u7BA1\u7406\u8FD0\u7EF4",level:2},{value:"\u52A0\u5BC6",id:"\u52A0\u5BC6",level:2},{value:"\u53C2\u8003",id:"\u53C2\u8003",level:2},{value:"SSD",id:"ssd",level:2}];function c(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",sup:"sup",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"zfs",children:"ZFS"})}),"\n",(0,l.jsx)(e.admonition,{type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZFS 2.2 \u652F\u6301 Overlay"}),"\n"]})}),"\n",(0,l.jsx)(e.h2,{id:"tips",children:"Tips"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://zfsonlinux.org/",children:"zfsonlinux"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/zfsonlinux/zfs",children:"zfsonlinux/zfs"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://open-zfs.org/",children:"open-zfs"})}),"\n",(0,l.jsxs)(e.li,{children:["Archlinux ",(0,l.jsx)(e.a,{href:"https://wiki.archlinux.org/index.php/ZFS",children:"ZFS"})]}),"\n",(0,l.jsxs)(e.li,{children:["Archlinux ",(0,l.jsx)(e.a,{href:"https://wiki.archlinux.org/index.php/ZFS/Virtual_disks",children:"ZFS/Virtual disks"})]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pthree.org/2012/04/17/install-zfs-on-debian-gnulinux/",children:"ZFS Administration"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://buildwithbsd.org/zfs/zfs_tutorial_part_1.html",children:"ZFS Tutorial - 2016"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://serverfault.com/questions/355708",children:"ZFS Resources"})}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://docs.oracle.com/cd/E23824_01/pdf/821-1448.pdf",children:"Oracle\xae Solaris Administration: ZFS File Systems - 2012"}),(0,l.jsx)(e.a,{href:"https://docs.oracle.com/cd/E23824_01/html/821-1448/",children:"HTML"})]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://docs.oracle.com/cd/E23824_01/html/821-1448/gkkih.html",children:"Encryption"})}),"\n",(0,l.jsxs)(e.li,{children:["\u6570\u636E\u5B8C\u6574\u6027\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u5B8C\u6574\u6027\u662F ZFS \u7684\u4E3B\u8981\u7279\u6027"}),"\n",(0,l.jsx)(e.li,{children:"256 \u4F4D\u7684\u6821\u9A8C\u548C\u4F4D\u4E8E\u5143\u6570\u636E\u4E2D,\u4E0E\u6570\u636E\u76F8\u9694\u79BB"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Copy on Write"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u5FEB\u7167"}),"\n",(0,l.jsxs)(e.li,{children:["Pooled Data Storage\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZFS \u4F1A\u5C06\u5B58\u50A8\u8BBE\u5907\u7684\u53EF\u7528\u7A7A\u95F4\u4F5C\u4E3A\u4E00\u4E2A\u8D44\u6E90\u6C60, zpool"}),"\n",(0,l.jsx)(e.li,{children:"\u4F1A\u7528\u4E8E\u4F18\u5316\u6027\u80FD\u548C\u5197\u4F59"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["RAIDZ\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RAIDZ1 - RAID-5"}),"\n",(0,l.jsx)(e.li,{children:"RAIDZ2 - RAID-6"}),"\n",(0,l.jsx)(e.li,{children:"RAIDZ3 \u7528\u7684\u76F8\u5BF9\u8F83\u5C11, \u591A\u4E00\u4E2A\u5197\u4F59"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"SSD \u6DF7\u5408\u5B58\u50A8\u6C60"}),"\n",(0,l.jsxs)(e.li,{children:["\u5BB9\u91CF\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZFS \u662F 128 \u4F4D\u7684\u6587\u4EF6\u7CFB\u7EDF, \u53EF\u5B58\u50A8 256 ZB"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u6570\u636E\u6E05\u6D17\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZFS \u53EF\u5BF9\u5B58\u50A8\u6C60\u91CC\u7684\u6570\u636E\u8FDB\u884C\u5B8C\u6574\u6027\u6821\u9A8C,\u53EF\u4FEE\u6539\u5176\u4E2D\u7684\u6570\u636E\u9519\u8BEF."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u53EF\u4F7F\u7528 ZSF \u6307\u4EE4\u6765\u7BA1\u7406\u6587\u4EF6\u7CFB\u7EDF"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u53BB\u91CD"}),"\n",(0,l.jsx)(e.li,{children:"\u52A0\u5BC6"}),"\n",(0,l.jsx)(e.li,{children:"ARC - Adaptive Replacement Cache."}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/zfsonlinux/zfs/wiki/faq",children:"faq"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u9009\u62E9\u521B\u5EFA pool \u7684\u540D\u5B57\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5F00\u53D1,\u6D4B\u8BD5 /dev/hdX,/dev/sdX"}),"\n",(0,l.jsx)(e.li,{children:"\u5C0F\u4E8E 10 \u786C\u76D8 /dev/disk/by-id"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u4E8E 10 \u786C\u76D8 /dev/disk/by-path"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u4E8E 10 \u6700\u597D /dev/disk/by-vdev"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://openzfs.github.io/openzfs-docs/Project%20and%20Community/FAQ.html",children:"FAQ"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.freebsd.org/cgi/man.cgi?query=zpool&sektion=8",children:"zpool.8"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.freebsd.org/cgi/man.cgi?query=zfs&sektion=8",children:"zfs.8"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.slideshare.net/MatthewAhrens/openzfs-novel-algorithms-snapshots-space-allocation-raidz-matt-ahrens",children:"OpenZFS novel algorithms: snapshots, space allocation, RAID-Z - Matt Ahrens"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://www.zfsbuild.com/2010/05/26/zfs-raid-levels/",children:"http://www.zfsbuild.com/2010/05/26/zfs-raid-levels/"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://calomel.org/zfs_raid_speed_capacity.html",children:"ZFS Raidz Performance, Capacity and Integrity"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://forum.proxmox.com/threads/zfs-with-ssds-am-i-asking-for-a-headache-in-the-near-future.25967/",children:"https://forum.proxmox.com/threads/zfs-with-ssds-am-i-asking-for-a-headache-in-the-near-future.25967/"})}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://wintelguy.com/zfs-calc.pl",children:"ZFS / RAIDZ Capacity Calculator"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://utcc.utoronto.ca/~cks/space/blog/solaris/ZFSSystemAttributes",children:"ZFSSystemAttributes"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://utcc.utoronto.ca/~cks/space/blog/solaris/ZFSDRaidNotes",children:"ZFSDRaidNotes"})}),"\n",(0,l.jsxs)(e.li,{children:["ZFS native encryption vs LUKS ",(0,l.jsx)(e.a,{href:"https://news.ycombinator.com/item?id=32340433",children:"https://news.ycombinator.com/item?id=32340433"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"why-zfs",children:"Why ZFS"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["zpool - \u8F6F RAID\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8F6F\u4EF6\u63A7\u5236 - \u6062\u590D\u521B\u5EFA\u90FD\u6BD4\u786C RAID \u65B9\u4FBF\u5FEB\u901F"}),"\n",(0,l.jsx)(e.li,{children:"dRAID \u66F4\u8FDB\u4E00\u6B65\u63D0\u5347\u5927\u91CF\u76D8\u4F4D\u65F6\u7684\u6062\u590D\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u7075\u6D3B\u7684\u5197\u4F59\u7A0B\u5EA6\u63A7\u5236"}),"\n",(0,l.jsx)(e.li,{children:"\u5B8C\u6574\u6027\u6821\u9A8C"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"dataset - \u903B\u8F91\u5212\u5206 zpool"}),"\n",(0,l.jsxs)(e.li,{children:["ZFS - \u6587\u4EF6\u7CFB\u7EDF\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5FEB\u7167"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u91CF\u5907\u4EFD - zfs send, zfs recv"}),"\n",(0,l.jsx)(e.li,{children:"\u900F\u660E\u538B\u7F29"}),"\n",(0,l.jsx)(e.li,{children:"dedup"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7F13\u5B58 - \u5199\u7F13\u5B58\u3001\u8BFB\u7F13\u5B58\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5229\u7528\u989D\u5916\u7684 SSD \u52A0\u901F"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"When not to use ZFS"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u57FA\u4E8E RAW Disk \u7684\u96C6\u7FA4\u5B58\u50A8 - \u4F8B\u5982: Ceph"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"notes",children:"NOTES"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["zpool\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5B58\u50A8\u6C60\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E00\u7EC4\u865A\u62DF\u8BBE\u5907\u7684\u5408\u96C6"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["vdev \u72B6\u6001\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DEGRADED"}),"\n",(0,l.jsx)(e.li,{children:"FAULTED"}),"\n",(0,l.jsx)(e.li,{children:"OFFLINE"}),"\n",(0,l.jsx)(e.li,{children:"ONLINE"}),"\n",(0,l.jsx)(e.li,{children:"REMOVED"}),"\n",(0,l.jsx)(e.li,{children:"UNAVAIL"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4E3B\u8981\u7684\u5B88\u62A4\u8FDB\u7A0B\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["zfs-import\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"zpool import"})}),"\n",(0,l.jsx)(e.li,{children:"\u5BFC\u5165 pool"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["zfs-mount\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"zfs mount -a"})," / ",(0,l.jsx)(e.code,{children:"zfs umount -a"})]}),"\n",(0,l.jsx)(e.li,{children:"\u81EA\u52A8\u6302\u8F7D\u76EE\u5F55, \u6302\u8F7D\u76EE\u5F55\u548C\u662F\u5426\u6302\u8F7D\u7531 mountpoint \u548C canmount \u63A7\u5236"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["zfs-share\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"zfs share -a"})," / ",(0,l.jsx)(e.code,{children:"zfs unshare -a"})]}),"\n",(0,l.jsx)(e.li,{children:"\u63A7\u5236 iSCSI, NFS \u6216 CIFS \u7B49\u7F51\u7EDC\u5171\u4EAB"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["zfs-zed\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZFS Event Daemon"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7 zfs \u4E8B\u4EF6, \u5F53\u6709 zevent \u65F6\u95F4\u89E6\u53D1\u65F6, \u4F1A\u6267\u884C\u76F8\u5E94\u7C7B\u578B\u7684\u811A\u672C"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"A raidz group with	N disks	of size	X with P parity	disks can hold\napproximately (N-P)*X bytes and can withstand P device(s) failing\nbefore data integrity is compromised. The minimum number of\ndevices in	a raidz	group is one more than the number of parity\ndisks. The	recommended number is between 3	and 9 to help increase\nperformance."}),"\n",(0,l.jsx)(e.h2,{id:"\u6570\u636E\u5197\u4F59",children:"\u6570\u636E\u5197\u4F59"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Stripped\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65E0\u5197\u4F59"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["RAIDZ1\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7B49\u540C\u4E8E RAID 5"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u5927\u7684\u78C1\u76D8\u7A7A\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u5F53\u78C1\u76D8\u8BFB\u5199\u5757\u5927\u4E8E 128K \u65F6\u6027\u80FD\u8F83\u597D"}),"\n",(0,l.jsxs)(e.li,{children:["\u5E94\u8BE5\u4F7F\u7528 2",(0,l.jsx)(e.sup,{children:"n"}),"+1 \u4E2A\u78C1\u76D8"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["RAIDZ2\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7B49\u540C\u4E8E RAID 6"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u597D\u7684\u5BB9\u9519"}),"\n",(0,l.jsx)(e.li,{children:"\u6BD4 RAIDZ1 \u66F4\u597D\u7684 MTTDL(mean time to data loss)"}),"\n",(0,l.jsxs)(e.li,{children:["\u5E94\u8BE5\u4F7F\u7528 2",(0,l.jsx)(e.sup,{children:"n"}),"+2 \u4E2A\u78C1\u76D8"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["RAIDZ3\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5E94\u8BE5\u4F7F\u7528 2",(0,l.jsx)(e.sup,{children:"n"}),"+3 \u4E2A\u78C1\u76D8"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u955C\u50CF\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7B49\u540C\u4E8E RAID 1"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u66F4\u591A\u7684\u78C1\u76D8\u7A7A\u95F4,\u4F46\u5904\u7406\u5C0F\u6570\u636E\u7684\u8BFB\u5199\u6027\u80FD\u4F1A\u8F83\u597D."}),"\n",(0,l.jsx)(e.li,{children:"\u4E3A\u4E86\u8FFD\u6C42\u66F4\u597D\u7684\u6027\u80FD\u53EF\u57FA\u4E8E RAIDZ \u5B9E\u73B0\u955C\u50CF,\u7279\u522B\u662F\u9488\u5BF9\u4EA4\u5927\u7684,\u4E0D\u53EF\u7F13\u5B58\u7684\u968F\u673A\u8BFB."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u6BCF\u4E2A vdev \u7684\u78C1\u76D8\u4E0D\u5E94\u8BE5\u8D85\u8FC7 12 \u4E2A.\u5EFA\u8BAE\u6BCF\u4E2A vdev \u4E3A 3-9 \u4E2A\u78C1\u76D8."}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6216\u591A\u4E2A\u78C1\u76D8\u7EC4\u6210 vdev"}),"\n",(0,l.jsx)(e.li,{children:"vdev \u521B\u5EFA\u540E\u4E0D\u80FD\u4FEE\u6539"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6216\u591A\u4E2A vdev \u7EC4\u6210 zpool"}),"\n",(0,l.jsx)(e.li,{children:"\u78C1\u76D8\u635F\u574F\u4E0D\u4F1A\u5BFC\u81F4\u6570\u636E\u4E22\u5931"}),"\n",(0,l.jsx)(e.li,{children:"vdev \u635F\u574F\u5BFC\u81F4 zpool \u4E0D\u53EF\u4F7F\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u6DFB\u52A0\u5230 zpool \u540E\u7684 vdev \u4E0D\u80FD\u88AB\u5220\u9664"}),"\n",(0,l.jsx)(e.li,{children:"ZIL(ZFS intent log) \u635F\u574F\u4F1A\u5BFC\u81F4\u6570\u636E\u4E22\u5931"}),"\n",(0,l.jsx)(e.li,{children:"L1ARC \u662F\u5B58\u50A8\u4E8E RAM \u7684\u8BFB\u7F13\u5B58,\u4E0D\u5E94\u8BE5\u8D85\u8FC7 7/8 \u603B RAM"}),"\n",(0,l.jsx)(e.li,{children:"L2ARC \u662F\u5B58\u50A8\u4E8E\u78C1\u76D8\u7684\u8BFB\u7F13\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"ZIL \u548C L2ARC \u5B58\u50A8\u4E8E SSD \u4F46\u4E0D\u5E94\u8BE5\u5B58\u50A8\u4E8E\u540C\u4E00\u4E2A SSD"}),"\n",(0,l.jsx)(e.li,{children:"ZIL \u4E3B\u8981\u7528\u4E8E\u540C\u6B65\u5199,\u5927\u591A\u6570\u60C5\u51B5\u4E0B\u4E0D\u9700\u8981"}),"\n",(0,l.jsx)(e.li,{children:"L2ARC \u5927\u591A\u6570\u60C5\u51B5\u4E0B\u4E0D\u4F1A\u63D0\u5347\u592A\u591A\u7684\u6027\u80FD"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0 RAM \u662F\u63D0\u5347\u6027\u80FD\u7684\u6700\u597D\u65B9\u5F0F"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.a,{href:"https://github.com/zfsonlinux/zfs/blob/master/module/zfs/dmu.c",children:"https://github.com/zfsonlinux/zfs/blob/master/module/zfs/dmu.c"}),"\nThis statistic shows ZFS DMU (Data Management Unit) operations/sec.\n",(0,l.jsx)(e.a,{href:"https://docs.oracle.com/cd/E27998_01/html/E48490/analytics__statistics__disk_zfs_dmu_operations.html",children:"https://docs.oracle.com/cd/E27998_01/html/E48490/analytics__statistics__disk_zfs_dmu_operations.html"})]}),"\n",(0,l.jsxs)(e.p,{children:["ARC buffer data (ABD).\n",(0,l.jsx)(e.a,{href:"https://github.com/zfsonlinux/zfs/blob/master/module/zfs/abd.c",children:"https://github.com/zfsonlinux/zfs/blob/master/module/zfs/abd.c"})]}),"\n",(0,l.jsxs)(e.p,{children:["dnode\ndnode is a data structure which represents an object. An object can be a ZPL file or directory, a ZVOL volume, or several other types of internal metadata\n",(0,l.jsx)(e.a,{href:"http://open-zfs.org/wiki/Documentation/DnodeSync",children:"http://open-zfs.org/wiki/Documentation/DnodeSync"})]}),"\n",(0,l.jsx)(e.h2,{id:"\u786C\u4EF6",children:"\u786C\u4EF6"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://open-zfs.org/wiki/Hardware",children:"Hardware"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"tutor",children:"Tutor"}),"\n",(0,l.jsx)(e.h3,{id:"\u51C6\u5907\u5DE5\u4F5C",children:"\u51C6\u5907\u5DE5\u4F5C"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u521B\u5EFA\u5DE5\u4F5C\u533A\u95F4\nmkdir -p ~/temp/zfs && cd $_\n# \u4F7F\u7528\u6587\u4EF6\u4F5C\u4E3A\u5B58\u50A8, \u5B9E\u9645\u4F7F\u7528\u65F6\u5C06\u6587\u4EF6\u66FF\u6362\u4E3A\u8BBE\u5907\u5373\u53EF\nfor i in {1..4};do dd bs=1M count=256 if=/dev/zero of=disk$i; done\ndd bs=1M count=256 if=/dev/zero of=sparedisk\n"})}),"\n",(0,l.jsx)(e.h3,{id:"zpool",children:"zpool"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u521B\u5EFA\u5355\u4E2A\u78C1\u76D8\u7684 Pool, \u6CA1\u6709\u6570\u636E\u5197\u4F59\nzpool create tank $PWD/disk1\nzpool list\n# \u5199\u5165\u6570\u636E, OS X \u7684\u6302\u8F7D\u70B9\u5728 /Volumes/tank, Linux \u4E3A /tank\ndd bs=1M count=64 if=/dev/random of=/tank/foo\n# \u67E5\u770B\u5199\u5165\u540E\u7684\u72B6\u6001\nzpool list tank\n# \u6E05\u9664\nzpool destroy\n\n# \u955C\u50CF Pool\nzpool create tank mirror $PWD/disk1 $PWD/disk2\nzpool status tank\ndd bs=1M count=64 if=/dev/random of=/tank/foo\n# \u4F7F disk1 \u6570\u636E\u635F\u574F\ndd bs=1M seek=10 count=1 conv=notrunc if=/dev/random of=disk1\nzpool scrub tank\nzpool status tank\n# \u53EA\u662F\u6570\u636E\u635F\u574F\u78C1\u76D8\u6CA1\u6709\u5F02\u5E38, \u53EF\u4F7F\u7528 clear \u4FEE\u590D\nzpool clear tank\nzpool status tank\n# \u4F7F disk1 \u78C1\u76D8\u635F\u574F\necho > disk1\nzpool scrub tank\n# \u663E\u793A\u6709\u4E00\u4E2A\u78C1\u76D8\u4E0D\u53EF\u7528\u4F46\u4F9D\u7136\u53EF\u4EE5\u64CD\u4F5C\nzpool status tank\ndd bs=1M count=64 if=/dev/random of=/tank/bar\n# \u66FF\u6362\u635F\u574F\u7684\u78C1\u76D8\nzpool replace tank $PWD/disk1 $PWD/sparedisk\nzpool status\n# \u6269\u5BB9,\u6DFB\u52A0\u65B0\u7684\u78C1\u76D8\nzpool add tank mirror $PWD/disk3 $PWD/disk4\nzpool list\ndd bs=1M count=100 if=/dev/urandom of=/tank/bar\nzpool iostat -v tank\nzpool destroy tank\n"})}),"\n",(0,l.jsx)(e.h3,{id:"zfs-1",children:"zfs"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"zpool create tank mirror $PWD/disk1 $PWD/disk2\nzfs list tank\n# \u521B\u5EFA\u65B0\u7684\u6587\u4EF6\u7CFB\u7EDF\nzfs create tank/joey\nzfs create tank/monica\nzfs create tank/ross\nzfs list -r tank\ndf -h |grep tank\n# \u5220\u9664\u6587\u4EF6\u7CFB\u7EDF\nzfs destroy tank/ross\nzfs create tank/ross\n# \u4FEE\u6539\u6302\u8F7D\u70B9\nzfs set mountpoint=$PWD/monica tank/monica\n# \u5378\u8F7D\u6587\u4EF6\u7CFB\u7EDF\nzfs umount tank/joey\ndf -h |grep tank\n# \u4ECE\u65B0\u6302\u8F7D\nzfs mount tank/joey\n# \u83B7\u53D6\u6240\u6709\u5C5E\u6027\n# SOURCE: '-' \u53EA\u8BFB default \u9ED8\u8BA4\u503C local \u672C\u5730\u4FEE\u6539\u7684\u503C inherited \u7EE7\u627F\u81EA\u7236\u6587\u4EF6\u7CFB\u7EDF\u7684\u503C temporary\nzfs get all tank/joey\nzfs get -Hp -o name,property,value used,available tank/joey\n\n\n# \u9650\u5236\u914D\u989D\nzfs set quota=50m tank/joey\n# \u8BBE\u7F6E\u9884\u7559\nzfs set reservation=25m tank/joey\nzfs get -r quota tank\nzfs get -r reservation tank\n\n# \u542F\u7528\u538B\u7F29\nzfs set compression=lz4 tank/joey\nzfs get -r compression tank\n# \u4F7F\u7528\u8BCD\u5178\u6D4B\u8BD5\u538B\u7F29\n# \u5728 Ubuntu/Debian \u4E0B\u9700\u8981\u5B89\u88C5 wordlist,\u4F8B\u5982 apt-get install wamerican-large\ncp /usr/share/dict/words /tank/ross/\ncp /usr/share/dict/words /tank/joey/\nzfs list -o name,used,compressratio,compression tank/{joey,ross}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"share",children:"share"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u542F\u52A8 nfs\napk add nfs-utils\nservice nfs start\n\n# \u4F1A\u4FEE\u6539 /var/lib/nfs/etab \u914D\u7F6E\u6587\u4EF6\nzfs set sharenfs=on data/share\n# samba\n# zfs set sharesmb=on data/share\n# \u8BBE\u7F6E\u989D\u5916\u9009\u9879\nzfs set sharenfs="rw=@192.168.11.0/24" data/share\n# \u5171\u4EAB\u662F\u6240\u6709\u5B9A\u4E49\u4E86\u5171\u4EAB\u5C5E\u6027\u7684\u5377\nzfs share -a\n# \u542F\u52A8\u65F6\u6267\u884C zfs share -a\nrc-update add zfs-share\n\n# \u67E5\u770B\u6240\u6709\u7684\u5171\u4EAB\u72B6\u6001\nzfs list -o name,sharenfs\n\n# \u53D6\u6D88\u6240\u6709\u5171\u4EAB\nzfs unshare -a\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u7BA1\u7406\u8FD0\u7EF4",children:"\u7BA1\u7406\u8FD0\u7EF4"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"zpool status -x\n# \u8FDB\u884C\u6570\u636E\u6E05\u7406\u64CD\u4F5C\nzpool scrub tank\n# \u67E5\u770B scrub \u72B6\u6001\nzpool status\n# io \u7EDF\u8BA1, \u95F4\u9694 5s\nzpool iostat -v 5\n# \u4ECE pool \u4E2D\u79FB\u9664\u8BBE\u5907, \u53EA\u80FD\u79FB\u9664 \u672A\u4F7F\u7528\u7684\u70ED\u5907, \u7F13\u5B58, \u9876\u5C42\u8BBE\u5907, \u65E5\u5FD7\u8BBE\u5907\nzpool remove main device\n# \u6DFB\u52A0\u9876\u5C42\u8BBE\u5907\nzpool add main raidz dev1 dev2\n# \u6DFB\u52A0\u7F13\u5B58\nzpool add main cache dev\n# -f \u683C\u5F0F\u5316\nsudo zpool add main -f cache /dev/disk/by-id/wwn-0x500000000abcd\n\n# \u67E5\u770B\u538B\u7F29\u4FE1\u606F\n# compressratio, compression, refcompressratio\nzfs get all main/archive | grep com\n# \u67E5\u770B\u538B\u7F29\u540E\u7684\u5927\u5C0F\ndu -h .\n# \u67E5\u770B\u5B9E\u9645\u5927\u5C0F\ndu --apparent-size -h .\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u52A0\u5BC6",children:"\u52A0\u5BC6"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.a,{href:"https://blog.heckel.xyz/2017/01/08/zfs-encryption-openzfs-zfs-on-linux/",children:"https://blog.heckel.xyz/2017/01/08/zfs-encryption-openzfs-zfs-on-linux/"}),"\n",(0,l.jsx)(e.a,{href:"https://www.rolando.cl/blog/2017/06/13/playing-with-zfs-encryption/",children:"https://www.rolando.cl/blog/2017/06/13/playing-with-zfs-encryption/"}),"\n",(0,l.jsx)(e.a,{href:"https://news.ycombinator.com/item?id=14591452",children:"https://news.ycombinator.com/item?id=14591452"})]}),"\n",(0,l.jsx)(e.h2,{id:"\u53C2\u8003",children:"\u53C2\u8003"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://blog.delphix.com/matt/2014/06/06/zfs-stripe-width/",children:"ZFS RAIDZ stripe width, or: How I Learned to Stop Worrying and Love RAIDZ"})}),"\n",(0,l.jsx)(e.li,{children:"[Getting the Most out of ZFS Pools](Getting the Most out of ZFS Pools)"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://constantin.glez.de/blog/2010/06/closer-look-zfs-vdevs-and-performance",children:"A Closer Look at ZFS, Vdevs and Performance"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://wiki.freebsd.org/ZFSTuningGuide",children:"FreeBSD ZFS Tuning Guide"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://docs.oracle.com/cd/E19253-01/819-5461/index.html",children:"ZFS Administration Guide"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://blogs.oracle.com/video/entry/becoming_a_zfs_ninja",children:"Becoming a ZFS Ninja (video)"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://forums.freenas.org/index.php?threads/slideshow-explaining-vdev-zpool-zil-and-l2arc-for-noobs.7775/",children:"Slideshow explaining VDev, zpool, ZIL and L2ARC and other newbie mistakes!"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://www.bsdnow.tv/tutorials/zfs",children:"A Crash Course on ZFS"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.youtube.com/watch?v=uT2i2ryhCio",children:"ZFS: The Last Word in File Systems - Part 1 (video)"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://calomel.org/zfs_raid_speed_capacity.html",children:"ZFS Raidz Performance, Capacity and Integrity"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://louwrentius.com/the-hidden-cost-of-using-zfs-for-your-home-nas.html",children:"The 'Hidden' Cost of Using ZFS for Your Home NAS"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"ssd",children:"SSD"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://linuxhint.com/configuring-zfs-cache/",children:"https://linuxhint.com/configuring-zfs-cache/"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.reddit.com/r/zfs/comments/7bd797/ssd_caching/",children:"https://www.reddit.com/r/zfs/comments/7bd797/ssd_caching/"})}),"\n",(0,l.jsx)(e.li,{children:"SLOG is a write cache. This is the one you'd want to mirror and you'd also want to use an SSD that can finish in flight writes in the case of a power outage"}),"\n",(0,l.jsx)(e.li,{children:"Something with a battery or capacitor"}),"\n"]})]})}function a(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>d});var i=s(7378);let l={},r=i.createContext(l);function t(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);