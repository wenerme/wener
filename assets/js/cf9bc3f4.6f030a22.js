"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["99822"],{45637:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>t,toc:()=>l,default:()=>m,metadata:()=>s,assets:()=>a,contentTitle:()=>c});var s=JSON.parse('{"id":"devops/docker/docker-swarm","title":"Docker Swarm","description":"Tips","source":"@site/../notes/devops/docker/docker-swarm.md","sourceDirName":"devops/docker","slug":"/devops/docker/swarm","permalink":"/notes/devops/docker/swarm","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/docker/docker-swarm.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1602516815000,"frontMatter":{"id":"docker-swarm","title":"Docker Swarm"},"sidebar":"docs","previous":{"title":"Docker \u5B58\u50A8","permalink":"/notes/devops/docker/storage"},"next":{"title":"Docker Version","permalink":"/notes/devops/docker/version"}}'),o=r(86106),i=r(17776);let t={id:"docker-swarm",title:"Docker Swarm"},c="Docker Swarm",a={},l=[{value:"Tips",id:"tips",level:2},{value:"Pitfall",id:"pitfall",level:2},{value:"18.03",id:"1803",level:3},{value:"1.21.1",id:"1211",level:3},{value:"Reference",id:"reference",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"docker-swarm",children:"Docker Swarm"})}),"\n",(0,o.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u4EC0\u4E48\u65F6\u5019\u7528 Docker - \u800C\u4E0D\u662F K8S\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u5F53\u4E00\u53F0\u673A\u5668\u6027\u80FD\u4E0D\u8DB3\u65F6"}),"\n",(0,o.jsx)(n.li,{children:"\u5F53\u8282\u70B9\u5C0F\u4E8E 10 \u65F6"}),"\n",(0,o.jsx)(n.li,{children:"\u5F53\u5BB9\u5668\u6570\u91CF\u5C0F\u4E8E 1000 \u65F6"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u53EF\u5907\u4EFD swarm \u7684\u72B6\u6001,\u4EE5\u4FBF\u4EE5\u540E\u6062\u590D ",(0,o.jsx)(n.code,{children:"/var/lib/docker/swarm/raft"})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u521D\u59CB\u5316 Swarm\ndocker swarm init --advertise-addr <MANAGER-IP>\n# \u52A0\u5165\u8BE5 Swarm \u7684 Wroker \u6267\u884C\u7684\u547D\u4EE4\ndocker swarm join-token worker\n# \u52A0\u5165\u8BE5 Swarm \u7684 manager \u6267\u884C\u7684\u547D\u4EE4\ndocker swarm join-token manager\n# \u67E5\u770B\u8282\u70B9\ndocker node ls\n# \u63D0\u5347\u8282\u70B9\u4E3A\u4E3B\u8282\u70B9\ndocker node promote node-3\n# \u79BB\u5F00 Swarm\ndocker swarm leave\n# \u79FB\u9664\u8282\u70B9\ndocker node rm node-2\n# \u521B\u5EFA\u7F51\u7EDC\ndocker network create --driver overlay my-network\n# \u4F7F\u670D\u52A1\u8FD0\u884C\u5728\u7F51\u7EDC\u4E2D\ndocker service create --replicas 3 --network my-network --name my-web nginx\n# \u542F\u52A8\u4E00\u4E2A busybox \u7528\u4E8E\u6D4B\u8BD5\u7F51\u7EDC\ndocker service create --name my-busybox --network my-network busybox sleep 3000\n# \u5728\u6267\u884C my-busybox \u7684\u8282\u70B9\u4E0A\u53EF\u901A\u8FC7 docker exec -it my-busybox.1.1dok2cmx2mln5hbqve8ilnair sh \u8FDB\u5165\u4EA4\u4E92\n# \u67E5\u770B my-web \u8FD9\u4E2A\u670D\u52A1\u7684 vip\n# nslookup my-web\n# \u67E5\u770B my-web \u540E\u6240\u6709 container \u7684\u4FE1\u606F\n# nslookup tasks.my-web\n# \u53EF\u6D4B\u8BD5\u670D\u52A1\u662F\u5426\u6B63\u5E38\n# wget -O- 10.0.0.5\n\n\n# \u6DFB\u52A0 Label\ndocker node update --label-add TYPE=main myhost\n# \u67E5\u770B\u6240\u6709\u7684 Label\ndocker node inspect hd2-1 --format '{{range $k,$v:=.Spec.Labels}}{{$k}}={{$v}}{{\"\\n\"}}{{end}}'\n# \u5728\u6307\u5B9A\u7684\u8282\u70B9\u4E0A\u6267\u884C\ndocker service create --name tool --replicas=1 --container-label TYPE=main --network=pwork --mount type=bind,src=/data,dst=/data ubuntu bash\n"})}),"\n",(0,o.jsx)(n.h2,{id:"pitfall",children:"Pitfall"}),"\n",(0,o.jsx)(n.h3,{id:"1803",children:"18.03"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u5173\u4E8E Swarm Network \u7684\u95EE\u9898\u4E5F\u8FD8\u6709\u975E\u5E38\u591A"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/moby/moby/issues?q=is%3Aopen+is%3Aissue+label%3Aarea%2Fswarm+label%3Aarea%2Fnetworking",children:"https://github.com/moby/moby/issues?q=is%3Aopen+is%3Aissue+label%3Aarea%2Fswarm+label%3Aarea%2Fnetworking"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"1211",children:"1.21.1"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u8DE8\u4E3B\u673A\u7684 Overlay \u4F9D\u7136\u6709\u95EE\u9898"}),"\n",(0,o.jsx)(n.li,{children:"Label \u7ECF\u5E38\u4E0D\u751F\u6548"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/docker/docker/issues/25325",children:"#25325 Docker 1.12 swarm mode load balancing not consistently working"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"http://blog.bugsnag.com/container-orchestration-with-docker-swarm-mode",children:"Lessons learned from using Docker Swarm mode in production"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=12508711",children:"HN"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u5B66\u4E60\u8D44\u6E90\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/yeasy/docker_practice/",children:"https://github.com/yeasy/docker_practice/"})}),"\n"]}),"\n"]}),"\n"]})]})}function m(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},17776:function(e,n,r){r.d(n,{R:()=>t,x:()=>c});var s=r(7378);let o={},i=s.createContext(o);function t(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);