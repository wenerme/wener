"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["662722"],{132994:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>t,toc:()=>d,default:()=>o,metadata:()=>s,assets:()=>a,contentTitle:()=>c});var s=JSON.parse('{"id":"service/auth/authz/casl","title":"CASL","description":"- stalniy/casl","source":"@site/../notes/service/auth/authz/casl.md","sourceDirName":"service/auth/authz","slug":"/service/auth/authz/casl","permalink":"/notes/service/auth/authz/casl","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/auth/authz/casl.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1761527855000,"frontMatter":{"title":"CASL"},"sidebar":"docs","previous":{"title":"Casbin","permalink":"/notes/service/auth/authz/casbin"},"next":{"title":"permify","permalink":"/notes/service/auth/authz/permify"}}'),l=i(486106),r=i(917776);let t={title:"CASL"},c="CASL",a={},d=[{value:"Notes",id:"notes",level:2},{value:"ucast",id:"ucast",level:2},{value:"view page",id:"view-page",level:2}];function h(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"casl",children:"CASL"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/stalniy/casl",children:"stalniy/casl"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"MIT, TS, JS"}),"\n",(0,l.jsx)(e.li,{children:"core 6KB"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["CASL - CanCanAble Simple Language\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AuthZ"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0 ABAC\u3001RBAC"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Ruby CanCan, RoR CanCanCan"}),"\n",(0,l.jsxs)(e.li,{children:["\u6838\u5FC3\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Ability"}),"\n",(0,l.jsxs)(e.li,{children:["Action\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F8B\u5982 read, create, update, delete, manage"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Subject\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F8B\u5982 Post"}),"\n",(0,l.jsx)(e.li,{children:"all \u8868\u793A\u6240\u6709"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"Rule"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["vs Casbin\u3001OPA\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u66F4\u7B80\u5355\uFF0C\u66F4\u6613\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u524D\u7AEF"}),"\n",(0,l.jsx)(e.li,{children:"\u9762\u5411 Web"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm add @casl/react @casl/ability\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E8F\u5217\u5316"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:'interface Rule {\n  pricipal: string; // e.g. user id\n  action: string; // read\n  subject: string; // Post\n  conditions: any; // {"published": true}\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RBAC"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"function defineAbilitiesFor(role) {\n  const { can, build } = new AbilityBuilder(Ability);\n\n  if (role === 'user') {\n    can('read', 'Article');\n    can('create', 'Article');\n  } else if (role === 'admin') {\n    can(['read', 'create', 'update', 'delete'], 'Article');\n  }\n\n  return build();\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"can('read', 'Address', { 'country.isoCode': 'UA' });\ncan('read', 'Post', 'author.*');\ncan('read', 'Post', 'vehicle.*.generic.*');\n\n// \u652F\u6301\u81EA\u5B9A\u4E49 any/all\n// \u9ED8\u8BA4 manage \u548C all\nconst ability = new Ability([{ action: '*', subject: '*' }], {\n  anyAction: '*',\n  anySubjectType: '*',\n});\n\ncan('*', 'Post');\ncan('*', '*');\n"})}),"\n",(0,l.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E3B\u8BED (S) + \u8C13\u8BED (V) + \u5BBE\u8BED (O)"}),"\n",(0,l.jsxs)(e.li,{children:["User (S) + reads (V) + Order (O)\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"can(\u8C13\u8BED, \u5BBE\u8BED)"})}),"\n",(0,l.jsx)(e.li,{children:"action, subject, fields, conditions"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Builder\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"can, cannot -> rules -> build -> createAbility -> Ability"}),"\n",(0,l.jsxs)(e.li,{children:["createAbility -> createMongoAbility\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"mongoQueryMatcher - @ucast/mongo2js"}),"\n",(0,l.jsx)(e.li,{children:"fieldPatternMatcher"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["can, cannot\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"(action: string, subject?: Subject, field?: string)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"interface BaseRawRule<Conditions> {\n  fields?: string | string[];\n  conditions?: Conditions;\n  /** indicates that rule forbids something (i.e., has inverted logic) */\n  inverted?: boolean;\n  /** explains the reason of why rule does not allow to do something */\n  reason?: string;\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"ucast",children:"ucast"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/stalniy/ucast",children:"stalniy/ucast"})}),"\n",(0,l.jsx)(e.li,{children:"@ucast/core"}),"\n",(0,l.jsxs)(e.li,{children:["@ucast/js\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u89E3\u91CA\u5668"}),"\n",(0,l.jsx)(e.li,{children:"eq, ne"}),"\n",(0,l.jsx)(e.li,{children:"lt, lte"}),"\n",(0,l.jsx)(e.li,{children:"gt, gte"}),"\n",(0,l.jsx)(e.li,{children:"within, nin"}),"\n",(0,l.jsx)(e.li,{children:"all"}),"\n",(0,l.jsx)(e.li,{children:"regex"}),"\n",(0,l.jsx)(e.li,{children:"or, nor, and, not"}),"\n",(0,l.jsx)(e.li,{children:"exists"}),"\n",(0,l.jsx)(e.li,{children:"size"}),"\n",(0,l.jsx)(e.li,{children:"mod"}),"\n",(0,l.jsx)(e.li,{children:"where,"}),"\n",(0,l.jsx)(e.li,{children:"elemMatch"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://docs.mongodb.org/manual/reference/operator/query/",children:"http://docs.mongodb.org/manual/reference/operator/query/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(e.h2,{id:"view-page",children:"view page"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"// Route-as-Subject\ncan('view', '/xyz')\n// Entity-as-Subject\ncan('view', 'Page', { path: '/xyz' })\n"})})]})}function o(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}},917776:function(n,e,i){i.d(e,{R:()=>t,x:()=>c});var s=i(7378);let l={},r=s.createContext(l);function t(n){let e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);