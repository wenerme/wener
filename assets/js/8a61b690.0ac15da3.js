"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["8491"],{28722:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>r,toc:()=>o,default:()=>h,metadata:()=>s,assets:()=>c,contentTitle:()=>d});var s=JSON.parse('{"id":"devops/kubernetes/platform/istio","title":"Istio \u670D\u52A1\u7F51\u683C","description":"- istio/istio","source":"@site/../notes/devops/kubernetes/platform/istio.md","sourceDirName":"devops/kubernetes/platform","slug":"/devops/kubernetes/platform/istio","permalink":"/notes/devops/kubernetes/platform/istio","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/platform/istio.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1637477347000,"frontMatter":{"id":"istio","title":"Istio \u670D\u52A1\u7F51\u683C"},"sidebar":"docs","previous":{"title":"Istio Version","permalink":"/notes/devops/kubernetes/platform/istio-version"},"next":{"title":"KEDA","permalink":"/notes/devops/kubernetes/platform/keda"}}'),l=i(86106),t=i(17776);let r={id:"istio",title:"Istio \u670D\u52A1\u7F51\u683C"},d="Istio",c={},o=[{value:"\u5E38\u7528\u914D\u7F6E\u9879",id:"\u5E38\u7528\u914D\u7F6E\u9879",level:2},{value:"\u5B89\u88C5",id:"\u5B89\u88C5",level:2},{value:"\u81EA\u5B9A\u4E49\u5B89\u88C5",id:"\u81EA\u5B9A\u4E49\u5B89\u88C5",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"istio",children:"Istio"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/istio/istio",children:"istio/istio"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"connect, manage, and secure microservices by Google, IBM, and Lyft"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6CE8\u610F\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["ingressgateway \u9ED8\u8BA4\u9700\u8981 LoadBalaner - \u56E0\u6B64\u9700\u8981\u96C6\u7FA4\u80FD\u83B7\u53D6\u5230 IP - \u5728\u4E0D\u66F4\u6539\u914D\u7F6E\u7684\u524D\u63D0\u4E0B\u53EF\u4EE5\u4F7F\u7528 ",(0,l.jsx)(n.a,{href:"../network/metallb",children:"metallb"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67B6\u6784\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6570\u636E\u5C42\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63A7\u5236\u670D\u52A1\u4E4B\u95F4\u7684\u7F51\u7EDC\u901A\u4FE1"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u63A7\u5236\u5C42\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7BA1\u7406\u914D\u7F6E\u8DEF\u7531"}),"\n",(0,l.jsx)(n.li,{children:"\u914D\u7F6E\u7B56\u7565\u548C\u91C7\u96C6"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7EC4\u4EF6\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Envoy \u4EE3\u7406/Sidecar\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u52A8\u6001\u670D\u52A1\u53D1\u73B0"}),"\n",(0,l.jsx)(n.li,{children:"\u8D1F\u8F7D\u5747\u8861"}),"\n",(0,l.jsx)(n.li,{children:"TLS \u7EC8\u6B62"}),"\n",(0,l.jsx)(n.li,{children:"HTTP/2 gRPC \u4EE3\u7406"}),"\n",(0,l.jsx)(n.li,{children:"\u7194\u65AD"}),"\n",(0,l.jsx)(n.li,{children:"\u5065\u5EB7\u68C0\u67E5"}),"\n",(0,l.jsx)(n.li,{children:"\u9636\u6BB5\u53D1\u5E03 - \u767E\u5206\u6BD4\u6D41\u91CF\u5207\u5206"}),"\n",(0,l.jsx)(n.li,{children:"\u9519\u8BEF\u6CE8\u5165"}),"\n",(0,l.jsx)(n.li,{children:"\u6307\u6807\u76D1\u63A7"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Mixer - \u7B56\u7565\u548C\u8FDC\u7A0B\u63A7\u5236"}),"\n",(0,l.jsxs)(n.li,{children:["Pilot - \u914D\u5408 Envoy \u5DE5\u4F5C\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u670D\u52A1\u53D1\u73B0"}),"\n",(0,l.jsx)(n.li,{children:"\u6D41\u91CF\u7BA1\u7406 - A/B \u6D4B\u8BD5\u3001\u7070\u5EA6\u53D1\u5E03"}),"\n",(0,l.jsx)(n.li,{children:"\u5F39\u6027 - \u8D85\u65F6\u63A7\u5236\u3001\u91CD\u8BD5\u3001\u7194\u65AD"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Citadel\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u670D\u52A1\u5230\u670D\u52A1\u3001\u670D\u52A1\u5230\u7528\u6237 \u9274\u6743"}),"\n",(0,l.jsx)(n.li,{children:"\u53EF\u5C06\u7F51\u683C\u670D\u52A1\u5185\u7684\u672A\u52A0\u5BC6\u901A\u4FE1\u5347\u7EA7\u4E3A\u52A0\u5BC6\u901A\u4FE1"}),"\n",(0,l.jsx)(n.li,{children:"\u63A7\u5236\u8C01\u80FD\u8BBF\u95EE\u4EC0\u4E48 - \u800C\u4E0D\u662F\u7B80\u5355\u7684\u4F9D\u8D56\u5E95\u5C42\u7684 IP \u9650\u5236"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Galley\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u914D\u7F6E\u6821\u9A8C\u3001\u8BFB\u53D6\u3001\u5904\u7406\u5206\u53D1"}),"\n",(0,l.jsx)(n.li,{children:"\u5C06\u5E95\u5C42\u7CFB\u7EDF\u7684\u914D\u7F6E(\u4F8B\u5982 k8s)\u5E94\u7528\u5230 istio \u4F53\u7CFB\u4E2D"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8BBE\u8BA1\u76EE\u6807\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6700\u5927\u7684\u900F\u660E\u6027"}),"\n",(0,l.jsx)(n.li,{children:"\u6269\u5C55\u6027"}),"\n",(0,l.jsx)(n.li,{children:"\u4FBF\u643A\u6027 - \u964D\u4F4E\u5BF9\u5E95\u5C42\u7684\u611F\u77E5\u3001\u8FD0\u884C\u5728\u4EFB\u4F55\u4E91\u4E0A"}),"\n",(0,l.jsx)(n.li,{children:"\u7EDF\u4E00\u7684\u7B56\u7565\u63A7\u5236"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7EC4\u4EF6\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"base"}),"\n",(0,l.jsx)(n.li,{children:"pilot"}),"\n",(0,l.jsx)(n.li,{children:"proxy"}),"\n",(0,l.jsx)(n.li,{children:"telemetry"}),"\n",(0,l.jsx)(n.li,{children:"policy"}),"\n",(0,l.jsx)(n.li,{children:"ingressGateways"}),"\n",(0,l.jsx)(n.li,{children:"egressGateways"}),"\n",(0,l.jsx)(n.li,{children:"cni"}),"\n",(0,l.jsxs)(n.li,{children:["istiod\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u670D\u52A1\u53D1\u73B0"}),"\n",(0,l.jsx)(n.li,{children:"\u914D\u7F6E\u7BA1\u7406"}),"\n",(0,l.jsx)(n.li,{children:"\u8BC1\u4E66\u7BA1\u7406"}),"\n",(0,l.jsx)(n.li,{children:"pilot citadel galley"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://istio.io/latest/docs/ops/deployment/architecture/",children:"\u67B6\u6784"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://istio.io/latest/docs/ops/deployment/performance-and-scalability/",children:"Performance and Scalability"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["envoy\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"0.35 vCPU, 40 MB / 1000 rps"}),"\n",(0,l.jsx)(n.li,{children:"+2.65 ms 90% latency"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"istio-telemetry - 0.6 vCPU / 1000 mesh-wide requests / second for deployments that use Mixer."}),"\n",(0,l.jsx)(n.li,{children:"pilot - 1 vCPU, 1.5 GB"}),"\n",(0,l.jsx)(n.li,{children:"istiod - 1 vCPU, 1.5 GB - 1000 services, 2000 sidecars"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8D44\u6E90\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u81F3\u5C11\u51C6\u5907 4 CPU 8G"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://engineering.hellofresh.com/ff4c26844bfb",children:"Everything We Learned Running Istio In Production \u2014 Part 2"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.giantswarm.io/guides/deploying-istio/",children:"How to deploy Istio in your Cluster"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5E38\u7528\u914D\u7F6E\u9879",children:"\u5E38\u7528\u914D\u7F6E\u9879"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u914D\u7F6E"}),(0,l.jsx)(n.th,{children:"\u503C"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"values.global.mtls.enabled"}),(0,l.jsx)(n.td,{children:"mTLS - \u4E0D\u5EFA\u8BAE\u5F00\u542F"})]})})]}),"\n",(0,l.jsx)(n.h2,{id:"\u5B89\u88C5",children:"\u5B89\u88C5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u914D\u7F6E\u5217\u8868\n# demo empty minimal preview remote default\n# https://istio.io/latest/docs/setup/additional-setup/config-profiles/\nistioctl profile list\n\n# \u67E5\u770B\u914D\u7F6E\u7684\u5185\u5BB9\n# \u6240\u6709\u7684\u9009\u9879\u53EF\u4EE5\u5728 apply \u7684\u65F6\u5019\u4F7F\u7528 set \u4FEE\u6539\nistioctl profile dump demo\n# \u67E5\u770B\u67D0\u9879\u914D\u7F6E\nistioctl profile dump --config-path trafficManagement.components.pilot demo\n\n# \u5B89\u88C5 demo \u914D\u7F6E\n# \u53EF\u9009 default	demo	minimal	sds	remote\n# https://istio.io/docs/setup/additional-setup/config-profiles/\nistioctl manifest apply --set profile=demo\n\n# \u67E5\u770B\u5B89\u88C5\u7684\u670D\u52A1\nkubectl get svc -n istio-system\n\n# \u4E3A\u7A7A\u95F4\u5F00\u542F\u6CE8\u5165\nkubectl label namespace default istio-injection=enabled\n# \u6216\u8005\u5728\u521B\u5EFA\u5E94\u7528\u7684\u65F6\u5019\u914D\u7F6E\u6CE8\u5165\nkubectl create -n <namespace> -f <app-spec>.yaml\n\n# \u624B\u52A8\u6CE8\u5165\nistioctl kube-inject -f <app-spec>.yaml | kubectl apply -f -\n\n# \u5378\u8F7D\nistioctl manifest generate --set profile=demo | kubectl delete -f -\n# \u5220\u9664\u7A7A\u95F4\nkubectl delete namespace istio-system\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u81EA\u5B9A\u4E49\u5B89\u88C5",children:"\u81EA\u5B9A\u4E49\u5B89\u88C5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u53EF\u4EE5\u751F\u6210 Manifest \u7136\u540E kubectk \u5B89\u88C5 - \u4E5F\u53EF\u4EE5\u770B\u5230\u505A\u4E86\u4EC0\u4E48\nistioctl manifest generate\n\nistioctl manifest generate > istio-manifest.yaml\n# \u53EF\u4EE5\u9A8C\u8BC1\u914D\u7F6E\nistioctl verify-install -f istio-manifest.yaml\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},17776:function(e,n,i){i.d(n,{R:()=>r,x:()=>d});var s=i(7378);let l={},t=s.createContext(l);function r(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);