"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["83384"],{57362:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>c,toc:()=>h,default:()=>o,metadata:()=>l,assets:()=>t,contentTitle:()=>d});var l=JSON.parse('{"id":"service/workflow/cadence","title":"Cadence","description":"- uber/cadence \u662F\u4EC0\u4E48\uFF1F","source":"@site/../notes/service/workflow/cadence.md","sourceDirName":"service/workflow","slug":"/service/workflow/cadence","permalink":"/notes/service/workflow/cadence","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/workflow/cadence.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1714210316000,"frontMatter":{"title":"Cadence"},"sidebar":"docs","previous":{"title":"BullMQ","permalink":"/notes/service/workflow/bullmq"},"next":{"title":"conductor","permalink":"/notes/service/workflow/conductor"}}'),s=i(86106),r=i(17776);let c={title:"Cadence"},d="Cadence",t={},h=[{value:"\u5FEB\u901F\u5F00\u59CB",id:"\u5FEB\u901F\u5F00\u59CB",level:2},{value:"Golang",id:"golang",level:2},{value:"Java",id:"java",level:2},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF",level:2},{value:"Domain",id:"domain",level:2},{value:"Activity",id:"activity",level:2},{value:"\u5B9E\u73B0",id:"\u5B9E\u73B0",level:3},{value:"Workflow",id:"workflow",level:2},{value:"\u5B9E\u73B0",id:"\u5B9E\u73B0-1",level:3},{value:"\u6CE8\u610F",id:"\u6CE8\u610F",level:3},{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:2},{value:"\u5B58\u50A8\u7ED3\u6784",id:"\u5B58\u50A8\u7ED3\u6784",level:2},{value:"schema",id:"schema",level:2},{value:"Helm",id:"helm",level:2},{value:"Cannot register global domain when not enabled",id:"cannot-register-global-domain-when-not-enabled",level:2},{value:"Persistence Max QPS Reached",id:"persistence-max-qps-reached",level:2},{value:"Persistence Max QPS Reached for List Operations",id:"persistence-max-qps-reached-for-list-operations",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"cadence",children:"Cadence"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence",children:"uber/cadence"})," \u662F\u4EC0\u4E48\uFF1F\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MIT, Golang"}),"\n",(0,s.jsx)(e.li,{children:"\u5206\u5E03\u5F0F\uFF0C\u5927\u89C4\u6A21\uFF0C\u6301\u4E45\u5316\uFF0C\u9AD8\u53EF\u7528\u7684\u5F02\u6784\u8C03\u5EA6\u5F15\u64CE"}),"\n",(0,s.jsx)(e.li,{children:"\u7528\u4E8E\u5F02\u6B65\u957F\u65F6\u95F4\u8FD0\u884C\u7684\u4E1A\u52A1\u903B\u8F91"}),"\n",(0,s.jsx)(e.li,{children:"Fault Tolerant Actor Framework"}),"\n",(0,s.jsx)(e.li,{children:"fault-oblivious stateful workflow"}),"\n",(0,s.jsx)(e.li,{children:"\u63D0\u4F9B Java SDK\u3001Go SDK"}),"\n",(0,s.jsx)(e.li,{children:"Cadence \u66F4\u50CF\u662F\u4E00\u4E2A\u6267\u884C\u5E73\u53F0 - \u4F8B\u5982 BNMP\u3001Airflow DAG \u53EF\u4EE5\u5728\u5176\u4E4B\u4E0A\u8FD0\u884C"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview",children:"durable function"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4F7F\u7528\u573A\u666F\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5468\u671F\u6267\u884C / \u5206\u5E03\u5F0F CRON"}),"\n",(0,s.jsx)(e.li,{children:"\u5FAE\u670D\u52A1\u7F16\u6392"}),"\n",(0,s.jsx)(e.li,{children:"Polling - \u4F8B\u5982 \u6587\u4EF6\u4E0A\u4F20\u4E0B\u8F7D\u3001\u7F51\u7EDC\u670D\u52A1\u5065\u5EB7\u3001\u7B49\u5F85\u5916\u90E8\u670D\u52A1\u751F\u6548"}),"\n",(0,s.jsx)(e.li,{children:"\u4E8B\u4EF6\u9A71\u52A8\u7F16\u7A0B"}),"\n",(0,s.jsx)(e.li,{children:"\u5B58\u50A8\u626B\u63CF - \u4F8B\u5982 \u89C4\u6574 OSS \u4E2D\u6587\u4EF6\u5143\u6570\u636E"}),"\n",(0,s.jsx)(e.li,{children:"\u6279\u5904\u7406 - \u4F8B\u5982 \u62A5\u8868"}),"\n",(0,s.jsx)(e.li,{children:"\u57FA\u7840\u8BBE\u65BD\u5F00\u901A / Infrastructure provisioning - \u4F8B\u5982 \u5F00\u901A\u963F\u91CC\u4E91 ECS"}),"\n",(0,s.jsx)(e.li,{children:"CI/CD \u548C \u90E8\u7F72"}),"\n",(0,s.jsx)(e.li,{children:"\u8FD0\u7EF4\u7BA1\u7406 - \u4F8B\u5982 DB \u7EF4\u62A4\u3001\u5F00\u901A\u8D26\u53F7"}),"\n",(0,s.jsx)(e.li,{children:"\u4EA4\u4E92\u5E94\u7528 - \u4F8B\u5982 \u5728\u7528\u6237\u4E0B\u5355\u7684\u540C\u65F6\u540E\u53F0\u8FDB\u884C\u6B3A\u8BC8\u68C0\u6D4B"}),"\n",(0,s.jsx)(e.li,{children:"DSL \u5DE5\u4F5C\u6D41 - BPMN, Apache Airflow, AWS Step Functions"}),"\n",(0,s.jsx)(e.li,{children:"\u5927\u6570\u636E \u548C \u673A\u5668\u5B66\u4E60"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u7EC4\u4EF6\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8BF7\u6C42\u5904\u7406\uFF1A Microservices\u3001Serverless\u3001Actors"}),"\n",(0,s.jsxs)(e.li,{children:["\u5B58\u50A8\uFF1A \u6570\u636E\u3001\u7F13\u5B58\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Cassandra / MySQL / Postgres"}),"\n",(0,s.jsx)(e.li,{children:"metric - Prometheus - \u53EF\u9009"}),"\n",(0,s.jsxs)(e.li,{children:["ElastiCache+Kafka - \u652F\u6301\u9AD8\u7EA7\u641C\u7D22\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4F8B\u5982 scanWorkflowExecutions"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"S3 - archival"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"Queues"}),"\n",(0,s.jsx)(e.li,{children:"Job Schedulers"}),"\n",(0,s.jsx)(e.li,{children:"Consensus\uFF1A Leader Election\u3001Sharding\u3001Distributed Locks"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u9AD8\u7EA7\u7279\u6027\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9AD8\u7EA7\u53EF\u89C6\u5316"}),"\n",(0,s.jsx)(e.li,{children:"\u5DE5\u4F5C\u6D41\u5F52\u6863"}),"\n",(0,s.jsx)(e.li,{children:"\u8DE8\u6570\u636E\u4E2D\u5FC3\u590D\u5236"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/temporalio/temporal",children:"temporalio/temporal"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"cadence fork, \u5F00\u53D1\u8005\u7684\u521B\u4E1A\u9879\u76EE"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence-web",children:"uber/cadence-web"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u67E5\u770B\u8FD0\u884C\u7684\u6D41\u7A0B"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/uber-go/cadence-client",children:"uber-go/cadence-client"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Go \u5BA2\u6237\u7AEF"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence-idl",children:"uber/cadence-idl"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"proto,thrift"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence-idl/tree/master/proto/uber/cadence/api/v1",children:"uber/cadence/api/v1"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/yarpc/yarpc-go",children:"yarpc/yarpc-go"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"RPC - JSON, Thrift, and Protobuf"}),"\n",(0,s.jsx)(e.li,{children:"HTTP/1.1, gRPC, and TChannel"}),"\n",(0,s.jsx)(e.li,{children:"cadence \u6B63\u5728\u4ECE thrift \u8FC1\u79FB\u4E3A grpc"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["helm banzai-charts ",(0,s.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/tree/master/cadence",children:"cadence"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["go thrift \u7248\u672C\u51B2\u7A81 ",(0,s.jsx)(e.a,{href:"https://github.com/uber-go/cadence-client/issues/1107",children:"#1107"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7528\u7684\u5F88\u8001\u7684\u7248\u672C 0.9.3, 2016 \u5E74 - cadence \u6B63\u5728\u8FC1\u79FB\u4E3A grpc"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u914D\u7F6E\u4E00\u5B9A ",(0,s.jsx)(e.strong,{children:"\u4E0D\u8981\u4FEE\u6539"})," numOfShards - \u53EA\u6709\u8FC1\u79FB\u5230\u65B0\u96C6\u7FA4"]}),"\n"]})}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5355\u4E2A Workflow \u9650\u5236\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"50k \u4E8B\u4EF6\u4F1A\u544A\u8B66"}),"\n",(0,s.jsx)(e.li,{children:"200k \u4E8B\u4EF6\u4F1A\u88AB\u76F4\u63A5\u7EC8\u6B62"}),"\n",(0,s.jsx)(e.li,{children:"\u6700\u591A\u6267\u884C 100k \u6D3B\u52A8"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u63A8\u8350\u63A7\u5236\u5728 \u51E0\u5343 signal - \u901A\u8FC7 ContinueAsNew \u907F\u514D\u5355\u4E2A workflow \u81A8\u80C0"}),"\n"]})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"port"}),(0,s.jsx)(e.th,{children:"proto"}),(0,s.jsx)(e.th,{children:"service"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7833"}),(0,s.jsx)(e.td,{children:"grpc"}),(0,s.jsx)(e.td,{children:"frontend"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7933"}),(0,s.jsx)(e.td,{children:"Thrift TChannel"}),(0,s.jsx)(e.td,{children:"frontend"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7834"}),(0,s.jsx)(e.td,{children:"grpc"}),(0,s.jsx)(e.td,{children:"history"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7934"}),(0,s.jsx)(e.td,{children:"Thrift TChannel"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7835"}),(0,s.jsx)(e.td,{children:"grpc"}),(0,s.jsx)(e.td,{children:"matching"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7935"}),(0,s.jsx)(e.td,{children:"Thrift TChannel"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7939"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"worker"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"9090"}),(0,s.jsx)(e.td,{children:"http/metrics"}),(0,s.jsx)(e.td,{})]})]})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# macOS\nbrew install cadence-workflow\n# Docker\ndocker run --rm ubercadence/cli:master\n\n# CADENCE_CLI_ADDRESS --address\n# CADENCE_CLI_DOMAIN --domain\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5FEB\u901F\u5F00\u59CB",children:"\u5FEB\u901F\u5F00\u59CB"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u4F7F\u7528 postgres\ncurl -o docker-compose.yml https://raw.githubusercontent.com/uber/cadence/master/docker/docker-compose-postgres.yml\ncurl -O https://raw.githubusercontent.com/uber/cadence/master/docker/prometheus_config.yml\n# UI http://localhost:8088\n# Grafana http://localhost:3000\n# postgres :5432,prometheus :9090,grafana :3000,cadence 8000-8003,7933-3935,7939,cadence-web :8088\ndocker-compose up\n\n# \u6CE8\u518C domain\n# --address=host.docker.internal:7932\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain register -rd 1 --global_domain=false\n# domian \u4FE1\u606F\ndocker run --network=host --rm ubercadence/cli:master --do test-domain domain describe\n"})}),"\n",(0,s.jsx)(e.h2,{id:"golang",children:"Golang"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber-common/cadence-samples/blob/master/cmd/samples/recipes/helloworld/main.go",children:"helloworld/main.go"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"java",children:"Java"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u6D41\u7A0B\u63A5\u53E3\npublic interface TransferWorkflow {\n  @WorkflowMethod(executionStartToCloseTimeoutSeconds = WEEK_SECOND)\n  void execute(String fromAccountId, String toAccountId, Money amount);\n\n  @SignalMethod // \u4FE1\u53F7\u65B9\u6CD5\n  void doCount(int n);\n  @QueryMethod // \u67E5\u8BE2\u65B9\u6CD5\n  int void getCount();\n}\n// \u4E8B\u4EF6\u63A5\u53E3\npublic interface Account {\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void debit(String fromAccountId, Money amount);\n  @ActivityMethod(scheduleToCloseTimeoutSeconds = 300)\n  void credit(String toAccountId, Money amount);\n}\npublic interface TransferWorkflowImpl implements TransferWorkflow {\n  // \u652F\u6301\u914D\u7F6E\u81EA\u52A8\u91CD\u8BD5\n  private final Account account = Workflow.newActivityStub(Account.class);\n  @Override\n  public void execute(String fromAccountId, String toAccountId, Money amount){\n    // \u89E6\u53D1\u4E8B\u4EF6 - \u963B\u585E\u8BE5\u6D41\u7A0B\n    // \u4E8B\u4EF6\u53EF\u80FD\u6267\u884C\u975E\u5E38\u4E45 - \u4F8B\u5982\u51E0\u5929\n    account.debit(fromAccountId,amount);\n    try {\n      account.credit(toAccountId,amount);\n    } catch (IllegalArgumentException e){\n      // \u4E1A\u52A1\u8865\u507F\u903B\u8F91\n      account.credit(fromAccountId,amount);\n    }\n\n    // \u53EF\u624B\u52A8\u963B\u585E\n    Workflow.sleep(Duration.ofDays(7));\n  }\n\n  // \u672C\u5730\u72B6\u6001 - \u6301\u4E45\u5316\u7684\n  private int counter;\n  @Override\n  public void doCount(int n){\n    counter += n;\n  }\n  @QueryMethod\n  public int void getCount(){\n    return counter;\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u670D\u52A1\u7AEF",children:"\u670D\u52A1\u7AEF"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["SERVICES - \u8FD0\u884C\u7684\u670D\u52A1\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"frontend, history, matching, worker"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"CADENCE_STORE_PASSWORD"}),"\n",(0,s.jsx)(e.li,{children:"CADENCE_VISIBILITY_STORE_PASSWORD"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml",children:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-configmap.yaml"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"env"}),(0,s.jsx)(e.th,{children:"desc"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_PLUGIN"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_HOST"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_PORT"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_DATABASE"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_USER"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_PASSWORD"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SQL_CONNECT_ATTRIBUTES"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CASSANDRA_HOST"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CASSANDRA_DB_PORT"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CASSANDRA_KEYSPACE"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CASSANDRA_USER"}),(0,s.jsx)(e.td,{})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CASSANDRA_PASSWORD"}),(0,s.jsx)(e.td,{})]})]})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"curl -LO https://raw.githubusercontent.com/uber/cadence/master/docker/config_template.yaml\ndocker run --rm -it \\\n  -v $PWD/config_template.yaml:/etc/cadence/config/config_template.yaml \\\n  -e DB=postgres -e POSTGRES_SEEDS=127.0.0.1 -e POSTGRES_USER=cadence -e POSTGRES_PWD=cadence \\\n  --name cadence ubercadence/server\n"})}),"\n",(0,s.jsx)(e.h1,{id:"concept",children:"\u6982\u5FF5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Domain - \u57DF\u5212\u5206 - \u591A\u79DF\u6237\u7684\u79DF\u6237\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4F5C\u4E3A TaskList \u548C Workflow \u7684\u547D\u540D\u7A7A\u95F4"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301 SecurityToken"}),"\n",(0,s.jsx)(e.li,{children:"\u914D\u7F6E\u6570\u636E\u7559\u5B58\u65F6\u95F4"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["TaskList\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4EFB\u52A1\u5217\u8868\u3001\u5E94\u7528\u5206\u7EC4"}),"\n",(0,s.jsx)(e.li,{children:"\u542F\u52A8\u7684 worker \u4F1A pull \u7ED9\u5B9A\u7684 TaskList"}),"\n",(0,s.jsx)(e.li,{children:"\u610F\u5473\u7740\u5FC5\u987B\u8981\u5148\u786E\u5B9A TaskList \u7684\u540D\u5B57"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Worker\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5B88\u62A4\u8FDB\u7A0B"}),"\n",(0,s.jsxs)(e.li,{children:["\u672C\u5730\u6CE8\u518C Workflow\u3001Activity\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9ED8\u8BA4\u4F7F\u7528 \u51FD\u6570\u540D \u4F5C\u4E3A\u540D\u5B57"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u79D2\u7EA7 \u65F6\u95F4\u7CBE\u786E\u5EA6"}),"\n",(0,s.jsx)(e.li,{children:"WorkflowWorker"}),"\n",(0,s.jsx)(e.li,{children:"ActivityWorker"}),"\n",(0,s.jsx)(e.li,{children:"SessionWorker"}),"\n",(0,s.jsx)(e.li,{children:"ShadowWorker"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Workflow - \u903B\u8F91\u6D41\u7A0B\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u786E\u5B9A\u6027\u3001\u5E42\u7B49\u6027"}),"\n",(0,s.jsx)(e.li,{children:"\u53EA\u80FD\u901A\u8FC7\u7528 activity \u4E0E\u5916\u754C\u4EA4\u4E92"}),"\n",(0,s.jsx)(e.li,{children:"go - workflow.Go"}),"\n",(0,s.jsx)(e.li,{children:"chan - workflow.Channel"}),"\n",(0,s.jsx)(e.li,{children:"select - workflow.Selector"}),"\n",(0,s.jsx)(e.li,{children:"time.Now - workflow.Now"}),"\n",(0,s.jsx)(e.li,{children:"time.Sleep - workflow.Sleep"}),"\n",(0,s.jsx)(e.li,{children:"log - workflow.GetLogger"}),"\n",(0,s.jsxs)(e.li,{children:["Future\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"cadence \u7279\u6709\u6982\u5FF5 - \u5F02\u6B65\u64CD\u4F5C\u3001timer"}),"\n",(0,s.jsxs)(e.li,{children:["\u5355\u4E2A Selector AddFuture \u53EA\u4F1A\u89E6\u53D1\u4E00\u6B21\u56DE\u8C03\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Future \u5B8C\u6210\u540E\u4E0D\u4F1A\u518D\u89E6\u53D1\uFF0C\u9664\u975E\u91CD\u65B0\u6784\u5EFA Selector \u6216 \u518D\u6B21 Add"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["NewContinueAsNewError\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E3A\u907F\u514D history \u8FC7\u5927\uFF0C\u5EFA\u8BAE\u91CD\u542F"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Activity - \u5355\u4E2A\u6B65\u9AA4\u6D3B\u52A8\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8FD4\u56DE\u5FC5\u9700\u5305\u542B error"}),"\n",(0,s.jsx)(e.li,{children:"TaskToken - \u552F\u4E00\u6807\u8BC6 -> DomainName, WorkflowID, ActivityID"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Session\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8C03\u5EA6\u591A\u4E2A Activity \u5230\u76F8\u540C\u8282\u70B9"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Replayer\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u91CD\u653E\u68C0\u6D4B workflow \u662F\u5426\u53D8\u5316"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Shadower\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4ECE\u670D\u52A1\u7AEF\u62C9\u53D6\u5386\u53F2\u8FDB\u884C\u91CD\u653E"}),"\n",(0,s.jsx)(e.li,{children:"\u4F9D\u8D56\u9AD8\u7EA7\u641C\u7D22 - Elastic \u5B58\u50A8"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Archiver\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8D1F\u8D23\u5F52\u6863\u548C\u53D6\u56DE\u5386\u53F2"}),"\n",(0,s.jsx)(e.li,{children:"workflowID + runID \u5B9A\u4F4D"}),"\n",(0,s.jsx)(e.li,{children:"\u5B58\u50A8: local, S3, Kafka"}),"\n",(0,s.jsx)(e.li,{children:"history archival"}),"\n",(0,s.jsx)(e.li,{children:"visibility archival"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Advanced visibility\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u57FA\u4E8E SearchAttributes \u8FDB\u884C\u641C\u7D22 - \u53EA\u652F\u6301\u57FA\u7840\u7C7B\u578B"}),"\n",(0,s.jsx)(e.li,{children:"\u9700\u8981 Elastic"}),"\n",(0,s.jsx)(e.li,{children:"Memo \u5217\u8868\u53EF\u89C1\uFF0C\u4F46\u4E0D\u4F1A\u7D22\u5F15 - \u652F\u6301\u4EFB\u610F\u7C7B\u578B"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["ActivityTask\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7531 activity worker \u5904\u7406"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["DecisionTask\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7531 workflow worker \u5904\u7406"}),"\n",(0,s.jsx)(e.li,{children:"\u5904\u7406\u5916\u90E8\u4E8B\u4EF6 - signal\u3001timer"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u670D\u52A1\u89D2\u8272\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"FE - Front End - \u524D\u7AEF API \u670D\u52A1"}),"\n",(0,s.jsxs)(e.li,{children:["HS - History Service - \u6838\u5FC3\u5DE5\u4F5C\u6D41\u7F16\u6392\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Cross DC replication"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"MS - Matching Service - workflow/activity <-> worker"}),"\n",(0,s.jsx)(e.li,{children:"WS - Worker Service - \u5185\u90E8\u670D\u52A1\uFF0C\u4F8B\u5982 archiving"}),"\n",(0,s.jsx)(e.li,{children:"Worker - \u7528\u6237\u7F16\u5199"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["query - \u67E5\u8BE2\u6D41\u7A0B\u72B6\u6001\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"__stack_trace"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Event\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Signal - \u5916\u90E8\u4E8B\u4EF6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"domain",children:"Domain"}),"\n",(0,s.jsx)(e.h2,{id:"activity",children:"Activity"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5E94\u7528\u4EE3\u7801"}),"\n",(0,s.jsx)(e.li,{children:"\u957F\u65F6\u95F4\u8FD0\u884C\u7684 - \u5FC3\u8DF3"}),"\n",(0,s.jsx)(e.li,{children:"\u5F02\u6B65"}),"\n",(0,s.jsx)(e.li,{children:"\u57FA\u4E8E\u7B56\u7565\u91CD\u8BD5"}),"\n",(0,s.jsx)(e.li,{children:"\u8DEF\u7531\u5230\u4E3B\u673A\u548C\u8FDB\u7A0B"}),"\n",(0,s.jsx)(e.li,{children:"\u901A\u8FC7\u961F\u5217\u5206\u53D1"}),"\n",(0,s.jsx)(e.li,{children:"Worker \u901F\u7387\u548C\u5E76\u53D1\u9650\u5236"}),"\n",(0,s.jsx)(e.li,{children:"\u961F\u5217\u901F\u7387\u9650\u5236"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u6982\u5FF5\u7C7B\u4F3C\u4E8E Queue"}),"\n",(0,s.jsx)(e.h3,{id:"\u5B9E\u73B0",children:"\u5B9E\u73B0"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u8D85\u65F6\u7B56\u7565\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ScheduleToStart"}),"\n",(0,s.jsx)(e.li,{children:"StartToClose"}),"\n",(0,s.jsx)(e.li,{children:"ScheduleToClose"}),"\n",(0,s.jsx)(e.li,{children:"Heartbeat"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u91CD\u8BD5\u7B56\u7565\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"InitialInterval"}),"\n",(0,s.jsx)(e.li,{children:"BackoffCoefficient"}),"\n",(0,s.jsx)(e.li,{children:"MaximumInterval"}),"\n",(0,s.jsx)(e.li,{children:"MaximumAttempts"}),"\n",(0,s.jsx)(e.li,{children:"ExpirationInterval"}),"\n",(0,s.jsx)(e.li,{children:"NonRetryableErrorReasons"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"workflow",children:"Workflow"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u865A\u62DF\u5BF9\u8C61 - Java\u3001Go\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4F8B\u5982 \u7528\u6237\u3001\u64CD\u4F5C\u76EE\u6807 - \u652F\u6301\u67E5\u8BE2\u548C\u76F8\u5173\u64CD\u4F5C"}),"\n",(0,s.jsx)(e.li,{children:"\u6BCF\u4E2A\u865A\u62DF\u5BF9\u8C61\u90FD\u6709\u81EA\u5DF1\u7684\u72B6\u6001 - \u56E0\u6B64\u7CFB\u7EDF\u4E2D\u7684 Entity \u90FD\u4F1A\u6620\u5C04\u5230 Workflow"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u4E8B\u52A1\u6027"}),"\n",(0,s.jsx)(e.li,{children:"\u7F16\u6392 Activities"}),"\n",(0,s.jsx)(e.li,{children:"\u54CD\u5E94\u5916\u90E8\u4E8B\u4EF6"}),"\n",(0,s.jsx)(e.li,{children:"\u6709\u72B6\u6001 - \u672C\u5730\u53D8\u91CF\u548C\u6808"}),"\n",(0,s.jsx)(e.li,{children:"\u53EF\u67E5\u8BE2"}),"\n",(0,s.jsx)(e.li,{children:"\u957F\u65F6\u95F4\u5B58\u5728"}),"\n",(0,s.jsx)(e.li,{children:"\u6301\u4E45\u5316\u8BA1\u65F6\u5668"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5B9E\u73B0-1",children:"\u5B9E\u73B0"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u6BCF\u4E2A\u57DF\u4E0B \u6BCF\u4E2A Workflow \u6709\u4E00\u4E2A\u552F\u4E00 ID - \u901A\u5E38\u662F\u4E1A\u52A1\u5BF9\u8C61 ID - \u4F8B\u5982\u8BA2\u5355\u3001\u5BA2\u6237\u7684 ID\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Domain Name, Workflow ID, Run ID"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u6BCF\u6B21\u6267\u884C\u6709 Run ID"}),"\n",(0,s.jsxs)(e.li,{children:["\u590D\u7528\u7B56\u7565\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"AllowDuplicateFailedOnly - \u9ED8\u8BA4 - \u5141\u8BB8\u5931\u8D25\u7684\u6D41\u7A0B\u91CD\u590D\u6267\u884C"}),"\n",(0,s.jsx)(e.li,{children:"AllowDuplicate - \u5982\u679C\u6D41\u7A0B\u5F53\u524D\u672A\u8FD0\u884C"}),"\n",(0,s.jsx)(e.li,{children:"RejectDuplicate - \u4E0D\u5141\u8BB8\u91CD\u590D\u6267\u884C"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u6CE8\u610F",children:"\u6CE8\u610F"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6CA1\u6709\u76F4\u63A5\u7684 API \u64CD\u4F5C\uFF0C\u901A\u8FC7 Activity \u8FDB\u884C\u54CD\u5E94"}),"\n",(0,s.jsx)(e.li,{children:"\u6838\u5FC3\u662F\u7F16\u6392 Activity"}),"\n",(0,s.jsx)(e.li,{children:"\u53EF\u4EE5\u7406\u89E3\u4E3A\u5355\u7EBF\u7A0B\u7684\u5E94\u7528\u903B\u8F91 - \u4F46\u5B9E\u9645\u4F1A\u8FC1\u79FB\u5230\u4E0D\u540C\u4E3B\u673A\u8FD0\u884C"}),"\n",(0,s.jsxs)(e.li,{children:["\u4E0E\u4F20\u7EDF\u610F\u4E49 Workflow \u4E0D\u540C - orchestrator\u3001",(0,s.jsx)(e.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview",children:"durable function"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4F20\u7EDF\u610F\u4E49 Workflow\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4ECE\u67D0\u4E2A\u5730\u65B9\u5F00\u59CB\uFF0C\u5230\u67D0\u4E2A\u5730\u65B9\u7ED3\u675F"}),"\n",(0,s.jsx)(e.li,{children:"LCDP / \u4F4E\u4EE3\u7801\u5F00\u53D1\u5E73\u53F0 - \u56FE\u5F62\u5316\u66FF\u4EE3\u7F16\u7801"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u7C7B\u4F3C\u4E8E\u4E00\u4E2A\u65B9\u6CD5"}),"\n",(0,s.jsxs)(e.li,{children:["UI \u7684\u6D41\u7A0B\u6784\u5EFA\u6700\u7EC8\u4E5F\u662F\u6620\u5C04\u4E3A\u4EE3\u7801\u5C42\u9762\u7684\u6267\u884C - workflow \u662F code first\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Workflow \u518D\u53BB\u652F\u6301 UI \u7684 graph"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u53EF\u4EE5\u5C06\u591A\u4E2A Task \u6620\u5C04\u4E3A\u5355\u4E2A Workflow - \u53EF\u901A\u8FC7\u53D8\u91CF\u63A7\u5236\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u903B\u8F91\u5904\u7406\u66F4\u52A0\u6E05\u6670"}),"\n",(0,s.jsx)(e.li,{children:"\u51CF\u5C11 DB Load"}),"\n",(0,s.jsx)(e.li,{children:"\u601D\u8003\u65B9\u5F0F\u4F1A\u6709\u6240\u4E0D\u540C"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5F02\u6784\u548C LongRun \u7684\u7279\u6027\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u53EF\u4EE5\u7528\u4E8E\u7BA1\u7406\u5176\u4ED6\u5E73\u53F0\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7BA1\u7406 CI\u3001CD \u6267\u884C"}),"\n",(0,s.jsx)(e.li,{children:"\u7BA1\u7406 Flink\u3001Spark \u4EFB\u52A1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u53EF\u7528\u4E8E\u6267\u884C\u5468\u671F\u6027\u4EFB\u52A1\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6BCF\u6708\u62A5\u8868"}),"\n",(0,s.jsx)(e.li,{children:"\u5404\u79CD\u957F\u77ED\u5468\u671F\u4EFB\u52A1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["/etc/cadence/config/config_template.yaml\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/docker/config_template.yaml",children:"docker/config_template.yaml"})}),"\n",(0,s.jsx)(e.li,{children:"\u914D\u7F6E\u6A21\u677F"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"/etc/cadence/config/dynamicconfig/config.yaml"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/common/config/config.go",children:"https://github.com/uber/cadence/blob/master/common/config/config.go"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence/blob/master/common/service/config.go",children:"https://github.com/uber/cadence/blob/master/common/service/config.go"})}),"\n",(0,s.jsxs)(e.li,{children:["domain\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Retention"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'history:\n  # 2K -> SQL\n  # 8K -> Cassandra\n  numHistoryShards: 4\n\n  # \u5B58\u50A8\u5F15\u7528\n  defaultStore: default\n  visibilityStore: visibility\n  advancedVisibilityStore: es-visibility\n  # \u5B58\u50A8\u914D\u7F6E\n  datastores:\n    default:\n      nosql:\n        pluginName: "cassandra"\n      sql:\n        pluginName: "postgres"\n        encodingType: "thriftrw"\n        decodingTypes: ["thriftrw"]\n        databaseName: {{ default .Env.DBNAME "cadence" }}\n        connectAddr: "{{ default .Env.POSTGRES_SEEDS "" }}:{{ default .Env.DB_PORT "5432" }}"\n        connectProtocol: "tcp"\n        user: {{ default .Env.POSTGRES_USER "" }}\n        password: {{ default .Env.POSTGRES_PWD "" }}\n        maxConns: 20\n        maxIdleConns: 20\n        maxConnLifetime: "1h"\n        tls:\n          enabled: true\n          sslmode: require\n      elasticsearch:\n        version: {{ default .Env.ES_VERSION "" }}\n        username: {{ default .Env.ES_USER "" }}\n        password: {{ default .Env.ES_PWD "" }}\n        url:\n          scheme: "http"\n          host: "{{ default .Env.ES_SEEDS "" }}:{{ default .Env.ES_PORT "9200" }}"\n        indices:\n          visibility: {{ default .Env.VISIBILITY_NAME "cadence-visibility-dev" }}\n    visibility:\n      sql:\n        # \u4E00\u822C\u4F1A\u7528\u4E0D\u540C\u7684\u5E93\n        databaseName: {{ default .Env.VISIBILITY_DBNAME "cadence_visibility" }}\n    es-visibility:\ndynamicConfigClient:\n  filepath: /etc/cadence/config/dynamicconfig/config.yaml\n  pollInterval: 10s\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"# \u52A8\u6001\u914D\u7F6E\nfrontend.visibilityListMaxQPS:\n  - value: 1000\n    constraints:\n      domainName: 'domainA'\n  - value: 2000\n    constraints:\n      domainName: 'domainB'\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"\n# \u5355\u8282\u70B9\nfrontend.persistenceMaxQPS: 2000\n# \u5168\u5C40\nfrontend.persistenceGlobalMaxQPS: 2000\n# visibility db\nfrontend.visibilityListMaxQPS: 10\nfrontend.esVisibilityListMaxQPS: 30\n\nmatching.persistenceMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 3000\nmatching.persistenceGlobalMaxQPS: 2000\n\nhistory.persistenceMaxQPS: 9000\nhistory.persistenceGlobalMaxQPS: 9000\nhistory.historyVisibilityOpenMaxQPS:\nhistory.historyVisibilityClosedMaxQPS:\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5B58\u50A8\u7ED3\u6784",children:"\u5B58\u50A8\u7ED3\u6784"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence/tree/master/schema/postgres",children:"schema/postgres"})}),"\n",(0,s.jsx)(e.li,{children:"domains"}),"\n",(0,s.jsx)(e.li,{children:"domain_metadata"}),"\n",(0,s.jsx)(e.li,{children:"shards"}),"\n",(0,s.jsx)(e.li,{children:"transfer_tasks"}),"\n",(0,s.jsx)(e.li,{children:"cross_cluster_tasks"}),"\n",(0,s.jsx)(e.li,{children:"executions"}),"\n",(0,s.jsx)(e.li,{children:"current_executions"}),"\n",(0,s.jsx)(e.li,{children:"buffered_events"}),"\n",(0,s.jsx)(e.li,{children:"tasks"}),"\n",(0,s.jsx)(e.li,{children:"task_lists"}),"\n",(0,s.jsx)(e.li,{children:"replication_tasks"}),"\n",(0,s.jsx)(e.li,{children:"replication_tasks_dlq"}),"\n",(0,s.jsx)(e.li,{children:"timer_tasks"}),"\n",(0,s.jsx)(e.li,{children:"activity_info_maps"}),"\n",(0,s.jsx)(e.li,{children:"timer_info_maps"}),"\n",(0,s.jsx)(e.li,{children:"child_execution_info_maps"}),"\n",(0,s.jsx)(e.li,{children:"request_cancel_info_maps"}),"\n",(0,s.jsx)(e.li,{children:"signal_info_maps"}),"\n",(0,s.jsx)(e.li,{children:"buffered_replication_task_maps"}),"\n",(0,s.jsx)(e.li,{children:"signals_requested_sets"}),"\n",(0,s.jsx)(e.li,{children:"history_node"}),"\n",(0,s.jsx)(e.li,{children:"history_tree"}),"\n",(0,s.jsx)(e.li,{children:"queue"}),"\n",(0,s.jsx)(e.li,{children:"queue_metadata"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"schema",children:"schema"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"go build -o cadence-sql-tool github.com/uber/cadence/cmd/tools/sql\n# \u9ED8\u8BA4\u5B58\u50A8 \u548C visibility \u90FD\u9700\u8981\nenv $(cat .env | xargs) ./cadence-sql-tool setup-schema -v 0.0\nenv $(cat .vis | xargs) ./cadence-sql-tool setup-schema -v 0.0\n# update - \u6CE8\u610F \u9ED8\u8BA4 \u548C visibility \u8DEF\u5F84\u4E0D\u540C\nenv $(cat .env | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/cadence/versioned/\nenv $(cat .vis | xargs) go run ./cmd/tools/sql/ update-schema -d schema/postgres/visibility/versioned/\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",metastring:'title=".env"',children:"SQL_PLUGIN=postgres\nSQL_HOST=192.168.1.1\nSQL_PORT=5432\nSQL_DATABASE=cadence\nSQL_USER=cadence\nSQL_PASSWORD=\nSQL_CONNECT_ATTRIBUTES=sslmode=require\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["postgres \u5F00\u542F --tls \u8981\u6C42\u63D0\u4F9B ca - \u5B9E\u9645\u4E0D\u9700\u8981\uFF0C\u76EE\u524D\u8981\u6539\u68C0\u6D4B\u4EE3\u7801\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/uber/cadence/pull/4639",children:"#4639"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(e.h2,{id:"helm",children:"Helm"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence",children:"https://github.com/wenerme/charts/tree/master/banzai/charts/cadence"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u540C\u6B65\u81EA banzai charts"}),"\n",(0,s.jsx)(e.li,{children:"banzai \u56FD\u5185\u65E0\u6CD5\u8BBF\u95EE"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"existingSecret \u5305\u542B password \u5B57\u6BB5"}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["helm schema job \u4E0D\u652F\u6301 postgres\uFF0C\u4E0D\u652F\u6301\u4F7F\u7528 existingSecret\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5EFA\u8BAE\u672C\u5730\u8FC1\u79FB"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/issues/1301",children:"banzaicloud/banzai-charts#1301"}),"\nSetup Job doesn't pull value from secret"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["service \u672A\u66B4\u9732 grpc \u7AEF\u53E3\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/banzaicloud/banzai-charts/issues/1305",children:"banzaicloud/banzai-charts#1305"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(e.h2,{id:"cannot-register-global-domain-when-not-enabled",children:"Cannot register global domain when not enabled"}),"\n",(0,s.jsxs)(e.p,{children:["cli \u6CE8\u518C\u6DFB\u52A0 ",(0,s.jsx)(e.code,{children:"--global_domain=false"})]}),"\n",(0,s.jsx)(e.h2,{id:"persistence-max-qps-reached",children:"Persistence Max QPS Reached"}),"\n",(0,s.jsx)(e.p,{children:"\u6570\u636E\u5E93\u9650\u5236"}),"\n",(0,s.jsx)(e.h2,{id:"persistence-max-qps-reached-for-list-operations",children:"Persistence Max QPS Reached for List Operations"}),"\n",(0,s.jsx)(e.p,{children:"visibility \u6570\u636E\u5E93\u9650\u5236"})]})}function o(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},17776:function(n,e,i){i.d(e,{R:()=>c,x:()=>d});var l=i(7378);let s={},r=l.createContext(s);function c(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);