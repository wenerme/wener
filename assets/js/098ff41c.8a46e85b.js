"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["33631"],{22586:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>c,toc:()=>t,default:()=>a,metadata:()=>i,assets:()=>h,contentTitle:()=>d});var i=JSON.parse('{"id":"devops/infra/packer","title":"Packer","description":"- hashicorp/packer \u662F\u4EC0\u4E48\uFF1F","source":"@site/../notes/devops/infra/packer.md","sourceDirName":"devops/infra","slug":"/devops/infra/packer","permalink":"/notes/devops/infra/packer","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/infra/packer.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1741072966000,"frontMatter":{"title":"Packer"},"sidebar":"docs","previous":{"title":"Nomad","permalink":"/notes/devops/infra/nomad"},"next":{"title":"Pulumi","permalink":"/notes/devops/infra/pulumi"}}'),r=s(86106),l=s(17776);let c={title:"Packer"},d="Packer",h={},t=[{value:"HCL2",id:"hcl2",level:2},{value:"Template",id:"template",level:2},{value:"\u6A21\u7248\u8BED\u6CD5",id:"\u6A21\u7248\u8BED\u6CD5",level:3},{value:"\u6761\u4EF6\u53D8\u91CF",id:"\u6761\u4EF6\u53D8\u91CF",level:3},{value:"HOME",id:"home",level:3},{value:"communicator",id:"communicator",level:3},{value:"docker",id:"docker",level:3},{value:"qemu",id:"qemu",level:3}];function o(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"packer",children:"Packer"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/hashicorp/packer",children:"hashicorp/packer"})," \u662F\u4EC0\u4E48\uFF1F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"BSL, Go"}),"\n",(0,r.jsx)(e.li,{children:"\u81EA\u52A8\u5316\u591A\u5E73\u53F0\u955C\u50CF\u6784\u5EFA\u5DE5\u5177"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u4F7F\u7528\u573A\u666F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"CD"}),"\n",(0,r.jsx)(e.li,{children:"Dev/Prod Parity"}),"\n",(0,r.jsx)(e.li,{children:"Appliance/Demo Creation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6838\u5FC3\u6D41\u7A0B\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u542F\u52A8 builder\uFF0C\u63D0\u4F9B\u4E00\u81F4\u7684\u73AF\u5883\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"vm\u3001docker"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6267\u884C provisioners - \u670D\u52A1\u5F00\u901A\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6784\u5EFA artifact"}),"\n",(0,r.jsx)(e.li,{children:"file provisioner \u4E0B\u8F7D artifact \u5230\u672C\u5730"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6267\u884C post-processor\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"artifice \u9A8C\u8BC1 \u4EA7\u51FA\u7269 \u5B58\u5728"}),"\n",(0,r.jsx)(e.li,{children:"\u4E0A\u4F20\u5230 docker hub\u3001oss \u7B49\u5176\u4ED6\u5730\u65B9"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6CE8\u610F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Builder \u4E0D\u652F\u6301\u4F9D\u8D56"}),"\n",(0,r.jsxs)(e.li,{children:["\u81EA\u52A8\u52A0\u8F7D",(0,r.jsx)(e.a,{href:"https://www.packer.io/guides/hcl/variables",children:"\u53D8\u91CF"})," ",(0,r.jsx)(e.code,{children:"*.auto.pkrvars.hcl"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"PACKER_LOG=1"})," \u5F00\u542F\u65E5\u5FD7"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/geerlingguy/packer-boxes",children:"geerlingguy/packer-boxes"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"~/.cache/packer"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# macOS\nbrew install packer\n\npacker version\n# timestamp,target,type,data\npacker -machine-readable version\n\npacker -autocomplete-install\n\npacker build template.json\n\n# console\n# \u5B9E\u9A8C\u53D8\u91CF\u66FF\u6362\n# help exit variables\npacker console my_template.json\necho {{timestamp}} | packer console\n\n# hcl2 console - 1.6+\npacker console folder/\npacker console file.pkr.hcl\necho "1 + 5" | packer console --config-type=hcl2\npacker console --config-type=hcl2\n\npacker fix old.json > new.json\npacker inspect template.json\npacker validate my-template.json\n\n# \u4F7F\u7528 JQ \u5220\u9664\u8BC4\u8BBA\njq \'walk(if type == "object" then del(._comment) else . end)\' commented_template.json > uncommented_template.json\n\n# \u624B\u52A8\u5B89\u88C5\n# https://packer.io/downloads.html\nver=$(curl -sfL https://api.github.com/repos/hashicorp/packer/releases/latest | jq .tag_name -r)\nver=${ver##v}\ncurl -LOC- https://releases.hashicorp.com/packer/${ver}/packer_${ver}_linux_amd64.zip\n'})}),"\n",(0,r.jsx)(e.h2,{id:"hcl2",children:"HCL2"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"packer build folder"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"variables.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"locals.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"sources.pkr.hcl"}),"\n",(0,r.jsx)(e.li,{children:"build.pkr.hcl"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5F15\u53F7\u548C heredoc \u91CC\u4F7F\u7528 ",(0,r.jsx)(e.code,{children:"${"})," ",(0,r.jsx)(e.code,{children:"%{"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/hashicorp/packer/issues/9176",children:"#9176"})," - HCL2: implementation list"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-hcl",children:'# \u5168\u5C40\u5B9A\u4E49\u53EF\u590D\u7528\u7684 builder\nsource "docker" "base" {\n  image = "wener/base"\n  discard = true\n  pull = false\n}\n\n# \u672C\u5730\u53D8\u91CF\nlocals {\n    # \u76F4\u63A5\u5F15\u7528\n    wee = local.baz\n    # \u5B57\u7B26\u4E32\u4E2D\u66FF\u6362\n    baz = "Foo is \'${var.foo}\' but not \'${local.wee}\'"\n}\n\n# \u53D8\u91CF\u5B9A\u4E49\nvariable "foo" {\n    type = string\n    default = "the default value of the `foo` variable"\n    description = "description of the `foo` variable"\n}\n\n# \u6784\u5EFA\nbuild {\n  name = "test-build"\n  # \u5F15\u7528\n  source "docker.base" {}\n  # \u591A\u4E2A\n  # source = [ "source.docker.first", "source.docker.second" ]\n\n  provisioner "shell" {\n    # \u6307\u5B9A source \u6267\u884C\n    only = ["source.docker.base"]\n    # \u7B49\u5F85\u6307\u5B9A\u65F6\u95F4\n    pause_before = "10s"\n    max_retries = 5\n    timeout = "5m"\n\n    inline = [ "echo Tesing" ]\n  }\n\n  post-processor "shell-local" {\n    inline = ["echo Down working"]\n  }\n\n  post-processor "checksum" {\n    checksum_types = [ "md5", "sha512" ]\n    keep_input_artifact = true\n    only = ["source.amazon-ebs.example"]\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"template",children:"Template"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/builders",children:"builders"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"alicloud-ecs - \u963F\u91CC\u4E91 ECS \u8FD0\u884C"}),"\n",(0,r.jsx)(e.li,{children:"docker - Docker \u91CC\u8FD0\u884C"}),"\n",(0,r.jsx)(e.li,{children:"qemu - \u901A\u8FC7 QEMU \u8FD0\u884C"}),"\n",(0,r.jsx)(e.li,{children:"libvirt - \u901A\u8FC7 libvirt \u8FD0\u884C"}),"\n",(0,r.jsx)(e.li,{children:"tencentcloud-cvm - \u817E\u8BAF\u4E91 CVM \u8FD0\u884C"}),"\n",(0,r.jsx)(e.li,{children:"file - \u57FA\u4E8E\u6587\u4EF6\u6784\u5EFA artifact \u7136\u540E\u8FD0\u884C post-processors"}),"\n",(0,r.jsx)(e.li,{children:"null - \u8BBE\u7F6E SSH\uFF0C\u8FD0\u884C provisioners"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/communicators",children:"communicator"})," - \u901A\u4FE1\u673A\u5236"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/post-processors",children:"post-processors"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"alicloud-import"}),"\n",(0,r.jsx)(e.li,{children:"artifice - \u6307\u5B9A\u4EA7\u51FA\u7269\uFF0C\u4E4B\u540E\u7684 post-processors \u80FD\u8BBF\u95EE\u5230"}),"\n",(0,r.jsx)(e.li,{children:"compress"}),"\n",(0,r.jsx)(e.li,{children:"checksum"}),"\n",(0,r.jsx)(e.li,{children:"docker-import"}),"\n",(0,r.jsx)(e.li,{children:"docker-push"}),"\n",(0,r.jsx)(e.li,{children:"docker-save"}),"\n",(0,r.jsx)(e.li,{children:"docker-tag"}),"\n",(0,r.jsx)(e.li,{children:"manifest"}),"\n",(0,r.jsx)(e.li,{children:"shell - \u672C\u5730\u6267\u884C"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/provisioners",children:"provisioners"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ansible-local - \u672C\u5730\u6267\u884C"}),"\n",(0,r.jsx)(e.li,{children:"ansible - \u8FDC\u7A0B\u6267\u884C"}),"\n",(0,r.jsx)(e.li,{children:"breakpoint - \u7B49\u5F85\u7528\u6237\u786E\u8BA4"}),"\n",(0,r.jsx)(e.li,{children:"file - \u6587\u4EF6\u4E0A\u4F20"}),"\n",(0,r.jsx)(e.li,{children:"powershell"}),"\n",(0,r.jsx)(e.li,{children:"shell"}),"\n",(0,r.jsx)(e.li,{children:"shell-local"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["variables\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{user 'aws_access_key'}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{env 'MY_SECRET'}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ consul_key 'my_image/softs_versions/next' }}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ vault '/secret/data/hello' 'foo'}}"})}),"\n",(0,r.jsx)(e.li,{children:"\u6570\u7EC4\u53D8\u91CF\u53EF\u4F7F\u7528\u9017\u53F7\u62FC\u63A5\u7684\u5B57\u7B26\u4E32"}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"-var=name=value"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"-var-file=vars.json"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "_comment": "This is a comment",\n  // \u5FC5\u987B - \u5B9A\u4E49\u4E00\u4E2A\u6216\u591A\u4E2A builder\n  "builders": [{}],\n  "description": "",\n  // packer \u6700\u5C0F\u7248\u672C\n  "min_packer_version": "",\n  // \u540E\u5904\u7406\u6B65\u9AA4\n  "post-processors": [{}],\n  // \u5B89\u88C5\u914D\u7F6E\u548C\u5305\u7684\u6B65\u9AA4\n  "provisioners": [{}],\n  // \u9519\u8BEF\u65F6\u6267\u884C\n  "error-cleanup-provisioner": {\n    "type": "shell-local",\n    "inline": ["echo \'rubber ducky\'> ducky.txt"]\n  },\n  // \u53D8\u91CF\u5B9A\u4E49\n  "variables": {\n    "my_secret": "{{env `MY_SECRET`}}",\n    "not_a_secret": "plaintext",\n    "foo": "bar"\n  },\n  // \u5B9A\u4E49\u654F\u611F\u53D8\u91CF\n  "sensitive-variables": ["my_secret", "foo"]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6A21\u7248\u8BED\u6CD5",children:"\u6A21\u7248\u8BED\u6CD5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/templates/engine",children:"\u6A21\u677F\u8BED\u6CD5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{ }}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{timestamp}}"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"{{.Variable}}"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"func"}),(0,r.jsx)(e.th,{children:"desc"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build_name"}),(0,r.jsx)(e.td,{children:"\u6784\u5EFA\u540D"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build_type"}),(0,r.jsx)(e.td,{children:"\u6784\u5EFA\u7C7B\u578B"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"clean_resource_name"}),(0,r.jsxs)(e.td,{children:["\u5E72\u51C0\u7684\u8D44\u6E90\u540D\u5B57\uFF0C\u7A7A\u683C\u8F6C",(0,r.jsx)(e.code,{children:"-"}),"\uFF0C\u5C0F\u5199\uFF0C\u622A\u53D6\u957F\u5EA6\uFF08GCE 63\uFF0CAzure 80\uFF09"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"env"}),(0,r.jsx)(e.td,{children:"\u73AF\u5883\u53D8\u91CF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"build"}),(0,r.jsx)(e.td,{children:"\u6784\u5EFA\u65F6\u7684\u72B6\u6001\u548C\u8FDE\u63A5\u4FE1\u606F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"isotime [FORMAT]"})}),(0,r.jsx)(e.td,{children:"\u65F6\u95F4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"lower"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"packer_version"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"pwd"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"replace"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"( old, new string, n int, s )"})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"replace_all"}),(0,r.jsx)(e.td,{children:"\u5168\u66FF\u6362"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"split"}),(0,r.jsx)(e.td,{children:"\u5206\u5272\u5B57\u7B26\u4E32"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"template_dir"}),(0,r.jsx)(e.td,{children:"\u6A21\u677F\u76EE\u5F55"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"timestamp"}),(0,r.jsx)(e.td,{children:"UNIX \u65F6\u95F4\u6233\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u4E3A\u53D8\u91CF\u4F7F\u7528\uFF0C\u5426\u5219\u4F1A\u53D8"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"uuid"}),(0,r.jsx)(e.td,{children:"UUID"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"upper"}),(0,r.jsx)(e.td,{children:"\u5927\u5199"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"user"}),(0,r.jsx)(e.td,{children:"\u7528\u6237\u53D8\u91CF"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["build\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ID - \u6784\u5EFA VM \u7684 ID - \u4F8B\u5982 EC2 \u7684 instance id"}),"\n",(0,r.jsx)(e.li,{children:"Host, Port, User, Password - \u8BBF\u95EE\u673A\u5668\u7684\u4FE1\u606F\uFF0C\u7528\u4E8E Ansible \u6216 Inspec"}),"\n",(0,r.jsx)(e.li,{children:"ConnType - \u901A\u4FE1\u7C7B\u578B"}),"\n",(0,r.jsx)(e.li,{children:"PackerRunUUID - \u6784\u5EFA ID"}),"\n",(0,r.jsx)(e.li,{children:"PackerHTTPIP, PackerHTTPPort, PackerHTTPAddr - packer \u63D0\u4F9B\u7684 http \u6587\u4EF6\u670D\u52A1 - vm \u4E2D\u7684 http \u76EE\u5F55"}),"\n",(0,r.jsx)(e.li,{children:"SSHPublicKey, SSHPrivateKey - packer \u94FE\u63A5\u7684\u5BC6\u94A5"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6761\u4EF6\u53D8\u91CF",children:"\u6761\u4EF6\u53D8\u91CF"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "type": "shell-local",\n  "command": "if [ ! -z \\"{{user `do_nexpose_scan`}}\\" ]; then python -u trigger_nexpose_scan.py; fi"\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"home",children:"HOME"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "variables": {\n    "home": "{{env `HOME`}}"\n  },\n  "builders": [\n    {\n      "type": "google",\n      "account_file": "{{ user `home` }}/.secrets/gcp-{{ user `env` }}.json"\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"communicator",children:"communicator"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.packer.io/docs/communicators",children:"communicator"})," - \u901A\u4FE1\u673A\u5236\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"none - \u4E0D\u8BBE\u7F6E\uFF0C\u4E0D\u80FD\u4F7F\u7528 provisioners"}),"\n",(0,r.jsxs)(e.li,{children:["ssh\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ssh_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_keypair_name"}),"\n",(0,r.jsx)(e.li,{children:"temporary_key_pair_name"}),"\n",(0,r.jsx)(e.li,{children:"ssh_clear_authorized_keys"}),"\n",(0,r.jsx)(e.li,{children:"ssh_private_key_file"}),"\n",(0,r.jsx)(e.li,{children:"ssh_pty"}),"\n",(0,r.jsx)(e.li,{children:"ssh_timeout"}),"\n",(0,r.jsx)(e.li,{children:"ssh_agent_auth"}),"\n",(0,r.jsx)(e.li,{children:"ssh_disable_agent_forwarding"}),"\n",(0,r.jsx)(e.li,{children:"ssh_handshake_attempts"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_agent_auth"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_interactive"}),"\n",(0,r.jsx)(e.li,{children:"ssh_bastion_private_key_file"}),"\n",(0,r.jsx)(e.li,{children:"ssh_file_transfer_method"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_host"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_port"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_username"}),"\n",(0,r.jsx)(e.li,{children:"ssh_proxy_password"}),"\n",(0,r.jsx)(e.li,{children:"ssh_keep_alive_interval"}),"\n",(0,r.jsx)(e.li,{children:"ssh_read_write_timeout"}),"\n",(0,r.jsx)(e.li,{children:"ssh_remote_tunnels"}),"\n",(0,r.jsx)(e.li,{children:"ssh_local_tunnels"}),"\n",(0,r.jsx)(e.li,{children:"ssh_public_key"}),"\n",(0,r.jsx)(e.li,{children:"ssh_private_key"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["winrm\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"winrm_username"}),"\n",(0,r.jsx)(e.li,{children:"winrm_password"}),"\n",(0,r.jsx)(e.li,{children:"winrm_host"}),"\n",(0,r.jsx)(e.li,{children:"winrm_port"}),"\n",(0,r.jsx)(e.li,{children:"winrm_timeout"}),"\n",(0,r.jsx)(e.li,{children:"winrm_use_ssl"}),"\n",(0,r.jsx)(e.li,{children:"winrm_insecure"}),"\n",(0,r.jsx)(e.li,{children:"winrm_use_ntlm"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["docker\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Docker Builder"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "communicator": "ssh",\n  "ssh_username": "myuser",\n  "pause_before_connecting": "10m"\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"docker",children:"docker"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "builders": [\n    {\n      "type": "docker",\n      // \u57FA\u7840\u955C\u50CF\n      "image": "ubuntu",\n      // \u4E09\u9009\u4E00 commit, discard, export_path\n      // \u63D0\u4EA4\n      "commit": true,\n      // \u4E22\u5F03\n      "discard": true,\n      // \u5BFC\u51FA\u5230\u6587\u4EF6\n      "export_path": "image.tar"\n    }\n  ],\n  "post-processors": [\n    [\n      {\n        "type": "docker-import",\n        "repository": "hashicorp/packer",\n        "tag": "0.7"\n      },\n      "docker-push"\n    ]\n  ]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"qemu",children:"qemu"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u542F\u52A8\u53C2\u6570"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"-cdrom /xxx/packer_cache/xxx.iso\n-name packer-alpine\n-vnc 127.0.0.1:92\n-boot once=d\n-netdev user,id=user.0,hostfwd=tcp::4287-:22\n-device virtio-net,netdev=user.0\n# \u6302\u8F7D\u4E3A /dev/vda\n-drive file=output-alpine/packer-alpine,if=virtio,cache=writeback,discard=ignore,format=qcow2\n-m 512M\n-machine type=pc,accel=hvf\n"})})]})}function a(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},17776:function(n,e,s){s.d(e,{R:()=>c,x:()=>d});var i=s(7378);let r={},l=i.createContext(r);function c(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);