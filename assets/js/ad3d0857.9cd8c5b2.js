"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["13066"],{26365:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>s,toc:()=>c,default:()=>m,metadata:()=>l,assets:()=>d,contentTitle:()=>a});var l=JSON.parse('{"id":"dev/build/mage","title":"magefile","description":"- \u4F18\u52BF","source":"@site/../notes/dev/build/mage.md","sourceDirName":"dev/build","slug":"/dev/build/mage","permalink":"/notes/dev/build/mage","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/dev/build/mage.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1627915171000,"frontMatter":{"title":"magefile"},"sidebar":"docs","previous":{"title":"LLVM IR","permalink":"/notes/dev/build/llvm"},"next":{"title":"make","permalink":"/notes/dev/build/make"}}'),t=i(86106),r=i(17776);let s={title:"magefile"},a="mega",d={},c=[];function o(e){let n={a:"a",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"mega",children:"mega"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4F18\u52BF\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u6709 Makefile \u7C7B\u4F3C\u7684\u8BED\u4E49\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Target\u3001\u4F9D\u8D56\u3001\u6587\u4EF6\u53D8\u5316\u68C0\u6D4B"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u901A\u8FC7 Go \u7F16\u7801"}),"\n",(0,t.jsx)(n.li,{children:"\u53EF\u4EE5\u4F7F\u7528\u4EFB\u610F\u5E93"}),"\n",(0,t.jsx)(n.li,{children:"\u53EF\u4EE5\u7F16\u8BD1"}),"\n",(0,t.jsx)(n.li,{children:"\u65B9\u4FBF\u4F9D\u8D56\u5176\u4ED6\u5730\u65B9\u7684 Target"}),"\n",(0,t.jsx)(n.li,{children:"\u53EF\u4EE5\u4E0D\u7528\u5B89\u88C5\uFF0C\u53EA\u9700\u8981 Go"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u52A3\u52BF\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u975E\u9759\u6001\u7F16\u8BD1\u5219\u4F9D\u8D56 Go"}),"\n",(0,t.jsx)(n.li,{children:"\u9759\u6001\u9700\u8981\u4EA4\u53C9\u7F16\u8BD1\u591A\u5E73\u53F0 - \u5176\u4ED6\u7684 task runner \u7531\u5B98\u65B9\u63D0\u4F9B\u7F16\u8BD1\u597D\u7684"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u573A\u666F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F8B\u5982 \u5B9A\u4E49\u4E00\u4E2A Yaml \u8868\u793A\u8981\u505A\u7684 Task\uFF0C\u901A\u8FC7 Go \u89E3\u6790\u7136\u540E\u6267\u884C\u4F1A\u5F88\u5BB9\u6613"}),"\n",(0,t.jsx)(n.li,{children:"\u590D\u6742\u7684\u81EA\u5B9A\u4E49\u4EFB\u52A1\u903B\u8F91"}),"\n",(0,t.jsxs)(n.li,{children:["\u805A\u5408\u5176\u4ED6\u5305\u4F5C\u4E3A\u547D\u4EE4\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F8B\u5982 shfmt\u3001sprig - \u7C7B\u4F3C\u4E8E busybox"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u9A8C\u8BC1\u6D4B\u8BD5 Go \u4EE3\u7801"}),"\n",(0,t.jsxs)(n.li,{children:["\u81EA\u5B9A\u4E49\u547D\u4EE4\u5DE5\u5177\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7C7B\u4F3C\u4E8E cobra - \u4F46\u53EF\u6DFB\u52A0 go \u81EA\u5B9A\u4E49"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u6CE8\u610F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Target \u4E0D\u652F\u6301 flag\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/magefile/mage/issues/24",children:"magefile/mage#24"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://magefile.org/environment/",children:"ENVIRONMENT VARIABLES"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"go get -u -d github.com/magefile/mage\ncd $GOPATH/src/github.com/magefile/mage\ngit pull\ngo run bootstrap.go\n\nmage -init\nmage -l\n\n# \u7F16\u8BD1\u4E3A\u53EF\u6267\u884C\u6587\u4EF6 - \u4F1A\u5FFD\u7565 GOOS GOARCH\n# \u4F7F\u7528 -goos -goarch \u4EA4\u53C9\u7F16\u8BD1\nmage -compile ./builder\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// magefile \u9700\u8981\u8BE5 Tag\n// +build mage\n\nimport "github.com/magefile/mage/mg"\nimport "github.com/magefile/mage/sh"\n// Dir Glob Path\n// import "github.com/magefile/mage/target"\n\nvar Default = Build\nvar Aliases = map[string]interface{} {\n  "i":     Install,\n  "build": Build,\n  "ls":    List,\n}\n\n// \u652F\u6301\u7684 Target \u51FD\u6570\u7B7E\u540D\nfunc Install(){}\nfunc Deploy() error {return nil}\nfunc List(context.Context)\nfunc Build(context.Context) error {\n  // \u4F9D\u8D56\n  mg.Deps(Install)\n  return nil\n}\n\n// \u547D\u540D\u7A7A\u95F4\n// mage build:site\ntype Build mg.Namespace\nfunc (Build) Site() error {\n  return nil\n}\nfunc (Build) Docs() {}\n\n\n// \u5BFC\u5165\u5176\u4ED6 Target\n// \u4F1A\u5FFD\u7565 default \u548C alias\nimport (\n  // \u6CE8\u91CA\u662F\u5FC5\u987B\u7684 - \u5BFC\u5165\u5230\u6839\u547D\u540D\u7A7A\u95F4\n  // mage:import\n  _ "example.com/me/foobar"\n  // \u5BFC\u5165\u5230 build \u547D\u540D\u7A7A\u95F4 - mage build:deploy\n  // mage:import build\n  "example.com/me/builder"\n)\n\n// \u53EF\u76F4\u63A5\u4F7F\u7528 go build -tags mage \u6765\u7F16\u8BD1 \u6216 go run main.go -l \u6765\u6267\u884C\n// +build ignore\npackage main\nimport (\n	"os"\n	"github.com/magefile/mage/mage"\n)\nfunc main() {\n	os.Exit(mage.Main())\n}\n'})})]})}function m(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},17776:function(e,n,i){i.d(n,{R:()=>s,x:()=>a});var l=i(7378);let t={},r=l.createContext(t);function s(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);