"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["588958"],{580889:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>t,toc:()=>d,default:()=>h,metadata:()=>i,assets:()=>a,contentTitle:()=>l});var i=JSON.parse('{"id":"devops/docker/docker-faq","title":"Docker FAQ","description":"- Docker Best Practices","source":"@site/../notes/devops/docker/docker-faq.md","sourceDirName":"devops/docker","slug":"/devops/docker/faq","permalink":"/notes/devops/docker/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/docker/docker-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Docker FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"Dockerfile","permalink":"/notes/devops/docker/dockerfile"},"next":{"title":"DockerHub","permalink":"/notes/devops/docker/hub"}}'),s=r(486106),o=r(917776);let t={title:"Docker FAQ",tags:["FAQ"]},l="Docker FAQ",a={},d=[{value:"Host IP",id:"host-ip",level:2},{value:"env",id:"env",level:2},{value:"\u5728 docker \u4E2D\u4F7F\u7528 docker",id:"\u5728-docker-\u4E2D\u4F7F\u7528-docker",level:2},{value:"\u975E root \u7ED1\u5B9A\u79C1\u6709\u7AEF\u53E3",id:"\u975E-root-\u7ED1\u5B9A\u79C1\u6709\u7AEF\u53E3",level:2},{value:"\u505C\u6B62\u6240\u6709\u5BB9\u5668",id:"\u505C\u6B62\u6240\u6709\u5BB9\u5668",level:2},{value:"\u8FC1\u79FB\u6570\u636E\u76EE\u5F55",id:"\u8FC1\u79FB\u6570\u636E\u76EE\u5F55",level:2},{value:"No swap limit support",id:"no-swap-limit-support",level:2},{value:"\u4E3A\u5DF2\u7ECF\u8FD0\u884C\u7684 Docker \u5BB9\u5668\u6DFB\u52A0\u7AEF\u53E3\u6620\u5C04",id:"\u4E3A\u5DF2\u7ECF\u8FD0\u884C\u7684-docker-\u5BB9\u5668\u6DFB\u52A0\u7AEF\u53E3\u6620\u5C04",level:2},{value:"upper fs does not support RENAME_WHITEOUT",id:"upper-fs-does-not-support-rename_whiteout",level:2},{value:"docker zfs vol",id:"docker-zfs-vol",level:2},{value:"driver &quot;zfs&quot; failed to remove root filesystem",id:"driver-zfs-failed-to-remove-root-filesystem",level:2},{value:"\u6CA1\u6743\u9650",id:"\u6CA1\u6743\u9650",level:2},{value:"bridge-nf-call-iptables",id:"bridge-nf-call-iptables",level:2},{value:"Cannot link to a non running container",id:"cannot-link-to-a-non-running-container",level:2},{value:"docker exporter does not currently support exporting manifest lists",id:"docker-exporter-does-not-currently-support-exporting-manifest-lists",level:2},{value:"could not create a builder instance with TLS data loaded from environment",id:"could-not-create-a-builder-instance-with-tls-data-loaded-from-environment",level:2},{value:"DOCKER_HOST environment variable overrides the active context. To use a context, either set the global --context flag, or unset DOCKER_HOST environment variable.",id:"docker_host-environment-variable-overrides-the-active-context-to-use-a-context-either-set-the-global---context-flag-or-unset-docker_host-environment-variable",level:2},{value:"failed to solve with frontend dockerfile.v0: failed to create LLB definition: unexpected status code [manifests latest]: 403 Forbidden",id:"failed-to-solve-with-frontend-dockerfilev0-failed-to-create-llb-definition-unexpected-status-code-manifests-latest-403-forbidden",level:2},{value:"OpenTelemetry",id:"opentelemetry",level:2},{value:"DOCKER_HOST \u683C\u5F0F",id:"docker_host-\u683C\u5F0F",level:2},{value:"error from daemon in stream: Error grabbing logs: invalid character &#39;\\x00&#39; looking for beginning of valu",id:"error-from-daemon-in-stream-error-grabbing-logs-invalid-character-x00-looking-for-beginning-of-valu",level:2},{value:"Error running exec in container: failed to open stdout fifo: error creating fifo",id:"error-running-exec-in-container-failed-to-open-stdout-fifo-error-creating-fifo",level:2},{value:"overlayfs: upper fs does not support RENAME_WHITEOUT",id:"overlayfs-upper-fs-does-not-support-rename_whiteout",level:2},{value:"listing workers: failed to list workers: Unavailable: connection closed before server preface received",id:"listing-workers-failed-to-list-workers-unavailable-connection-closed-before-server-preface-received",level:2},{value:"multiple platforms feature is currently not supported for docker driver. Please switch to a different driver",id:"multiple-platforms-feature-is-currently-not-supported-for-docker-driver-please-switch-to-a-different-driver",level:2},{value:"Docker Image Format v1 and Docker Image manifest version 2",id:"docker-image-format-v1-and-docker-image-manifest-version-2",level:2},{value:"nftables",id:"nftables",level:2},{value:"No chain/target/match by that name",id:"no-chaintargetmatch-by-that-name",level:3},{value:"docker kill signal",id:"docker-kill-signal",level:2},{value:"error from daemon in stream: Error grabbing logs: invalid character &#39;\\x00&#39; looking for beginning of value",id:"error-from-daemon-in-stream-error-grabbing-logs-invalid-character-x00-looking-for-beginning-of-value",level:2},{value:"Error saving credentials: error storing credentials - err: exit status 1, out: <code>User interaction is not allowed. (-25308)</code>",id:"error-saving-credentials-error-storing-credentials---err-exit-status-1-out-user-interaction-is-not-allowed--25308",level:2},{value:"change mount propagation through procfd",id:"change-mount-propagation-through-procfd",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"docker-faq",children:"Docker FAQ"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://gist.github.com/StevenACoffman/41fee08e8782b411a4a26b9700ad7af5",children:"Docker Best Practices"})}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u907F\u514D bind \u6587\u4EF6\uFF0C\u800C\u662F bind \u76EE\u5F55\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"bind \u6587\u4EF6\u662F\u8DDF\u8E2A inode, Host mv x.txt y.txt \u4F1A\u5BFC\u81F4\u6620\u5C04\u7684 y.txt \u6587\u4EF6 inode \u53D8\u5316, \u5BB9\u5668\u5185\u770B\u4E0D\u5230\u65B0\u7684\u5185\u5BB9"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker system df # \u67E5\u770B\u78C1\u76D8\u4F7F\u7528\u60C5\u51B5\n\n# \u907F\u514D\u65E5\u5FD7\u8FC7\u5927\ndocker run --log-opt max-size=10m --log-opt max-file=3 [\u4F60\u7684\u955C\u50CF\u540D]\n\n# Docker over SSH\ndocker context create svr --docker "host=ssh://admin@svr"\n\n# Docker transfer image over SSH\ndocker save image | ssh svr docker load\n\nssh -nNT -L /tmp/remote.docker.sock:/var/run/docker.sock user@host\nexport DOCKER_HOST="unix:///tmp/remote.docker.sock"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"host-ip",children:"Host IP"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"host.docker.internal"}),"\n",(0,s.jsx)(n.li,{children:"docker.for.mac.localhost"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"/sbin/ip route | awk '/default/ { print $3 }'\n\ngetent host.docker.internal\ngetent hosts docker.for.mac.localhost\n\ndocker network inspect bridge -f '{{range .IPAM.Config}}{{.Gateway}}{{end}}'\n\n# Docker in AWS\n# http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-data-retrieval\ncurl http://169.254.169.254/latest/meta-data/local-ipv4\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"getaddrinfo ENOTFOUND host.docker.internal\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53EA\u6709 Windows \u548C macOS \u5B9A\u4E49\u4E86 host.docker.internal"}),"\n",(0,s.jsx)(n.li,{children:"Linux \u4E0B host network \u76F4\u63A5\u4F7F\u7528 localhost"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.orbstack.dev/docker/domains",children:"https://docs.orbstack.dev/docker/domains"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"container-name.orb.local"}),"\n",(0,s.jsx)(n.li,{children:"service.project.orb.local"}),"\n",(0,s.jsxs)(n.li,{children:["\u672C\u5730\u53EF\u76F4\u63A5\u6253\u5F00 ",(0,s.jsx)(n.a,{href:"http://orb.local",children:"http://orb.local"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"env",children:"env"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["DOCKER_REGISTRY_URL\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["jenkins ",(0,s.jsx)(n.code,{children:"docker.withRegistry"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"DOCKER_REGISTRY_CREDENTIALS_ID"}),"\n",(0,s.jsx)(n.li,{children:"DOCKER_CONFIG=~/.docker"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/reference/commandline/cli/#environment-variables",children:"https://docs.docker.com/engine/reference/commandline/cli/#environment-variables"})}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"volume-bind-\u6587\u4EF6\u4E0D\u4F1A\u66F4\u65B0",children:"volume bind \u6587\u4EF6\u4E0D\u4F1A\u66F4\u65B0"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5C1D\u8BD5 bind \u76EE\u5F55\uFF0C\u4E0D\u8981 bind \u6587\u4EF6"}),"\n",(0,s.jsx)(n.li,{children:"\u6587\u4EF6 bind \u662F inode"}),"\n",(0,s.jsx)(n.li,{children:"\u56E0\u4E3A\u6709\u4E9B\u4FEE\u6539\u662F\u76F4\u63A5\u66FF\u4EE3\u6587\u4EF6\uFF0C\u5BFC\u81F4 inode \u53D8\u5316"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5728-docker-\u4E2D\u4F7F\u7528-docker",children:"\u5728 docker \u4E2D\u4F7F\u7528 docker"}),"\n",(0,s.jsx)(n.p,{children:"\u76F4\u63A5\u6620\u5C04 /var/run/docker.sock"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v /var/run/docker.sock:/var/run/docker.sock --name box wener/demo:test\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u975E-root-\u7ED1\u5B9A\u79C1\u6709\u7AEF\u53E3",children:"\u975E root \u7ED1\u5B9A\u79C1\u6709\u7AEF\u53E3"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E00\u822C\u6765\u8BF4\u6DFB\u52A0 CAP_NET_BIND_SERVICE \u5373\u53EF\uFF0C\u4F46\u662F\u5BF9\u975E root \u65E0\u6548"}),"\n",(0,s.jsxs)(n.li,{children:["\u8BBE\u7F6E sysctl ",(0,s.jsx)(n.code,{children:"net.ipv4.ip_unprivileged_port_start=0"})," \u5373\u53EF\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9700\u8981 kernel 4.11+"}),"\n",(0,s.jsx)(n.li,{children:"ubuntu 18+"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u505C\u6B62\u6240\u6709\u5BB9\u5668",children:"\u505C\u6B62\u6240\u6709\u5BB9\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker stop $(docker ps -aq)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u8FC1\u79FB\u6570\u636E\u76EE\u5F55",children:"\u8FC1\u79FB\u6570\u636E\u76EE\u5F55"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"/var/lib/docker \u5BF9 docker \u6027\u80FD\u5F71\u54CD\u8F83\u5927"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u505C\u6B62\u670D\u52A1\u8FC1\u79FB\u6570\u636E\nservice docker stop\nmkdir -p /data/docker\nsudo rsync -aP /var/lib/docker/ /data/docker/\n\n# \u6DFB\u52A0 data-root \u914D\u7F6E\n# { "data-root": "/data/docker" }\nnano /etc/docker/daemon.json\n\n# \u542F\u52A8\nservice docker start\n# \u67E5\u770B\u65B0\u7684\u914D\u7F6E\ndocker info | grep \'Root Dir\'\n\n# \u786E\u8BA4\u65E7\u7684\u76EE\u5F55\u6CA1\u6709\u88AB\u4F7F\u7528\napk add lsof\nlsof +D /var/lib/docker\n'})}),"\n",(0,s.jsx)(n.h2,{id:"no-swap-limit-support",children:"No swap limit support"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6DFB\u52A0\u5185\u6838\u53C2\u6570 ",(0,s.jsx)(n.code,{children:"cgroup_enable=memory swapaccount=1"})]}),"\n",(0,s.jsx)(n.li,{children:"\u727A\u7272 1% \u7684\u5185\u5BB9\uFF0C10% \u6027\u80FD\u6765\u652F\u6301\u5185\u5B58\u548C\u4EA4\u6362\u533A\u5BA1\u8BA1"}),"\n",(0,s.jsxs)(n.li,{children:["\u4E00\u822C ",(0,s.jsx)(n.code,{children:"cgroup_enable=memory"})," \u4F1A\u5F00\u542F\uFF0C\u4F46 ",(0,s.jsx)(n.code,{children:"swapaccount"})," \u4E0D\u5F00"]}),"\n",(0,s.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/config/containers/resource_constraints/",children:"Runtime options with Memory, CPUs, and GPUs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/install/linux-postinstall/#your-kernel-does-not-support-cgroup-swap-limit-capabilities",children:"Your kernel does not support cgroup swap limit capabilities"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4E3A\u5DF2\u7ECF\u8FD0\u884C\u7684-docker-\u5BB9\u5668\u6DFB\u52A0\u7AEF\u53E3\u6620\u5C04",children:"\u4E3A\u5DF2\u7ECF\u8FD0\u884C\u7684 Docker \u5BB9\u5668\u6DFB\u52A0\u7AEF\u53E3\u6620\u5C04"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"HOSTPORT=80\nCONTAINERIP=172.16.0.2\n\niptables -t nat -A DOCKER -p tcp --dport ${HOSTPORT} -j DNAT --to-destination ${CONTAINERIP}:${HOSTPORT}\niptables -t nat -A POSTROUTING -j MASQUERADE -p tcp --source ${CONTAINERIP} --destination ${CONTAINERIP} --dport ${HOSTPORT}\niptables -A DOCKER -j ACCEPT -p tcp --destination ${CONTAINERIP} --dport ${HOSTPORT}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"upper-fs-does-not-support-rename_whiteout",children:"upper fs does not support RENAME_WHITEOUT"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"zfs \u65E0\u6CD5\u8FD0\u884C docker overlay"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/openzfs/zfs/issues/8648",children:"openzfs/zfs#8648"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"docker-zfs-vol",children:"docker zfs vol"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"docker \u652F\u6301 zfs driver"}),"\n",(0,s.jsxs)(n.li,{children:["\u4F46\u662F\u6709\u4E9B\u95EE\u9898\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/moby/moby/issues/41055",children:"moby/moby#41055"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u5B9E\u5728\u9700\u8981\u53EF\u4EE5\u8003\u8651 zvol"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'mkdir -p /data/docker\n# -s sparse volume \u4E0D\u4FDD\u7559\u7A7A\u95F4\nzfs create -s -V 100GB main/docker-vol\nmkfs.ext4 /dev/zvol/main/docker-vol\nmount /dev/zvol/main/docker-vol /data/docker\n# \u6301\u4E45\u5316 mount\ntail -1 /proc/mounts | sudo tee -a /etc/fstab\n\n# \u505C\u670D\u52A1\u8FC1\u79FB\nservice docker stop\nsudo rsync -aP /var/lib/docker/ /data/docker/\n# { "data-root": "/data/docker" }\nnano /etc/docker/daemon.json\nservice docker start\n\n# \u67E5\u770B\u65B0\u7684\u914D\u7F6E\ndocker info | grep \'Root Dir\'\n\n# \u786E\u8BA4\u65E7\u7684\u76EE\u5F55\u6CA1\u6709\u88AB\u4F7F\u7528\napk add lsof\nlsof +D /var/lib/docker\n'})}),"\n",(0,s.jsx)(n.h2,{id:"driver-zfs-failed-to-remove-root-filesystem",children:'driver "zfs" failed to remove root filesystem'}),"\n",(0,s.jsxs)(n.p,{children:["\u4E00\u8FB9\u9000\u51FA\uFF0C\u53E6\u5916\u4E00\u8FB9\u8FD8\u5728\u64CD\u4F5C\u65F6\u53EF\u80FD\u51FA\u73B0\uFF0C\u4E4B\u540E\u518D\u6267\u884C ",(0,s.jsx)(n.code,{children:"docker rm"})," \u5373\u53EF\u3002"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679C ",(0,s.jsx)(n.code,{children:"docker rm"})," \u8FD8\u51FA\u73B0\u5F02\u5E38"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Error response from daemon: container 2736566eac14027e7bf708c2babe894f1978249fc4a674886e158d6aa886479a: driver "zfs" failed to remove root filesystem: exit status 1: "/usr/sbin/zfs fs destroy -r main/docker/9d56a9bde13e6a1d37c6af5a55057cc4a9fb8b684ff454ac25f415b70bc55d0d" => cannot open \'main/docker/9d56a9bde13e6a1d37c6af5a55057cc4a9fb8b684ff454ac25f415b70bc55d0d\': dataset does not exist\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5219\u53EF\u4EE5\u5148\u521B\u5EFA\u518D\u6267\u884C"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zfs create main/docker/9d56a9bde13e6a1d37c6af5a55057cc4a9fb8b684ff454ac25f415b70bc55d0d\ndocker rm container\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6CA1\u6743\u9650",children:"\u6CA1\u6743\u9650"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo adduser $USER docker\n"})}),"\n",(0,s.jsx)(n.h2,{id:"bridge-nf-call-iptables",children:"bridge-nf-call-iptables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",metastring:'title="/etc/sysctl.d/99-br_netfilter.conf"',children:"net.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo sysctl -p /etc/sysctl.d/99-br_netfilter.conf\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cannot-link-to-a-non-running-container",children:"Cannot link to a non running container"}),"\n",(0,s.jsx)(n.h2,{id:"docker-exporter-does-not-currently-support-exporting-manifest-lists",children:"docker exporter does not currently support exporting manifest lists"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u53EA\u80FD --push ",(0,s.jsx)(n.a,{href:"https://github.com/docker/buildx/issues/59",children:"docker/buildx#59"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"could-not-create-a-builder-instance-with-tls-data-loaded-from-environment",children:"could not create a builder instance with TLS data loaded from environment"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u53EA\u8981\u4E0D\u662F\u9ED8\u8BA4\u7684\u5C31\u884C\ndocker context create tls\ndocker buildx create --name multiarch-builder --driver docker-container --use tls\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/docker/buildx/issues/413",children:"https://github.com/docker/buildx/issues/413"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"docker_host-environment-variable-overrides-the-active-context-to-use-a-context-either-set-the-global---context-flag-or-unset-docker_host-environment-variable",children:"DOCKER_HOST environment variable overrides the active context. To use a context, either set the global --context flag, or unset DOCKER_HOST environment variable."}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-solve-with-frontend-dockerfilev0-failed-to-create-llb-definition-unexpected-status-code-manifests-latest-403-forbidden",children:"failed to solve with frontend dockerfile.v0: failed to create LLB definition: unexpected status code [manifests latest]: 403 Forbidden"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export DOCKER_BUILDKIT=0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"opentelemetry",children:"OpenTelemetry"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"io.containerd.tracing.processor.v1.otlp"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"docker_host-\u683C\u5F0F",children:"DOCKER_HOST \u683C\u5F0F"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["DOCKER_HOST\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"tcp://1.2.3.4:2375"}),"\n",(0,s.jsx)(n.li,{children:"unix:///var/run/docker.sock"}),"\n",(0,s.jsxs)(n.li,{children:["npipe:///./pipe/docker_engine\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Named Pipe"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"fd://1.2.3.4:5678"}),"\n",(0,s.jsx)(n.li,{children:"ssh://1.2.3.4:22"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"//host:port"})," -> ",(0,s.jsx)(n.code,{children:"tpc://"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"error-from-daemon-in-stream-error-grabbing-logs-invalid-character-x00-looking-for-beginning-of-valu",children:"error from daemon in stream: Error grabbing logs: invalid character '\\x00' looking for beginning of valu"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"for cont in $(docker container ps | cut -f1 -d\\  | grep -v CONTAINER); do\n  sudo truncate -s0 $(docker container inspect --format='{{.LogPath}}' $cont)\ndone\n\nsudo sh -c \"grep -Pa '\\x00' /var/lib/docker/containers/**/*json.log\"\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/docker/for-linux/issues/140",children:"https://github.com/docker/for-linux/issues/140"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"error-running-exec-in-container-failed-to-open-stdout-fifo-error-creating-fifo",children:"Error running exec in container: failed to open stdout fifo: error creating fifo"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Error running exec XXX in container: failed to open stdin fifo: error creating fifo /var/run/docker/containerd/XXX/XXX-stdin: no such file or directory\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/docker/for-linux/issues/1091",children:"https://github.com/docker/for-linux/issues/1091"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overlayfs-upper-fs-does-not-support-rename_whiteout",children:"overlayfs: upper fs does not support RENAME_WHITEOUT"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4FEE\u6539 /var/lib/docker \u6302\u5728\u4F4D\u7F6E"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"listing-workers-failed-to-list-workers-unavailable-connection-closed-before-server-preface-received",children:"listing workers: failed to list workers: Unavailable: connection closed before server preface received"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker buildx ls\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u91CD\u542F dind \u540E\u6062\u590D"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"multiple-platforms-feature-is-currently-not-supported-for-docker-driver-please-switch-to-a-different-driver",children:"multiple platforms feature is currently not supported for docker driver. Please switch to a different driver"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'multiple platforms feature is currently not supported for docker driver. Please switch to a different driver (eg. "docker buildx create --use")\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Multi-platform build is not supported for the docker driver\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker buildx create --name multiarch-builder --driver docker-container --use\n\ndocker buildx ls\n"})}),"\n",(0,s.jsx)(n.h2,{id:"docker-image-format-v1-and-docker-image-manifest-version-2",children:"Docker Image Format v1 and Docker Image manifest version 2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Docker Image Format v1 and Docker Image manifest version 2, schema 1 support is disabled by default and will be removed in an upcoming release\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://distribution.github.io/distribution/spec/deprecated-schema-v1/",children:"https://distribution.github.io/distribution/spec/deprecated-schema-v1/"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"nftables",children:"nftables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5BB9\u5668\u5185\u65E0\u6CD5\u8BBF\u95EE\u7F51\u7EDC"}),"\n",(0,s.jsx)(n.li,{children:"\u91CD\u542F docker \u670D\u52A1\u4E00\u822C\u80FD\u6062\u590D"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo service docker restart # ensure docker network rules are loaded\n\n# \u65B9\u6848 1. \u8FC1\u79FB docker \u76F8\u5173\u914D\u7F6E\u5230 nftables\nsudo iptables-save > legacy-rules.txt\niptables-restore-translate -f legacy-rules.txt\n# \u8C03\u6574\u540E\u5C06\u5185\u5BB9\u653E\u5230 /etc/nftables.d/docker.nft\n# nftables reload now works\n\n# \u65B9\u6848 2. \u8BA9 nftables \u548C iptables \u540C\u65F6\u5B58\u5728\napk add iptables-legacy\nmodprobe ip_tables\nmodprobe ip6_tables\n\nlsmod | grep -E '^[^_]+_tables'\n\niptables -V # nf_tables\n\niptables-legacy -L # \u6CA1\u6709\u5185\u5BB9 - \u8BF4\u660E docker \u7528\u7684 nft \u7248\u672C\n\n# \u76F8\u5F53\u4E8E\u662F iptables-nft\nrealpath $(which iptables)        # /sbin/xtables-nft-multi\nrealpath $(which iptables-legacy) # /sbin/xtables-legacy-multi\n# ln -s /sbin/xtables-nft-multi /sbin/iptables\n\nln -fs /sbin/xtables-legacy-multi /sbin/iptables\n\nservice nftables reload # \u91CD\u7F6E nftables \u89C4\u5219\nservice docker restart  # \u91CD\u542F docker\niptables -L             # \u5B58\u5728\u65B0\u7684 DOCKER \u89C4\u5219\n\n# \u8FD9\u6837\u8FC7\u540E iptable \u6CA1\u95EE\u9898\u4F46\u662F\u5BB9\u5668\u5185\u65E0\u6CD5\u8BBF\u95EE\u7F51\u7EDC\n\n# check network\ndocker run --rm -it wener/base nslookup example.com\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"revert"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ln -fs /sbin/xtables-nft-multi /sbin/iptables\n\nsudo iptables-legacy -t nat -F\nsudo iptables-legacy -t nat -X\nsudo iptables-legacy -t mangle -F\nsudo iptables-legacy -t mangle -X\nsudo iptables-legacy -F\nsudo iptables-legacy -X\n\nsudo iptables-legacy-save # \u9A8C\u8BC1\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Debian/Ubuntu"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo update-alternatives --set iptables /usr/sbin/iptables-legacy\nsudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy\nsudo update-alternatives --set arptables /usr/sbin/arptables-legacy\nsudo update-alternatives --set ebtables /usr/sbin/ebtables-legacy\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["dind\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"DOCKER_IPTABLES_LEGACY"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/docker-library/docker/blob/fbb79dd2512681b42f6f0a3a82543c29640b85ce/dockerd-entrypoint.sh#L147-L165",children:"https://github.com/docker-library/docker/blob/fbb79dd2512681b42f6f0a3a82543c29640b85ce/dockerd-entrypoint.sh#L147-L165"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"AlpineLinux 3.19 \u540E iptables \u9ED8\u8BA4\u4E3A\u4E86 nft"}),"\n",(0,s.jsxs)(n.li,{children:["docker nft\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E3B\u8981\u662F\u7528 table ip filter \u548C table ip nat"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/containers/podman/issues/24486",children:"https://github.com/containers/podman/issues/24486"})}),"\n",(0,s.jsxs)(n.li,{children:["Native support for nftables ",(0,s.jsx)(n.a,{href:"https://github.com/docker/for-linux/issues/1472#issuecomment-2189535038",children:"https://github.com/docker/for-linux/issues/1472#issuecomment-2189535038"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/docker-library/docker/issues/467",children:"https://github.com/docker-library/docker/issues/467"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/moby/libnetwork/issues/2331",children:"https://github.com/moby/libnetwork/issues/2331"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.going-flying.com/blog/docker-and-nftables.html",children:"https://www.going-flying.com/blog/docker-and-nftables.html"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"no-chaintargetmatch-by-that-name",children:"No chain/target/match by that name"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u901A\u5E38\u662F\u56E0\u4E3A\u4F7F\u7528\u4E86 nftables\uFF0C nftables reload \u6E05\u6389\u4E86 iptables \u89C4\u5219"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"failed to create network service: Error response from daemon: Failed to Setup IP tables: Unable to enable SKIP DNAT rule:  (iptables failed: iptables --wait -t nat -I DOCKER -i br-3918c98566e1 -j RETURN: iptables: No chain/target/match by that name.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"docker-kill-signal",children:"docker kill signal"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Non-fatal signals break restart policies ",(0,s.jsx)(n.a,{href:"https://github.com/moby/moby/issues/11065",children:"#11065"})]}),"\n",(0,s.jsxs)(n.li,{children:["Signal breaks unless-stopped restart policy ",(0,s.jsx)(n.a,{href:"https://github.com/moby/moby/issues/41302",children:"#41302"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u53EA\u6709 restart=alway \u5F3A\u5236\u91CD\u542F\u7684\u53EF\u4EE5\ndocker kill --signal=SIGHUP service\n\n# workaround\ndocker exec service -- kill -s HUP 1\n\n# test \u4E0D\u4F1A\u91CD\u542F\ndocker run -d --name=test --restart=unless-stopped nginx\ndocker kill -s HUP test\n"})}),"\n",(0,s.jsx)(n.p,{children:"from scratch \u7684\u5BB9\u5668\u6CA1\u6709 kill, \u56E0\u6B64\u65E0\u6CD5\u4F7F\u7528\u4FE1\u53F7"}),"\n",(0,s.jsx)(n.h2,{id:"error-from-daemon-in-stream-error-grabbing-logs-invalid-character-x00-looking-for-beginning-of-value",children:"error from daemon in stream: Error grabbing logs: invalid character '\\x00' looking for beginning of value"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose down\ndocker compose up -d\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"error-saving-credentials-error-storing-credentials---err-exit-status-1-out-user-interaction-is-not-allowed--25308",children:["Error saving credentials: error storing credentials - err: exit status 1, out: ",(0,s.jsx)(n.code,{children:"User interaction is not allowed. (-25308)"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"unlock keychain"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u901A\u8FC7 SSH \u8FDE\u63A5\u65F6\u53EF\u80FD\u4F1A\u51FA\u73B0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5148 unlock \u518D login\nsecurity unlock-keychain\ndocker login\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E0D\u4F7F\u7528 docker-desktop \u4F5C\u4E3A credsStore"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u79FB\u9664 ~/.docker/config.json \u4E2D\u7684 ",(0,s.jsx)(n.code,{children:'"credsStore": "desktop"'})]}),"\n",(0,s.jsx)(n.h2,{id:"change-mount-propagation-through-procfd",children:"change mount propagation through procfd"}),"\n",(0,s.jsx)(n.p,{children:"\u662F\u56E0\u4E3A\u5B9A\u4E49\u4E86 Volume \u4F46\u662F\u6302\u8F7D\u7684\u4F4D\u7F6E\u6CA1\u6709\u914D\u7F6E\u5BF9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting "/data/wener/postgres/data" to rootfs at "/var/lib/postgresql/data": change mount propagation through procfd: open o_path procfd: open /var/lib/docker/overlay2/3bf68d0318bef526ef74ace5351a73e876f7ce22cdd08cce88bc77d499c10529/merged/var/lib/postgresql/data: no such file or directory: unknown\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["18+\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"/var/lib/postgresql/18/docker"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u4E4B\u524D /var/lib/postgresql/data"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - ./postgres/data:/var/lib/postgresql/\n"})})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},917776:function(e,n,r){r.d(n,{R:()=>t,x:()=>l});var i=r(7378);let s={},o=i.createContext(s);function t(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);