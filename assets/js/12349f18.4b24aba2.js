"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["819310"],{19972:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>c,toc:()=>o,default:()=>u,metadata:()=>s,assets:()=>d,contentTitle:()=>l});var s=JSON.parse('{"id":"queue/nats/nats-k8s","title":"Nats on K8S","description":"| port | for       |","source":"@site/../notes/queue/nats/nats-k8s.md","sourceDirName":"queue/nats","slug":"/queue/nats/k8s","permalink":"/notes/queue/nats/k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/queue/nats/nats-k8s.md","tags":[{"inline":true,"label":"Kubernetes","permalink":"/notes/tags/kubernetes"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1647510739000,"frontMatter":{"tags":["Kubernetes"]},"sidebar":"docs","previous":{"title":"NATS JetStream","permalink":"/notes/queue/nats/jetstream"},"next":{"title":"KV","permalink":"/notes/queue/nats/kv"}}'),r=t(486106),a=t(917776);let c={tags:["Kubernetes"]},l="Nats on K8S",d={},o=[{value:"setup nats resolver",id:"setup-nats-resolver",level:2}];function i(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"nats-on-k8s",children:"Nats on K8S"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"port"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"443"}),(0,r.jsx)(e.td,{children:"websocket"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"4222"}),(0,r.jsx)(e.td,{children:"client"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"6222"}),(0,r.jsx)(e.td,{children:"cluster"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"8222"}),(0,r.jsx)(e.td,{children:"monitor"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"7777"}),(0,r.jsx)(e.td,{children:"metrics"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"7422"}),(0,r.jsx)(e.td,{children:"leafnodes"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"7522"}),(0,r.jsx)(e.td,{children:"gateways"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"1883"}),(0,r.jsx)(e.td,{children:"mqtt"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"setup-nats-resolver",children:"setup nats resolver"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/nats-io/k8s/tree/main/helm/charts/nats#nats-resolver-setup-example",children:"https://github.com/nats-io/k8s/tree/main/helm/charts/nats#nats-resolver-setup-example"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",metastring:'title="setup-nsc"',children:'[ -z "$NKEYS_PATH" ] && {\n    export NKEYS_PATH=$(pwd)/nsc/nkeys\n}\n\n[ -z "$NSC_HOME" ] && {\n    export NSC_HOME=$(pwd)/nsc/accounts\n}\n\nif [ ! -f .nsc.env ]; then\n  echo \'\n# NSC Environment Setup\nexport NKEYS_PATH=$(pwd)/nsc/nkeys\nexport NSC_HOME=$(pwd)/nsc/accounts\n\' > .nsc.env\nfi\n\nmkdir -p "$NKEYS_PATH"\nmkdir -p "$NSC_HOME"\nnsc add operator --name KO\n\n# Create system account\nnsc add account --name SYS\nnsc add user    --name sys\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"nsc generate config --sys-account SYS --nats-resolver\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"auth:\n  enabled: true\n\n  timeout: '5s'\n\n  resolver:\n    type: full\n\n    operator: #\n\n    systemAccount: #\n\n    store:\n      dir: '/etc/nats-config/accounts/jwt'\n      size: '1Gi'\n\n    resolverPreload:\n      #: #\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"helm install\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# port forward\nkubectl -n nats port-forward svc/nats 4222:4222\n\n# for JetStream\naccount=JS1\nnsc add account  --name $account\nnsc edit account --name $account --js-disk-storage -1 --js-consumer -1 --js-streams -1\nnsc add user -a $account js-user\n\n# Upload\nnsc push --system-account SYS -u nats://localhost:4222 -A\n# \u6D4B\u8BD5\nnats stream ls -s localhost --creds ./nsc/nkeys/creds/KO/JS1/js-user.creds\n\n# nats protocol\nnsc tool rtt --nats nats://localhost:4222\n# websocket\nnsc tool rtt --nats wss://nats.example.com:443\n"})})]})}function u(n={}){let{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(i,{...n})}):i(n)}},917776:function(n,e,t){t.d(e,{R:()=>c,x:()=>l});var s=t(7378);let r={},a=s.createContext(r);function c(n){let e=s.useContext(a);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);