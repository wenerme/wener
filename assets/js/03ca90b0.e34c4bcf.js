"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["52630"],{86793:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>a,toc:()=>s,default:()=>p,metadata:()=>t,assets:()=>o,contentTitle:()=>i});var t=JSON.parse('{"id":"platform/replicate","title":"replicate","description":"- [replicate/cog](https://github.com/replicate/c","source":"@site/../notes/platform/replicate.md","sourceDirName":"platform","slug":"/platform/replicate","permalink":"/notes/platform/replicate","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/platform/replicate.md","tags":[{"inline":true,"label":"Serverless","permalink":"/notes/tags/serverless"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1749531424000,"frontMatter":{"tags":["Serverless"]},"sidebar":"docs","previous":{"title":"\u817E\u8BAF\u4E91","permalink":"/notes/platform/qcloud"},"next":{"title":"RunPod","permalink":"/notes/platform/runpod"}}'),c=r(486106),l=r(917776);let a={tags:["Serverless"]},i="replicate",o={},s=[{value:"hexiaochun/pp-ocr-v4",id:"hexiaochunpp-ocr-v4",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"replicate",children:"replicate"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["[replicate/cog](",(0,c.jsx)(n.a,{href:"https://github.com/replicate/c",children:"https://github.com/replicate/c"}),"\nog)\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Apache-2.0, Go, Python, Docker"}),"\n",(0,c.jsx)(n.li,{children:"\u7528\u4E8E\u673A\u5668\u5B66\u4E60\u6A21\u578B\u7684\u90E8\u7F72\u548C\u8FD0\u884C"}),"\n",(0,c.jsx)(n.li,{children:"\u652F\u6301\u591A\u79CD\u6A21\u578B\u683C\u5F0F"}),"\n",(0,c.jsx)(n.li,{children:"\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7B80\u5355\u7684 API \u6765\u8FD0\u884C\u6A21\u578B"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://replicate.com/microsoft/omniparser-v2",children:"https://replicate.com/microsoft/omniparser-v2"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"$0.0017 / run"}),"\n",(0,c.jsx)(n.li,{children:"$1.00 / 588 runs"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://replicate.com/black-forest-labs/flux-kontext-pro",children:"https://replicate.com/black-forest-labs/flux-kontext-pro"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"$0.04 / run"}),"\n",(0,c.jsx)(n.li,{children:"$1.00 / 25 runs"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["PaddleOCR v4 ",(0,c.jsx)(n.a,{href:"https://replicate.com/hexiaochun/pp-ocr-v4",children:"https://replicate.com/hexiaochun/pp-ocr-v4"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# crane \u80FD\u83B7\u53D6 image \u5927\u5C0F\n# 7.5G\ncrane manifest r8.im/hexiaochun/pp-ocr-v4@sha256:084b779cb09bc2462335a5768fabaeaaba53bb3f70afd0d2fe48fad71fdc4d5a | jq '.config.size + ([.layers[].size] | add)' | numfmt --to=iec\n# 11G\ncrane manifest r8.im/microsoft/omniparser-v2@sha256:49cf3d41b8d3aca1360514e83be4c97131ce8f0d99abfc365526d8384caa88df | jq '.config.size + ([.layers[].size] | add)' | numfmt --to=iec\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["/src\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"predictor.py"}),"\n",(0,c.jsx)(n.li,{children:"cog.yaml"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"hexiaochunpp-ocr-v4",children:"hexiaochun/pp-ocr-v4"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"build:\n  gpu: true\n  python_version: '3.9'\n  system_packages:\n    - ffmpeg # Required for video processing\n  python_packages:\n    - pillow\n  run:\n    - pip install --default-timeout=1000 paddlepaddle-gpu\n    - pip install paddleocr\n    - mkdir -p /root/.paddleocr/whl/cls/ch_ppocr_mobile_v2.0_cls_infer # \u5148\u521B\u5EFA\u76EE\u5F55\n    - wget -O /root/.paddleocr/whl/cls/ch_ppocr_mobile_v2.0_cls_infer/ch_ppocr_mobile_v2.0_cls_infer.tar https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar\n    - tar -xvf /root/.paddleocr/whl/cls/ch_ppocr_mobile_v2.0_cls_infer/ch_ppocr_mobile_v2.0_cls_infer.tar -C /root/.paddleocr/whl/cls/ch_ppocr_mobile_v2.0_cls_infer\n    - mkdir -p /root/.paddleocr/whl/det/ch/ch_PP-OCRv4_det_infer # \u521B\u5EFA\u76EE\u5F55\n    - wget -O /root/.paddleocr/whl/det/ch/ch_PP-OCRv4_det_infer/ch_PP-OCRv4_det_infer.tar https://paddleocr.bj.bcebos.com/PP-OCRv4/chinese/ch_PP-OCRv4_det_infer.tar\n    - tar -xvf /root/.paddleocr/whl/det/ch/ch_PP-OCRv4_det_infer/ch_PP-OCRv4_det_infer.tar -C /root/.paddleocr/whl/det/ch/ch_PP-OCRv4_det_infer\n    - mkdir -p /root/.paddleocr/whl/rec/ch/ch_PP-OCRv4_rec_infer # \u521B\u5EFA\u76EE\u5F55\n    - wget -O /root/.paddleocr/whl/rec/ch/ch_PP-OCRv4_rec_infer/ch_PP-OCRv4_rec_infer.tar https://paddleocr.bj.bcebos.com/PP-OCRv4/chinese/ch_PP-OCRv4_rec_infer.tar\n    - tar -xvf /root/.paddleocr/whl/rec/ch/ch_PP-OCRv4_rec_infer/ch_PP-OCRv4_rec_infer.tar -C /root/.paddleocr/whl/rec/ch/ch_PP-OCRv4_rec_infer\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-py",children:'from cog import BasePredictor, Input, Path\nfrom paddleocr import PaddleOCR, draw_ocr\nfrom PIL import Image\n\nclass Predictor(BasePredictor):\n    def setup(self):\n        # Load the PaddleOCR model once during setup\n        self.lang = \'ch\'  # Save the default language\n        self.ocr = PaddleOCR(use_angle_cls=True, lang=self.lang)  # Load the model with the default language\n\n    def predict(self, image: Path = Input(description="Input image file"), lang: str = Input(description="Language model", default="ch")) -> dict:\n        # Update the language if different from the loaded model\n        if self.lang != lang:\n            self.ocr = PaddleOCR(use_angle_cls=True, lang=lang)\n            self.lang = lang  # Update the current language\n\n        # Perform OCR on the image\n        result = self.ocr.ocr(str(image), cls=True)\n\n        # Extract results\n        extracted_data = []\n        for res in result:\n            for line in res:\n                box = line[0]\n                text = line[1][0]\n                confidence = line[1][1]\n                extracted_data.append({\n                    "box": box,\n                    "text": text,\n                    "confidence": confidence\n                })\n\n        # Return the OCR results\n        return {"results": extracted_data}\n'})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'curl -s -X POST \\\n  -H "Content-Type: application/json" \\\n  -d $\'{\n    "input": {\n      "lang": "ch",\n      "image": "https://replicate.delivery/pbxt/LU2RNiJHWHYLMvsZZjGktBFFVUB3OYR49mzp20Mln3WNPznP/output.jpg"\n    }\n  }\' \\\n  http://localhost:5000/predictions\n'})})]})}function p(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},917776:function(e,n,r){r.d(n,{R:()=>a,x:()=>i});var t=r(7378);let c={},l=t.createContext(c);function a(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);