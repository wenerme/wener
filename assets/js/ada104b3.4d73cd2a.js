"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["722336"],{772023:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>l,assets:()=>c,contentTitle:()=>d});var l=JSON.parse('{"id":"ai/dev/litellm/litellm-insight","title":"LiteLLM Inside","description":"- \u4EF7\u683C\u4FE1\u606F","source":"@site/../notes/ai/dev/litellm/litellm-insight.md","sourceDirName":"ai/dev/litellm","slug":"/ai/dev/litellm/insight","permalink":"/notes/ai/dev/litellm/insight","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/ai/dev/litellm/litellm-insight.md","tags":[{"inline":true,"label":"Inside","permalink":"/notes/tags/inside"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1769354203000,"frontMatter":{"tags":["Inside"]},"sidebar":"docs","previous":{"title":"LiteLLM","permalink":"/notes/ai/dev/litellm/"},"next":{"title":"llama-swap","permalink":"/notes/ai/dev/llama-swap"}}'),t=s(486106),i=s(917776);let r={tags:["Inside"]},d="LiteLLM Inside",c={},a=[{value:"cache",id:"cache",level:2},{value:"semantic cache",id:"semantic-cache",level:2},{value:"config.yaml",id:"configyaml",level:2},{value:"\u53C2\u8003",id:"\u53C2\u8003",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"litellm-inside",children:"LiteLLM Inside"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4EF7\u683C\u4FE1\u606F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json",children:"https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Header"}),(0,t.jsx)(n.th,{children:"For"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Request"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-timeout: <seconds>"})}),(0,t.jsx)(n.td,{children:"\u8BF7\u6C42\u8D85\u65F6\u8BBE\u7F6E"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-stream-timeout: <seconds>"})}),(0,t.jsx)(n.td,{children:"\u7B2C\u4E00\u4E2A Chunk \u8D85\u65F6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-enable-message-redaction: <boolean>"})}),(0,t.jsx)(n.td,{children:"\u542F\u7528\u6D88\u606F\u5185\u5BB9\u5C4F\u853D"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-tags: <tag1,tag2,...>"})}),(0,t.jsx)(n.td,{children:"\u8BF7\u6C42\u6807\u7B7E"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-num-retries: <number>"})}),(0,t.jsx)(n.td,{children:"\u8BF7\u6C42\u91CD\u8BD5\u6B21\u6570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-spend-logs-metadata: <json>"})}),(0,t.jsx)(n.td,{children:"\u8BF7\u6C42\u5F00\u9500\u65E5\u5FD7\u5143\u6570\u636E"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Request/Anthropic"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"anthropic-version: <str>"})}),(0,t.jsx)(n.td,{children:"API version"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"anthropic-beta: <str>"})}),(0,t.jsx)(n.td,{children:"beta version"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Request/OpenAI"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"openai-organization: <str>"})}),(0,t.jsx)(n.td,{children:"organization id"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Request/Bypass"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-*"})}),(0,t.jsx)(n.td,{children:"\u9700\u8981\u914D\u7F6E forward_client_headers_to_llm_api"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Response/Rate Limit"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-remaining-requests: <int>"})}),(0,t.jsx)(n.td,{children:"\u5269\u4F59\u53EF\u7528\u8BF7\u6C42\u6570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-remaining-tokens: <int>"})}),(0,t.jsx)(n.td,{children:"\u5269\u4F59\u53EF\u7528token\u6570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-limit-requests: <int>"})}),(0,t.jsx)(n.td,{children:"\u6700\u5927\u8BF7\u6C42\u6570\u9650\u5236"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-limit-tokens: <int>"})}),(0,t.jsx)(n.td,{children:"\u6700\u5927token\u6570\u9650\u5236"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-reset-requests: <int>"})}),(0,t.jsx)(n.td,{children:"\u8BF7\u6C42\u9650\u5236\u91CD\u7F6E\u65F6\u95F4"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-ratelimit-reset-tokens: <int>"})}),(0,t.jsx)(n.td,{children:"token\u9650\u5236\u91CD\u7F6E\u65F6\u95F4"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Response/Latency"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-response-duration-ms: <float>"})}),(0,t.jsx)(n.td,{children:"\u4ECE\u8BF7\u6C42\u5230\u54CD\u5E94\u7684\u603B\u8017\u65F6(\u6BEB\u79D2)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-overhead-duration-ms: <float>"})}),(0,t.jsx)(n.td,{children:"LiteLLM\u5904\u7406\u5F00\u9500\u65F6\u95F4(\u6BEB\u79D2)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Response/Retry&Fallback"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-attempted-retries: <int>"})}),(0,t.jsx)(n.td,{children:"\u5B9E\u9645\u91CD\u8BD5\u6B21\u6570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-attempted-fallbacks: <int>"})}),(0,t.jsx)(n.td,{children:"\u5B9E\u9645\u56DE\u9000\u6B21\u6570"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-max-fallbacks: <int>"})}),(0,t.jsx)(n.td,{children:"\u6700\u5927\u56DE\u9000\u6B21\u6570\u9650\u5236"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Response/Cost"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-response-cost: <float>"})}),(0,t.jsx)(n.td,{children:"API\u8C03\u7528\u8D39\u7528"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-litellm-key-spend: <float>"})}),(0,t.jsx)(n.td,{children:"API\u5BC6\u94A5\u603B\u6D88\u8D39"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Response/Bypass"})}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"llm_provider-*"})}),(0,t.jsx)(n.td,{children:"\u900F\u4F20LLM\u63D0\u4F9B\u5546\u7684\u54CD\u5E94\u5934"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="spend-logs-metadata"',children:'{ "user_id": "12345", "project_id": "proj_abc", "request_type": "chat_completion" }\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cache",children:"cache"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7528\u4E8E\u9AD8\u9891\u76F8\u540C\u95EE\u9898\u573A\u666F"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'${namespace}:${sha256("model:${model}+messages+paramrs")}'})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"semantic-cache",children:"semantic cache"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["messages \u2192 embedding\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4E0D\u540C\u63AA\u8F9E\u4F46\u610F\u601D\u76F8\u8FD1\u7684\u95EE\u9898"}),"\n",(0,t.jsx)(n.li,{children:"\u964D\u4F4E LLM \u8C03\u7528\u6210\u672C"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u652F\u6301\u5B58\u50A8\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Redis, RedisVL\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/redis/redis-vl-python",children:"https://github.com/redis/redis-vl-python"})}),"\n",(0,t.jsx)(n.li,{children:"litellm_semantic_cache_index"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Qdrant"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "id": "uuid",\n  "vector": [],\n  "payload": {\n    "text": "prompt",\n    "response": "value"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"litellm_settings:\n  cache: true\n  cache_params:\n    type: qdrant-semantic\n    qdrant_collection_name: 'cache_tenant_${team_id}'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configyaml",children:"config.yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"include:\n  - model_config.yaml\n\nmodel_list: []\nlitellm_settings:\n  num_retries: 3 # retry call 3 times on each model_name (e.g. zephyr-beta)\n  request_timeout: 10 # raise Timeout error if call takes longer than 10s. Sets litellm.request_timeout\n  fallbacks: [{ 'zephyr-beta': ['gpt-4o'] }] # fallback to gpt-4o if call fails num_retries\n  context_window_fallbacks: [{ 'zephyr-beta': ['gpt-3.5-turbo-16k'] }, { 'gpt-4o': ['gpt-3.5-turbo-16k'] }] # fallback to gpt-3.5-turbo-16k if context window error\n  allowed_fails: 3 # cooldown model if it fails > 1 call in a minute.\nrouter_settings: # router_settings are optional\n  routing_strategy: simple-shuffle # Literal[\"simple-shuffle\", \"least-busy\", \"usage-based-routing\",\"latency-based-routing\"], default=\"simple-shuffle\"\n  model_group_alias: { 'gpt-4': 'gpt-4o' } # all requests with `gpt-4` will be routed to models with `gpt-4o`\n  num_retries: 2\n  timeout: 30 # 30 seconds\n  redis_host: <your redis host> # set this when using multiple litellm proxy deployments, load balancing state stored in redis\n  redis_password: <your redis password>\n  redis_port: 1992\ngeneral_settings: {}\nenvironment_variables: {}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"model_list:\n  - model_name: glm-4.5\n    litellm_params:\n      model: openai/glm-4.5\n      litellm_credential_name: zhipu_credential\n\n  - model_name: glm-4.5-air\n    litellm_params:\n      model: openai/glm-4.5-air\n      litellm_credential_name: zhipu_credential\n\n  - model_name: '*'\n    litellm_params:\n      model: openai/glm-4.5-air\n      litellm_credential_name: zhipu_credential\n\ncredential_list:\n  - credential_name: zhipu_credential\n    credential_values:\n      api_base: os.environ/ZHIPU_API_BASE\n      api_key: os.environ/ZHIPU_API_KEY\n    credential_info:\n      description: '\u667A\u666E'\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u652F\u6301\u901A\u914D\u7B26"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"model_list:\n  - model_name: xai/*\n    litellm_params:\n      model: xai/*\n      api_key: os.environ/XAI_API_KEY\n\nlitellm_settings:\n  check_provider_endpoint: true\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# params for litellm.completion() - https://docs.litellm.ai/docs/completion/input#input---request-body\nlitellm_params:\n  model: openai/facebook/opt-125m\n  api_base: http://0.0.0.0:4000/v1\n  api_key: none\n  api_version: '2023-05-15'\n  rpm: 60 # Optional[int]: When rpm/tpm set - litellm uses weighted pick for load balancing. rpm = Rate limit for this deployment: in requests per minute (rpm).\n  tpm: 1000 # Optional[int]: tpm = Tokens Per Minute\n  azure_ad_token: ''\n  seed: 1234\n  max_token: 1024\n  temperature: 0.2\n  organization: 'org-12345'\n  aws_region_name: 'us-west-2'\n  extra_headers: { 'AI-Resource Group': 'ishaan-resource' }\nmodel_info:\n  version: 2\n  access_groups: ['restricted-models']\n  supported_environments: ['development', 'production', 'staging']\n  custom_tokenizer:\n    identifier: deepseek-ai/DeepSeek-V3-Base\n    revision: main\n    auth_token: os.environ/HUGGINGFACE_API_KEY\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.litellm.ai/docs/proxy/configs",children:"https://docs.litellm.ai/docs/proxy/configs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.litellm.ai/docs/proxy/config_settings",children:"https://docs.litellm.ai/docs/proxy/config_settings"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u53C2\u8003",children:"\u53C2\u8003"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.litellm.ai/docs/proxy/request_headers",children:"https://docs.litellm.ai/docs/proxy/request_headers"})}),"\n",(0,t.jsxs)(n.li,{children:["Anthropic\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Beta header\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.claude.com/en/api/beta-headers",children:"https://docs.claude.com/en/api/beta-headers"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Features"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.claude.com/en/docs/build-with-claude/overview",children:"https://docs.claude.com/en/docs/build-with-claude/overview"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},917776:function(e,n,s){s.d(n,{R:()=>r,x:()=>d});var l=s(7378);let t={},i=l.createContext(t);function r(e){let n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);