"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["13105"],{48848:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>r,toc:()=>l,default:()=>d,metadata:()=>o,assets:()=>s,contentTitle:()=>c});var o=JSON.parse('{"id":"os/linux/network/nftables/nftables-cookbook","title":"NFTables Cookbook","description":"- \u53C2\u8003","source":"@site/../notes/os/linux/network/nftables/nftables-cookbook.md","sourceDirName":"os/linux/network/nftables","slug":"/os/linux/network/nftables/cookbook","permalink":"/notes/os/linux/network/nftables/cookbook","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/network/nftables/nftables-cookbook.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1739157197000,"frontMatter":{"title":"NFTables Cookbook"},"sidebar":"docs","previous":{"title":"NFTables","permalink":"/notes/os/linux/network/nftables/"},"next":{"title":"nftables \u89C4\u5219","permalink":"/notes/os/linux/network/nftables/rule"}}'),i=t(86106),a=t(17776);let r={title:"NFTables Cookbook"},c="NFTables Cookbook",s={},l=[{value:"docker iptables",id:"docker-iptables",level:2},{value:"\u9632\u706B\u5899\u529F\u80FD",id:"\u9632\u706B\u5899\u529F\u80FD",level:2},{value:"\u57FA\u7840 NAT \u529F\u80FD",id:"\u57FA\u7840-nat-\u529F\u80FD",level:2}];function p(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"nftables-cookbook",children:"NFTables Cookbook"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes",children:"Quick reference-nftables in 10 minutes"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wiki.gentoo.org/wiki/Nftables/Examples",children:"Nftables/Examples"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_(NAT)",children:"Performing Network Address Translation (NAT)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"docker-iptables",children:"docker iptables"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"docker \u4F7F\u7528 iptables \u521B\u5EFA\u7684\u57FA\u7840\u89C4\u5219"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nft",children:'# Warning: table ip nat is managed by iptables-nft, do not touch!\ntable ip nat {\n	chain DOCKER {\n		iifname "docker0" counter packets 0 bytes 0 return\n	}\n\n	chain POSTROUTING {\n		type nat hook postrouting priority srcnat; policy accept;\n		ip saddr 172.17.0.0/16 oifname != "docker0" counter packets 0 bytes 0 xt target "MASQUERADE"\n	}\n\n	chain PREROUTING {\n		type nat hook prerouting priority dstnat; policy accept;\n		xt match "addrtype" counter packets 472 bytes 25650 jump DOCKER\n	}\n\n	chain OUTPUT {\n		type nat hook output priority dstnat; policy accept;\n		ip daddr != 127.0.0.0/8 xt match "addrtype" counter packets 0 bytes 0 jump DOCKER\n	}\n}\n# Warning: table ip filter is managed by iptables-nft, do not touch!\ntable ip filter {\n	chain DOCKER {\n	}\n\n	chain DOCKER-ISOLATION-STAGE-1 {\n		iifname "docker0" oifname != "docker0" counter packets 0 bytes 0 jump DOCKER-ISOLATION-STAGE-2\n		counter packets 31697 bytes 12130383 return\n	}\n\n	chain DOCKER-ISOLATION-STAGE-2 {\n		oifname "docker0" counter packets 0 bytes 0 drop\n		counter packets 0 bytes 0 return\n	}\n\n	chain FORWARD {\n		type filter hook forward priority filter; policy accept;\n		counter packets 31681 bytes 12128929 jump DOCKER-USER\n		counter packets 31684 bytes 12129109 jump DOCKER-ISOLATION-STAGE-1\n		oifname "docker0" xt match "conntrack" counter packets 0 bytes 0 accept\n		oifname "docker0" counter packets 0 bytes 0 jump DOCKER\n		iifname "docker0" oifname != "docker0" counter packets 0 bytes 0 accept\n		iifname "docker0" oifname "docker0" counter packets 0 bytes 0 accept\n	}\n\n	chain DOCKER-USER {\n		counter packets 31682 bytes 12130415 return\n	}\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u9632\u706B\u5899\u529F\u80FD",children:"\u9632\u706B\u5899\u529F\u80FD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nft",children:'table ip filter {\n  # \u5141\u8BB8\u672C\u5730\u8BF7\u6C42\n	chain output {\n		type filter hook output priority 100; policy accept;\n	}\n\n  # \u5141\u8BB8\u5C40\u57DF\u7F51\u5230 fw\uFF0C\u4E0D\u5141\u8BB8 WAN \u5230 fw\n	chain input {\n		type filter hook input priority 0; policy accept;\n		iifname "lan0" accept\n		iifname "wan0" drop\n	}\n\n  # \u5141\u8BB8 LAN \u8BF7\u6C42 WAN - \u5141\u8BB8 WAN \u56DE\u5E94 LAN \u8BF7\u6C42\n	chain forward {\n		type filter hook forward priority 0; policy drop;\n		iifname "lan0" oifname "wan0" accept\n		iifname "wan0" oifname "lan0" ct state related,established accept\n	}\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u57FA\u7840-nat-\u529F\u80FD",children:"\u57FA\u7840 NAT \u529F\u80FD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'table ip nat {\n	chain prerouting {\n		type nat hook prerouting priority 0; policy accept;\n	}\n\n  # \u4ECE WAN \u51FA\u7684\u5305\uFF0C\u5728\u7ED3\u675F\u8DEF\u7531\u540E\u66FF\u6362 \u6765\u6E90\u5730\u5740 \u4E3A wan0 \u7684\u4E3B\u8981\u5730\u5740\n	chain postrouting {\n		type nat hook postrouting priority 100; policy accept;\n		oifname "wan0" masquerade\n	}\n}\n'})})]})}function d(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},17776:function(e,n,t){t.d(n,{R:()=>r,x:()=>c});var o=t(7378);let i={},a=o.createContext(i);function r(e){let n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);