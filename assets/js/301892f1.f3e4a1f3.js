"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["55536"],{13288:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>i,toc:()=>d,default:()=>h,metadata:()=>a,assets:()=>l,contentTitle:()=>t});var a=JSON.parse('{"id":"service/auth/ldap/apacheds-kerberos","title":"ApacheDS Kerberos","description":"- ApacheDS 2.0 Kerberos User Guide","source":"@site/../notes/service/auth/ldap/apacheds-kerberos.md","sourceDirName":"service/auth/ldap","slug":"/service/auth/ldap/apacheds-kerberos","permalink":"/notes/service/auth/ldap/apacheds-kerberos","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/auth/ldap/apacheds-kerberos.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1660664456000,"frontMatter":{"title":"ApacheDS Kerberos"},"sidebar":"docs","previous":{"title":"LADP","permalink":"/notes/service/auth/ldap/"},"next":{"title":"ApacheDS \u8FD0\u7EF4","permalink":"/notes/service/auth/ldap/apacheds-ops"}}'),c=r(86106),s=r(17776);let i={title:"ApacheDS Kerberos"},t="ApacheDS Kerberos",l={},d=[{value:"kerby",id:"kerby",level:2},{value:"\u542F\u52A8",id:"\u542F\u52A8",level:2},{value:"\u521D\u59CB\u914D\u7F6E",id:"\u521D\u59CB\u914D\u7F6E",level:2},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF",level:2},{value:"FAQ",id:"faq",level:2},{value:"Server not found in Kerberos database while getting initial credentials",id:"server-not-found-in-kerberos-database-while-getting-initial-credentials",level:3}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"apacheds-kerberos",children:"ApacheDS Kerberos"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://directory.apache.org/apacheds/kerberos-user-guide.html",children:"ApacheDS 2.0 Kerberos User Guide"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"KDC (Key DIstribution Center)"}),"\n",(0,c.jsx)(n.li,{children:"TGS (Ticket Granting Server)"}),"\n",(0,c.jsx)(n.li,{children:"AS (Authentication Server)"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.li,{children:"\u5B9E\u73B0\u4E86 Kerberos V5"}),"\n",(0,c.jsx)(n.li,{children:"\u652F\u6301\u52A0\u5BC6 - des-cbc-md5, des3-cbc-sha1-kd, aes128-cts-hmac-sha1-96, aes256-cts-hmac-sha1-96, rc4-hmac encryption"}),"\n",(0,c.jsx)(n.li,{children:"\u652F\u6301 UDP TCP"}),"\n",(0,c.jsx)(n.li,{children:"\u6BCF\u6B21\u4FEE\u6539\u5BC6\u7801 version \u4F1A\u589E\u52A0"}),"\n",(0,c.jsxs)(n.li,{children:["\u5B9E\u73B0\u7684 RFC ",(0,c.jsx)(n.a,{href:"https://directory.apache.org/apacheds/kerberos-ug/1.2.3-standards.html",children:"\u6807\u51C6"})]}),"\n",(0,c.jsxs)(n.li,{children:["\u6CE8\u610F\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u5FC5\u987B\u8981\u660E\u6587\u5BC6\u7801\u751F\u6210 krb5 key\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5BC6\u7801\u6700\u7EC8\u4E5F\u4F1A\u4EE5 SHA"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"kerby",children:"kerby"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://directory.apache.org/kerby/user-guide.html",children:"Kerby User Guide"})}),"\n",(0,c.jsxs)(n.li,{children:["\u540E\u7AEF\u5B58\u50A8\u652F\u6301\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5185\u5B58"}),"\n",(0,c.jsx)(n.li,{children:"Json"}),"\n",(0,c.jsx)(n.li,{children:"Zookeeper"}),"\n",(0,c.jsx)(n.li,{children:"LDAP"}),"\n",(0,c.jsx)(n.li,{children:"Mavibot"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\u652F\u6301\u7684\u52A0\u5BC6\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"des, des3, rc4, aes, camellia"}),"\n",(0,c.jsxs)(n.li,{children:["\u90E8\u5206\u4F9D\u8D56 JCE - \u9700\u8981\u989D\u5916\u5B89\u88C5\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"OpenJDK \u6216\u65B0\u7248\u6709\u81EA\u5E26"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Encryption Type"}),(0,c.jsx)(n.th,{children:"Description"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des-cbc-crc"}),(0,c.jsx)(n.td,{children:"DES cbc mode with CRC-32 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des-cbc-md4"}),(0,c.jsx)(n.td,{children:"DES cbc mode with RSA-MD4 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des-cbc-md5"}),(0,c.jsx)(n.td,{children:"DES cbc mode with RSA-MD5 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des3-cbc-sha1 des3-hmac-sha1 des3-cbc-sha1-kd"}),(0,c.jsx)(n.td,{children:"Triple DES cbc mode with HMAC/sha1"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des-hmac-sha1"}),(0,c.jsx)(n.td,{children:"DES with HMAC/sha1 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"aes256-cts-hmac-sha1-96 aes256-cts AES-256"}),(0,c.jsx)(n.td,{children:"CTS mode with 96-bit SHA-1 HMAC"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"aes128-cts-hmac-sha1-96 aes128-cts AES-128"}),(0,c.jsx)(n.td,{children:"CTS mode with 96-bit SHA-1 HMAC"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"arcfour-hmac rc4-hmac arcfour-hmac-md5"}),(0,c.jsx)(n.td,{children:"RC4 with HMAC/MD5"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"arcfour-hmac-exp rc4-hmac-exp arcfour-hmac-md5-exp"}),(0,c.jsx)(n.td,{children:"Exportable RC4 with HMAC/MD5 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"camellia256-cts-cmac camellia256-cts"}),(0,c.jsx)(n.td,{children:"Camellia-256 CTS mode with CMAC"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"camellia128-cts-cmac camellia128-cts"}),(0,c.jsx)(n.td,{children:"Camellia-128 CTS mode with CMAC"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des"}),(0,c.jsx)(n.td,{children:"The DES family: des-cbc-crc, des-cbc-md5, and des-cbc-md4 (weak)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"des3"}),(0,c.jsx)(n.td,{children:"The triple DES family: des3-cbc-sha1"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"aes"}),(0,c.jsx)(n.td,{children:"The AES family: aes256-cts-hmac-sha1-96 and aes128-cts-hmac-sha1-96"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"rc4"}),(0,c.jsx)(n.td,{children:"The RC4 family: arcfour-hmac"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"camellia"}),(0,c.jsx)(n.td,{children:"The Camellia family: camellia256-cts-cmac and camellia128-cts-cmac"})]})]})]}),"\n",(0,c.jsx)(n.h1,{id:"\u672C\u5730\u5B9E\u9A8C",children:"\u672C\u5730\u5B9E\u9A8C"}),"\n",(0,c.jsx)(n.h2,{id:"\u542F\u52A8",children:"\u542F\u52A8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u6620\u5C04\u76EE\u5F55\u540E\u672C\u5730\u4E5F\u53EF\u4EE5\u4F7F\u7528\ndocker run --rm -it -e TZ=Asia/Shanghai \\\n  -p 10389:10389 -p 10636:10636 \\\n  -p 60088:60088 -p 60464:60464  -p 60088:60088/udp -p 60464:60464/udp \\\n  -v $PWD/apacheds:/opt/apacheds/instances \\\n  --name apacheds wener/apacheds\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u521D\u59CB\u914D\u7F6E",children:"\u521D\u59CB\u914D\u7F6E"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u521B\u5EFA\u670D\u52A1"}),"\n",(0,c.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"http://directory.apache.org/apacheds/kerberos-ug/4-using-kerberos.html",children:"http://directory.apache.org/apacheds/kerberos-ug/4-using-kerberos.html"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ldif",children:"# \u57FA\u7840\u9876\u5C42\u67B6\u6784\ndn: dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: domain\ndc: security\n\ndn: ou=services,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nou: services\n\ndn: ou=users,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nou: users\n\n# \u521B\u5EFA\u7528\u6237 wener\ndn: uid=wener,ou=users,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: krb5KDCEntry\nobjectClass: inetOrgPerson\nobjectClass: krb5Principal\nobjectClass: person\nobjectClass: organizationalPerson\ncn: Wener Chen\nkrb5KeyVersionNumber: 1\nkrb5PrincipalName: wener@EXAMPLE.COM\nsn: Wener\nuid: wener\nuserPassword: secret\n\n# \u521B\u5EFA\u670D\u52A1\ndn: uid=ldap,ou=services,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nobjectClass: krb5KDCEntry\nobjectClass: uidObject\nobjectClass: krb5Principal\nkrb5KeyVersionNumber: 0\nkrb5PrincipalName: ldap/example.net@EXAMPLE.COM\nuid: ldap\nuserPassword: randomKey\nou: LDAP\n\ndn: uid=krbtgt,ou=services,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nobjectClass: krb5KDCEntry\nobjectClass: uidObject\nobjectClass: krb5Principal\nkrb5KeyVersionNumber: 0\nkrb5PrincipalName: krbtgt/EXAMPLE.COM@EXAMPLE.COM\nuid: krbtgt\nuserPassword:: randomkey\nou: TGT\n\ndn: uid=kpasswd,ou=services,dc=security,dc=example,dc=com\nobjectClass: top\nobjectClass: organizationalUnit\nobjectClass: krb5KDCEntry\nobjectClass: uidObject\nobjectClass: krb5Principal\nkrb5KeyVersionNumber: 0\nkrb5PrincipalName: kadmin/changepw@EXAMPLE.COM\nuid: kpasswd\nuserPassword:: randomkey\nou: KPasswd\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u5BA2\u6237\u7AEF",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,c.jsxs)(n.p,{children:["\u76F8\u540C\u8282\u70B9\u5BA2\u6237\u7AEF\u914D\u7F6E\uFF0C\u4FEE\u6539 hosts ",(0,c.jsx)(n.code,{children:"example.com"})," \u6307\u5411\u672C\u5730"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"/etc/krb5.conf"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ini",children:" [logging]\n default = FILE:/var/log/krb5libs.log\n kdc = FILE:/var/log/krb5kdc.log\n admin_server = FILE:/var/log/kadmind.log\n\n[libdefaults]\ndebug = true\ndefault_realm = EXAMPLE.COM\ndns_lookup_realm = false\ndns_lookup_kdc = false\nticket_lifetime = 24h\nrenew_lifetime = 7d\nrdns = false\nforwardable = true\nallow_weak_crypto = yes\n\n[realms]\n EXAMPLE.COM = {\n  kdc = 127.0.0.1:60088\n  chpasswd_server = 127.0.0.1:60464\n  kpasswd_server = 127.0.0.1:60464\n  default_domain = EXAMPLE.COM\n }\n\n\n[domain_realm]\n.EXAMPLE.COM = EXAMPLE.COM\nEXAMPLE.COM = EXAMPLE.COM\n"})}),"\n",(0,c.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,c.jsx)(n.h3,{id:"server-not-found-in-kerberos-database-while-getting-initial-credentials",children:"Server not found in Kerberos database while getting initial credentials"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u53EF\u80FD\u662F\u52A0\u5BC6\u7B97\u6CD5\u9700\u8981\u5B89\u5168\u6269\u5C55\uFF0C\u5C1D\u8BD5\u8C03\u6574"}),"\n",(0,c.jsx)(n.li,{children:"\u53EF\u80FD\u662F\u6CA1\u6709\u521B\u5EFA\u76F8\u5E94\u7684\u670D\u52A1"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"[21:35:42] ERROR [org.apache.directory.server.KERBEROS_LOG] - ERR_152 Unexpected exception: null\njava.lang.NullPointerException\n	at org.apache.directory.server.kerberos.kdc.authentication.AuthenticationService.verifyEncryptedTimestamp(AuthenticationService.java:335)\n	at org.apache.directory.server.kerberos.kdc.authentication.AuthenticationService.execute(AuthenticationService.java:129)\n	at org.apache.directory.server.kerberos.protocol.KerberosProtocolHandler.messageReceived(KerberosProtocolHandler.java:217)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain$TailFilter.messageReceived(DefaultIoFilterChain.java:1015)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.callNextMessageReceived(DefaultIoFilterChain.java:650)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.access$1300(DefaultIoFilterChain.java:49)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain$EntryImpl$1.messageReceived(DefaultIoFilterChain.java:1128)\n	at org.apache.mina.filter.codec.ProtocolCodecFilter$ProtocolDecoderOutputImpl.flush(ProtocolCodecFilter.java:413)\n	at org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:257)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.callNextMessageReceived(DefaultIoFilterChain.java:650)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.access$1300(DefaultIoFilterChain.java:49)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain$EntryImpl$1.messageReceived(DefaultIoFilterChain.java:1128)\n	at org.apache.mina.core.filterchain.IoFilterAdapter.messageReceived(IoFilterAdapter.java:122)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.callNextMessageReceived(DefaultIoFilterChain.java:650)\n	at org.apache.mina.core.filterchain.DefaultIoFilterChain.fireMessageReceived(DefaultIoFilterChain.java:643)\n	at org.apache.mina.transport.socket.nio.NioDatagramAcceptor.readHandle(NioDatagramAcceptor.java:314)\n	at org.apache.mina.transport.socket.nio.NioDatagramAcceptor.processReadySessions(NioDatagramAcceptor.java:270)\n	at org.apache.mina.transport.socket.nio.NioDatagramAcceptor.access$700(NioDatagramAcceptor.java:68)\n	at org.apache.mina.transport.socket.nio.NioDatagramAcceptor$Acceptor.run(NioDatagramAcceptor.java:181)\n	at org.apache.mina.util.NamePreservingRunnable.run(NamePreservingRunnable.java:64)\n	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n	at java.lang.Thread.run(Thread.java:748)\n"})})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},17776:function(e,n,r){r.d(n,{R:()=>i,x:()=>t});var a=r(7378);let c={},s=a.createContext(c);function i(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);