"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["407082"],{132943:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>i,toc:()=>c,default:()=>m,metadata:()=>t,assets:()=>a,contentTitle:()=>l});var t=JSON.parse('{"id":"service/observability/metrics/promxy","title":"promxy","description":"- jacksontj/promxy","source":"@site/../notes/service/observability/metrics/promxy.md","sourceDirName":"service/observability/metrics","slug":"/service/observability/metrics/promxy","permalink":"/notes/service/observability/metrics/promxy","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/observability/metrics/promxy.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"promxy"},"sidebar":"docs","previous":{"title":"PromQL","permalink":"/notes/service/observability/metrics/prometheus/promql"},"next":{"title":"Thanos \u7248\u672C","permalink":"/notes/service/observability/metrics/thanos-version"}}'),s=r(486106),o=r(917776);let i={title:"promxy"},l="promxy",a={},c=[{value:"\u914D\u7F6E\u793A\u4F8B",id:"\u914D\u7F6E\u793A\u4F8B",level:2},{value:"\u57FA\u672CHA\u914D\u7F6E",id:"\u57FA\u672Cha\u914D\u7F6E",level:3},{value:"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B",id:"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B",level:3}];function p(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"promxy",children:"promxy"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/jacksontj/promxy",children:"jacksontj/promxy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u805A\u5408\u591A\u4E2A prometheus \u8FDB\u884C\u67E5\u8BE2"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/jacksontj/promxy/blob/master/cmd/promxy/config.yaml",children:"config.yaml"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["nocache=1 for VictoriaMetrics ",(0,s.jsx)(n.a,{href:"https://github.com/jacksontj/promxy/blob/d4609ebcfd2a50d58f2115c1f079bf4779fc5515/pkg/servergroup/config.go#L96-L99",children:"QueryParams"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# http://127.0.0.1:8082\npromxy --config config.yaml\n\n# https://hub.docker.com/r/jacksontj/promxy\n# docker run -p 8082:8082 -v $(pwd)/config.yaml:/config.yaml jacksontj/promxy --config /config.yaml\ndocker run -p 8082:8082 -v $(pwd)/config.yaml:/config.yaml jacksontj/promxy --config.file=/config.yaml\n\npromxy --config.file=config.yaml\n\n# \u8BBF\u95EEPromxy\u7684Web\u754C\u9762\ncurl "http://localhost:8082/graph"\n\n# API\u67E5\u8BE2\ncurl "http://localhost:8082/api/v1/query?query=up"\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"VictoriaMetrics\u4F18\u5316"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6DFB\u52A0 ",(0,s.jsx)(n.code,{children:"nocache=1"})," \u67E5\u8BE2\u53C2\u6570\u907F\u514D\u7F13\u5B58\u95EE\u9898"]}),"\n",(0,s.jsxs)(n.li,{children:["\u914D\u7F6E ",(0,s.jsx)(n.code,{children:"query_params"})," \u90E8\u5206\u5728server_groups\u4E2D"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u914D\u7F6E\u793A\u4F8B",children:"\u914D\u7F6E\u793A\u4F8B"}),"\n",(0,s.jsx)(n.h3,{id:"\u57FA\u672Cha\u914D\u7F6E",children:"\u57FA\u672CHA\u914D\u7F6E"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"global:\n  external_labels:\n    proxy: 'true'\n\nprometheus:\n  global:\n    scrape_interval: 15s\n    evaluation_interval: 15s\n\n# Server groups for HA\nserver_groups:\n  - static_configs:\n      - targets:\n          - prometheus-1:9090\n          - prometheus-2:9090\n          - prometheus-3:9090\n    labels:\n      cluster: 'prod'\n      replica: '1'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B",children:"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"global:\n  external_labels:\n    proxy: 'true'\n  # Query timeout\n  timeout: 5m\n\nprometheus:\n  global:\n    scrape_interval: 15s\n    evaluation_interval: 15s\n    # External labels to add to metrics\n    external_labels:\n      region: 'us-west'\n\n  # Alerting configuration\n  alerting:\n    alertmanagers:\n      - static_configs:\n          - targets:\n              - alertmanager:9093\n\n  # Rule files\n  rule_files:\n    - 'rules.yml'\n\n# Server groups define how to connect to Prometheus servers\nserver_groups:\n  # Production cluster\n  - static_configs:\n      - targets:\n          - prometheus-prod-1:9090\n          - prometheus-prod-2:9090\n          - prometheus-prod-3:9090\n    labels:\n      cluster: 'prod'\n      environment: 'production'\n    # Anti-affinity for load balancing\n    anti_affinity: 30s\n    # Remote read configuration\n    remote_read: true\n    # Query parameters to pass through\n    query_params:\n      nocache: '1'\n\n  # Staging cluster\n  - static_configs:\n      - targets:\n          - prometheus-staging:9090\n    labels:\n      cluster: 'staging'\n      environment: 'staging'\n\n# Server configuration\nserver:\n  # Listen address\n  listen_addr: '0.0.0.0:8082'\n  # Enable profiling\n  enable_profiling: true\n  # Metrics path\n  metrics_path: '/metrics'\n\n# Logging configuration\nlogging:\n  level: 'info'\n  format: 'json'\n"})})]})}function m(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},917776:function(e,n,r){r.d(n,{R:()=>i,x:()=>l});var t=r(7378);let s={},o=t.createContext(s);function i(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);