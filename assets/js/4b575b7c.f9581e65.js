"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["20775"],{65503:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>d,toc:()=>h,default:()=>o,metadata:()=>r,assets:()=>c,contentTitle:()=>i});var r=JSON.parse('{"id":"devops/kubernetes/internal/k8s-labels","title":"Kubernetes \u6807\u7B7E","description":"- https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints","source":"@site/../notes/devops/kubernetes/internal/k8s-labels.md","sourceDirName":"devops/kubernetes/internal","slug":"/devops/kubernetes/internal/k8s-labels","permalink":"/notes/devops/kubernetes/internal/k8s-labels","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/internal/k8s-labels.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1652772118000,"frontMatter":{"title":"Kubernetes \u6807\u7B7E"},"sidebar":"docs","previous":{"title":"HPA","permalink":"/notes/devops/kubernetes/internal/k8s-hpa"},"next":{"title":"Metrics","permalink":"/notes/devops/kubernetes/internal/k8s-metrics"}}'),t=s(86106),l=s(17776);let d={title:"Kubernetes \u6807\u7B7E"},i="Kubernetes \u6807\u7B7E",c={},h=[{value:"\u8282\u70B9\u6807\u7B7E",id:"\u8282\u70B9\u6807\u7B7E",level:2},{value:"Deprecated",id:"deprecated",level:3},{value:"\u8D44\u6E90\u6807\u7B7E",id:"\u8D44\u6E90\u6807\u7B7E",level:2},{value:"\u5E94\u7528\u6807\u7B7E",id:"\u5E94\u7528\u6807\u7B7E",level:2},{value:"Helm \u6807\u7B7E",id:"helm-\u6807\u7B7E",level:2},{value:"Helm \u6CE8\u89E3",id:"helm-\u6CE8\u89E3",level:2},{value:"LabelSelector",id:"labelselector",level:2},{value:"region vs zone",id:"region-vs-zone",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-\u6807\u7B7E",children:"Kubernetes \u6807\u7B7E"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints",children:"https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/labels-annotations-taints/",children:"https://kubernetes.io/docs/reference/labels-annotations-taints/"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u8282\u70B9\u6807\u7B7E",children:"\u8282\u70B9\u6807\u7B7E"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"kubernetes.io/ingress.class"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"label"}),(0,t.jsx)(n.th,{children:"demo"}),(0,t.jsx)(n.th,{children:"desc"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"k3s.io/hostname"}),(0,t.jsx)(n.td,{children:"node-3"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"k3s.io/internal-ip"}),(0,t.jsx)(n.td,{children:"10.10.1.1"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"kubernetes.io/arch"}),(0,t.jsx)(n.td,{children:"amd64"}),(0,t.jsx)(n.td,{children:"+v1.14"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"kubernetes.io/hostname"}),(0,t.jsx)(n.td,{children:"node-3"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"kubernetes.io/os"}),(0,t.jsx)(n.td,{children:"linux"}),(0,t.jsx)(n.td,{children:"+v1.14"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["node-role.kubernetes.io/",(0,t.jsx)(n.code,{children:"<role>"})]}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"node-role.kubernetes.io/master"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Master node"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"node-role.kubernetes.io/control-plane"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"cp"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"node.kubernetes.io/instance-type"}),(0,t.jsx)(n.td,{children:"k3s"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"topology.kubernetes.io/region"}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"+v1.17"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"topology.kubernetes.io/zone"}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"+v1.17"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u8BBE\u7F6E node role \u4E3A worker\n# role \u540D\u5B57\u4EFB\u610F\n# value \u4E0D\u91CD\u8981\uFF0C\u4E3B\u8981\u662F\u5B58\u5728\u8BE5 label\nkubectl label node node-2 node-role.kubernetes.io/worker=true\n# \u89C4\u5212 region \u548C zone\nkubectl label node master-1 topology.kubernetes.io/region=sh\nkubectl label node master-1 topology.kubernetes.io/zone=sh-dc1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"deprecated",children:"Deprecated"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"label"}),(0,t.jsx)(n.th,{children:"demo"}),(0,t.jsx)(n.th,{children:"desc"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"beta.kubernetes.io/arch"}),(0,t.jsx)(n.td,{children:"amd64"}),(0,t.jsx)(n.td,{children:"!v1.14, -v1.18"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"beta.kubernetes.io/instance-type"}),(0,t.jsx)(n.td,{children:"k3s"}),(0,t.jsx)(n.td,{children:"!v1.17"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"beta.kubernetes.io/os"}),(0,t.jsx)(n.td,{children:"linux"}),(0,t.jsx)(n.td,{children:"!v1.14, -v1.18"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"failure-domain.beta.kubernetes.io/region"}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"!v1.17"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"failure-domain.beta.kubernetes.io/zone"}),(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"!v1.17"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u8D44\u6E90\u6807\u7B7E",children:"\u8D44\u6E90\u6807\u7B7E"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"kind"}),(0,t.jsx)(n.th,{children:"annotation"}),(0,t.jsx)(n.th,{children:"demo"}),(0,t.jsx)(n.th,{children:"desc"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"StorageClass"}),(0,t.jsx)(n.td,{children:"storageclass.kubernetes.io/is-default-class"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"\u9ED8\u8BA4 StorageClass"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"VolumeSnapshotClass"}),(0,t.jsx)(n.td,{children:"snapshot.storage.kubernetes.io/is-default-class"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Ingress"}),(0,t.jsx)(n.td,{children:"kubernetes.io/ingress.class"}),(0,t.jsx)(n.td,{children:"nginx"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"\u5E9F\u5F03"}),",spec.ingressClassName"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"IngressClass"}),(0,t.jsx)(n.td,{children:"ingressclass.kubernetes.io/is-default-class"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"kind"}),(0,t.jsx)(n.th,{children:"label"}),(0,t.jsx)(n.th,{children:"demo"}),(0,t.jsx)(n.th,{children:"desc"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Namespace"}),(0,t.jsx)(n.td,{children:"kubernetes.io/metadata.name"}),(0,t.jsx)(n.td,{children:"kube-system"}),(0,t.jsx)(n.td,{children:"namespace \u7684\u540D\u5B57"})]})})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl get storageclass\n\n# \u53D6\u6D88 sc \u7684\u9ED8\u8BA4\u503C\nkubectl patch storageclass local-path -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}\'\n# \u8BBE\u7F6E\u9ED8\u8BA4\nkubectl patch storageclass longhorn -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5E94\u7528\u6807\u7B7E",children:"\u5E94\u7528\u6807\u7B7E"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/",children:"Recommanded Lables"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://helm.sh/docs/chart_best_practices/labels/",children:"Helm Labels"})}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"label"}),(0,t.jsx)(n.th,{children:"example"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/name"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"mysql"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/instance"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"mysql-abcd"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/version"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"5.7"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/component"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"database"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/part-of"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ghost"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/managed-by"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"helm"})})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"podAntiAffinity:\n  preferredDuringSchedulingIgnoredDuringExecution:\n    - weight: 100\n      podAffinityTerm:\n        labelSelector:\n          matchLabels:\n            app.kubernetes.io/component: prometheus\n            app.kubernetes.io/instance: kube-prometheus\n            app.kubernetes.io/name: kube-prometheus\n        topologyKey: kubernetes.io/hostname\n"})}),"\n",(0,t.jsx)(n.h2,{id:"helm-\u6807\u7B7E",children:"Helm \u6807\u7B7E"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"label"}),(0,t.jsx)(n.th,{children:"example"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"app.kubernetes.io/managed-by"}),(0,t.jsx)(n.td,{children:"Helm"})]})})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# \u8D44\u6E90 label\nlabels:\n  app.kubernetes.io/component: controller\n  app.kubernetes.io/instance: ingress-nginx\n  app.kubernetes.io/managed-by: Helm\n  app.kubernetes.io/name: ingress-nginx\n  app.kubernetes.io/version: 0.35.0\n  helm.sh/chart: ingress-nginx-2.16.0\n\n# selector label\nmatchLabels:\n  app.kubernetes.io/component: controller\n  app.kubernetes.io/instance: ingress-nginx\n  app.kubernetes.io/name: ingress-nginx\n"})}),"\n",(0,t.jsx)(n.h2,{id:"helm-\u6CE8\u89E3",children:"Helm \u6CE8\u89E3"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"annotation"}),(0,t.jsx)(n.th,{children:"value"}),(0,t.jsx)(n.th,{children:"desc"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"meta.helm.sh/release-name"}),(0,t.jsx)(n.td,{children:"linkerd2"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"meta.helm.sh/release-namespace"}),(0,t.jsx)(n.td,{children:"linkerd"}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"labelselector",children:"LabelSelector"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"labelSelector - \u6570\u7EC4\u5185\u4E3A OR \u5173\u7CFB"}),"\n",(0,t.jsxs)(n.li,{children:["matchLabels\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"label: value"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["matchExpressions - \u6570\u7EC4\u5185\u4E3A AND \u5173\u7CFB\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"key"}),"\n",(0,t.jsx)(n.li,{children:"operator: In, NotIn, Exists, DoesNotExist"}),"\n",(0,t.jsx)(n.li,{children:"values: []"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"dashboardLabelSelector: # OR\n  - matchExpressions: # AND\n      - { key: app, operator: In, values: [grafana] }\n      - { key: group, operator: In, values: [grafana] }\n"})}),"\n",(0,t.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,t.jsx)(n.h2,{id:"region-vs-zone",children:"region vs zone"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["region - \u533A\u57DF\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5730\u533A/zone \u96C6\u5408"}),"\n",(0,t.jsx)(n.li,{children:"\u540C\u533A\u57DF \u9AD8\u5E26\u5BBD\u3001\u4F4E\u5EF6\u8FDF"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["zone - \u53EF\u7528\u533A ",(0,t.jsx)(n.code,{children:"<region>-<zone>"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"us-central1"}),"\n",(0,t.jsx)(n.li,{children:"us-central1-a - zone \u5185\u533A\u57DF"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cloud.google.com/compute/docs/regions-zones",children:"https://cloud.google.com/compute/docs/regions-zones"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/setup/best-practices/multiple-zones/",children:"https://kubernetes.io/docs/setup/best-practices/multiple-zones/"})}),"\n"]})]})}function o(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},17776:function(e,n,s){s.d(n,{R:()=>d,x:()=>i});var r=s(7378);let t={},l=r.createContext(t);function d(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);