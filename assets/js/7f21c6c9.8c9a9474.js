"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["888549"],{234105:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>i,toc:()=>o,default:()=>x,metadata:()=>t,assets:()=>c,contentTitle:()=>l});var t=JSON.parse('{"id":"devops/docker/docker-dockerfile","title":"Dockerfile","description":"\u5185\u7F6E\u53D8\u91CF","source":"@site/../notes/devops/docker/docker-dockerfile.md","sourceDirName":"devops/docker","slug":"/devops/docker/dockerfile","permalink":"/notes/devops/docker/dockerfile","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/docker/docker-dockerfile.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1753627141000,"frontMatter":{"title":"Dockerfile"},"sidebar":"docs","previous":{"title":"DID","permalink":"/notes/devops/docker/dind"},"next":{"title":"Docker FAQ","permalink":"/notes/devops/docker/faq"}}'),d=r(486106),s=r(917776);let i={title:"Dockerfile"},l="Dockerfile",c={},o=[{value:"ssh clone",id:"ssh-clone",level:2}];function h(n){let e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"dockerfile",children:"Dockerfile"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"# syntax = docker/dockerfile:1\n# syntax = docker/dockerfile:experimental\n"})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"\u5185\u7F6E\u53D8\u91CF"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-dockerfile",children:"FROM alpine\nARG TARGETPLATFORM\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"env"}),(0,d.jsx)(e.th,{children:"for"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"TARGETPLATFORM"}),(0,d.jsx)(e.td,{children:"\u6784\u5EFA\u7ED3\u679C\u7684\u5E73\u53F0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"TARGETOS"}),(0,d.jsx)(e.td,{children:"OS of TARGETPLATFORM"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"TARGETARCH"}),(0,d.jsx)(e.td,{children:"arch of TARGETPLATFORM"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"TARGETVARIANT"}),(0,d.jsx)(e.td,{children:"variant of TARGETPLATFORM"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDPLATFORM"}),(0,d.jsx)(e.td,{children:"\u6267\u884C\u6784\u5EFA\u7684\u8282\u70B9\u7684\u5E73\u53F0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDOS"}),(0,d.jsx)(e.td,{children:"OS of BUILDPLATFORM"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDARCH"}),(0,d.jsx)(e.td,{children:"arch of BUILDPLATFORM"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDVARIANT"}),(0,d.jsx)(e.td,{children:"variant of BUILDPLATFORM"})]})]})]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["TARGETARCH\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"amd64"}),"\n",(0,d.jsx)(e.li,{children:"arm64"}),"\n",(0,d.jsx)(e.li,{children:"arm/v7"}),"\n",(0,d.jsx)(e.li,{children:"arm/v6"}),"\n",(0,d.jsx)(e.li,{children:"ppc64le"}),"\n",(0,d.jsx)(e.li,{children:"s390x"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["platform\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"linux/amd64, linux/arm/v7, windows/amd64"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"BuildKit \u5185\u7F6E"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"Arg"}),(0,d.jsx)(e.th,{children:"Type"}),(0,d.jsx)(e.th,{children:"Description"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_CACHE_MOUNT_NS"}),(0,d.jsx)(e.td,{children:"String"}),(0,d.jsx)(e.td,{children:"Set optional cache ID namespace."})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_CONTEXT_KEEP_GIT_DIR"}),(0,d.jsx)(e.td,{children:"Bool"}),(0,d.jsx)(e.td,{children:"Trigger git context to keep the .git directory."})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_INLINE_CACHE2"}),(0,d.jsx)(e.td,{children:"Bool"}),(0,d.jsx)(e.td,{children:"Inline cache metadata to image config or not."})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_MULTI_PLATFORM"}),(0,d.jsx)(e.td,{children:"Bool"}),(0,d.jsx)(e.td,{children:"Opt into determnistic output regardless of multi-platform output or not."})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_SANDBOX_HOSTNAME"}),(0,d.jsx)(e.td,{children:"String"}),(0,d.jsx)(e.td,{children:"Set the hostname (default buildkitsandbox)"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"BUILDKIT_SYNTAX"}),(0,d.jsx)(e.td,{children:"String"}),(0,d.jsx)(e.td,{children:"Set frontend image"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SOURCE_DATE_EPOCH"}),(0,d.jsx)(e.td,{children:"Int"}),(0,d.jsx)(e.td,{children:"Set the UNIX timestamp for created image and layers. More info from reproducible builds. Supported since Dockerfile 1.5, BuildKit 0.11"})]})]})]}),"\n",(0,d.jsx)(e.h2,{id:"ssh-clone",children:"ssh clone"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"FROM alpine\nRUN --mount=type=ssh \\\n  apk add git openssh-client \\\n  && install -m 0700 -d ~/.ssh \\\n  && ssh-keyscan github.com >> ~/.ssh/known_hosts \\\n  && git clone git@github.com:wener/wode.git\n"})})]})}function x(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(h,{...n})}):h(n)}},917776:function(n,e,r){r.d(e,{R:()=>i,x:()=>l});var t=r(7378);let d={},s=t.createContext(d);function i(n){let e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:i(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);