"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["143677"],{400862:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>h,metadata:()=>s,assets:()=>l,contentTitle:()=>o});var s=JSON.parse('{"id":"languages/go/go-generic","title":"\u6CDB\u578B","description":"- \u7C7B\u578B\u53C2\u6570","source":"@site/../notes/languages/go/go-generic.md","sourceDirName":"languages/go","slug":"/languages/go/generic","permalink":"/notes/languages/go/generic","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/go/go-generic.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1655970411000,"frontMatter":{"title":"\u6CDB\u578B"},"sidebar":"docs","previous":{"title":"Go FAQ","permalink":"/notes/languages/go/faq"},"next":{"title":"Go GUI Awesome","permalink":"/notes/languages/go/gui-awesome"}}'),r=t(486106),i=t(917776);let a={title:"\u6CDB\u578B"},o="Golang \u6CDB\u578B",l={},c=[{value:"new(T)",id:"newt",level:2},{value:"method must have no type parameters",id:"method-must-have-no-type-parameters",level:2},{value:"cannot use generic type without instantiation",id:"cannot-use-generic-type-without-instantiation",level:2},{value:"cannot use type assertion on type parameter value Xxx(variable of type T constrained by any)",id:"cannot-use-type-assertion-on-type-parameter-value-xxxvariable-of-type-t-constrained-by-any",level:2}];function d(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"golang-\u6CDB\u578B",children:"Golang \u6CDB\u578B"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7C7B\u578B\u53C2\u6570\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"T any"})," - \u4EFB\u610F\u7C7B\u578B"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"T int | int8"})," - \u5176\u4E2D\u4E4B\u4E00"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"T ~int"})," - \u5141\u8BB8\u884D\u751F\u7C7B\u578B - \u4F8B\u5982 ",(0,r.jsx)(n.code,{children:"type Age int"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md",children:"propose"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://go.dev/doc/tutorial/generics",children:"Tutorial: Getting started with generics"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u76EE\u524D\u4E0D\u597D\u4F7F\u7528 new(T), \u589E\u52A0\u4E00\u4E2A\u7C7B\u578B\u8FDB\u884C\u9650\u5236"}),"\n",(0,r.jsxs)(n.li,{children:["method \u4E0D\u652F\u6301\u7C7B\u578B\u53C2\u6570 - ",(0,r.jsx)(n.a,{href:"https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#No-parameterized-methods",children:"No parameterized methods"})]}),"\n",(0,r.jsxs)(n.li,{children:["type \u53C2\u6570\u4E0D\u652F\u6301 assert - \u53EF\u4EE5\u8003\u8651 ",(0,r.jsx)(n.code,{children:"_,ok := any(v).(int)"})]}),"\n"]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["golang.org/x/exp/slices - ",(0,r.jsx)(n.a,{href:"https://github.com/golang/go/issues/45955",children:"#45955"})]}),"\n",(0,r.jsxs)(n.li,{children:["lightweight anonymous function syntax - ",(0,r.jsx)(n.a,{href:"https://github.com/golang/go/issues/21498",children:"#21498"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u4F7F\u7528 struct \u5B57\u6BB5\u4F5C\u4E3A\u4E00\u4E2A\u7C7B\u578B ",(0,r.jsx)(n.a,{href:"https://github.com/golang/go/issues/48522",children:"#48522"})]}),"\n"]})}),"\n",(0,r.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h2,{id:"newt",children:"new(T)"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u76EE\u524D\u8BE5\u65B9\u6CD5\u65E0\u6CD5\u4F7F\u7528 ",(0,r.jsx)(n.a,{href:"https://stackoverflow.com/questions/71440697",children:"https://stackoverflow.com/questions/71440697"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u76F4\u63A5\u9650\u5B9A\u4E0D\u65B9\u4FBF\u4F20\u53C2\u6570\uFF0C\u56E0\u4E3A struct \u4E0D\u4E00\u5B9A\u5B9E\u73B0 interface, ",(0,r.jsx)(n.code,{children:"*struct"})," \u624D\u5B9E\u73B0 interface"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="\u6B63\u786E\u505A\u6CD5"',children:"type Setter[T any] interface {\n	SetIndex(n int)\n	*T\n}\nfunc setIndex[T any, PT Setter[T]](items []int) (o []PT) {\n	for _, v := range items {\n		m := PT(new(T))\n		m.SetIndex(v)\n		o = append(o, m)\n	}\n	return\n}\n\n// \u9650\u5B9A \u63A5\u53E3 \u76F4\u63A5\u5199\u4E5F\u53EF\u4EE5\nfunc setIndex[T any, PT interface {\n  SetIndex(n int)\n  *T\n}](items []int) (o []PT) {\n	for _, v := range items {\n		m := PT(new(T))\n		m.SetIndex(v)\n		o = append(o, m)\n	}\n	return\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="\u9519\u8BEF\u505A\u6CD5"',children:"func setIndex[M interface {\n	SetIndex(n int)\n}](items []int) (o []M) {\n	for _, v := range items {\n    // NPE\n		m := *new(M)\n		m.SetIndex(v)\n		o = append(o, m)\n	}\n	return\n}\n\ntype A struct {\n	Index int\n}\n\nfunc (s *A) SetIndex(v int) {\n	s.Index = v\n}\nfunc TestSetIndex(t *testing.T) {\n  // \u4F1A\u51FA\u73B0 NPE\n	fmt.Println(setIndex[*A]([]int{1, 2, 3, 4}))\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"method-must-have-no-type-parameters",children:"method must have no type parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"func \u652F\u6301\u7C7B\u578B\u53C2\u6570"}),"\n",(0,r.jsxs)(n.li,{children:["method \u4E0D\u652F\u6301\u7C7B\u578B\u53C2\u6570\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53EA\u80FD\u4F7F\u7528 struct \u4E0A\u7684\u7C7B\u578B\u53C2\u6570"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#No-parameterized-methods",children:"No parameterized methods"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type A struct{}\n// method \u4E0D\u652F\u6301 \u7C7B\u578B\u53C2\u6570\nfunc (v A)Map[T any](f func(A)T)T{\n  return f(v)\n}\n\n// func \u652F\u6301 \u7C7B\u578B\u53C2\u6570\nfunc Map[IN any, OUT any](s IN, f func(IN) OUT) (o OUT) {\n	return f(s)\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cannot-use-generic-type-without-instantiation",children:"cannot use generic type without instantiation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type A[T any] struct {}\n// \u4E0D\u53EF\u4EE5\nfunc(a A)Name(){}\n// \u53EF\u4EE5\nfunc(a A[T])Name(){}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cannot-use-type-assertion-on-type-parameter-value-xxxvariable-of-type-t-constrained-by-any",children:"cannot use type assertion on type parameter value Xxx(variable of type T constrained by any)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type A[T any] struct {\n  Val T\n}\nfunc(a A[T])Name(){\n  // \u4E0D\u53EF\u4EE5 - \u56E0\u4E3A T \u662F\u5177\u4F53\u7C7B\u578B\n  _,_=a.Val.(string)\n\n  // \u53EF\u4EE5\n  var v interface{} = a.Val\n	_, _ = v.(string)\n\n  // \u53EF\u4EE5\n  _, _ = (interface{})(a.Val).(string)\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["proposal: spec: generics: type switch on parametric types ",(0,r.jsx)(n.a,{href:"https://github.com/golang/go/issues/45380",children:"#45380"})]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>o});var s=t(7378);let r={},i=s.createContext(r);function a(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);