"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["45856"],{17599:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>l,toc:()=>o,default:()=>h,metadata:()=>s,assets:()=>c,contentTitle:()=>d});var s=JSON.parse('{"id":"web/editor/craftjs","title":"craft.js","description":"- prevwong/craft.js","source":"@site/../notes/web/editor/craftjs.md","sourceDirName":"web/editor","slug":"/web/editor/craftjs","permalink":"/notes/web/editor/craftjs","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/editor/craftjs.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1699940620000,"frontMatter":{"title":"craft.js"},"sidebar":"docs","previous":{"title":"CodeMirror","permalink":"/notes/web/editor/codemirror"},"next":{"title":"Draftjs","permalink":"/notes/web/editor/draftjs"}}'),i=r(86106),t=r(17776);let l={title:"craft.js"},d="craft.js",c={},o=[{value:"Internal",id:"internal",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"craftjs",children:"craft.js"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/prevwong/craft.js",children:"prevwong/craft.js"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MIT, React"}),"\n",(0,i.jsx)(e.li,{children:"drag and drop page editors"}),"\n",(0,i.jsx)(e.li,{children:"\u7F16\u8F91\u6A21\u5F0F\u5BF9\u73B0\u6709\u7EC4\u4EF6\u4FB5\u5165"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["@craftjs/core\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"150kb - self 30kb + @craftjs/utils 13kb + lodash 96kb + immer + nanoid"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/prevwong/reka.js",children:"prevwong/reka.js"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u65B0\u7684\u72B6\u6001\u7BA1\u7406+\u5E8F\u5217\u5316"}),"\n",(0,i.jsx)(e.li,{children:"mobx"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{type:"caution",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5BF9\u73B0\u6709\u7EC4\u4EF6\u4FB5\u5165"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsxs)(e.del,{children:["\u6682\u4E0D\u652F\u6301 Reaact 18 StrictMode ",(0,i.jsx)(e.a,{href:"https://github.com/prevwong/craft.js/issues/404",children:"#404"})]})}),"\n"]})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",children:'import React from "react";\nimport {Editor, Frame, Canvas, Selector} from "@craftjs/core";\n\nconst TextComponent = ({text}) => {\n  const { connectors: { connect, drag }, isClicked, actions: {setProp} } = useNode(\n    (state) => ({\n      isClicked: state.event.selected,\n    })\n  );\n\n  return (\n    <div ref={dom => connect(drag(dom))}>\n      <h2>{text}</h2>\n      {\n        isClicked ? (\n          <Modal>\n            <input\n              type="text"\n              value={text}\n              onChange={e => setProp(e.target.value)}\n            />\n          </Modal>\n        )\n      }\n    </div>\n  )\n}\n\nconst Container = () => {\n  const { actions: {add}, query: { createNode, node } } = useEditor();\n  const { id, connectors: {drag, connect} } = useNode();\n  return (\n    <div ref={dom => connect(drag(dom))}>\n      <a onClick={() => {\n        const { data: {type, props}} = node(id).get();\n        add(\n          createNode(React.createElement(type, props));\n        );\n      }}>\n        Make a copy of me\n      </a>\n    </div>\n  )\n}\n\nconst SaveButton = () => {\n  const { query } = useEditor();\n  return <a onClick={() => console.log(query.serialize()) }>Get JSON</a>\n}\n\nconst App = () => {\n  return (\n    <div>\n      <header>Editor</header>\n      <Editor>\n        <Frame resolver={{TextComponent, Container}}>\n          <Canvas>\n            <TextComponent text="I\'m already rendered here" />\n          </Canvas>\n        </Frame>\n        <SaveButton/>\n      </Editor>\n    </div>\n  )\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"internal",children:"Internal"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["useMethos \u57FA\u4E8E ",(0,i.jsx)(e.a,{href:"https://github.com/pelotom/use-methods",children:"pelotom/use-methods"})," \u505A\u4E86\u4E00\u5B9A\u8C03\u6574\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u52A0\u4E86 QueryMethods - \u7528\u4E8E\u67E5\u8BE2\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u52A0\u4E86\u72B6\u6001\u8BA2\u9605\u673A\u5236"}),"\n",(0,i.jsxs)(e.li,{children:["\u539F\u59CB userMethods \u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"[state, callbacks]"}),", \u73B0\u5728\u7684\u8FD4\u56DE ",(0,i.jsx)(e.code,{children:"[actions, query, watcher, getState]"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u7406\u89E3 ",(0,i.jsx)(e.code,{children:"useMethos"})," \u5BF9\u770B\u61C2 useEditor \u548C useNode \u975E\u5E38\u6709\u5E2E\u52A9"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Editor\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u914D\u7F6E\u9879\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"onRender - \u6E32\u67D3 hoc"}),"\n",(0,i.jsx)(e.li,{children:"resolver - \u7EC4\u4EF6\u5217\u8868"}),"\n",(0,i.jsx)(e.li,{children:"enabled - \u662F\u5426\u542F\u7528\u7F16\u8F91"}),"\n",(0,i.jsx)(e.li,{children:"indicator - \u7EBF\u6761\u989C\u8272 - success \u548C error"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u72B6\u6001\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"nodes - \u6240\u6709\u8282\u70B9"}),"\n",(0,i.jsx)(e.li,{children:"events - \u4E8B\u4EF6\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"options - \u914D\u7F6E\u9879"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["API \u901A\u8FC7 useMethods \u5B9E\u73B0 - actions\u3001queries\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E3B\u8981\u662F\u7EF4\u62A4 node \u7684\u7ED3\u6784 - \u589E\u3001\u5220\u3001\u6539\u3001\u67E5"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Events\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:'\u4E8B\u4EF6\u5904\u7406 - "select" | "hover" | "drag" | "drop" | "create"'}),"\n",(0,i.jsx)(e.li,{children:"\u7EF4\u62A4\u8282\u70B9\u4E0A\u7684\u4E8B\u4EF6\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u7EF4\u62A4 drop \u7684 \u6807\u8BC6\u52A8\u753B"}),"\n",(0,i.jsx)(e.li,{children:"\u903B\u8F91\u76F8\u5BF9\u590D\u6742"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"NodeElement \u4F1A\u57FA\u4E8E id \u5BF9\u8282\u70B9\u8FDB\u884C memo"}),"\n",(0,i.jsx)(e.li,{children:"NodeHandlers \u4F1A\u4ECE\u4E8B\u4EF6\u673A\u5236\u884D\u751F\u51FA\u9488\u5BF9\u8282\u70B9\u7684\u4E8B\u4EF6\u5904\u7406"}),"\n",(0,i.jsxs)(e.li,{children:["Canvas\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u66FF\u4EE3\u7EC4\u4EF6\uFF0C\u76F8\u5F53\u4E8E\u7EC4\u4EF6\u7684 decorator\u3001hoc"}),"\n",(0,i.jsx)(e.li,{children:"\u521D\u59CB\u5316\u5185\u90E8\u7EC4\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"\u7EF4\u62A4 ID \u6620\u5C04\u5173\u7CFB"}),"\n",(0,i.jsx)(e.li,{children:"\u4F9D\u8D56 internalEditor \u548C internalNode \u7EF4\u62A4\u72B6\u6001"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["useInternalNode\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4ECE NodeContext \u66B4\u9732\u989D\u5916\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["NodeContext\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5305\u542B id, related, connectors"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["UserComponent\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9644\u52A0\u989D\u5916\u914D\u7F6E\u4FE1\u606F\u7684\u7EC4\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"name"}),"\n",(0,i.jsx)(e.li,{children:"rules - \u63A7\u5236\u62D6\u62C9\u884C\u4E3A"}),"\n",(0,i.jsx)(e.li,{children:"related"}),"\n",(0,i.jsx)(e.li,{children:"defaultProps"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Node - \u8282\u70B9\u4FE1\u606F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"id"}),"\n",(0,i.jsx)(e.li,{children:"data"}),"\n",(0,i.jsx)(e.li,{children:"events - selected\u3001dragged\u3001hovered"}),"\n",(0,i.jsx)(e.li,{children:"dom"}),"\n",(0,i.jsx)(e.li,{children:"related"}),"\n",(0,i.jsx)(e.li,{children:"rules - canDrag\u3001canMoveIn\u3001canMoveOut"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["NodeData - \u8282\u70B9\u6570\u636E\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"props"}),"\n",(0,i.jsx)(e.li,{children:"type"}),"\n",(0,i.jsx)(e.li,{children:"name"}),"\n",(0,i.jsx)(e.li,{children:"displayName"}),"\n",(0,i.jsx)(e.li,{children:"isCanvas"}),"\n",(0,i.jsx)(e.li,{children:"parent"}),"\n",(0,i.jsx)(e.li,{children:"index"}),"\n",(0,i.jsx)(e.li,{children:"nodes"}),"\n",(0,i.jsx)(e.li,{children:"hidden"}),"\n",(0,i.jsx)(e.li,{children:"custom"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u5E8F\u5217\u5316\u4F1A\u6392\u51FA\u9ED8\u8BA4\u7684 type\u3001props\u3001isCanvas\u3001name \u7136\u540E\u5E8F\u5217\u5316\u7EC4\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://craft.js.org/r/docs/acknowledgements/",children:"https://craft.js.org/r/docs/acknowledgements/"})}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},17776:function(n,e,r){r.d(e,{R:()=>l,x:()=>d});var s=r(7378);let i={},t=s.createContext(i);function l(n){let e=s.useContext(t);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),s.createElement(t.Provider,{value:e},n.children)}}}]);