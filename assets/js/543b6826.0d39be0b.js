"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["83750"],{36076:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>j,default:()=>o,metadata:()=>i,assets:()=>d,contentTitle:()=>r});var i=JSON.parse('{"id":"service/storage/juicefs/README","title":"juicefs","description":"- juicedata/juicefs","source":"@site/../notes/service/storage/juicefs/README.md","sourceDirName":"service/storage/juicefs","slug":"/service/storage/juicefs/","permalink":"/notes/service/storage/juicefs/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/juicefs/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1713894098000,"frontMatter":{"title":"juicefs"},"sidebar":"docs","previous":{"title":"immich","permalink":"/notes/service/storage/immich"},"next":{"title":"JuiceFS Configuration","permalink":"/notes/service/storage/juicefs/conf"}}'),l=s(86106),c=s(17776);let t={title:"juicefs"},r="juicefs",d={},j=[{value:"Docker",id:"docker",level:2},{value:"SQL",id:"sql",level:2}];function h(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"juicefs",children:"juicefs"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/juicedata/juicefs",children:"juicedata/juicefs"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Apache-2.0, Go"}),"\n",(0,l.jsx)(n.li,{children:"\u5143\u6570\u636E \u548C \u6570\u636E \u5206\u79BB"}),"\n",(0,l.jsxs)(n.li,{children:["distributed ",(0,l.jsx)(n.strong,{children:"POSIX"})," fs"]}),"\n",(0,l.jsx)(n.li,{children:"metadata - Redis, Postgres, MySQL, SQLite3, badger, TiKV"}),"\n",(0,l.jsxs)(n.li,{children:["data - s3, minio, webdav, redis, file, sqlite3, mysql, postgres, sftp\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://juicefs.com/docs/community/how_to_setup_object_storage/#supported-object-storage",children:"Supported Object Storage"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u63A5\u53E3\u652F\u6301 S3, HDFS, CSI"}),"\n",(0,l.jsx)(n.li,{children:"64MiB Chunk -> Slice -> 4 MiB Block"}),"\n",(0,l.jsx)(n.li,{children:"4MiB cache granularity"}),"\n",(0,l.jsx)(n.li,{children:"\u652F\u6301\u538B\u7F29 - lz4, zstd"}),"\n",(0,l.jsx)(n.li,{children:"\u652F\u6301\u52A0\u5BC6"}),"\n",(0,l.jsx)(n.li,{children:"\u652F\u6301\u56DE\u6536\u7AD9"}),"\n",(0,l.jsxs)(n.li,{children:["\u5BF9\u5E26\u5BBD\u8981\u6C42\u9AD8\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5E26\u5BBD\u4E0D\u8DB3\uFF0C\u53EF\u4EE5\u628A\u7F13\u5B58\u8BBE\u5927\uFF0C\u518D\u5F00\u542F\u5F02\u6B65\u5199\u5165\u6A21\u5F0F --writeback"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/engineering/distributed-filesystem-comparison",children:"https://juicefs.com/zh-cn/blog/engineering/distributed-filesystem-comparison"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/solutions/clickhouse-disaggregated-storage-and-compute-practice",children:"https://juicefs.com/zh-cn/blog/solutions/clickhouse-disaggregated-storage-and-compute-practice"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://juicefs.com/zh-cn/blog/engineering/similarities-and-differences-between-seaweedfs-and-juicefs-structures",children:"vs SeaweedFS"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{title:"\u4E0D\u63D0\u4F9B\u5B9E\u9645\u5B58\u50A8",type:"caution",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5C06\u5BF9\u8C61\u5B58\u50A8\u66B4\u9732\u4E3A FS \u5B58\u50A8\u534F\u8BAE"}),"\n",(0,l.jsx)(n.li,{children:"\u7EF4\u62A4 FS \u5143\u6570\u636E"}),"\n",(0,l.jsx)(n.li,{children:"\u672C\u8EAB\u4E0D\u5B58\u50A8\u6570\u636E"}),"\n"]})}),"\n",(0,l.jsxs)(n.admonition,{title:"\u9650\u5236",type:"info",children:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"limit"}),(0,l.jsx)(n.th,{children:"for"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u76EE\u5F55\u6DF1\u5EA6"}),(0,l.jsx)(n.td,{children:"\u4E0D\u9650"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u6587\u4EF6\u540D\u957F\u5EA6"}),(0,l.jsx)(n.td,{children:"255"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"soft link \u957F\u5EA6"}),(0,l.jsx)(n.td,{children:"4096 bytes"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"hard link"}),(0,l.jsx)(n.td,{children:"2^31"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u76EE\u5F55\u6587\u4EF6\u6570"}),(0,l.jsx)(n.td,{children:"2^31"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"volume \u6587\u4EF6\u6570"}),(0,l.jsx)(n.td,{children:"unlimited"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u5355\u6587\u4EF6\u5927\u5C0F"}),(0,l.jsx)(n.td,{children:"2^(26+31) = 2^57 = 128 TiB"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u603B\u6587\u4EF6\u5927\u5C0F"}),(0,l.jsx)(n.td,{children:"4EiB"})]})]})]})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"brew install juicefs # macOS\n\n# \u624B\u52A8\u5B89\u88C5 Linux, Darwin\nVER=$(curl -s https://api.github.com/repos/juicedata/juicefs/releases/latest | grep 'tag_name' | cut -d '\"' -f 4 | tr -d 'v')\ncurl -L -o juicefs.tar.gz \"https://github.com/juicedata/juicefs/releases/download/v${VER}/juicefs-${VER}-$(uname -s | tr '[:upper:]' '[:lower:]')-amd64.tar.gz\"\ntar zxvf juicefs.tar.gz juicefs\n./juicefs version\nsudo mv juicefs /usr/local/bin/\n\n# META-URL MOUNTPOINT\n# --storage file --bucket $HOME/.juicefs/local \u4E3A\u9ED8\u8BA4\u503C\njuicefs format \\\n  --storage file --bucket $HOME/.juicefs/local \\\n  sqlite3://jfs.db jfs\n\nls $HOME/.juicefs/local/jfs/\nsqlite3 jfs.db \"select * from jfs_setting\"\n\n# macOS \u9700\u8981\u5B89\u88C5 macFUSE\nbrew install macfuse\n\n# 100GB \u7F13\u5B58\u5230 $HOME/.juicefs/cache\n# 1h \u5143\u6570\u636E\u5907\u4EFD\n# http://localhost:9567/metrics\njuicefs mount \\\n  --cache-dir $HOME/.juicefs/cache --cache-size 102400 \\\n  --backup-meta 1h \\\n  -o allow_other -o allow_root \\\n  sqlite3://jfs.db $PWD/mnt\n\ncd mnt\njuicefs bench .\n\ntouch test.txt\ntouch $(cat /dev/urandom | tr -dc '0' | head -c 255) # \u6210\u529F\ntouch $(cat /dev/urandom | tr -dc '0' | head -c 256) # \u5931\u8D25\n\ncd -\n\njuicefs info mnt/test.txt            # \u6587\u4EF6\u4FE1\u606F\njuicefs info mnt                     # \u76EE\u5F55\u4FE1\u606F\njuicefs config sqlite3://jfs.db      # \u914D\u7F6E\u4FE1\u606F\njuicefs status sqlite3://jfs.db      # session \u72B6\u6001\njuicefs gc sqlite3://jfs.db          # \u6570\u636E\u626B\u63CF\njuicefs gc sqlite3://jfs.db --delete # \u6570\u636E\u6E05\u7406\njuicefs fsck sqlite3://jfs.db        # \u6570\u636E\u6821\u9A8C\njuicefs profile mnt                  # \u64CD\u4F5C\u76D1\u63A7\njuicefs stats mnt                    # io \u7EDF\u8BA1\n\njuicefs gateway sqlite3://jfs.db 0.0.0.0:9090 # S3 \u7F51\u5173\n\n# \u5143\u6570\u636E\u5907\u4EFD\n# --subdir \u53EA\u5907\u4EFD\u6307\u5B9A\u76EE\u5F55\njuicefs dump sqlite3://jfs.db meta.dump.json\n# \u5143\u6570\u636E\u6062\u590D - \u786E\u4FDD\u6CA1\u6709\u5199\u5165\njuicefs load redis://127.0.0.1:6379/1 meta.dump.json\n\n# \u6570\u636E\u6E05\u7A7A\nUUID=$(juicefs status sqlite3://jfs.db | jq .Setting.UUID -r)\n# \u6240\u6709 session \u65AD\u5F00\u540E\u624D\u53EF\u4EE5\u64CD\u4F5C\njuicefs destroy sqlite3://jfs.db $UUID\ndu -sh $HOME/.juicefs/local/jfs/\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["~/.juicefs/local/jfs/\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"juicefs_uuid"}),"\n",(0,l.jsx)(n.li,{children:"chunks/"}),"\n",(0,l.jsx)(n.li,{children:"testing/"}),"\n",(0,l.jsxs)(n.li,{children:["meta/\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"dump-2023-03-16-174211.json.gz"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["/mnt/\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:".accesslog"}),"\n",(0,l.jsx)(n.li,{children:".config"}),"\n",(0,l.jsx)(n.li,{children:".stats - \u7EDF\u8BA1"}),"\n",(0,l.jsxs)(n.li,{children:[".trash/\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["YYYY-mm-dd-hh/\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"{\u7236\u76EE\u5F55 inode}-{\u6587\u4EF6 inode}-{\u539F\u59CB\u6587\u4EF6\u540D}"})," - \u67E5\u8BE2 inode ",(0,l.jsx)(n.code,{children:"juicefs info -i 3"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"meta/ - \u5143\u6570\u636E\u5907\u4EFD"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["backup-meta\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u26A0\uFE0F \u8D85\u8FC7 100 \u4E07 \u5219\u4E0D\u5728\u6BCF 1h \u81EA\u52A8\u5907\u4EFD\uFF0C\u9700\u8981\u624B\u52A8\u914D\u7F6E\u66F4\u5927\u95F4\u9694"}),"\n",(0,l.jsx)(n.li,{children:"Redis 100 \u4E07 1 \u5206\u949F 1GB \u5185\u5B58"}),"\n",(0,l.jsxs)(n.li,{children:["\u6E05\u7406\u89C4\u5219\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4FDD\u7559 2 \u5929\u5B8C\u6574"}),"\n",(0,l.jsx)(n.li,{children:"< 2 \u5468, \u6BCF\u5929\u4FDD\u7559 1 \u4EFD"}),"\n",(0,l.jsx)(n.li,{children:"< 2 \u6708, \u6BCF\u5468\u4FDD\u7559 1 \u4EFD"}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"2 \u6708, \u6BCF\u6708\u4FDD\u7559 1 \u4EFD"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["file\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"$HOME/.juicefs/local"}),"\n",(0,l.jsx)(n.li,{children:"/var/jfs"}),"\n",(0,l.jsx)(n.li,{children:"C:/jfs/local"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["fuse \u9009\u9879\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["writeback_cache\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Linux 3.15+ ",(0,l.jsx)(n.a,{href:"https://www.kernel.org/doc/Documentation/filesystems/fuse-io.txt",children:"https://www.kernel.org/doc/Documentation/filesystems/fuse-io.txt"})]}),"\n",(0,l.jsx)(n.li,{children:"\u5229\u4E8E\u5C0F\u6570\u636E(e.g. 100b)\u9891\u7E41\u8BFB\u5199"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"user_id=100,group_id=100"}),"\n",(0,l.jsx)(n.li,{children:"debug"}),"\n",(0,l.jsx)(n.li,{children:"allow_other"}),"\n",(0,l.jsx)(n.li,{children:"allow_root"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/pjd/pjdfstest",children:"pjd/pjdfstest"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"POSIX test suite"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/linux-test-project/ltp",children:"linux-test-project/ltp"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"docker",children:"Docker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker plugin install juicedata/juicefs --alias juicefs\n\ndocker volume create -d juicefs \\\n  -o name=VOLUME_NAME \\\n  -o metaurl=META_URL \\\n  -o storage=STORAGE_TYPE \\\n  -o bucket=BUCKET_NAME \\\n  -o access-key=ACCESS_KEY \\\n  -o secret-key=SECRET_KEY \\\n  jfsvolume\n\n# \u5DF2\u6709 volume\ndocker volume create -d juicefs \\\n  -o name=VOLUME_NAME \\\n  -o metaurl=META_URL \\\n  jfsvolume\n\ndocker run -it -v jfsvolume:/opt wener/base ls /opt\n\ndocker volume rm jfsvolume\n\n# disable,upgrade,enable,rm\ndocker plugin disable juicefs\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://hub.docker.com/r/juicedata/mount",children:"https://hub.docker.com/r/juicedata/mount"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/juicedata/juicefs/blob/main/hack/builder/Dockerfile",children:"https://github.com/juicedata/juicefs/blob/main/hack/builder/Dockerfile"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"sql",children:"SQL"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["storage\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"jfs_blob"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["metadata\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"jfs_chunk"}),"\n",(0,l.jsx)(n.li,{children:"jfs_chunk_ref"}),"\n",(0,l.jsx)(n.li,{children:"jfs_counter"}),"\n",(0,l.jsx)(n.li,{children:"jfs_delfile"}),"\n",(0,l.jsx)(n.li,{children:"jfs_delslices"}),"\n",(0,l.jsx)(n.li,{children:"jfs_detached_node"}),"\n",(0,l.jsx)(n.li,{children:"jfs_dir_quota"}),"\n",(0,l.jsx)(n.li,{children:"jfs_dir_stats"}),"\n",(0,l.jsx)(n.li,{children:"jfs_edge"}),"\n",(0,l.jsx)(n.li,{children:"jfs_flock"}),"\n",(0,l.jsx)(n.li,{children:"jfs_node"}),"\n",(0,l.jsx)(n.li,{children:"jfs_plock"}),"\n",(0,l.jsx)(n.li,{children:"jfs_session2"}),"\n",(0,l.jsx)(n.li,{children:"jfs_setting"}),"\n",(0,l.jsx)(n.li,{children:"jfs_sustained"}),"\n",(0,l.jsx)(n.li,{children:"jfs_symlink"}),"\n",(0,l.jsx)(n.li,{children:"jfs_xattr"}),"\n"]}),"\n"]}),"\n"]})]})}function o(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},17776:function(e,n,s){s.d(n,{R:()=>t,x:()=>r});var i=s(7378);let l={},c=i.createContext(l);function t(e){let n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);