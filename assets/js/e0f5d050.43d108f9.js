"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["251541"],{960605:function(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>o});var d=s(834861),i=s(486106),r=s(917776);let l={slug:"rescue-root-disk",title:"\u7CFB\u7EDF\u76D8\u6062\u590D",tags:["AlpineLinux","\u8FD0\u7EF4"]},t="\u7CFB\u7EDF\u76D8\u6062\u590D",a={authorsImageUrls:[]},o=[{value:"\u73B0\u72B6",id:"\u73B0\u72B6",level:2},{value:"\u5907\u4EFD\u6062\u590D\u65B9\u6848",id:"\u5907\u4EFD\u6062\u590D\u65B9\u6848",level:2},{value:"\u6062\u590D",id:"\u6062\u590D",level:2},{value:"\u51C6\u5907\u5907\u4EFD\u76D8",id:"\u51C6\u5907\u5907\u4EFD\u76D8",level:3},{value:"\u5206\u533A\u8868&amp;\u542F\u52A8\u5206\u533A\u5907\u4EFD",id:"\u5206\u533A\u8868\u542F\u52A8\u5206\u533A\u5907\u4EFD",level:3},{value:"root \u5206\u533A\u5907\u4EFD",id:"root-\u5206\u533A\u5907\u4EFD",level:3},{value:"\u9A8C\u8BC1",id:"\u9A8C\u8BC1",level:3},{value:"\u603B\u7ED3",id:"\u603B\u7ED3",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\u559C\u6B22\u4F7F\u7528 \u95EA\u5B58\u76D8/U \u76D8 \u4F5C\u4E3A Linux \u7CFB\u7EDF\u76D8\uFF0C\u4F46 U \u76D8 \u4F7F\u7528\u5BFF\u547D\u6709\u9650\uFF0C\u5F53\u5F02\u5E38\u540E\u9700\u8981\u5BF9\u7CFB\u7EDF\u76D8\u8FDB\u884C\u66F4\u6362\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u73B0\u72B6",children:"\u73B0\u72B6"}),"\n",(0,i.jsx)(n.p,{children:"\u4F7F\u7528 SanDisk CZ430 \u4F5C\u4E3A \u7CFB\u7EDF\u76D8/Root \u5206\u533A"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"lsblk"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nsda      8:0    1 114.6G  0 disk\n\u251C\u2500sda1   8:1    1   128M  0 part /boot\n\u2514\u2500sda2   8:2    1 114.4G  0 part /\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"df -h /"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Filesystem      Size  Used Avail Use% Mounted on\n/dev/sda2       113G  2.2G  106G   2% /\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u4F7F\u7528\u4E00\u6BB5\u65F6\u95F4\u540E\uFF0C U \u76D8 \u5F02\u5E38\uFF0C\u7CFB\u7EDF\u88AB\u91CD\u65B0\u6302\u8F7D\u4E3A\u53EA\u8BFB\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"touch ~/test\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"touch: cannot touch '/home/admin/test': Read-only file system\n"})}),"\n",(0,i.jsx)(n.p,{children:"dmesg \u53EF\u770B\u5230\u5F02\u5E38\u4FE1\u606F\uFF0C\u51E0\u4E2A\u6708\u524D\u5DF2\u7ECF\u51FA\u95EE\u9898\u4E86\uFF0C\u56E0\u4E3A\u7CFB\u7EDF\u8FD8\u80FD\u6B63\u5E38\u4F7F\u7528\u6682\u4E14\u6CA1\u7BA1\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dmesg",metastring:'title="dmesg -T"',children:"[Tue Sep  7 16:48:16 2021] sd 2:0:0:0: [sda] tag#0 UNKNOWN(0x2003) Result: hostbyte=0x00 driverbyte=0x08 cmd_age=0s\n[Tue Sep  7 16:48:16 2021] sd 2:0:0:0: [sda] tag#0 Sense Key : 0x7 [current]\n[Tue Sep  7 16:48:16 2021] sd 2:0:0:0: [sda] tag#0 ASC=0x27 ASCQ=0x0\n[Tue Sep  7 16:48:16 2021] sd 2:0:0:0: [sda] tag#0 CDB: opcode=0x2a 2a 00 00 04 16 90 00 00 08 00\n[Tue Sep  7 16:48:16 2021] blk_update_request: critical target error, dev sda, sector 267920 op 0x1:(WRITE) flags 0x103000 phys_seg 1 prio class 0\n[Tue Sep  7 16:48:16 2021] Buffer I/O error on dev sda2, logical block 466, lost async page write\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5907\u4EFD\u6062\u590D\u65B9\u6848",children:"\u5907\u4EFD\u6062\u590D\u65B9\u6848"}),"\n",(0,i.jsx)(n.p,{children:"\u5C06\u73B0\u5728\u6570\u636E\u5B8C\u6574\u5907\u4EFD\u5230\u65B0\u7684 U \u76D8\uFF0C\u91CD\u542F\u5373\u53EF\uFF0C\u4F46\u6062\u590D\u5907\u4EFD\u6709\u597D\u51E0\u79CD\u65B9\u5F0F\u3002"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u5168\u76D8 dd"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u901F\u5EA6\u6162"}),"\n",(0,i.jsx)(n.li,{children:"\u7B80\u5355\u66B4\u529B"}),"\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u63D0\u4F9B\u81F3\u5C11\u73B0\u5728\u78C1\u76D8\u5927\u5C0F\u7684\u5B58\u50A8"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"\u91CD\u88C5 - \u4EC5\u62F7\u8D1D\u6570\u636E"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9EBB\u70E6"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"\u6062\u590D\u5206\u533A\u3001\u6062\u590D\u6570\u636E"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9AD8\u6548"}),"\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u591A\u4E00\u70B9\u64CD\u4F5C"}),"\n",(0,i.jsx)(n.li,{children:"\u65B0\u78C1\u76D8\u53EA\u9700\u8981\u5DF2\u7528\u7A7A\u95F4\u5927\u5C0F\u5373\u53EF"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6062\u590D",children:"\u6062\u590D"}),"\n",(0,i.jsx)(n.p,{children:"\u56E0\u4E3A\u8FD9\u662F\u5DF2\u7ECF\u7B2C\u4E09\u56DB\u6B21\u6062\u590D\u4E86\uFF0C\u4E4B\u524D\u90FD\u662F dd\uFF0C\u4F46\u8FD9\u6B21\u6253\u7B97\u7528\u66F4\u9AD8\u6548\u7684\u65B9\u5F0F\uFF0C\u4E14\u8FD9\u6B21\u7684\u7CFB\u7EDF\u76D8\u4E3A 128G\uFF0C\u4F46\u76EE\u524D\u53EA\u6709 64G \u7684\u7A7A\u95F2 U \u76D8\uFF0C\u6545\u9009\u62E9\u65B9\u6848 3\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6062\u590D\u8FC7\u7A0B"})}),"\n",(0,i.jsxs)(n.ol,{start:"0",children:["\n",(0,i.jsx)(n.li,{children:"\u51C6\u5907\u5907\u4EFD\u76D8"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u533A\u8868\u5907\u4EFD & \u542F\u52A8\u5206\u533A\u5907\u4EFD"}),"\n",(0,i.jsx)(n.li,{children:"root \u5206\u533A \u5907\u4EFD & \u4FEE\u590D"}),"\n",(0,i.jsx)(n.li,{children:"\u9A8C\u8BC1"}),"\n",(0,i.jsx)(n.li,{children:"\u5173\u673A"}),"\n",(0,i.jsx)(n.li,{children:"\u53D6\u6389\u574F\u7684 U \u76D8"}),"\n",(0,i.jsx)(n.li,{children:"\u5F00\u673A"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"\u6062\u590D\u5907\u4EFD\u6CE8\u610F\u4E8B\u9879",type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9009\u62E9\u4E00\u4E2A\u53EF\u5199\u76EE\u5F55 - tmpfs,shm - \u4F8B\u5982: /run, /var/run, /tmp, /dev/shm"}),"\n"]})}),"\n",(0,i.jsx)(n.h3,{id:"\u51C6\u5907\u5907\u4EFD\u76D8",children:"\u51C6\u5907\u5907\u4EFD\u76D8"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5907\u4EFD\u76D8 /dev/sdb 64G\uFF0C\u540C SanDisk CZ430"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-pre",metastring:'title="lsblk"',children:"NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nsda      8:0    1 114.6G  0 disk\n\u251C\u2500sda1   8:1    1   128M  0 part /boot\n\u2514\u2500sda2   8:2    1 114.4G  0 part /\nsdb      8:16   1  57.3G  0 disk\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5206\u533A\u8868\u542F\u52A8\u5206\u533A\u5907\u4EFD",children:"\u5206\u533A\u8868&\u542F\u52A8\u5206\u533A\u5907\u4EFD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u786E\u4FDD\u4F7F\u7528 root \u7528\u6237\u64CD\u4F5C\nsudo su\n# \u8FDB\u5165\u53EF\u5199\u76EE\u5F55\ncd /run\n\n# \u6B63\u5E38\u60C5\u51B5\u5206\u533A\u8868\u7684\u5907\u4EFD\u6062\u590D\n# sfdisk -d /dev/sda | sfdisk -f /dev/sdb\n\n# \u9009\u62E9\u7B80\u5355\u65B9\u5F0F\u5907\u4EFD\u540E\u518D\u4FEE\u6539\u6700\u540E\u5206\u533A\n# \u8FD9\u91CC dd 130MB - \u540C\u65F6\u628A boot \u5206\u533A\u5907\u4EFD\u4E86\ndd if=/dev/sda of=/dev/sdb bs=1M count=130 status=progress\n\n# \u8F6C\u50A8\u5206\u533A\u8868\nsfdisk -d /dev/sda > sda.partition.table.txt\n# \u5220\u9664\u7B2C\u4E8C\u4E2A\u5206\u533A\u7684\u5927\u5C0F\nsed -r '$ s/size=\\s*\\d+,//' -i sda.partition.table.txt\n# \u91CD\u5EFA\u5206\u533A\nsfdisk -f /dev/sdb < sda.partition.table.txt\n# \u73B0\u5728\u5206\u533A\u5927\u5C0F\u6B63\u5E38\nfdisk -l /dev/sdb\n\n# \u5206\u533A\u53D8\u5316\u91CD\u65B0\u626B\u63CF\nmdev -s\npartprobe\n# \u51FA\u73B0\u5206\u533A\nls /dev/sdb*\n"})}),"\n",(0,i.jsx)(n.h3,{id:"root-\u5206\u533A\u5907\u4EFD",children:"root \u5206\u533A\u5907\u4EFD"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"root \u5206\u533A\u4E00\u822C\u8F83\u5927\uFF0C\u76F4\u63A5 dd \u6162\u4E14\u4F24 U \u76D8"}),"\n",(0,i.jsx)(n.li,{children:"\u76F4\u63A5 dd \u9700\u8981\u76EE\u6807\u76F8\u540C\u5927\u5C0F\uFF0C\u5426\u5219\u4E22\u6570\u636E"}),"\n",(0,i.jsx)(n.li,{children:"\u8FD9\u91CC\u4F7F\u7528 clone \u6570\u636E\u65B9\u5F0F"}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"\u7531\u4E8E\u76EE\u6807\u5206\u533A\u66F4\u5C0F\uFF0C\u4E0D\u80FD\u76F4\u63A5\u590D\u5236",type:"caution",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# ext4 \u6570\u636E\u62F7\u8D1D - \u57FA\u4E8E ext4 block\uFF0C\u53EA\u62F7\u8D1D\u4F7F\u7528\u90E8\u5206\n# \u4E5F\u53EF\u4EE5\u7528\u4E8E\u751F\u6210 img \u5907\u4EFD\u955C\u50CF\u4E4B\u540E\u7528\ne2image -ra -p /dev/sda2 /dev/sdb2\n"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5982\u679C\u5206\u533A\u5927\u5C0F\u8DB3\u591F\uFF0C\u76F4\u63A5\u590D\u5236\u5373\u53EF"}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"\u56E0\u4E3A root \u5206\u533A\u4E3A 120G\uFF0C\u4F46\u5B9E\u9645\u53EA\u7528\u4E86 2.2G\uFF0C \u5148\u955C\u50CF\u5206\u533A\uFF0C\u7F29\u5C0F\u5206\u533A\uFF0C\u7136\u540E\u6062\u590D\u5230\u65B0\u7684\u5206\u533A\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7D22\u6027\u5185\u5B58\u6709 4G\uFF0C\u56E0\u6B64\u76F4\u63A5\u5728 /dev/shm \u64CD\u4F5C\uFF0C\u5426\u5219\u9700\u8981\u5916\u7F6E\u5B58\u50A8\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4ECE\u65B0\u6302\u8F7D\u4E3A 3G - \u9ED8\u8BA4 2G\nmount -o remount,size=3G /dev/shm\n# \u5236\u4F5C\u955C\u50CF\ne2image -rap /dev/sda2 sda2.raw\n\n# \u4FEE\u590D\u5206\u533A - \u4E00\u822C U\u76D8 \u635F\u574F\u90FD\u4F1A\u5BFC\u81F4 fs \u5F02\u5E38\ne2fsck -y sda2.raw\n# \u7F29\u5C0F\u5206\u533A\nresize2fs sda2.raw 4G\n# \u6062\u590D\ne2image -rap sda2.raw /dev/sdb2\n# \u6269\u5C55\u5206\u533A\nresize2fs /dev/sdb2\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u9A8C\u8BC1",children:"\u9A8C\u8BC1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"fsck /dev/sdb1\nfsck /dev/sdb2\n\nmount /dev/sdb2 /mnt\nmount /dev/sdb1 /mnt/boot\n# \u4E0D\u5E94\u8BE5\u6709\u53D8\u5316\nrsync -vna /boot/ /mnt/boot/\n\n# \u7531\u4E8E fsck \u4FEE\u590D\uFF0C\u53EF\u80FD root \u5206\u533A\u5927\u5C0F\u4E0D\u540C\ndf / /mnt /boot /mnt/boot\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679C\u88C5\u6709 qemu\uFF0C\u8FD8\u53EF\u4EE5\u76F4\u63A5\u542F\u7528 qemu \u9A8C\u8BC1\uFF0C\u76EE\u524D\u5C31\u7B80\u5355\u786E\u8BA4\u6587\u4EF6\u6CA1\u95EE\u9898\u5373\u53EF\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u51C6\u5907\u5173\u673A\u91CD\u542F\numount -R /mnt\neject /dev/sdb\n\npoweroff\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53D6\u6389 \u574F\u7684 U \u76D8\uFF0C\u542F\u52A8\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4E00\u5207\u6062\u590D\u6B63\u5E38\u3002\u{1F389}"}),"\n",(0,i.jsx)(n.h2,{id:"\u603B\u7ED3",children:"\u603B\u7ED3"}),"\n",(0,i.jsx)(n.p,{children:"\u7CFB\u7EDF\u76D8\u6062\u590D\u8FD8\u662F\u76F8\u5F53\u5BB9\u6613\uFF0C\u4F46 CZ430 \u786E\u5B9E\u6709\u70B9\u8001\u4E86\uFF0C\u5728 2017 \u5E74\u5DE6\u53F3\u4E0A\u5E02\uFF0C\u76F8\u540C\u89C4\u683C\u5DF2\u7ECF\u5356 4\u30015 \u5E74\u4E86\uFF0C\u6027\u80FD\u5404\u65B9\u9762\u6709\u6240\u6B20\u7F3A\uFF0C\u4E4B\u540E\u4F1A\u5C3D\u91CF\u9009\u62E9 Lexar S47\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://wener.me/notes/ops/admin/fio-out/",children:"https://wener.me/notes/ops/admin/fio-out/"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SanDisk CZ430, Lexar S47 \u6027\u80FD\u5BF9\u6BD4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6B64\u5916\u4F7F\u7528 U \u76D8 \u505A\u7CFB\u7EDF\u76D8\u7684\u65F6\u5019\uFF0C\u4E00\u5B9A\u6CE8\u610F\u4FEE\u6539 docker \u4E4B\u7C7B\u7684\u6570\u636E\u76EE\u5F55\u4E3A\u5176\u4ED6\u5B58\u50A8\uFF0C\u56E0\u4E3A\u8DD1\u5B9E\u9645\u5E94\u7528\u7684\u65F6\u5019 U \u76D8 \u6027\u80FD\u662F\u4E0D\u8DB3\u7684\uFF0C\u4E14\u6570\u636E\u5E93\u7C7B\u578B\u5E94\u7528\u7684\u5C0F BlockSize IO \u4E0D\u9002\u5408 U \u76D8\u3002"})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},917776:function(e,n,s){s.d(n,{R:()=>l,x:()=>t});var d=s(7378);let i={},r=d.createContext(i);function l(e){let n=d.useContext(r);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),d.createElement(r.Provider,{value:n},e.children)}},834861:function(e){e.exports=JSON.parse('{"permalink":"/story/rescue-root-disk","editUrl":"https://github.com/wenerme/wener/edit/master/story/../story/2021/2021-11-17-rescue-root-disk.md","source":"@site/../story/2021/2021-11-17-rescue-root-disk.md","title":"\u7CFB\u7EDF\u76D8\u6062\u590D","description":"\u559C\u6B22\u4F7F\u7528 \u95EA\u5B58\u76D8/U \u76D8 \u4F5C\u4E3A Linux \u7CFB\u7EDF\u76D8\uFF0C\u4F46 U \u76D8 \u4F7F\u7528\u5BFF\u547D\u6709\u9650\uFF0C\u5F53\u5F02\u5E38\u540E\u9700\u8981\u5BF9\u7CFB\u7EDF\u76D8\u8FDB\u884C\u66F4\u6362\u3002","date":"2021-11-17T00:00:00.000Z","tags":[{"inline":true,"label":"AlpineLinux","permalink":"/story/tags/alpine-linux"},{"inline":true,"label":"\u8FD0\u7EF4","permalink":"/story/tags/\u8FD0\u7EF4"}],"readingTime":4.73,"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"rescue-root-disk","title":"\u7CFB\u7EDF\u76D8\u6062\u590D","tags":["AlpineLinux","\u8FD0\u7EF4"]},"unlisted":false,"prevItem":{"title":"\u4ECE\u65B0\u5B66\u4E60","permalink":"/story/relearning"},"nextItem":{"title":"PostgreSQL ORDER BY+LIMIT \u65F6\u7684\u7D22\u5F15\u9009\u62E9","permalink":"/story/postgresql-use-wrong-index-with-order-and-limit"}}')}}]);