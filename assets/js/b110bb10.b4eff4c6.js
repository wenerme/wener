"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["89741"],{92827:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>r,toc:()=>c,default:()=>u,metadata:()=>l,assets:()=>h,contentTitle:()=>d});var l=JSON.parse('{"id":"service/storage/tus","title":"tus","description":"- tus","source":"@site/../notes/service/storage/tus.md","sourceDirName":"service/storage","slug":"/service/storage/tus","permalink":"/notes/service/storage/tus","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/tus.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1740927882000,"frontMatter":{"title":"tus"},"sidebar":"docs","previous":{"title":"Storage Glossary","permalink":"/notes/service/storage/glossary"},"next":{"title":"uppy","permalink":"/notes/service/storage/uppy"}}'),i=s(86106),t=s(17776);let r={title:"tus"},d="tus",h={},c=[{value:"Protocol",id:"protocol",level:2},{value:"hooks",id:"hooks",level:2},{value:"extensions",id:"extensions",level:2}];function o(n){let e={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"tus",children:"tus"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["tus\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://tus.io/implementations.html",children:"https://tus.io/implementations.html"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"SDK for JS, Java, iOS, Python, NodeJS, .NET"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["tus v1 ",(0,i.jsx)(e.a,{href:"https://tus.io/protocols/resumable-upload.html",children:"\u534F\u8BAE"})]}),"\n",(0,i.jsxs)(e.li,{children:["tus v2 \u88AB httpwg \u91C7\u7528\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/httpwg/http-extensions/blob/main/draft-ietf-httpbis-resumable-upload.md",children:"https://github.com/httpwg/http-extensions/blob/main/draft-ietf-httpbis-resumable-upload.md"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/tus/tusd",children:"tus/tusd"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MIT, Golang"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u6682\u505C\u6062\u590D"}),"\n",(0,i.jsxs)(e.li,{children:["\u4F7F\u7528 hook \u673A\u5236\u6765\u5B9E\u73B0\u4E1A\u52A1\u903B\u8F91\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"shell, http, gRPC, golang plugin"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/tus/tus-node-server",children:"tus/tus-node-server"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"NodeJS server"}),"\n",(0,i.jsx)(e.li,{children:"@tus/server, @tus/file-store, @tus/s3-store"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 EVENTS \u6765\u5B9E\u73B0\u81EA\u5B9A\u4E49\u903B\u8F91"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"uppy"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tus/tus-js-client",children:"tus/tus-js-client"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"protocol",children:"Protocol"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5934\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Upload-Offset\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5F53\u524D"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Upload-Length\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6574\u4F53\u5927\u5C0F"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Tus-Version\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"1.0.0"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Tus-Resumable\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"OPTIONS \u9700\u8981\u5305\u542B"}),"\n",(0,i.jsx)(e.li,{children:"\u503C\u4E3A\u7248\u672C\u53F7"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7248\u672C\u4E0D\u652F\u6301\u8FD4\u56DE 412 Precondition Failed"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Tus-Extension\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u670D\u52A1\u7AEF\u8FD4\u56DE\uFF0C\u9017\u53F7\u5206\u9694"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Tus-Max-Size\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u670D\u52A1\u7AEF\u8FD4\u56DE"}),"\n",(0,i.jsx)(e.li,{children:"\u6700\u5927\u6587\u4EF6\u5927\u5C0F"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"X-HTTP-Method-Override"}),"\n",(0,i.jsx)(e.li,{children:"Upload-Defer-Length"}),"\n",(0,i.jsx)(e.li,{children:"Upload-Metadata"}),"\n",(0,i.jsx)(e.li,{children:"Tus-Checksum-Algorithm"}),"\n",(0,i.jsx)(e.li,{children:"Upload-Checksum"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u65B9\u6CD5\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"HEAD"}),"\n",(0,i.jsx)(e.li,{children:"PATCH"}),"\n",(0,i.jsx)(e.li,{children:"OPTIONS"}),"\n",(0,i.jsxs)(e.li,{children:["\u521B\u5EFA\u4E0A\u4F20\u8D44\u6E90\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["-> ",(0,i.jsx)(e.code,{children:"POST /files"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Upload-Length"}),"\n",(0,i.jsx)(e.li,{children:"Upload-Metadata"}),"\n",(0,i.jsx)(e.li,{children:"Tus-Resumable"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["<- 201 Created\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Location"}),"\n",(0,i.jsx)(e.li,{children:"Tus-Resumable"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-http",children:"OPTIONS /files HTTP/1.1\nHost: tus.example.org\n\nHTTP/1.1 204 No Content\nTus-Resumable: 1.0.0\nTus-Version: 1.0.0\nTus-Extension: checksum\nTus-Checksum-Algorithm: md5,sha1,crc32\n"})}),"\n",(0,i.jsx)(e.h1,{id:"tusd",children:"tusd"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"tusd -upload-dir=./data\n\nexport AWS_ACCESS_KEY_ID=xxxxx\nexport AWS_SECRET_ACCESS_KEY=xxxxx\nexport AWS_REGION=eu-west-1\ntusd -s3-bucket=my-test-bucket.com -s3-endpoint=minio -s3-object-prefix=upload -show-greeting=false\n"})}),"\n",(0,i.jsx)(e.h2,{id:"hooks",children:"hooks"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Type\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"script"}),"\n",(0,i.jsx)(e.li,{children:"http"}),"\n",(0,i.jsx)(e.li,{children:"gRPC"}),"\n",(0,i.jsx)(e.li,{children:"golang plugin"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Hook\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"pre-create"}),"\n",(0,i.jsx)(e.li,{children:"post-create"}),"\n",(0,i.jsxs)(e.li,{children:["post-receive\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u672A\u5F00\u542F"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"pre-finish"}),"\n",(0,i.jsx)(e.li,{children:"post-finish"}),"\n",(0,i.jsx)(e.li,{children:"post-terminate"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Model\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/tus/tusd/blob/main/docs/hooks.md",children:"https://github.com/tus/tusd/blob/main/docs/hooks.md"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://pkg.go.dev/github.com/tus/tusd/v2/pkg/hooks#HookRequest",children:"https://pkg.go.dev/github.com/tus/tusd/v2/pkg/hooks#HookRequest"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://pkg.go.dev/github.com/tus/tusd/v2/pkg/hooks#HookResponse",children:"https://pkg.go.dev/github.com/tus/tusd/v2/pkg/hooks#HookResponse"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"tusd --hooks-http http://localhost:8081/write --hooks-http-retry 5 --hooks-http-backoff 2\n"})}),"\n",(0,i.jsx)(e.h1,{id:"tus-node-server",children:"tus-node-server"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4E8B\u4EF6\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"POST_CREATE - \u521B\u5EFA\u4E86 upload \u4F46\u8FD8\u6CA1\u5199\u5165\u5230 store"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.del,{children:"POST_RECEIVE"})," - \u7C7B\u4F3C\u4E8E POST_FINISH"]}),"\n",(0,i.jsx)(e.li,{children:"POST_RECEIVE_V2 - \u6BCF\u9694 postReceiveInterval \u4F1A\u8C03\u7528\u4E00\u6B21\uFF0C\u80FD\u591F\u83B7\u53D6\u5230\u8FDB\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"POST_FINISH - \u4E0A\u4F20\u5B8C\u6210\uFF0C\u5B8C\u6210\u54CD\u5E94\u7ED9\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.li,{children:"POST_TERMINATE - \u4E0A\u4F20\u88AB\u7EC8\u6B62\uFF0C\u5B8C\u6210\u54CD\u5E94\u7ED9\u5BA2\u6237\u7AEF"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["KvStore\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MemoryKvStore"}),"\n",(0,i.jsxs)(e.li,{children:["FileKvStore\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"./{KEY}.json"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"RedisKvStore"}),"\n",(0,i.jsx)(e.li,{children:"IoRedisKvStore"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["DataStore\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"FileStore"}),"\n",(0,i.jsx)(e.li,{children:"S3Store"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"npm add @tus/server @tus/file-store @tus/s3-store\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"type TUpload = {\n  id: string;\n  size?: number;\n  offset: number;\n  // uppy type, relativePath, name\n  // tusd filetype, filename\n  metadata?: Record<string, string | null>;\n  storage?: {\n    type: string;\n    path: string;\n    bucket?: string;\n  };\n  creation_date?: string;\n};\n"})}),"\n",(0,i.jsx)(e.h2,{id:"extensions",children:"extensions"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"creation"}),"\n",(0,i.jsx)(e.li,{children:"creation-with-upload"}),"\n",(0,i.jsx)(e.li,{children:"creation-defer-length"}),"\n",(0,i.jsx)(e.li,{children:"termination"}),"\n",(0,i.jsx)(e.li,{children:"expiration"}),"\n"]})]})}function u(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},17776:function(n,e,s){s.d(e,{R:()=>r,x:()=>d});var l=s(7378);let i={},t=l.createContext(i);function r(n){let e=l.useContext(t);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),l.createElement(t.Provider,{value:e},n.children)}}}]);