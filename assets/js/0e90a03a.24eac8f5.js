"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["485323"],{791444:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>d,toc:()=>o,default:()=>x,metadata:()=>r,assets:()=>h,contentTitle:()=>c});var r=JSON.parse('{"id":"service/network/proxy/mihomo/mihomo-conf","title":"Mihomo \u914D\u7F6E","description":"- [DNS]","source":"@site/../notes/service/network/proxy/mihomo/mihomo-conf.md","sourceDirName":"service/network/proxy/mihomo","slug":"/service/network/proxy/mihomo/conf","permalink":"/notes/service/network/proxy/mihomo/conf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/network/proxy/mihomo/mihomo-conf.md","tags":[{"inline":true,"label":"Configuration","permalink":"/notes/tags/configuration"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1764555082000,"frontMatter":{"tags":["Configuration"]},"sidebar":"docs","previous":{"title":"mihomo","permalink":"/notes/service/network/proxy/mihomo/"},"next":{"title":"PAC","permalink":"/notes/service/network/proxy/pac"}}'),l=s(486106),i=s(917776);let d={tags:["Configuration"]},c="Mihomo \u914D\u7F6E",h={},o=[{value:"DNS",id:"dns",level:2}];function t(n){let e={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"mihomo-\u914D\u7F6E",children:"Mihomo \u914D\u7F6E"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"[DNS]"}),"\n",(0,l.jsx)(e.li,{children:"sniffer - \u55C5\u63A2"}),"\n",(0,l.jsxs)(e.li,{children:["prixies - \u51FA\u7AD9\u4EE3\u7406\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5185\u7F6E\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DIRECT"}),"\n",(0,l.jsx)(e.li,{children:"REJECT"}),"\n",(0,l.jsx)(e.li,{children:"REJECT-DROP"}),"\n",(0,l.jsx)(e.li,{children:"PASS - \u5339\u914D\u65F6\u5FFD\u7565\u89C4\u5219"}),"\n",(0,l.jsx)(e.li,{children:"COMPATIBLE = DIRECT"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["proxy-groups - \u4EE3\u7406\u7EC4\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5185\u7F6E GLOBAL\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6240\u6709\u4EE3\u7406\u7EC4\u548C\u4EE3\u7406\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u53EF\u4EE5\u8986\u76D6\u5B9A\u4E49"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"proxy-providers - \u4EE3\u7406\u96C6\u5408"}),"\n",(0,l.jsx)(e.li,{children:"rule-providers - \u89C4\u5219\u96C6\u5408"}),"\n",(0,l.jsxs)(e.li,{children:["\u5165\u7AD9\u4EE3\u7406\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"mixed-port - HTTP+Socks"}),"\n",(0,l.jsx)(e.li,{children:"port - HTTP/HTTPS"}),"\n",(0,l.jsx)(e.li,{children:"socks-port - SOCKS4/4a/5"}),"\n",(0,l.jsxs)(e.li,{children:["redir-port\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Linux, Android, macOS"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["tproxy-port\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Linux, Android"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"tun"}),"\n",(0,l.jsx)(e.li,{children:"listeners"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["dns\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["default-nameserver\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7528\u6765\u89E3\u6790 DNS \u7528\u5230\u7684\u57DF\u540D\uFF0C\u5FC5\u987B\u662F IP"}),"\n",(0,l.jsx)(e.li,{children:"\u63A8\u8350 tls://223.5.5.5:853"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["direct-nameserver\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"for DIRECT"}),"\n",(0,l.jsx)(e.li,{children:"nameserver-policy -> nameserver -> fallback"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["nameserver-policy\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u7B56\u7565\u9009\u62E9 DNS"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"nameserver"}),"\n",(0,l.jsx)(e.li,{children:"proxy-server-nameserver"}),"\n",(0,l.jsxs)(e.li,{children:["fallback\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u901A\u5E38\u4E3A\u6D77\u5916 DNS"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u5408 fallback-filter: geoip-code: CN"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["respect-rules\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DNS \u670D\u52A1\u662F\u5426\u8D70\u8DEF\u7531\u89C4\u5219"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["enhanced-mode\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"redir-host - DNSMapping"}),"\n",(0,l.jsx)(e.li,{children:"fake-ip"}),"\n",(0,l.jsx)(e.li,{children:"normal"}),"\n",(0,l.jsx)(e.li,{children:"hosts"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://wiki.metacubex.one/en/config/general/",children:"https://wiki.metacubex.one/en/config/general/"})}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:'log-level: warning\nmixed-port: 7890\nallow-lan: true\nbind-address: "*"\n# off, always, strict\nfind-process-mode: off\nmode: rule\ntcp-concurrent: true\nunified-delay: true\nipv6: false\n'})}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u914D\u7F6E\u4E86 tun+sniffer \u4E5F\u53EF\u4EE5\u8FD9\u6837\ncurl -H 'Host: example.com' 198.18.0.1\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5927\u90E8\u5206\u914D\u7F6E\u548C clash \u914D\u7F6E\u76F8\u540C"}),"\n",(0,l.jsx)(e.li,{children:"\u65B0\u589E\u7684\u80FD\u4F1A\u6709\u548C clash \u914D\u7F6E\u4E0D\u540C\u7684\u5730\u65B9"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u57DF\u540D\u5339\u914D\u89C4\u5219"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"sym"}),(0,l.jsx)(e.th,{children:"rule"}),(0,l.jsx)(e.th,{children:"true"}),(0,l.jsx)(e.th,{children:"false"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"*"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"*.wener.me"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"a.wener.me"})}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"a.a.wener.me"}),(0,l.jsx)(e.br,{}),(0,l.jsx)(e.code,{children:"wener.me"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"+"})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"+.wener.me"})}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"wener.me"}),(0,l.jsx)(e.br,{}),(0,l.jsx)(e.code,{children:"a.wener.me"}),(0,l.jsx)(e.br,{}),(0,l.jsx)(e.code,{children:"a.a.wener.me"})]}),(0,l.jsx)(e.td,{children:"-"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"."})}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:".wener.me"})}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"a.wener.me"}),(0,l.jsx)(e.br,{}),(0,l.jsx)(e.code,{children:"a.a.wener.me"})]}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"wener.me"})})]})]})]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u7AEF\u53E3\u8303\u56F4 ",(0,l.jsx)(e.code,{children:"114-514/810-1919,65530"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/ewigl/mihomo",children:"https://github.com/ewigl/mihomo"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"dns",children:"DNS"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u652F\u6301\u7684\u534F\u8BAE"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"# UDP - 53\n- 223.5.5.5\n- udp://223.5.5.5\n# TCP - 53\n- tcp://8.8.8.8\n# DoT - DNS over TLS - 853\n- tls://1.1.1.1\n# Do DNS over HTTPS - 443\n- https://doh.pub/dns-query\n# DoQ - DNS over QUIC - 853, 784\n- quic://dns.adguard.com:784\n# \u7CFB\u7EDF\n- system://\n- system\n# DHCP\n- dhcp://en0\n- dhcp://system # \u4EC5\u9650 cmfa\uFF0C\u4F7F\u7528\u7CFB\u7EDF dns\n\n# \u56FA\u5B9A\u8FD4\u56DE\u503C - \u7528\u4E8E\u5C4F\u853D\u57DF\u540D\n- rcode://success # No error\n- rcode://format_error # Format error\n- rcode://server_failure # Server failure\n- rcode://name_error # Non-existent domain\n- rcode://not_implemented # Not implemented\n- rcode://refused # Query refused\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u53C2\u6570\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tls://dns.google#RULES"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tls://dns.google#proxy"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"tls://dns.alidns.com#eth0"})}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"https://dns.cloudflare.com/dns-query#h3=true"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5F3A\u5236 HTTP/3"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"skip-cert-verify=true"})," - DoH \u4E0D\u9A8C\u8BC1\u8BC1\u4E66"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ecs=1.1.1.1/24"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DoH ECS \u7684 subnet"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ecs-override=true"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"DoH ECS \u5F3A\u5236\u8986\u76D6 subnet"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u56FD\u5185 DNS - DoT, DoH\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u963F\u91CC\u4E91\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"223.5.5.5"}),"\n",(0,l.jsx)(e.li,{children:"223.6.6.6"}),"\n",(0,l.jsx)(e.li,{children:"dns.alidns.com"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u817E\u8BAF\u4E91 DnsPod\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"1.12.12.12"}),"\n",(0,l.jsx)(e.li,{children:"120.53.53.53"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://doh.pub/dns-query",children:"https://doh.pub/dns-query"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u56FD\u5916 DNS - DoT, DoH, DoQ\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u26A0\uFE0F \u76EE\u524D\u6D77\u5916\u670D\u52A1\u90FD\u662F\u88AB\u963B\u65AD\u6216\u8005\u6C61\u67D3\u7684\u72B6\u6001"}),"\n",(0,l.jsxs)(e.li,{children:["Google\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"dns.google"}),"\n",(0,l.jsx)(e.li,{children:"8.8.8.8"}),"\n",(0,l.jsx)(e.li,{children:"8.8.4.4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Cloudflare\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"1.1.1.1"}),"\n",(0,l.jsx)(e.li,{children:"1.0.0.1"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://cloudflare-dns.com/dns-query",children:"https://cloudflare-dns.com/dns-query"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://one.one.one.one/dns-query",children:"https://one.one.one.one/dns-query"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.andan.me/diary/1742.html",children:"https://www.andan.me/diary/1742.html"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'kdig -d @1.1.1.1 +tls-ca +tls-host=one.one.one.one example.com\nkdig @dns.adguard.com wener.me +quic\nkdig @dns.google example.com +quic\ncurl --http2 --header "accept: application/dns-json" "https://1.1.1.1/dns-query?name=cloudflare.com" --next --http2 --header "accept: application/dns-json" "https://1.1.1.1/dns-query?name=example.com"\n'})})]})}function x(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(t,{...n})}):t(n)}},917776:function(n,e,s){s.d(e,{R:()=>d,x:()=>c});var r=s(7378);let l={},i=r.createContext(l);function d(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);