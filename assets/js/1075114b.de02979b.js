"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["322769"],{882598:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>s,toc:()=>d,default:()=>p,metadata:()=>i,assets:()=>a,contentTitle:()=>r});var i=JSON.parse('{"id":"os/alpine/alpine-conf","title":"Alpine Config","description":"Tips","source":"@site/../notes/os/alpine/alpine-conf.md","sourceDirName":"os/alpine","slug":"/os/alpine/conf","permalink":"/notes/os/alpine/conf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/alpine/alpine-conf.md","tags":[{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Alpine","permalink":"/notes/tags/alpine"},{"inline":true,"label":"Config","permalink":"/notes/tags/config"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Alpine Config","tags":["OS","Alpine","Config"]},"sidebar":"docs","previous":{"title":"Alpine chroot \u73AF\u5883","permalink":"/notes/os/alpine/chroot"},"next":{"title":"Alpine Desktop","permalink":"/notes/os/alpine/desktop"}}'),o=t(486106),l=t(917776);let s={title:"Alpine Config",tags:["OS","Alpine","Config"]},r="Alpine Internal",a={},d=[{value:"Tips",id:"tips",level:2},{value:"Chroot Setup",id:"chroot-setup",level:2},{value:"QEMU ARM",id:"qemu-arm",level:2},{value:"NBD",id:"nbd",level:2},{value:"Setup",id:"setup",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"alpine-internal",children:"Alpine Internal"})}),"\n",(0,o.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"alpine-base"}),"\n",(0,o.jsx)(n.li,{children:"alpine-mirrors"}),"\n",(0,o.jsx)(n.li,{children:"network-extras"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-iso",children:"alpinelinux/alpine-iso"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-conf",children:"alpinelinux/alpine-conf"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/aports",children:"alpinelinux/aports"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-conf/blob/master/setup-disk.in",children:"setup-disk.in"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-chroot-install",children:"alpine-chroot-install"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://wiki.alpinelinux.org/wiki/Alpine_Linux_in_a_chroot",children:"Alpine Linux in a chroot"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"apk add haveged haveged-openrc\nrc-update add haveged\n\n# OpenRC init scripts\nfor svc in devfs dmesg hwdrivers mdev; do rc-update --quiet add $svc sysinit; done\nfor svc in killprocs mount-ro savecache; do rc-update --quiet add $svc shutdown; done\nfor svc in modules sysctl hostname bootmisc swclock syslog swap; do ln -s /etc/init.d/$svc /etc/runlevels/boot; done\nfor svc in haveged sshd local networking; do rc-update --quiet add $svc default; done\n\nrc-update add networking default\n\nrc-update add hwclock boot\nrc-update add modules boot\nrc-update add sysctl boot\nrc-update add hostname boot\nrc-update add bootmisc boot\nrc-update add syslog boot\n\nrc-service --exists network\n\napk add ca-certificates\nupdate-ca-certificates\n\nsetup-ntp -c busybox\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-conf/blob/master/setup-alpine.in#L153",children:"setup-alpine.in#L153"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"adding things to the boot runlevel from a chroot is bugged in openrc right now\nAdding to another runlevel should work"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"chroot-setup",children:"Chroot Setup"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"touch /etc/network/interfaces\nmkdir /lib/modules\n\nchroot /alpine\n\nmount -t proc none /proc\n/etc/init.d/devfs start\n/etc/init.d/sysfs start\n\napk add dosfstools\n\nauto lo\niface lo inet loopback\n\ncat << EOF > /etc/network/interfaces\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet dhcp\n\nauto wlan0\niface wlan0 inet dhcp\nEOF\n\ntouch /run/openrc/softlevel\n\napk add nano htop curl wget bash bash-completion\nsed -i 's/\\/bin\\/ash/\\/bin\\/bash/g' /etc/passwd\n"})}),"\n",(0,o.jsx)(n.h2,{id:"qemu-arm",children:"QEMU ARM"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'qemu-system-arm -kernel armhf/boot/vmlinuz-rpi2 -initrd armhf/boot/initramfs-rpi2 -M raspi2 -serial stdio -dtb armhf/bcm2709-rpi-2-b.dtb -append "console=ttyAMA0,115200 kgdboc=ttyAMA0,115200 root=/dev/mmcblk0p2 rootfstype=ext4 rootwait" -sd target.img\n\nqemu-system-arm -kernel armhf/boot/vmlinuz-rpi2 -initrd armhf/boot/initramfs-rpi2 -M raspi2 -serial stdio -dtb armhf/bcm2709-rpi-2-b.dtb -append "dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait" -sd target.img\n\n# cmdline\ndwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait\n\necho -e \'brcmfmac\' >> /etc/modules\n\nqemu-system-aarch64 -kernel aarch64/boot/vmlinuz-rpi -initrd aarch64/boot/initramfs-rpi -M raspi3 -serial stdio -dtb aarch64/bcm2710-rpi-3-b.dtb -append "dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait" -sd demo-aarch64.img\n'})}),"\n",(0,o.jsx)(n.h2,{id:"nbd",children:"NBD"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"nbd-client 192.168.1.100 10809 /dev/nbd0\nnbd-client 192.168.1.100 9998 /dev/nbd1\n\nqemu-storage-daemon \\\n  --blockdev driver=qcow2,node-name=test,file.filename=test.qcow2,file.locking=off,file.driver=file \\\n  --nbd-server addr.type=inet,addr.host=0.0.0.0,addr.port=6789 \\\n  --export nbd,device=test\n\nqemu-nbd -f raw target.img -x target\n\nmodprobe nbd-client\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://www.kernel.org/doc/html/latest/admin-guide/blockdev/nbd.html",children:"NBD Admin Guide"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/acozzette/BUSE",children:"BUSE - A block device in userspace"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Couldn't resolve the nbd netlink family, make sure the nbd module is loaded and your nbd driver supports the netlink interface."}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/docker/for-mac/issues/4549",children:"docker/for-mac#4549"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/RPi-Distro/pi-gen/pull/349",children:"pi-gen#349"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://wiki.gentoo.org/wiki/OpenRC#Chroot_support",children:"Gentoo OpenRC Chroot support"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u65E9\u671F\u5373\u4FBF -s 0 \u4E5F\u4F1A\u521B\u5EFA swap \u5206\u533A,\u73B0\u5728\u4E0D\u4F1A\u521B\u5EFA"}),"\n",(0,o.jsx)(n.li,{children:"setup-disk \u7684\u5305\u57FA\u4E8E\u5F53\u524D\u7684 world \u8FDB\u884C\u5B89\u88C5\uFF0C\u76EE\u524D\u65E0\u6CD5\u4FEE\u6539"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/alpinelinux/alpine-conf",children:"alpinelinux/alpine-conf"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},917776:function(e,n,t){t.d(n,{R:()=>s,x:()=>r});var i=t(7378);let o={},l=i.createContext(o);function s(e){let n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);