"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["25995"],{22141:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>i,toc:()=>a,default:()=>p,metadata:()=>r,assets:()=>d,contentTitle:()=>c});var r=JSON.parse('{"id":"service/dns/powerdns/powerdns-lua","title":"PowerDNS LUA","description":"- \u81EA 4.2 \u5F00\u59CB\u652F\u6301","source":"@site/../notes/service/dns/powerdns/powerdns-lua.md","sourceDirName":"service/dns/powerdns","slug":"/service/dns/powerdns/lua","permalink":"/notes/service/dns/powerdns/lua","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/dns/powerdns/powerdns-lua.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1647984068000,"frontMatter":{"title":"PowerDNS LUA"},"sidebar":"docs","previous":{"title":"PowerDNS FAQ","permalink":"/notes/service/dns/powerdns/faq"},"next":{"title":"PowerDNS Recursor","permalink":"/notes/service/dns/powerdns/rec"}}'),s=t(86106),o=t(17776);let i={title:"PowerDNS LUA"},c="PowerDNS LUA",d={},a=[];function l(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"powerdns-lua",children:"PowerDNS LUA"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u81EA 4.2 \u5F00\u59CB\u652F\u6301"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://doc.powerdns.com/authoritative/lua-records/functions.html",children:"\u6240\u6709\u51FD\u6570"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://doc.powerdns.com/authoritative/lua-records/reference/index.html",children:"LUA Reference"})}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u9ED8\u8BA4\u4F1A\u6DFB\u52A0 ",(0,s.jsx)(n.code,{children:"return"}),"\uFF0C\u5982\u679C\u8BED\u53E5\u4E0D\u662F\u8FD4\u56DE\u503C\uFF0C\u53EF\u4EE5\u6DFB\u52A0 ",(0,s.jsx)(n.code,{children:";"})," \u524D\u7F00\uFF0C\u7136\u540E\u81EA\u5DF1\u5199 ",(0,s.jsx)(n.code,{children:"return"}),"\u3002"]}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u9488\u5BF9\u57DF\u540D\u542F\u7528 LUA\n-- \u6216\u914D\u7F6E\u6DFB\u52A0 enable-lua-records \u8FDB\u884C\u5168\u5C40\u542F\u7528\nINSERT INTO domainmetadata (domain_id, kind, content) VALUES (1, 'ENABLE-LUA-RECORDS', 1);\n\n-- \u6DFB\u52A0 LUA \u8BB0\u5F55\nINSERT INTO records (domain_id, name, type, content, ttl)\nVALUES (\n  1,\n  'www.example.com',\n  'LUA',\n  'A \"pickclosest({''192.0.2.1'',''192.0.2.2'',''198.51.100.1''})',\n  600\n);\n\n-- \u914D\u7F6E\u8BB0\u5F55\nINSERT INTO records (domain_id, name, type, content, ttl)\nVALUES ( 1, 'config.example.com', 'LUA',\n  'LUA \"fallbackIp=''192.168.1.1''\"', 600\n);\n-- \u4F7F\u7528\u914D\u7F6E\nINSERT INTO records (domain_id, name, type, content, ttl)\nVALUES ( 1, 'www.example.com', 'LUA',\n  'A \";include(''config'');return fallbackIp\"', 600\n);\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- \u8FD4\u56DE\u8BF7\u6C42\u65B9 IP\nwho:toString()\n\n-- \u6839\u636E\u8BF7\u6C42\u65B9 IP \u4E0D\u540C\u8FD4\u56DE\u4E0D\u540C\u5730\u5740\nview({\n  {{'10.10.0.0/16'}, {'10.10.1.1'}}\n  {{'0.0.0.0/0'}, {'192.0.2.1'}}\n})\n\n-- \u8FD4\u56DE\u5B58\u6D3B\u7684 IP\n-- \u5F02\u6B65\u68C0\u6D4B - \u5982\u679C\u90FD\u4E0D\u5B58\u6D3B\u5219\u90FD\u8FD4\u56DE\nifportup(443, {'192.0.2.1', '192.0.2.2'})\n-- \u4F7F\u7528 URL \u68C0\u6D4B\u5B58\u6D3B - stringmatch \u4E3A\u53EF\u9009\u7684\u5185\u5BB9\u5339\u914D\u6761\u4EF6\nifurlup(\"example.com/status\", { {\"192.0.2.20\", \"203.0.113.4\"}, {\"203.0.113.2\"} },{stringmatch='ok'})\n\n-- \u57FA\u4E8E\u8BF7\u6C42\u65B9\u7684 HASH(bestwho) \u8FDB\u884C\u8FD4\u56DE\npickwhashed({{10,'192.168.0.1'},{100,'192.168.0.2'}})\n-- \u968F\u673A\u8FD4\u56DE - \u6709\u5E26\u6743\u91CD\u7248\npickrandom({{'192.168.0.1'},{'192.168.0.2'}})\npickwrandom({{10,'192.168.0.1'},{100,'192.168.0.2'}})\n"})})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},17776:function(e,n,t){t.d(n,{R:()=>i,x:()=>c});var r=t(7378);let s={},o=r.createContext(s);function i(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);