"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["69505"],{12607:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>i,toc:()=>u,default:()=>d,metadata:()=>s,assets:()=>c,contentTitle:()=>a});var s=JSON.parse('{"id":"db/relational/postgresql/postgresql-vacuum","title":"PostgreSQL Vacuum","description":"- \u91CA\u653E\u7A7A\u95F4","source":"@site/../notes/db/relational/postgresql/postgresql-vacuum.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/vacuum","permalink":"/notes/db/relational/postgresql/vacuum","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-vacuum.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1686636573000,"frontMatter":{"title":"PostgreSQL Vacuum"},"sidebar":"docs","previous":{"title":"PostgreSQL Upgrade","permalink":"/notes/db/relational/postgresql/upgrade"},"next":{"title":"\u7248\u672C\u5386\u53F2","permalink":"/notes/db/relational/postgresql/version"}}'),t=l(86106),r=l(17776);let i={title:"PostgreSQL Vacuum"},a="Vacuum",c={},u=[{value:"When to vacuum",id:"when-to-vacuum",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"vacuum",children:"Vacuum"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u91CA\u653E\u7A7A\u95F4"}),"\n",(0,t.jsx)(n.li,{children:"\u7EF4\u62A4\u7EDF\u8BA1\u4FE1\u606F"}),"\n",(0,t.jsx)(n.li,{children:"\u91CD\u65B0\u7EC4\u7EC7\u8868"}),"\n",(0,t.jsxs)(n.li,{children:["\u63D0\u901F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u589E\u52A0 maintenance_work_mem"}),"\n",(0,t.jsx)(n.li,{children:"parallel"}),"\n",(0,t.jsx)(n.li,{children:"analyze \u6162\u4F46\u505A\u989D\u5916\u7EDF\u8BA1"}),"\n",(0,t.jsx)(n.li,{children:"\u8003\u8651 pg_repack"}),"\n",(0,t.jsx)(n.li,{children:"\u6709\u5927\u91CF\u5220\u9664\u8003\u8651 vacuum full"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"pg_stat_progress_analyze"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-vacuum.html",children:"https://www.postgresql.org/docs/current/sql-vacuum.html"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select * from pg_stat_progress_vacuum;\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["phase\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"initializing"}),"\n",(0,t.jsx)(n.li,{children:"scanning heap - heap_blks_scanned"}),"\n",(0,t.jsx)(n.li,{children:"vacuuming indexes"}),"\n",(0,t.jsx)(n.li,{children:"vacuuming heap - heap_blks_vacuumed"}),"\n",(0,t.jsx)(n.li,{children:"cleaning up indexes"}),"\n",(0,t.jsx)(n.li,{children:"truncating heap"}),"\n",(0,t.jsx)(n.li,{children:"performing final cleanup"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"when-to-vacuum",children:"When to vacuum"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8FDB\u884C\u4E86\u5927\u91CF\u7684\u8868\u4FEE\u6539"}),"\n",(0,t.jsx)(n.li,{children:"\u611F\u89C9\u67E5\u8BE2\u6709\u6027\u80FD\u95EE\u9898"}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},17776:function(e,n,l){l.d(n,{R:()=>i,x:()=>a});var s=l(7378);let t={},r=s.createContext(t);function i(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);