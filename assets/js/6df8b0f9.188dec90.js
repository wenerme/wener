"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["6755"],{20396:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>i,toc:()=>c,default:()=>p,metadata:()=>r,assets:()=>l,contentTitle:()=>a});var r=JSON.parse('{"id":"service/dns/powerdns/as/README","title":"Authoritative Server","description":"- PowerDNS/pdns","source":"@site/../notes/service/dns/powerdns/as/README.md","sourceDirName":"service/dns/powerdns/as","slug":"/service/dns/powerdns/as/","permalink":"/notes/service/dns/powerdns/as/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/dns/powerdns/as/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1712053653000,"frontMatter":{"title":"Authoritative Server"},"sidebar":"docs","previous":{"title":"PowerDNS","permalink":"/notes/service/dns/powerdns/"},"next":{"title":"PowerDNS AS API","permalink":"/notes/service/dns/powerdns/as/api"}}'),t=s(86106),d=s(17776);let i={title:"Authoritative Server"},a="PowerDNS Authoritative Server",l={},c=[{value:"Get Start",id:"get-start",level:2},{value:"GEO",id:"geo",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"powerdns-authoritative-server",children:"PowerDNS Authoritative Server"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/PowerDNS/pdns",children:"PowerDNS/pdns"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"GPLv2, C"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u7279\u6027\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u591A\u79CD\u540E\u7AEF"}),"\n",(0,t.jsx)(n.li,{children:"\u591A\u79CD\u590D\u5236\u65B9\u5F0F"}),"\n",(0,t.jsx)(n.li,{children:"\u4FEE\u6539\u4E0D\u9700\u8981\u91CD\u542F"}),"\n",(0,t.jsx)(n.li,{children:"\u5B9A\u5236\u7F13\u5B58"}),"\n",(0,t.jsxs)(n.li,{children:["Supermaster\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5F53\u4E3A\u4E00\u4E2A\u8282\u70B9\u8BBE\u7F6E\u4E86 Supermaster \u540E,\u5728\u4E3B\u8282\u70B9\u4E0A\u521B\u5EFA zone,\u6240\u6709\u5B50\u8282\u70B9\u4F1A\u81EA\u52A8\u521B\u5EFA\u76F8\u5E94\u7684 zone, \u5E76\u53D1\u8D77\u4E00\u4E2A AXFR \u8BF7\u6C42"}),"\n",(0,t.jsx)(n.li,{children:"bind \u4E2D\u9700\u8981\u624B\u52A8\u4E3A\u6240\u6709\u5B50\u8282\u70B9\u6DFB\u52A0 zone"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["NOTES\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5F53\u627E\u5230\u4E00\u6761\u5339\u914D\u7684\u540E\u4E0D\u4F1A\u518D\u5C1D\u8BD5\u4F7F\u7528\u901A\u914D\u7B26\u67E5\u627E\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F8B\u5982 *.example.org A 192.168.1.1, test.example.org TXT Test, \u5F53\u67E5\u8BE2 ANY test.example.org \u53EA\u4F1A\u8FD4\u56DE TXT"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://doc.powerdns.com/md/appendix/backend-writers-guide/",children:"Backend writers' guide"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://doc.powerdns.com/",children:"https://doc.powerdns.com/"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["pdnsutil\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u57DF\u540D\u7BA1\u7406\u5DE5\u5177"}),"\n",(0,t.jsx)(n.li,{children:"\u901A\u8FC7\u4FEE\u6539 DB - \u53EF\u4EE5\u8FDC\u7A0B\u4F7F\u7528"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'brew install pdns # macOS \u5B89\u88C5\n\n# SQLite3\n# https://doc.powerdns.com/authoritative/backends/generic-sqlite3.html\n# \u5C06 Schema \u4FDD\u5B58\u5230 schema.sqlite3\nsqlite3 powerdns.sqlite .read schema.sqlite3\n# \u5728\u524D\u53F0\u542F\u52A8, \u4E4B\u6240\u4EE5\u4FEE\u6539 \u7AEF\u53E3\u548C socket-dir \u662F\u56E0\u4E3A\u53EF\u80FD\u4F1A\u6CA1\u6709\u6743\u9650\npdns_server --daemon=no --launch=gsqlite3 --local-port=5300 --socket-dir=`pwd`/socket\n# \u5C06\u914D\u7F6E\u6587\u4EF6\u5199\u5165\u5230 pdns.conf\n# launch=gsqlite3\n# local-port=5300\n# socket-dir=./socket\n# gsqlite3-database=powerdns.sqlite\n# \u4F7F\u7528\u914D\u7F6E\u6587\u4EF6\u542F\u52A8\npdns_server --daemon=yes --config-dir=.\n\npdns_server --daemon=no --launch=remote --local-port=5300 --socket-dir=`pwd`/socket\n\n# pdns_control \u7528\u4E8E\u64CD\u4F5C\u5B9E\u4F8B\n# \u7B80\u5316 pdns_control \u64CD\u4F5C\nalias pc="pdns_control --config-dir=`pwd`"\n# \u9000\u51FA\u670D\u52A1\npc quite\n# \u83B7\u53D6\u5F53\u524D\u7684\u914D\u7F6E\npc current-config\n\n# pdnsutil \u7528\u4E8E\u64CD\u4F5C\u540E\u7AEF\u6570\u636E, \u5373\u4FBF\u6CA1\u6709\u542F\u52A8 server \u4E5F\u53EF\u4EE5\n# \u7B80\u5316 pdnsutil \u64CD\u4F5C\nalias pu="pdnsutil --config-dir=`pwd`"\n# \u6DFB\u52A0\u7528\u4E8E\u6D4B\u8BD5\u7684\u8BB0\u5F55\npu add-record i.wener.me @ A 127.0.0.1\npu add-record i.wener.me dev A 127.0.0.1\n\n# \u6D4B\u8BD5\u6DFB\u52A0\u7684\u8BB0\u5F55\ndig @127.0.0.1 -p 5300 dev.i.wener.me\n\n# \u5E38\u7528\u64CD\u4F5C\n# \u521B\u5EFA\npdnsutil create-zone mydomain.com\n# \u68C0\u6D4B\u73B0\u6709\u7684\u95EE\u9898\npdnsutil check-zone mydomain.com\n# add-record ZONE NAME TYPE [ttl] content\n\n\n# Playground\ndocker run --rm -it -p 5353:53 --entrypoint bash wener/pdns:edge\n'})}),"\n",(0,t.jsx)(n.h2,{id:"get-start",children:"Get Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'docker run --rm -it -p 80:80 -p 53:53 -p 53:53/udp -v $PWD:/host -w /host wener/dns bash\n\n# \u7528\u4E8E\u63A5\u53E3\u8BF7\u6C42\nAPI_KEY=$(cat /dev/urandom | env LC_CTYPE=C tr -dc \'a-zA-Z0-9\' | head -c 32)\nWEBSERVER_PASSWORD=$(cat /dev/urandom | env LC_CTYPE=C tr -dc \'a-zA-Z0-9\' | head -c 32)\n# /etc/pdns/pdns.conf \u6807\u51C6\u914D\u7F6E\u76EE\u5F55\ncat <<EOF | tee pdns.conf > /etc/pdns/pdns.conf\n# backend\nlaunch=gsqlite3\ngsqlite3-database=$PWD/pdns.sqlite\n# handle dnssec\ngsqlite3-dnssec\n\n# server\nlocal-port=53\nlocal-address=0.0.0.0\ndaemon=yes\nguardian=yes\n\n# dyndns\ndnsupdate=yes\nallow-dnsupdate-from=\n\n# web/api\nwebserver=yes\nwebserver-address=0.0.0.0\nwebserver-password=$WEBSERVER_PASSWORD\nwebserver-loglevel=normal\nwebserver-port=80\n\napi=yes\napi-key=$API_KEY\n\n# soa default\ndefault-soa-name=ns1.wener.me\ndefault-soa-edit=\ndefault-soa-edit-signed=\ndefault-soa-mail=\nsoa-expire-default=604800\nsoa-minimum-ttl=3600\nsoa-refresh-default=10800\nsoa-retry-default=3600\nEOF\n# \u521D\u59CB\u5316 sqlite\ncurl -LO https://raw.githubusercontent.com/PowerDNS/pdns/master/modules/gsqlite3backend/schema.sqlite3.sql\nsqlite3 pdns.sqlite ".read schema.sqlite3.sql"\n\n# \u524D\u53F0\u542F\u52A8\npdns_server --daemon=no\n\n# \u4ECE\u53E6\u5916\u4E00\u4E2A\u4F1A\u8BDD\u64CD\u4F5C\n\n# \u91CD\u542F - \u4FEE\u6539\u914D\u7F6E\u540E\u53EF\u4EE5\u4F7F\u7528\npdns_control cycle\n\n# \u57DF\u540D\u7BA1\u7406\npdnsutil create-zone wener.me\n# \u6DFB\u52A0\u8BB0\u5F55 - ns1.wener.tech \u5B9E\u9645\u4E0A\u5C31\u662F\u9700\u8981\u6307\u5411\u5F53\u524D\u7684\u670D\u52A1\u5668\npdnsutil add-record wener.me @ NS ns1.wener.tech\npdnsutil add-record wener.me @ A 127.0.0.1\npdnsutil add-record wener.me app A 127.0.0.1\n# \u68C0\u67E5\npdnsutil check-all-zones\n# \u6240\u6709\u7684\u8BB0\u5F55\nsqlite3 pdns.sqlite "select * from records"\n\n# \u5C06\u4E09\u7EA7\u57DF\u540D\u4F5C\u4E3A zone\npdnsutil create-zone svc.wener.me\npdnsutil add-record svc.wener.me @ NS ns1.wener.tech\npdnsutil add-record svc.wener.me @ A 127.0.0.1\n# \u5728\u4E0A\u7EA7\u6DFB\u52A0 NS \u8BB0\u5F55\npdnsutil add-record wener.me svc NS ns1.wener.tech\n\n# NSUPDATE\n# --------------------\n# \u4E0A\u7EA7\u542F\u7528 TSIG\npdnsutil activate-tsig-key wener.me admin master\n# \u4E0B\u7EA7\u542F\u7528 TSIG slave\npdnsutil activate-tsig-key svc.wener.me admin slave\n# \u5355\u57DF\u540D\u914D\u7F6E\npdnsutil generate-tsig-key svc-admin hmac-md5\npdnsutil set-meta svc.wener.me TSIG-ALLOW-DNSUPDATE svc-admin\npdnsutil set-meta svc.wener.me ALLOW-DNSUPDATE-FROM 0.0.0.0/0\n\n# \u67E5\u770B\npdnsutil list-tsig-keys\n# \u542F\u7528\u7684\u914D\u7F6E\u4FE1\u606F\nsqlite3 pdns.sqlite "select * from domainmetadata"\n\nSECRET=$(sqlite3 pdns.sqlite "select secret from tsigkeys where name=\'svc-admin\'")\n# DNS UPDATE\n# \u9ED8\u8BA4\u53EA\u652F\u6301 hmac-md5\nnsupdate <<EOF\nserver 127.0.0.1 53\nzone svc.wener.me\nupdate add web.svc.wener.me 3600 A 1.2.3.4\nkey svc-admin $SECRET\nsend\nEOF\n# \u6CDB\u57DF\u540D\u4FEE\u6539\nnsupdate <<EOF\nserver 127.0.0.1 53\nzone svc.wener.me\nupdate add *.svc.wener.me 3600 A 4.3.2.1\nkey svc-admin $SECRET\nsend\nEOF\n\n# \u4FEE\u6539\u4E0A\u7EA7\u57DF\u540D\u4F1A\u5931\u8D25\nnsupdate <<EOF\nserver 127.0.0.1 53\nzone wener.me\nupdate add web.wener.me 3600 A 1.2.3.4\nkey svc-admin $SECRET\nsend\nEOF\n\n# \u67E5\u770B\u6240\u6709\u57DF\u540D\u4FE1\u606F\ndig -t axfr svc.wener.me @127.0.0.1\n\n# DNSSEC\n# --------------------\npdnsutil secure-zone wener.me\npdnsutil secure-zone svc.wener.me\n\n# \u8F93\u51FA\u7684 DS \u6DFB\u52A0\u5230\u4E0A\u7EA7\npdnsutil show-zone svc.wener.me\n\n# \u5173\u95ED - \u8BB0\u5F97\u5220\u9664\u4E0A\u7EA7\u7684 DS\npdnsutil disable-dnssec wener.me\n'})}),"\n",(0,t.jsx)(n.h2,{id:"geo",children:"GEO"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://doc.powerdns.com/md/authoritative/backend-geo/",children:"https://doc.powerdns.com/md/authoritative/backend-geo/"})})]})}function p(e={}){let{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},17776:function(e,n,s){s.d(n,{R:()=>i,x:()=>a});var r=s(7378);let t={},d=r.createContext(t);function i(e){let n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);