"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["87399"],{41797:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>o,toc:()=>d,default:()=>h,metadata:()=>i,assets:()=>t,contentTitle:()=>c});var i=JSON.parse('{"id":"devops/kubernetes/platform/fission","title":"fission","description":"- fission/fission","source":"@site/../notes/devops/kubernetes/platform/fission.md","sourceDirName":"devops/kubernetes/platform","slug":"/devops/kubernetes/platform/fission","permalink":"/notes/devops/kubernetes/platform/fission","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/platform/fission.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1634945411000,"frontMatter":{"title":"fission"},"sidebar":"docs","previous":{"title":"K8S \u5E73\u53F0","permalink":"/notes/devops/kubernetes/platform/"},"next":{"title":"harvester","permalink":"/notes/devops/kubernetes/platform/harvester"}}'),l=s(86106),r=s(17776);let o={title:"fission"},c="fission",t={},d=[{value:"Functions",id:"functions",level:2},{value:"HTTP",id:"http",level:2},{value:"Environment",id:"environment",level:2},{value:"CanaryConfig",id:"canaryconfig",level:2},{value:"cli",id:"cli",level:2},{value:"deploy",id:"deploy",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"fission",children:"fission"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/fission/fission",children:"fission/fission"}),"\nFast and Simple Serverless Functions\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u76EE\u524D\u652F\u6301 NodeJS, Python, Ruby, Go, PHP, Bash, Linux executable"}),"\n",(0,l.jsx)(e.li,{children:"\u53EA\u64CD\u4F5C\u6E90\u7801\u4E0D\u64CD\u4F5C\u5BB9\u5668"}),"\n",(0,l.jsxs)(e.li,{children:["\u5185\u7F6E\u8DEF\u7531\u57FA\u4E8E gorilla/mux\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301\u547D\u540D\u53C2\u6570 ",(0,l.jsx)(e.code,{children:"/guestbook/{name}/{age:[0-9]+}"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"X-Fission-Params-Name: <name>"})," - \u6CE8\u610F\u540D\u5B57\u4F1A\u8F6C\u6362"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301 WebSocket"}),"\n",(0,l.jsx)(e.li,{children:"\u5E95\u5C42\u57FA\u4E8E keda"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["helm ",(0,l.jsx)(e.a,{href:"https://github.com/fission/fission-charts",children:"fission/fission-charts"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"fission-all - nats, influxdb"}),"\n",(0,l.jsx)(e.li,{children:"fission-core"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Function\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6E90\u7801 - \u53EF\u6267\u884C\u5185\u5BB9"}),"\n",(0,l.jsx)(e.li,{children:"Archive - \u53EF\u4EE5\u662F\u6253\u5305\u7684\u5185\u5BB9 - zip"}),"\n",(0,l.jsx)(e.li,{children:"Package - fission \u5C06 Archive \u8FDB\u884C\u6253\u5305 - \u5B9E\u9645\u6267\u884C"}),"\n",(0,l.jsxs)(e.li,{children:["\u90E8\u5206\u8BED\u8A00\u9700\u8981\u7F16\u8BD1 - \u9700\u8981\u521B\u5EFA\u73AF\u5883\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"fission \u8D1F\u8D23\u6784\u5EFA"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Environment\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63D0\u4F9B HTTP \u670D\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u8FD0\u884C Function"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Trigger - \u5165\u53E3/\u89E6\u53D1\u65B9\u5F0F\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"HTTP"}),"\n",(0,l.jsx)(e.li,{children:"Timer - \u5B9A\u65F6"}),"\n",(0,l.jsx)(e.li,{children:"Message Queue - KEDA - Kafka, NATS"}),"\n",(0,l.jsx)(e.li,{children:"Kubernetes Watch - \u5F53\u96C6\u7FA4\u53D8\u5316\u65F6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://hub.docker.com/u/fission/",children:"https://hub.docker.com/u/fission/"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"<lang>-env"})," - \u6267\u884C\u73AF\u5883"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"<lang>-builder"})," - \u6784\u5EFA"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5185\u7F6E\u8DEF\u5F84\u6620\u5C04\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"/secrets/<namespace>/<name>/<key>"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"/configs/<namespace>/<name>/<key>"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["secrets \u548C configs \u9700\u8981\u542F\u52A8\u65F6\u5141\u8BB8\u8BBF\u95EE\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4FEE\u6539\u65F6\u4F1A\u5BFC\u81F4 pod \u91CD\u542F"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679C\u5927\u91CF function \u4F7F\u7528\u76F8\u540C\u7684\uFF0C\u5219\u4F1A\u77AC\u95F4\u5BFC\u81F4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u6267\u884C\u7C7B\u578B\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["poolmgr\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u521B\u5EFA env \u81EA\u52A8\u521B\u5EFA"}),"\n",(0,l.jsx)(e.li,{children:"\u9ED8\u8BA4 pool 3"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301 Requests Per Pod - rpp \u9650\u5B9A\u6BCF\u4E2A pod \u8BF7\u6C42\u91CF"}),"\n",(0,l.jsx)(e.li,{children:"OnceOnly - \u4E00\u4E2A pod \u53EA\u5904\u7406\u4E00\u4E2A\u8BF7\u6C42"}),"\n",(0,l.jsx)(e.li,{children:"Concurrency - \u9650\u5B9A\u8BF7\u6C42\u5E76\u53D1"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["newdeploy\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u81EA\u52A8\u6269\u7F29\u5BB9"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E min,max"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"--minscale 0"})," \u53EF\u5B8C\u5168\u7F29\u5BB9 - \u51B7\u542F\u52A8\u4F1A\u6162"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4E0D\u652F\u6301 gRPC \u8DEF\u7531 - ",(0,l.jsx)(e.a,{href:"https://github.com/fission/fission/issues/250",children:"fission/fission#250"})]}),"\n",(0,l.jsx)(e.li,{children:"NATS \u76EE\u524D\u5C1A\u672A\u4F7F\u7528 JetStream API"}),"\n"]})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# macOS\ncurl -Lo fission https://github.com/fission/fission/releases/download/1.14.1/fission-1.14.1-darwin-amd64 \\\n    && chmod +x fission && sudo mv fission /usr/local/bin/\n\nfission env create --name nodejs --image fission/node-env\ncurl https://raw.githubusercontent.com/fission/examples/master/nodejs/hello.js > hello.js\nfission function create --name hello --env nodejs --code hello.js\n\n# \u521B\u5EFA\u8DEF\u7531\nfission route create --method GET --url /hello --function hello\n# \u8BF7\u6C42\nfission function test --name hello\n\n\n# \u6DFB\u52A0 Go \u73AF\u5883\nfission environment create --name go --image fission/go-env-1.12:1.13.1 --builder fission/go-builder-1.12:1.13.1\n"})}),"\n",(0,l.jsx)(e.h2,{id:"functions",children:"Functions"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"websocket.js"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-js",children:"module.exports = async function (ws, clients) {\n  ws.on('message', function incoming(data) {\n    clients.forEach(function each(client) {\n      client.send(data);\n    });\n  });\n\n  ws.on('close', function close() {\n    return {\n      status: 200,\n      message: 'I am done',\n    };\n  });\n};\n"})}),"\n",(0,l.jsx)(e.h2,{id:"http",children:"HTTP"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"X-Fission-Function-Uid: 82c95606-9afa-11e8-bbd1-08002720b796\nX-Fission-Function-Resourceversion: 480652\nX-Fission-Function-Name: reqpayload\nX-Fission-Function-Namespace: default\n\nX-Fission-Params-Name: Alice\nX-Fission-Params-Age: 23\n"})}),"\n",(0,l.jsx)(e.h2,{id:"environment",children:"Environment"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"apiVersion: fission.io/v1\nkind: Environment\nmetadata:\n  creationTimestamp: null\n  name: nodejs\n  namespace: default\nspec:\n  builder: {}\n  imagepullsecret: ''\n  keeparchive: false\n  poolsize: 3\n  resources: {}\n  runtime:\n    image: fission/node-env:latest\n  version: 2\n"})}),"\n",(0,l.jsx)(e.h2,{id:"canaryconfig",children:"CanaryConfig"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"apiVersion: fission.io/v1\nkind: CanaryConfig\nmetadata:\n  name: canary-1\n  namespace: default\nspec:\n  duration: 1m\n  failureType: status-code\n  failurethreshold: 10\n  newfunction: fn-a-v2\n  oldfunction: fn-a-v1\n  trigger: route-fn-a\n  weightincrement: 30\n"})}),"\n",(0,l.jsx)(e.h2,{id:"cli",children:"cli"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"FISSION_NAMESPACE"}),"\n",(0,l.jsx)(e.li,{children:"FISSION_ROUTER"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"deploy",children:"deploy"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/fission/fission/tree/master/charts/fission-all",children:"https://github.com/fission/fission/tree/master/charts/fission-all"})}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>o,x:()=>c});var i=s(7378);let l={},r=i.createContext(l);function o(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);