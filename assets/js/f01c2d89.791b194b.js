"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["40607"],{23154:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>o,default:()=>h,metadata:()=>l,assets:()=>d,contentTitle:()=>c});var l=JSON.parse('{"id":"db/relational/postgresql/postgresql-faq","title":"\u5E38\u89C1\u95EE\u9898","description":"- Errors and Messages","source":"@site/../notes/db/relational/postgresql/postgresql-faq.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/faq","permalink":"/notes/db/relational/postgresql/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"},{"inline":true,"label":"Limits","permalink":"/notes/tags/limits"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1756017263000,"frontMatter":{"title":"\u5E38\u89C1\u95EE\u9898","tags":["FAQ","Limits"]},"sidebar":"docs","previous":{"title":"PostgreSQL Extension","permalink":"/notes/db/relational/postgresql/extension"},"next":{"title":"PostgreSQL FDW","permalink":"/notes/db/relational/postgresql/fdw"}}'),i=s(86106),r=s(17776);let t={title:"\u5E38\u89C1\u95EE\u9898",tags:["FAQ","Limits"]},c="PostgreSQL FAQ",d={},o=[{value:"\u9650\u5236",id:"limits",level:2},{value:"unique constraint vs unique index",id:"unique-constraint-vs-unique-index",level:2},{value:"TOAST",id:"toast",level:2},{value:"\u670D\u52A1\u91CD\u8F7D",id:"\u670D\u52A1\u91CD\u8F7D",level:2},{value:"\u7EF4\u62A4",id:"\u7EF4\u62A4",level:2},{value:"\u5347\u7EA7",id:"\u5347\u7EA7",level:2},{value:"CTID",id:"ctid",level:2},{value:"\u65F6\u533A\u95EE\u9898",id:"\u65F6\u533A\u95EE\u9898",level:2},{value:"NULL \u5B57\u7B26 / <code>\\0</code> \u5B57\u7B26",id:"null-\u5B57\u7B26--0-\u5B57\u7B26",level:2},{value:"unsupported Unicode escape sequence",id:"unsupported-unicode-escape-sequence",level:2},{value:"\u5207\u6362\u7528\u6237",id:"\u5207\u6362\u7528\u6237",level:2},{value:"\u5207\u6362\u6570\u636E\u5E93",id:"\u5207\u6362\u6570\u636E\u5E93",level:2},{value:"\u5BC6\u7801\u5B58\u50A8",id:"\u5BC6\u7801\u5B58\u50A8",level:2},{value:"Calculating and Saving Space in PostgreSQL",id:"calculating-and-saving-space-in-postgresql",level:2},{value:"psql \u5F00\u542F\u65F6\u95F4\u8BB0\u5F55",id:"psql-\u5F00\u542F\u65F6\u95F4\u8BB0\u5F55",level:2},{value:"\u6570\u7EC4\u7D22\u5F15",id:"\u6570\u7EC4\u7D22\u5F15",level:2},{value:"\u6570\u7EC4\u5916\u952E",id:"\u6570\u7EC4\u5916\u952E",level:2},{value:"ERROR: cannot alter type of a column used by a view or rule",id:"error-cannot-alter-type-of-a-column-used-by-a-view-or-rule",level:2},{value:"\u65F6\u95F4\u6233\u4E0A\u7684\u6BEB\u79D2\u5904\u7406",id:"\u65F6\u95F4\u6233\u4E0A\u7684\u6BEB\u79D2\u5904\u7406",level:2},{value:"\u67E5\u8BE2\u8BED\u53E5\u7684\u6700\u5927\u5927\u5C0F",id:"\u67E5\u8BE2\u8BED\u53E5\u7684\u6700\u5927\u5927\u5C0F",level:2},{value:"IN vs any",id:"in-vs-any",level:2},{value:"\u91CD\u7F6E schema",id:"\u91CD\u7F6E-schema",level:2},{value:"psql \u4F7F\u7528\u8FDE\u63A5\u5B57\u7B26\u4E32",id:"psql-\u4F7F\u7528\u8FDE\u63A5\u5B57\u7B26\u4E32",level:2},{value:"control reached end of trigger procedure without RETURN",id:"control-reached-end-of-trigger-procedure-without-return",level:2},{value:"query has no destination for result data",id:"query-has-no-destination-for-result-data",level:2},{value:"could not resize shared memory segment &quot;/PostgreSQL.153520683&quot; to 1073812480 bytes: No space left on device",id:"could-not-resize-shared-memory-segment-postgresql153520683-to-1073812480-bytes-no-space-left-on-device",level:2},{value:"set-returning functions are not allowed in UPDATE",id:"set-returning-functions-are-not-allowed-in-update",level:2},{value:"Tuning",id:"tuning",level:2},{value:"Sale Point",id:"sale-point",level:2},{value:"ON CONFLICT DO UPDATE command cannot affect row a second time",id:"on-conflict-do-update-command-cannot-affect-row-a-second-time",level:2},{value:"\u751F\u6210\u5217",id:"\u751F\u6210\u5217",level:2},{value:"generated vs default column",id:"generated-vs-default-column",level:2},{value:"remaining connection slots are reserved for non-replication superuser connection",id:"remaining-connection-slots-are-reserved-for-non-replication-superuser-connection",level:2},{value:"CURRENT_TIMESTAMP vs NOW",id:"current_timestamp-vs-now",level:2},{value:"ON CONFLICT DO UPDATE command cannot affect row a second time (SQLSTATE 21000)",id:"on-conflict-do-update-command-cannot-affect-row-a-second-time-sqlstate-21000",level:2},{value:"column &quot;datlastsysoid&quot; does not exist",id:"column-datlastsysoid-does-not-exist",level:2},{value:"\u67E5\u627E\u6240\u6709\u5916\u952E",id:"\u67E5\u627E\u6240\u6709\u5916\u952E",level:2},{value:"ARRAY/\u6570\u7EC4 \u5916\u952E",id:"array\u6570\u7EC4-\u5916\u952E",level:2},{value:"cannot use column reference in DEFAULT expression",id:"cannot-use-column-reference-in-default-expression",level:2},{value:"lateral vs subquery",id:"lateral-vs-subquery",level:2},{value:"union vs union all",id:"union-vs-union-all",level:2},{value:"\u5916\u952E\u9700\u8981\u5EFA\u7ACB\u7D22\u5F15\u4E48\uFF1F",id:"\u5916\u952E\u9700\u8981\u5EFA\u7ACB\u7D22\u5F15\u4E48",level:2},{value:"enum vs check vs fk",id:"enum-vs-check-vs-fk",level:2},{value:"\u9884\u52A0\u8F7D table \u5230\u5185\u5B58",id:"\u9884\u52A0\u8F7D-table-\u5230\u5185\u5B58",level:2},{value:"ERROR: could not open file &quot;base/5/2704&quot;: No such file or directory",id:"error-could-not-open-file-base52704-no-such-file-or-directory",level:2},{value:"A field with precision 5, scale 4 must round to an absolute value less than 10^1",id:"a-field-with-precision-5-scale-4-must-round-to-an-absolute-value-less-than-101",level:2},{value:"the database system is in recovery mode the database system is in recovery mode",id:"the-database-system-is-in-recovery-mode-the-database-system-is-in-recovery-mode",level:2},{value:"ERROR: could not resize shared memory segment &quot;/PostgreSQL.2692148336&quot; to 1073812480 bytes: No space left on device",id:"error-could-not-resize-shared-memory-segment-postgresql2692148336-to-1073812480-bytes-no-space-left-on-device",level:2},{value:"K8S start &amp; shutdown",id:"k8s-start--shutdown",level:2},{value:"collate",id:"collate",level:2},{value:"there is no unique constraint matching given keys for referenced table",id:"there-is-no-unique-constraint-matching-given-keys-for-referenced-table",level:2},{value:"permission denied for table",id:"permission-denied-for-table",level:2},{value:"source for a multiple-column UPDATE item must be a sub-SELECT or ROW() expression",id:"source-for-a-multiple-column-update-item-must-be-a-sub-select-or-row-expression",level:2},{value:"for update nowait - FOR UPDATE cannot be applied to the nullable side of an outer join",id:"for-update-nowait---for-update-cannot-be-applied-to-the-nullable-side-of-an-outer-join",level:2},{value:"permission denied to set session authorization",id:"permission-denied-to-set-session-authorization",level:2},{value:"Windows minimal",id:"windows-minimal",level:2},{value:"\u5FD8\u8BB0\u5BC6\u7801",id:"\u5FD8\u8BB0\u5BC6\u7801",level:2}];function a(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"postgresql-faq",children:"PostgreSQL FAQ"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/errcodes-appendix.html",children:"Errors and Messages"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-keywords-appendix.html",children:"SQL Key Words"})}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["case-sentivity of identifiers - \u8868\u3001\u5217\u3001\u51FD\u6570\u540D\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5982\u679C\u6CA1\u6709\u53CC\u5F15\u53F7\uFF0C\u5219\u4E0D\u533A\u5206\u5927\u5C0F\u5199\uFF0C\u9ED8\u8BA4\u8F6C\u6362\u4E3A\u5C0F\u5199"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS",children:"https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u65E0 Foreign Key Arrays\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"FOREIGN KEY (EACH ELEMENT OF userids) REFERENCES users,"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/50441059/1870054",children:"https://stackoverflow.com/a/50441059/1870054"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://commitfest.postgresql.org/17/1252/",children:"https://commitfest.postgresql.org/17/1252/"})}),"\n",(0,i.jsx)(n.li,{children:"S094"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301 column reordering"}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# for Container\nsu -l postgres -s /bin/bash\nexport PATH="/usr/lib/postgresql/17/bin:$PATH"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/unsupported-features-sql-standard.html",children:"Unsupported Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SQL:2016"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"limits",children:"\u9650\u5236"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"limit"}),(0,i.jsx)(n.th,{children:"value"}),(0,i.jsx)(n.th,{children:"notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"db name"}),(0,i.jsx)(n.td,{children:"63 byte"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"identifier length"}),(0,i.jsx)(n.td,{children:"63 byte"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"columns per index"}),(0,i.jsx)(n.td,{children:"32"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"columns per table"}),(0,i.jsx)(n.td,{children:"1600"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"columns in a result set"}),(0,i.jsx)(n.td,{children:"1,664"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["max params ",(0,i.jsx)(n.code,{children:"?"}),", ",(0,i.jsx)(n.code,{children:":"})]}),(0,i.jsx)(n.td,{children:"32767"}),(0,i.jsx)(n.td,{children:"smallint"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"query params"}),(0,i.jsx)(n.td,{children:"65,535"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"function params"}),(0,i.jsx)(n.td,{children:"100"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"field size"}),(0,i.jsx)(n.td,{children:"1GB"}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/limits.html",children:"https://www.postgresql.org/docs/current/limits.html"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"unique-constraint-vs-unique-index",children:"unique constraint vs unique index"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u6838\u5FC3\u4E1A\u52A1\u8BED\u4E49\u5C3D\u91CF\u7528 constraint"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["unique constraint\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"unique(tid,entity_id)"})," -> ",(0,i.jsx)(n.code,{children:"flow_tid_entity_id_key"})]}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u5EF6\u540E"}),"\n",(0,i.jsx)(n.li,{children:"\u901A\u8FC7 unique index \u5B9E\u73B0 - \u81EA\u52A8\u521B\u5EFA"}),"\n",(0,i.jsxs)(n.li,{children:["\u9644\u5E26\u5728 TABLE \u4E0A\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"unique"})," \u5728 create table \u65F6\u5B9A\u4E49"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"alter table TABLE add unique (tid,rid,cid);"})," \u5728 create table \u4E4B\u540E\u5B9A\u4E49"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4E0D\u652F\u6301 ",(0,i.jsx)(n.code,{children:"ADD CONSTRAINT IF NOT EXISTS"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u652F\u6301 ",(0,i.jsx)(n.code,{children:"DROP CONSTRAINT IF EXISTS"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["unique index\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create unique index on flow(tid,entity_id)"})," -> ",(0,i.jsx)(n.code,{children:"flow_tid_entity_id_idx"})]}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u5E76\u53D1"}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5 \u5E26\u6761\u4EF6"}),"\n",(0,i.jsxs)(n.li,{children:["\u72EC\u7ACB INDEX \u6982\u5FF5\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u80FD\u5728 create table \u65F6\u5B9A\u4E49 - inline index \u6982\u5FF5"}),"\n",(0,i.jsx)(n.li,{children:"UNIQUE \u53EA\u662F INDEX \u7684\u4E00\u4E2A\u9650\u5236"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/6804058/1870054",children:"https://stackoverflow.com/a/6804058/1870054"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"add constraint if not exists"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/questions/23542794",children:"https://stackoverflow.com/questions/23542794"})}),"\n",(0,i.jsxs)(n.li,{children:["\u90FD\u652F\u6301 UNIQUE NULLS NOT DISTINCT\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u56E0\u4E3A\u662F INDEX \u7684\u80FD\u529B"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"toast",children:"TOAST"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TOAST = The Oversized-Attribute Storage Technique"}),"\n",(0,i.jsxs)(n.li,{children:["\u4E00\u884C 2kB - TOAST_TUPLE_THRESHOLD\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u8D85\u8FC7\u5148\u5C1D\u8BD5\u538B\u7F29\u5230 2kB - TOAST_TUPLE_TARGET\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9ED8\u8BA4 default_toast_compression=pglz, \u652F\u6301 lz4"}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u6309\u5217\u8BBE\u7F6E COMPRESSION"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u538B\u7F29\u4E0D\u8DB3\uFF0C\u5219\u5206 chunk \u5B58\u50A8\u5230\u5173\u8054\u7684 toast \u8868"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"TOAST \u4F7F\u7528 oid \u8DDF\u8E2A - \u6700\u591A 2^32 = 4 \u5341\u4EBF \u6761\u8BB0\u5F55"}),"\n",(0,i.jsxs)(n.li,{children:["\u5B58\u50A8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PLAIN - \u4E0D\u538B\u7F29\uFF0C\u65E0 out-of-line - \u8D85\u8FC7\u5219\u5F02\u5E38"}),"\n",(0,i.jsx)(n.li,{children:"EXTENDED - \u538B\u7F29+out-of-line"}),"\n",(0,i.jsx)(n.li,{children:"EXTERNAL - out-of-line"}),"\n",(0,i.jsx)(n.li,{children:"MAIN - \u538B\u7F29+\u5C1D\u8BD5\u5C3D\u91CF\u4E0D out-of-line"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/storage-toast.html",children:"TOAST storage"})}),"\n",(0,i.jsxs)(n.li,{children:["wiki ",(0,i.jsx)(n.a,{href:"https://wiki.postgresql.org/wiki/TOAST",children:"TOAST"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u9ED8\u8BA4 EXTENDED\nALTER TABLE users SET STORAGE EXTENDED;\n-- \u4FEE\u6539 TOAST_TUPLE_TARGET\nALTER TABLE users SET (toast_tuple_target = N);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u670D\u52A1\u91CD\u8F7D",children:"\u670D\u52A1\u91CD\u8F7D"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"pg_ctl"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"su postgres\npg_ctl reload\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"sql"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"psql -U postgres\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT pg_reload_conf();\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"service"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"service postgresql restart\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7EF4\u62A4",children:"\u7EF4\u62A4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://gist.github.com/rgreenjr/3637525",children:"postgres_queries_and_commands.sql"})," - Useful PostgreSQL Queries and Commands"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5347\u7EA7",children:"\u5347\u7EA7"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.xf.is/2019/02/26/convert-postgresql-cluster-to-use-page-checksums/",children:"https://www.xf.is/2019/02/26/convert-postgresql-cluster-to-use-page-checksums/"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"show data_checksums"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u53EF\u4EE5\u6784\u9020\u4E00\u4E2A\u5305\u542B\u6240\u6709\u7248\u672C\u7684\u955C\u50CF\uFF0C\u7136\u540E\u8FDB\u884C\u5347\u7EA7 - ",(0,i.jsx)(n.a,{href:"https://github.com/postgres/pgadmin4/blob/master/Dockerfile",children:"Dockerfile"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# https://github.com/tianon/docker-postgres-upgrade\ndocker run --rm \\\n  -v PGDATAOLD:/var/lib/postgresql/OLD/data \\\n  -v PGDATANEW:/var/lib/postgresql/NEW/data \\\n  tianon/postgres-upgrade:OLD-to-NEW\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pg_upgrade --old-datadir /var/lib/pgsql/data/ --new-datadir /var/lib/pgsql/10/data/ \\\n  --old-bindir /usr/bin/ --new-bindir /usr/pgsql-10/bin/\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ctid",children:"CTID"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://dba.stackexchange.com/questions/203989/what-is-the-data-type-of-the-ctid-system-column-in-postgres",children:"https://dba.stackexchange.com/questions/203989/what-is-the-data-type-of-the-ctid-system-column-in-postgres"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://postgresql.verite.pro/blog/2019/04/24/oid-column.html",children:"https://postgresql.verite.pro/blog/2019/04/24/oid-column.html"})}),"\n",(0,i.jsx)(n.h2,{id:"\u65F6\u533A\u95EE\u9898",children:"\u65F6\u533A\u95EE\u9898"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PG \u5B9E\u9645\u5B58\u50A8\u7684\u662F UTC \u4E0D\u4F1A\u5B58\u50A8\u65F6\u533A"}),"\n",(0,i.jsx)(n.li,{children:"\u65F6\u533A\u4FE1\u606F\u4F1A\u7528\u4E8E\u8F6C\u6362"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u5F53\u524D\u65F6\u533A\nshow timezone;\nshow timezone_abbreviations;\n-- \u53EF\u7528\u65F6\u533A\nSELECT * FROM pg_timezone_names;\n\n-- date \u8F6C tz \u5E94\u8BE5\u662F\u6B63\u5E38\u7684\nselect ('2020-01-02'::date)::TIMESTAMPTZ;\n\n-- session \u6709\u6548\nSET TIME ZONE TO 'UTC';\nSET TIMEZONE TO 'UTC';\n-- \u4E5F\u53EF\u4EE5\u76F4\u63A5\u6307\u5B9A offset\nSET timezone=-4;\n\n-- \u5F53\u524D\u65F6\u95F4\n-- UTC \u53EF\u4EE5\u4F7F\u7528 localtime\nSELECT LOCALTIMESTAMP AT TIME ZONE 'Asia/Shanghai';\n-- timestamp \u4E0D\u663E\u793A TZ \u4FE1\u606F\nSELECT NOW()::TIMESTAMP;\n-- current_timestamp \u662F timestamptz\n-- \u53EF\u4EE5\u63D0\u53D6 tz \u4FE1\u606F \u79D2\u3001\u5C0F\u65F6\nselect current_timestamp,\n       pg_typeof(current_timestamp),\n       extract(timezone from current_timestamp::timestamptz),\n       extract(timezone_h from current_timestamp::timestamptz)\n;\n\n-- db \u914D\u7F6E\nALTER SYSTEM SET timezone = 'UTC';\n\n-- \u4FEE\u6539\u89D2\u8272\u65F6\u533A\nALTER ROLE my_role SET TIMEZONE = '+1';\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"null-\u5B57\u7B26--0-\u5B57\u7B26",children:["NULL \u5B57\u7B26 / ",(0,i.jsx)(n.code,{children:"\\0"})," \u5B57\u7B26"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["PG \u4E0D\u5141\u8BB8\u5B57\u7B26\u4E32\u5305\u542B ",(0,i.jsx)(n.code,{children:"\\0"})]}),"\n",(0,i.jsx)(n.li,{children:"\u4F20\u5165\u4E4B\u524D\u66FF\u6362\u6216\u7528 bytea \u5B58\u50A8"}),"\n",(0,i.jsx)(n.li,{children:"JSON \u4E5F\u4E0D\u5141\u8BB8\u5305\u542B\u7A7A\u5B57\u7B26"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"unsupported-unicode-escape-sequence",children:"unsupported Unicode escape sequence"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E00\u822C\u662F\u56E0\u4E3A ",(0,i.jsx)(n.code,{children:"\\u0000"}),", \u66FF\u6362\u6389\u5373\u53EF, pg \u7684\u5B57\u7B26\u4E32\u4E0D\u652F\u6301 ",(0,i.jsx)(n.code,{children:"\\u0000"})]}),"\n",(0,i.jsx)(n.h2,{id:"\u5207\u6362\u7528\u6237",children:"\u5207\u6362\u7528\u6237"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"set role user;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5207\u6362\u6570\u636E\u5E93",children:"\u5207\u6362\u6570\u636E\u5E93"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EA\u80FD\u91CD\u65B0\u94FE\u63A5"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5BC6\u7801\u5B58\u50A8",children:"\u5BC6\u7801\u5B58\u50A8"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/pgcrypto.html",children:"pgcrypto"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.meetspaceapp.com/2016/04/12/passwords-postgresql-pgcrypto.html",children:"Hashed Passwords with PostgreSQL's pgcrypto"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/questions/15733196/where-2x-prefix-are-used-in-bcrypt",children:"https://stackoverflow.com/questions/15733196/where-2x-prefix-are-used-in-bcrypt"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u751F\u6210 Hash\nselect crypt('12345', gen_salt('bf', 8));\n-- \u5224\u65AD\u5BC6\u7801\u76F8\u7B49\nselect crypt('12345', password) = password\n\n-- PG \u65E0\u6CD5\u5904\u7406 2b - \u6216\u8005\u63D2\u5165\u65F6\u4FEE\u6539\u4E3A 2a\nselect *\nfrom users\nwhere username = 'admin'\n  and  regexp_replace(password,'^[$]2b','$2a') = crypt('admin', regexp_replace(salt,'^[$]2b','$2a'));\n"})}),"\n",(0,i.jsx)(n.h2,{id:"calculating-and-saving-space-in-postgresql",children:"Calculating and Saving Space in PostgreSQL"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/7431468/1870054",children:"Column Tetris"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=16471242",children:"HN"})}),"\n",(0,i.jsxs)(n.li,{children:["\u6BCF\u79CD\u6570\u636E\u7C7B\u578B\u90FD\u6709\u7279\u5B9A\u7684\u5BF9\u9F50\u8981\u6C42 - ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/catalog-pg-type.html",children:"pg-type"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/app-pgcontroldata.html",children:"pg_controldata"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u83B7\u53D6\u6570\u636E\u7684\u65CF\u7FA4\u4FE1\u606F"}),"\n",(0,i.jsx)(n.li,{children:"Maximum data alignment \u663E\u793A\u6570\u636E\u7684\u5BF9\u9F50\u8981\u6C42"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/static/functions-admin.html#FUNCTIONS-ADMIN-DBSIZE",children:"Database Object Size Functions"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pg_controldata data/\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u5217\u5BBD\nselect pg_column_size('int');\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pg_control version number:            1002\nCatalog version number:               201707211\nDatabase system identifier:           6502788473953883273\nDatabase cluster state:               in production\npg_control last modified:             \u4E94  3/ 9 12:04:15 2018\nLatest checkpoint location:           0/32F8A88\nPrior checkpoint location:            0/32DA0D0\nLatest checkpoint's REDO location:    0/32F8A50\nLatest checkpoint's REDO WAL file:    000000010000000000000003\nLatest checkpoint's TimeLineID:       1\nLatest checkpoint's PrevTimeLineID:   1\nLatest checkpoint's full_page_writes: on\nLatest checkpoint's NextXID:          0:730\nLatest checkpoint's NextOID:          25609\nLatest checkpoint's NextMultiXactId:  1\nLatest checkpoint's NextMultiOffset:  0\nLatest checkpoint's oldestXID:        548\nLatest checkpoint's oldestXID's DB:   1\nLatest checkpoint's oldestActiveXID:  730\nLatest checkpoint's oldestMultiXid:   1\nLatest checkpoint's oldestMulti's DB: 1\nLatest checkpoint's oldestCommitTsXid:0\nLatest checkpoint's newestCommitTsXid:0\nTime of latest checkpoint:            \u4E94  3/ 9 12:04:12 2018\nFake LSN counter for unlogged rels:   0/1\nMinimum recovery ending location:     0/0\nMin recovery ending loc's timeline:   0\nBackup start location:                0/0\nBackup end location:                  0/0\nEnd-of-backup record required:        no\nwal_level setting:                    replica\nwal_log_hints setting:                off\nmax_connections setting:              100\nmax_worker_processes setting:         8\nmax_prepared_xacts setting:           200\nmax_locks_per_xact setting:           64\ntrack_commit_timestamp setting:       off\nMaximum data alignment:               8\nDatabase block size:                  8192\nBlocks per segment of large relation: 131072\nWAL block size:                       8192\nBytes per WAL segment:                16777216\nMaximum length of identifiers:        64\nMaximum columns in an index:          32\nMaximum size of a TOAST chunk:        1996\nSize of a large-object chunk:         2048\nDate/time type storage:               64-bit integers\nFloat4 argument passing:              by value\nFloat8 argument passing:              by value\nData page checksum version:           1\nMock authentication nonce:            32f8310a0cf344f7c1432dd733d3cf6065b748697485724af31fbaf7605f50bc\n"})}),"\n",(0,i.jsx)(n.h2,{id:"psql-\u5F00\u542F\u65F6\u95F4\u8BB0\u5F55",children:"psql \u5F00\u542F\u65F6\u95F4\u8BB0\u5F55"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"\\timing"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u76F4\u63A5\u547D\u4EE4\u884C\u4F7F\u7528\npsql -c '\\timing' -c 'select 1'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6570\u7EC4\u7D22\u5F15",children:"\u6570\u7EC4\u7D22\u5F15"}),"\n",(0,i.jsx)(n.p,{children:"GIN \u7D22\u5F15\u662F\u53CD\u5411\u7D22\u5F15(inverted indexes), \u9002\u7528\u4E8E\u5305\u542B\u591A\u4E2A\u503C\u7684\u60C5\u51B5."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u652F\u6301\u7684\u64CD\u4F5C\u7B26\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<@"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"@>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"="})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"&&"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6570\u7EC4\u5916\u952E",children:"\u6570\u7EC4\u5916\u952E"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-cannot-alter-type-of-a-column-used-by-a-view-or-rule",children:"ERROR: cannot alter type of a column used by a view or rule"}),"\n",(0,i.jsx)(n.p,{children:"\u5FC5\u987B\u8981\u5148 drop view \u518D\u64CD\u4F5C, \u76EE\u524D\u6CA1\u6709\u6BD4\u8F83\u597D\u7684\u64CD\u4F5C\u65B9\u5F0F, \u4F46\u64CD\u4F5C\u90FD\u53EF\u4EE5\u5728\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u5B8C\u6210"}),"\n",(0,i.jsx)(n.p,{children:"\u6709\u4E9B\u4FEE\u6539\u53EF\u4EE5\u901A\u8FC7\u76F4\u63A5\u4FEE\u6539 pg_attribute \u6765\u8FBE\u5230\u76EE\u7684, \u4F46\u662F\u975E\u5E38\u4E0D\u5EFA\u8BAE."}),"\n",(0,i.jsx)(n.h2,{id:"\u65F6\u95F4\u6233\u4E0A\u7684\u6BEB\u79D2\u5904\u7406",children:"\u65F6\u95F4\u6233\u4E0A\u7684\u6BEB\u79D2\u5904\u7406"}),"\n",(0,i.jsx)(n.p,{children:"\u76EE\u524D\u6CA1\u6709\u6BD4\u8F83\u597D\u7684\u5904\u7406\u65B9\u5F0F"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u5C06\u4E00\u4E2A\u6BEB\u79D2\u7684 ts \u8F6C\u4E3A timestamp \u7C7B\u578B\nALTER TABLE  my_info\n  ALTER COLUMN tstmp TYPE TIMESTAMP USING to_timestamp(tstmp / 1000) + ((tstmp % 1000) || ' milliseconds') :: INTERVAL;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u67E5\u8BE2\u8BED\u53E5\u7684\u6700\u5927\u5927\u5C0F",children:"\u67E5\u8BE2\u8BED\u53E5\u7684\u6700\u5927\u5927\u5C0F"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76EE\u524D\u4E3A 1G"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dba.stackexchange.com/q/131399",children:"Is there a maximum length constraint for a postgres query?"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/postgres/postgres/blob/REL_10_1/src/common/psprintf.c#L28",children:"src/common/psprintf.c#L28"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"#define MaxAllocSize   ((Size) 0x3fffffff) /* 1 gigabyte - 1 */\n"})}),"\n",(0,i.jsx)(n.h2,{id:"in-vs-any",children:"IN vs any"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/28995514/1870054",children:"https://stackoverflow.com/a/28995514/1870054"})}),"\n",(0,i.jsxs)(n.li,{children:["IN\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Bitmap \u626B\u63CF"}),"\n",(0,i.jsx)(n.li,{children:"\u6570\u636E\u91CF\u5927\u65F6, \u6267\u884C\u65F6\u95F4\u66F4\u6162\u8BA1\u5212\u65F6\u95F4\u66F4\u4E45"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["ANY\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F1A\u4F7F\u7528\u4E34\u65F6\u8868\u505A JOIN"}),"\n",(0,i.jsx)(n.li,{children:"\u6570\u636E\u91CF\u5927\u65F6, \u6267\u884C\u65F6\u95F4\u66F4\u4E45\u8BA1\u5212\u65F6\u95F4\u66F4\u5FEB"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE test (\n  id  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  val TEXT\n);\n\n-- \u63D2\u5165\u6D4B\u8BD5\u6570\u636E\nDO\n$$\nBEGIN\n  FOR i IN 1..100000 LOOP\n    INSERT INTO test (val) VALUES ('val#' || i);\n  END LOOP;\nEND\n$$;\n\nEXPLAIN SELECT *\n        FROM test\n        WHERE id IN (1, 2, 3);\n\nEXPLAIN SELECT *\n        FROM test\n        WHERE id = ANY (VALUES (1), (2), (3));\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'# IN\nBitmap Heap Scan on test  (cost=12.86..19.97 rows=3 width=40)\n  Recheck Cond: (id = ANY (\'{1,2,3}\'::bigint[]))\n  ->  Bitmap Index Scan on test_pkey  (cost=0.00..12.86 rows=3 width=0)\n        Index Cond: (id = ANY (\'{1,2,3}\'::bigint[]))\n\n# ANY\nNested Loop  (cost=0.32..25.00 rows=3 width=40)\n  ->  HashAggregate  (cost=0.05..0.08 rows=3 width=4)\n        Group Key: ""*VALUES*"".column1\n        ->  Values Scan on ""*VALUES*""  (cost=0.00..0.04 rows=3 width=4)\n  ->  Index Scan using test_pkey on test  (cost=0.28..8.29 rows=1 width=40)\n        Index Cond: (id = ""*VALUES*"".column1)\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"-- \u6D4B\u8BD5 IN\nDO\n$$\nDECLARE\n  x   TEXT = '';\n  r   REFCURSOR;\n  rec RECORD;\nBEGIN\n  x = '0';\n  FOR i IN 1..1000 LOOP\n    x = x || ',' || i;\n  END LOOP;\n  OPEN r FOR EXECUTE 'EXPLAIN ANALYSE SELECT *\n        FROM test\n        WHERE id IN (' || x || ')';\n\n  FOR i IN 1..6 LOOP\n    FETCH r INTO rec;\n    RAISE NOTICE 'ROW %', rec;\n  END LOOP;\nEND\n$$;\n\n-- \u6D4B\u8BD5 ANY\nDO\n$$\nDECLARE\n  x   TEXT;\n  r   REFCURSOR;\n  rec RECORD;\nBEGIN\n  x = '(0)';\n  FOR i IN 1..1000 LOOP\n    x = x || ',(' || i || ')';\n  END LOOP;\n  OPEN r FOR EXECUTE 'EXPLAIN ANALYSE SELECT *\n        FROM test\n        WHERE id = any (VALUES ' || x || ')';\n\n  FOR i IN 1..10 LOOP\n    FETCH r INTO rec;\n    RAISE NOTICE 'ROW %', rec;\n  END LOOP;\nEND\n$$;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u91CD\u7F6E-schema",children:"\u91CD\u7F6E schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"DROP SCHEMA public CASCADE;\nCREATE SCHEMA public;\n\n-- 9.3+ \u53EF\u80FD\u9700\u8981\nGRANT ALL ON SCHEMA public TO postgres;\nGRANT ALL ON SCHEMA public TO public;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"psql-\u4F7F\u7528\u8FDE\u63A5\u5B57\u7B26\u4E32",children:"psql \u4F7F\u7528\u8FDE\u63A5\u5B57\u7B26\u4E32"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'psql -Atx "host=localhost port=5432 dbname=taop user=taop" -c \'select current_date\'\n\n# -d database\npsql -d "host=localhost port=5432 dbname=taop user=taop"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"control-reached-end-of-trigger-procedure-without-return",children:"control reached end of trigger procedure without RETURN"}),"\n",(0,i.jsx)(n.p,{children:"\u4F7F\u7528 trigger \u65F6\u51FA\u73B0\uFF0C\u6DFB\u52A0 return null"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"create or replace function sync_events_trigger() returns trigger\nas\n$$\nBEGIN\n    -- ...\n    return null; -- this is important\nEND;\n$$ language plpgsql volatile;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"query-has-no-destination-for-result-data",children:"query has no destination for result data"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u51FD\u6570\u4E2D select \u9700\u8981\u6307\u5B9A\u8F93\u51FA"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u5C06\u8FD4\u56DE\u7C7B\u578B\u6307\u5B9A\u4E3A table"}),"\n",(0,i.jsxs)(n.li,{children:["\u53EF\u4EE5 ",(0,i.jsx)(n.code,{children:"select into"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u53EF\u4EE5 \u8FD4\u56DE ",(0,i.jsx)(n.code,{children:"return(select * from tab)"})]}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u4F7F\u7528 perform/execute \u5982\u679C\u4E0D\u60F3\u8981\u7ED3\u679C"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION tst_dates_func()\nRETURNS TABLE( v int) as\n$$\n    select 1;\n$$ LANGUAGE sql;\n\nRETURN QUERY (select 1);\nRETURN(SELECT dblink_disconnect());\n\nSELECT 1 into result;\nRETURN result;\n\nPERFORM select 1;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"could-not-resize-shared-memory-segment-postgresql153520683-to-1073812480-bytes-no-space-left-on-device",children:'could not resize shared memory segment "/PostgreSQL.153520683" to 1073812480 bytes: No space left on device'}),"\n",(0,i.jsx)(n.p,{children:"\u589E\u52A0 docker \u7684 shm_size"}),"\n",(0,i.jsx)(n.h2,{id:"set-returning-functions-are-not-allowed-in-update",children:"set-returning functions are not allowed in UPDATE"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u66FF\u6362 unnest(array_value) -> ",(0,i.jsx)(n.code,{children:"array_value[1]"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u66FF\u6362 ",(0,i.jsx)(n.code,{children:"(regexp_matches(album, '^6,(?:(.+),)?tv\\d+'))[1]"})," -> ",(0,i.jsx)(n.code,{children:"substring (album FROM '^6,(?:(.+),)?tv\\d+')"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"tuning",children:"Tuning"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=28489340",children:"https://news.ycombinator.com/item?id=28489340"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://postgresqlco.nf/",children:"https://postgresqlco.nf/"})}),"\n",(0,i.jsxs)(n.li,{children:["Why Uber Engineering Switched from Postgres to MySQL - 2016\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MySQL used as key-value storage layer of homegrown sharded non-relational database"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://eng.uber.com/postgres-to-mysql-migration/",children:"https://eng.uber.com/postgres-to-mysql-migration/"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=17280239",children:"https://news.ycombinator.com/item?id=17280239"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=12166585",children:"https://news.ycombinator.com/item?id=12166585"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=26283348",children:"https://news.ycombinator.com/item?id=26283348"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Postgres better for read heavy"}),"\n",(0,i.jsx)(n.li,{children:"MySQL for write heavy"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Pain Point ",(0,i.jsx)(n.a,{href:"https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html",children:"https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://sql-info.de/postgresql/postgres-gotchas.html",children:"https://sql-info.de/postgresql/postgres-gotchas.html"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sale-point",children:"Sale Point"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"transactional ddl"}),"\n",(0,i.jsx)(n.li,{children:"JSONB,JSON"}),"\n",(0,i.jsx)(n.li,{children:"Extension"}),"\n",(0,i.jsx)(n.li,{children:"Native Array"}),"\n",(0,i.jsx)(n.li,{children:"window function"}),"\n",(0,i.jsx)(n.li,{children:"custom type"}),"\n",(0,i.jsxs)(n.li,{children:["MySQL 8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"atomic ddl - \u5F31\u4E8E transactional ddl"}),"\n",(0,i.jsx)(n.li,{children:"window function"}),"\n",(0,i.jsx)(n.li,{children:"arbitrary check"}),"\n",(0,i.jsx)(n.li,{children:"JSON"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://sql-info.de/mysql/gotchas.html",children:"https://sql-info.de/mysql/gotchas.html"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://fromdual.com/mysql-limitations",children:"https://fromdual.com/mysql-limitations"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"on-conflict-do-update-command-cannot-affect-row-a-second-time",children:"ON CONFLICT DO UPDATE command cannot affect row a second time"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u63D2\u5165\u524D\u8FDB\u884C dedup"}),"\n",(0,i.jsx)(n.li,{children:"CTE \u5148 select distinct"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u751F\u6210\u5217",children:"\u751F\u6210\u5217"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u751F\u6210\u5217\u4E0D\u80FD\u88AB\u624B\u52A8\u6307\u5B9A"}),"\n",(0,i.jsx)(n.li,{children:"stored - INSERT \u6216 UPDATE \u65F6\u5199\u5165"}),"\n",(0,i.jsx)(n.li,{children:"virtual - \u5B9E\u65F6\u8BA1\u7B97 - \u7C7B\u4F3C view"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"generated-vs-default-column",children:"generated vs default column"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["default\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u6307\u5B9A"}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u6307\u5B9A\u4F7F\u7528\u9ED8\u8BA4 - \u8BA1\u7B97 1 \u6B21"}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u5173\u8054\u5176\u4ED6\u5217"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["generated\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6BCF\u6B21\u884C\u53D8\u5316\u90FD\u4F1A\u751F\u6210"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"remaining-connection-slots-are-reserved-for-non-replication-superuser-connection",children:"remaining connection slots are reserved for non-replication superuser connection"}),"\n",(0,i.jsx)(n.p,{children:"\u6392\u67E5\u8FDE\u63A5\u6570\u95EE\u9898"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4FEE\u6539 max_connections \u5FC5\u987B\u91CD\u542F pg"}),"\n",(0,i.jsx)(n.li,{children:"\u5EFA\u8BAE\u5E94\u7528\u6307\u5B9A application_name"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u67E5\u770B\u5F53\u524D\u7684\u6700\u5927\u8FDE\u63A5\u6570\nshow max_connections;\n\n-- \u67E5\u770B\u8FDE\u63A5\u6570\u4E3B\u8981\u8C01\u5360\u7528\n-- idle \u591A\u8FD8\u662F active \u591A\nselect state, usename, application_name, datname, count(*)\nfrom pg_stat_activity\ngroup by state, usename, application_name, datname\norder by 1, 2, 3;\n\n-- \u6392\u67E5 active \u8FDE\u63A5\nselect *\nfrom pg_stat_activity\nwhere state = 'active';\n\n-- \u6309\u9700 kill \u8FDE\u63A5\n"})}),"\n",(0,i.jsx)(n.h2,{id:"current_timestamp-vs-now",children:"CURRENT_TIMESTAMP vs NOW"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6CA1\u6709\u533A\u522B"}),"\n",(0,i.jsx)(n.li,{children:"CURRENT_TIMESTAMP=\u4E8B\u7269\u5F00\u59CB\u65F6\u95F4=transaction_timestamp()=now()"}),"\n",(0,i.jsxs)(n.li,{children:["\u8F93\u5165\u65F6\u7684 ",(0,i.jsx)(n.code,{children:"now"})," \u4E0D\u7B49\u4E8E ",(0,i.jsx)(n.code,{children:"now()"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/datatype-datetime.html#DATATYPE-DATETIME-SPECIAL-TABLE",children:"Special Date/Time Inputs"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5176\u4ED6\u65F6\u95F4\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"statement_timestamp() - STABLE - \u8BED\u53E5\u65F6\u95F4"}),"\n",(0,i.jsx)(n.li,{children:"clock_timestamp() - VOLATILE - \u771F\u6B63\u5F53\u524D\u65F6\u95F4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dba.stackexchange.com/a/63549/234272",children:"https://dba.stackexchange.com/a/63549/234272"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"on-conflict-do-update-command-cannot-affect-row-a-second-time-sqlstate-21000",children:"ON CONFLICT DO UPDATE command cannot affect row a second time (SQLSTATE 21000)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"insert on conflict \u65F6\u6709\u91CD\u590D\u6570\u636E"}),"\n",(0,i.jsx)(n.li,{children:"\u63D2\u5165\u4E4B\u524D\u5148\u53BB\u91CD"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"column-datlastsysoid-does-not-exist",children:'column "datlastsysoid" does not exist'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PostgreSQL 15 \u79FB\u9664\u4E86\u8FD9\u4E2A\u5217"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/pgmodeler/pgmodeler/issues/1689",children:"https://github.com/pgmodeler/pgmodeler/issues/1689"})}),"\n",(0,i.jsx)(n.li,{children:"navicat 16 \u4E5F\u6709\u95EE\u9898"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"select distinct datlastsysoid from pg_database;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u67E5\u627E\u6240\u6709\u5916\u952E",children:"\u67E5\u627E\u6240\u6709\u5916\u952E"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT conrelid::regclass AS table_name,\n       conname AS foreign_key,\n       pg_get_constraintdef(oid)\nFROM   pg_constraint\nWHERE  contype = 'f'\nAND    connamespace = 'public'::regnamespace\nORDER  BY conrelid::regclass::text, contype DESC;\n\n-- psql\n\\d table_name\n"})}),"\n",(0,i.jsx)(n.h2,{id:"array\u6570\u7EC4-\u5916\u952E",children:"ARRAY/\u6570\u7EC4 \u5916\u952E"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/questions/41054507",children:"https://stackoverflow.com/questions/41054507"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cannot-use-column-reference-in-default-expression",children:"cannot use column reference in DEFAULT expression"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u80FD\u5728 default \u4E2D\u4F7F\u7528\u5176\u4ED6\u5217"}),"\n",(0,i.jsx)(n.li,{children:"\u901A\u8FC7 before insert \u89E6\u53D1\u5668\u5B9E\u73B0"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"lateral-vs-subquery",children:"lateral vs subquery"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["lateral\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PostgreSQL 9.3+"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Correlated_subquery",children:"correlated subquery"})}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u4EA7\u751F\u65B0\u7684\u884C"}),"\n",(0,i.jsx)(n.li,{children:"\u6BCF\u884C\u53EA\u6267\u884C 1 \u6B21"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LEFT JOIN LATERAL (select 1) t ON TRUE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LATERAL (select 1) t"})}),"\n",(0,i.jsx)(n.li,{children:"\u67E5\u8BE2\u53EF\u4EE5\u5F15\u7528\u5916\u90E8\u5217"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["subquery\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EA\u80FD\u8FD4\u56DE\u4E00\u4E2A\u503C"}),"\n",(0,i.jsx)(n.li,{children:"\u53EA\u6267\u884C 1 \u6B21"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"union-vs-union-all",children:"union vs union all"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["union\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5408\u5E76\u53BB\u91CD"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["union all\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u505A\u5904\u7406"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5916\u952E\u9700\u8981\u5EFA\u7ACB\u7D22\u5F15\u4E48",children:"\u5916\u952E\u9700\u8981\u5EFA\u7ACB\u7D22\u5F15\u4E48\uFF1F"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"pk \u548C unique \u4F1A\u81EA\u52A8\u5EFA\u7ACB\u7D22\u5F15"}),"\n",(0,i.jsxs)(n.li,{children:["fk \u4E0D\u4F1A\u81EA\u52A8\u5EFA\u7ACB\u7D22\u5F15\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5EFA\u8BAE\u5EFA\u7ACB\u7D22\u5F15"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"enum-vs-check-vs-fk",children:"enum vs check vs fk"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["enum\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u80FD\u5220\u9664"}),"\n",(0,i.jsx)(n.li,{children:"\u987A\u5E8F\u4E0D\u53EF\u53D8"}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u53EF\u4EE5\u6A21\u5F0F\u5339\u914D"}),"\n",(0,i.jsx)(n.li,{children:"\u5B9E\u9645\u5B58\u50A8 oridinal"}),"\n",(0,i.jsx)(n.li,{children:"\u9ED8\u8BA4\u6700\u957F 63byte"}),"\n",(0,i.jsx)(n.li,{children:"\u53EA\u6709 value"}),"\n",(0,i.jsx)(n.li,{children:"\u5B58\u50A8\u5728 pg_enum"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/datatype-enum.html",children:"https://www.postgresql.org/docs/current/datatype-enum.html"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["check\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6240\u89C1\u5373\u6240\u5F97"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["fk\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u5305\u542B label - \u65B9\u4FBF\u751F\u6210"}),"\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u52A8\u6001\u53D8\u5316"}),"\n",(0,i.jsx)(n.li,{children:"\u63A8\u8350 FK Value"}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u9700\u8981 alter table"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- ENUM\nCREATE TYPE valid_colors AS ENUM ('red', 'green', 'blue');\n\nCREATE TABLE t (\n    color VALID_COLORS\n);\n\n-- CHECK\nCREATE TABLE t (\n    colors TEXT CHECK (colors IN ('red', 'green', 'blue'))\n);\n\n-- FK ID\nCREATE TABLE valid_colors (\n    id SERIAL PRIMARY KEY NOT NULL,\n    color TEXT\n);\n\nINSERT INTO valid_colors (color) VALUES\n    ('red'),\n    ('green'),\n    ('blue');\n\nCREATE TABLE t (\n    color_id INTEGER REFERENCES valid_colors (id)\n);\n\n-- FK value\nCREATE TABLE valid_colors (\n    value text PRIMARY KEY NOT NULL,\n    label text\n);\n\nINSERT INTO valid_colors (value) VALUES\n    ('red'),\n    ('green'),\n    ('blue');\n\nCREATE TABLE t (\n    color text REFERENCES valid_colors (value)\n);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/10984951/1870054",children:"https://stackoverflow.com/a/10984951/1870054"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u9884\u52A0\u8F7D-table-\u5230\u5185\u5B58",children:"\u9884\u52A0\u8F7D table \u5230\u5185\u5B58"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/notes/db/relational/postgresql/pg_prewarm",children:"pg_prewarm"})}),"\n",(0,i.jsx)(n.h2,{id:"error-could-not-open-file-base52704-no-such-file-or-directory",children:'ERROR: could not open file "base/5/2704": No such file or directory'}),"\n",(0,i.jsx)(n.p,{children:"\u6570\u636E\u5E93\u5C11\u4E86\u6570\u636E\u6587\u4EF6"}),"\n",(0,i.jsx)(n.h2,{id:"a-field-with-precision-5-scale-4-must-round-to-an-absolute-value-less-than-101",children:"A field with precision 5, scale 4 must round to an absolute value less than 10^1"}),"\n",(0,i.jsx)(n.h2,{id:"the-database-system-is-in-recovery-mode-the-database-system-is-in-recovery-mode",children:"the database system is in recovery mode the database system is in recovery mode"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F7F\u7528 pg_isready \u5224\u65AD\u662F\u5426\u53EF\u7528"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-could-not-resize-shared-memory-segment-postgresql2692148336-to-1073812480-bytes-no-space-left-on-device",children:'ERROR: could not resize shared memory segment "/PostgreSQL.2692148336" to 1073812480 bytes: No space left on device'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"vacuum \u65F6\u53D1\u751F"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sysctl kernel.shmmax\nls -lash /dev/shm\n# PostgreSQL.1489521326\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"K8S \u4FEE\u6539"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spec:\n  containers:\n    - name: postgres\n      image: postgres\n      volumeMounts:\n        - mountPath: /dev/shm\n          name: dshm\n      ports:\n        - containerPort: 5432\n  volumes:\n    - name: dshm\n      emptyDir:\n        medium: Memory\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Docker"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --cap-add=SYS_ADMIN --shm-size 2G postgres\n"})}),"\n",(0,i.jsx)(n.h2,{id:"k8s-start--shutdown",children:"K8S start & shutdown"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"preStop:\n  exec:\n    command: ['/bin/sh', '-c', 'pg_ctl -D /var/lib/postgresql/data/pgdata -w -t 60 stop -m fast']\n    #command: ['/usr/local/bin/pg_ctl stop -D /var/lib/postgresql/data -w -t 60 -m fast']\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://stackoverflow.com/a/75829325/1870054",children:"https://stackoverflow.com/a/75829325/1870054"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"collate",children:"collate"}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"collate \u4E0D\u80FD\u521B\u5EFA db \u540E\u4FEE\u6539\uFF0C\u53EF\u4EE5\u9488\u5BF9 column \u6216 table \u4FEE\u6539\u3002"}),"\n"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["--lc-collate=C --lc-ctype=C\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5F71\u54CD\u6392\u5E8F\u3001\u6BD4\u8F83\u3001\u5B57\u7B26\u64CD\u4F5C"}),"\n",(0,i.jsxs)(n.li,{children:["\u597D\u5904\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"byte-level sorting"}),"\n",(0,i.jsx)(n.li,{children:"\u63D0\u5347\u6027\u80FD, text_pattern_ops, like"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u574F\u5904\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301 pg_trgm"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u9ED8\u8BA4 en_US.utf8"}),"\n",(0,i.jsx)(n.li,{children:"C \u662F\u6700\u5C0F\u5316\u7684 locale"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"create index on t (name COLLATE \"C\");\n-- \u652F\u6301\u4F7F\u7528 Index\nexplain select * from t where name like 'W%';\n-- \u4E0D\u4F1A\u7528 Index\nexplain select * from t where name = 'Wener';\n-- \u4F1A\u7528 Index\nexplain select * from t where name = 'Wener' collate \"C\";\n\n-- \u4FEE\u6539\u9ED8\u8BA4 COLLATE\nalter table t alter column name set data type text collate \"C\";\n-- \u4F1A\u7528 Index\nexplain select * from t where name = 'Wener';\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:['COLLATE "C" \u652F\u6301\u524D\u7F00\u8FC7\u6EE4\u7D22\u5F15\n',(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301 pg_trgm"}),"\n",(0,i.jsx)(n.li,{children:"show_trgm \u8FD4\u56DE\u7A7A"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"LC_COLLATE"}),"\n",(0,i.jsx)(n.li,{children:"LC_CTYPE"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"{locale_name}.{encoding_name}"})}),"\n",(0,i.jsxs)(n.li,{children:["C.UTF-8\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PostgreSQL 17+"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://pganalyze.com/blog/5mins-postgres-17-builtin-c-utf8-locale",children:"https://pganalyze.com/blog/5mins-postgres-17-builtin-c-utf8-locale"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"show lc_collate;\nshow lc_monetary;\n\nselect *\nfrom pg_settings\nwhere name like 'lc_%';\n\nset lc_monetary to \"en_IE.utf8\";\nselect 10::money;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/catalog-pg-collation.html",children:"pg_collation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/collation.html",children:"https://www.postgresql.org/docs/current/collation.html"})}),"\n",(0,i.jsxs)(n.li,{children:["LC_COLLATE\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9ED8\u8BA4 en_US.utf8"}),"\n",(0,i.jsx)(n.li,{children:"\u63A8\u8350 C"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"LC_CTYPE"}),"\n",(0,i.jsx)(n.li,{children:"LC_MONETERY"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"name"}),(0,i.jsx)(n.th,{children:"default"}),(0,i.jsx)(n.th,{children:"aliyun"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_collate"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:"C"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_ctype"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:"en_US.utf8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_messages"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:'""'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_monetary"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:"C"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_numeric"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:"C"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"lc_time"}),(0,i.jsx)(n.td,{children:"en_US.utf8"}),(0,i.jsx)(n.td,{children:"C"})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["initdb - ",(0,i.jsx)(n.code,{children:"--encoding=UTF-8 --lc-collate=C --lc-ctype=C"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POSTGRES_INITDB_ARGS: '--encoding=UTF-8 --lc-collate=C --lc-ctype=C'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"there-is-no-unique-constraint-matching-given-keys-for-referenced-table",children:"there is no unique constraint matching given keys for referenced table"}),"\n",(0,i.jsx)(n.p,{children:"\u5916\u952E\u5FC5\u987B unique"}),"\n",(0,i.jsx)(n.h2,{id:"permission-denied-for-table",children:"permission denied for table"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5916\u952E\u9700\u8981 REFERENCES"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/ddl-priv.html",children:"https://www.postgresql.org/docs/current/ddl-priv.html"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"source-for-a-multiple-column-update-item-must-be-a-sub-select-or-row-expression",children:"source for a multiple-column UPDATE item must be a sub-SELECT or ROW() expression"}),"\n",(0,i.jsx)(n.p,{children:"\u4E0D\u80FD\u5355\u4E2A\u5B57\u6BB5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"on conflict(value) do update set (label)= (excluded.label);\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4FEE\u6539\u4E3A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"on conflict(value) do update set (label,extensions)= (excluded.label,excluded.extensions);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"for-update-nowait---for-update-cannot-be-applied-to-the-nullable-side-of-an-outer-join",children:"for update nowait - FOR UPDATE cannot be applied to the nullable side of an outer join"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"mikroorm LockMode.PESSIMISTIC_WRITE_OR_FAIL"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"permission-denied-to-set-session-authorization",children:"permission denied to set session authorization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u83B7\u53D6\u5F53\u524D\u7684 superuser\nSELECT usename\nFROM pg_catalog.pg_user\nWHERE usesuper = true;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u26A0\uFE0F\u6CE8\u610F ",(0,i.jsx)(n.a,{href:"/notes/db/relational/postgresql/postgres-supabase",children:"supabase"})," \u7684 pg superuser \u662F supabase_admin\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["supabase_admin \u5BC6\u7801\u548C postgres \u76F8\u540C\uFF0C\u767B\u5F55\u540E ",(0,i.jsx)(n.code,{children:"ALTER USER postgres WITH SUPERUSER"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"windows-minimal",children:"Windows minimal"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4E0B\u8F7D zip\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.enterprisedb.com/download-postgresql-binaries",children:"https://www.enterprisedb.com/download-postgresql-binaries"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u89E3\u538B"}),"\n",(0,i.jsxs)(n.li,{children:["\u5F97\u5230 pgsql \u76EE\u5F55\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["17.0\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"zip 250MB"}),"\n",(0,i.jsx)(n.li,{children:"\u89E3\u538B\u540E 997MB"}),"\n",(0,i.jsx)(n.li,{children:"pgAdmin 650MB"}),"\n",(0,i.jsx)(n.li,{children:"bin 175MB"}),"\n",(0,i.jsx)(n.li,{children:"lib 95MB"}),"\n",(0,i.jsx)(n.li,{children:"doc 31MB"}),"\n",(0,i.jsx)(n.li,{children:"share 24MB"}),"\n",(0,i.jsxs)(n.li,{children:["\u79FB\u9664\u540E\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"112MB"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rm -rf pgAdmin doc include StackBuilder\nrm lib/*.pdb bin/*.pdb\n\ncd bin\nrm clusterdb.exe createdb.exe createuser.exe dropdb.exe dropuser.exe ecpg.exe oid2name.exe pg_amcheck.exe pg_archivecleanup.exe pg_basebackup.exe pg_checksums.exe pg_combinebackup.exe pg_config.exe pg_controldata.exe pg_createsubscriber.exe pg_isready.exe pg_receivewal.exe pg_recvlogical.exe pg_resetwal.exe pg_rewind.exe pg_test_fsync.exe pg_test_timing.exe pg_upgrade.exe pg_verifybackup.exe pg_waldump.exe pg_walsummary.exe pgbench.exe reindexdb.exe stackbuilder.exe vacuumdb.exe vacuumlo.exe\ncd -\n\nrm -rf share/locale\nrm -rf share/doc\n\nls bin/*.exe | sort\n# bin/initdb.exe\n# bin/pg_ctl.exe\n# bin/pg_dump.exe\n# bin/pg_dumpall.exe\n# bin/pg_restore.exe\n# bin/postgres.exe\n# bin/psql.exe\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"package"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ..\n# gnu tar + zstd ~ 27MB\ntar -I 'zstd -20' --exclude='.DS_Store' -cvf pgsql.tar.zst pgsql\n# just zip ~ 38MB\nzip -r -9 pgsql.zip pgsql -x \"*.DS_Store\"\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"init"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-batch",children:"set PATH=%PATH%;%CD%\\pgsql\\bin\ninitdb.exe -D .\\data -U postgres --encoding=UTF-8 --lc-collate=C --lc-ctype=C\npg_ctl -D ./data start -l db.log\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Shell"',children:"export PATH=$PWD/pgsql/bin:$PATH\nTZ=Asia/Shanghai initdb -D ./data -U postgres --encoding=UTF-8 --lc-collate=C --lc-ctype=C\npg_ctl -D ./data start -l db.log\n\nexport PGDATA=$PWD/data\npg_ctl status\npsql -U postgres\npg_ctl stop\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo 'listen_addresses = \"*\"' >> data/postgresql.conf\necho 'host all all 0.0.0.0/0 md5' >> data/pg_hba.conf\n\npg_ctl reload\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5FD8\u8BB0\u5BC6\u7801",children:"\u5FD8\u8BB0\u5BC6\u7801"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reset postgres password"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"psql -U postgres\nALTER USER postgres PASSWORD 'newpassword';\n"})})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},17776:function(e,n,s){s.d(n,{R:()=>t,x:()=>c});var l=s(7378);let i={},r=l.createContext(i);function t(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);