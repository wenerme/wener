"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["33002"],{63780:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>o,toc:()=>c,default:()=>h,metadata:()=>l,assets:()=>a,contentTitle:()=>t});var l=JSON.parse('{"id":"devops/kubernetes/storage/openebs","title":"OpenEBS","description":"- openebs/openebs","source":"@site/../notes/devops/kubernetes/storage/openebs.md","sourceDirName":"devops/kubernetes/storage","slug":"/devops/kubernetes/storage/openebs","permalink":"/notes/devops/kubernetes/storage/openebs","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/storage/openebs.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1647510739000,"frontMatter":{"title":"OpenEBS"},"sidebar":"docs","previous":{"title":"OpenEBS Version","permalink":"/notes/devops/kubernetes/storage/openebs-version"},"next":{"title":"Rook","permalink":"/notes/devops/kubernetes/storage/rook"}}'),i=s(86106),r=s(17776);let o={title:"OpenEBS"},t="OpenEBS",a={},c=[{value:"\u76EE\u5F55\u7ED3\u6784",id:"\u76EE\u5F55\u7ED3\u6784",level:2},{value:"Helm",id:"helm",level:2},{value:"Operator",id:"operator",level:2},{value:"zfs pv",id:"zfs-pv",level:2},{value:"Data Engine",id:"data-engine",level:2},{value:"CSI",id:"csi",level:2},{value:"LocalPV ZFS",id:"localpv-zfs",level:2},{value:"snapshot",id:"snapshot",level:3},{value:"clone",id:"clone",level:3},{value:"Backup/Restore",id:"backuprestore",level:3},{value:"driver name zfs.csi.openebs.io not found in the list of registered CSI drivers",id:"driver-name-zfscsiopenebsio-not-found-in-the-list-of-registered-csi-drivers",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"openebs",children:"OpenEBS"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/openebs",children:"openebs/openebs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.openebs.io",children:"openebs.io"})}),"\n",(0,i.jsxs)(n.li,{children:["Jiva \u6E90\u4E8E longhorn ",(0,i.jsx)(n.a,{href:"https://github.com/openebs/longhorn",children:"fork"}),"\uFF0C\u5728\u4E00\u4E9B\u5B9E\u73B0\u4E0A\u6709\u5206\u6B67\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76EE\u524D\u533A\u522B\u5DF2\u7ECF\u975E\u5E38\u5927"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u6B67\u70B9: Control Plane functionality, iSCSI Target implementation, Quorum, Backup / Restore, UI"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DB \u7C7B\u578B\u5E94\u7528\u6700\u597D\u4F7F\u7528 Local PV"}),"\n",(0,i.jsx)(n.li,{children:"\u65E0\u96C6\u7FA4\u80FD\u529B DB \u53EF\u4F7F\u7528 NVMe, SPDK, cStor + ZFS"}),"\n",(0,i.jsx)(n.li,{children:"\u6D41\u5E94\u7528\uFF08Kafka\uFF09\u5B58\u50A8\u63A8\u8350 NVMe Mayastor"}),"\n"]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5B58\u50A8\u7C7B\u578B"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Volume"}),(0,i.jsx)(n.th,{children:"Storage"}),(0,i.jsx)(n.th,{children:"Requirement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OpenEBS Mayastor"}),(0,i.jsx)(n.td,{children:"SSDs/Cloud Volumes"}),(0,i.jsx)(n.td,{children:"\u4F4E\u5EF6\u65F6, HA, \u540C\u6B65\u526F\u672C, \u5FEB\u7167, \u514B\u9686, Thin provisioning"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OpenEBS cStor"}),(0,i.jsx)(n.td,{children:"Disks/SSDs/Cloud Volumes"}),(0,i.jsx)(n.td,{children:"\u4FDD\u62A4\u8282\u70B9\u5F02\u5E38, \u540C\u6B65\u526F\u672C, \u5FEB\u7167, \u514B\u9686, Thin provisioning"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OpenEBS Jiva"}),(0,i.jsx)(n.td,{children:"hostpath, \u5916\u90E8\u6302\u8F7D"}),(0,i.jsx)(n.td,{children:"\u4FDD\u62A4\u8282\u70B9\u5F02\u5E38, \u540C\u6B65\u526F\u672C, Thin provisioning"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Local PV - Hostpath"}),(0,i.jsx)(n.td,{children:"hostpath, \u5916\u90E8\u6302\u8F7D"}),(0,i.jsx)(n.td,{children:"\u4F4E\u5EF6\u65F6, \u672C\u5730\u6301\u4E45\u5377"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Local PV - Device"}),(0,i.jsx)(n.td,{children:"Disks/SSDs/Cloud Volumes"}),(0,i.jsx)(n.td,{children:"\u4F4E\u5EF6\u65F6, \u672C\u5730\u6301\u4E45\u5377"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Local PV - ZFS"}),(0,i.jsx)(n.td,{children:"Disks/SSDs/Cloud Volumes"}),(0,i.jsx)(n.td,{children:"\u4F4E\u5EF6\u65F6, \u672C\u5730\u6301\u4E45\u5377, \u5FEB\u7167, \u514B\u9686"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Local PV - Rawfile"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u4F4E\u5EF6\u65F6, \u672C\u5730\u6301\u4E45\u5377"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u76EE\u5F55\u7ED3\u6784",children:"\u76EE\u5F55\u7ED3\u6784"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["/var/openebs/\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"local/ - Local PV - Hostpath"}),"\n",(0,i.jsx)(n.li,{children:"ndm/"}),"\n",(0,i.jsx)(n.li,{children:"sparse/"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"helm",children:"Helm"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openebs/charts",children:"https://github.com/openebs/charts"})}),"\n",(0,i.jsxs)(n.li,{children:["helm \u5B50 chart\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"cstor"}),"\n",(0,i.jsx)(n.li,{children:"jiva"}),"\n",(0,i.jsxs)(n.li,{children:["localpv-provisioner\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"StorageClass: openebs-hostpath"}),"\n",(0,i.jsx)(n.li,{children:"/var/openebs/local"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"lvm-localpv"}),"\n",(0,i.jsx)(n.li,{children:"openebs-ndm - node-disk-manager"}),"\n",(0,i.jsx)(n.li,{children:"zfs-localpv"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"helm \u529F\u80FD\u533A\u5206 \u5B50 chart \u6A21\u5F0F\u548C bundle \u7684 templates"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u9700\u8981\u5148\u5B89\u88C5 iscsi\n# https://docs.openebs.io/docs/next/prerequisites.html\n\nhelm repo add openebs https://openebs.github.io/charts\nhelm repo update\nhelm install --namespace openebs --name openebs openebs/openebs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"operator",children:"Operator"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u662F Helm Operator\uFF0C\u66F4\u5EFA\u8BAE\u76F4\u63A5\u5B89\u88C5 HELM"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u76F4\u63A5\u5B89\u88C5\nkubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"zfs-pv",children:"zfs pv"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u62D3\u666E Key - ",(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv/blob/develop/docs/faq.md#6-how-to-add-custom-topology-key",children:"How to add custom topology key"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F1A\u6DFB\u52A0 openebs.io/nodeid,openebs.io/nodename"}),"\n",(0,i.jsx)(n.li,{children:"\u9ED8\u8BA4\u6DFB\u52A0\u6240\u6709 node \u4E0A\u7684 label"}),"\n",(0,i.jsx)(n.li,{children:"ALLOWED_TOPOLOGIES \u63A7\u5236"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv/tree/develop/docs",children:"https://github.com/openebs/zfs-localpv/tree/develop/docs"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get csinodes -A\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="openebs-zfspv.sc.yaml"',children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: openebs-zfspv\nallowVolumeExpansion: true\nparameters:\n  poolname: 'zfspv-pool'\n  # zfs,ext2,ext3,ext4,xfs,btrfs\n  # \u975E zfs \u5219\u7528 zvol\n  # \u6709\u4E9B\u5E94\u7528\u5728\u6307\u5B9A\u7684 fs \u4E0A\u8FD0\u884C\u7684\u66F4\u597D - https://github.com/openebs/zfs-localpv/issues/169\n  # \u4E0D\u8BBE\u7F6E\u9ED8\u8BA4 ext4\n  fstype: 'zfs'\n  # \u5141\u8BB8\u591A\u6B21\u6302\u8F7D\n  # Deployment \u53EF\u4EE5\u4E0D\u7528 Recreate \u7B56\u7565\n  shared: 'yes'\n  # yes - \u5373\u4FBF zpool \u7A7A\u95F4\u4E0D\u591F\u4E5F\u4F1A\u63D0\u4F9B pv\n  # no - \u4F1A\u786E\u4FDD\u4FDD\u7559\u7A7A\u95F4\u8DB3\u591F\n  thinprovision: 'no'\n  dedup: 'no'\n  # on,off,lzjb,zstd,gzip,gzip-1,gzip-2,gzip-3,gzip-4,gzip-5,gzip-6,gzip-7,gzip-8,gzip-9,zle,lz4\n  # on - \u9ED8\u8BA4\u52A0\u5BC6\u7B97\u6CD5\n  compression: 'on'\n  # zfs \u914D\u7F6E\n  # recordsize:\n  # zvol \u914D\u7F6E\n  # volblocksize:\nprovisioner: zfs.csi.openebs.io\nallowedTopologies:\n  - matchLabelExpressions:\n      - key: openebs.io/nodeid\n        values:\n          - zfspv-node1\n          - zfspv-node2\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5FEB\u7167"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfspv-snapclass.yaml"',children:'kind: VolumeSnapshotClass\napiVersion: snapshot.storage.k8s.io/v1beta1\nmetadata:\n  name: zfspv-snapclass\n  annotations:\n    # snapshot.storage.kubernetes.io/is-default-class: "true"\ndriver: zfs.csi.openebs.io\ndeletionPolicy: Delete\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5BF9 PVC \u8FDB\u884C\u5FEB\u7167"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: snapshot.storage.k8s.io/v1beta1\nkind: VolumeSnapshot\nmetadata:\n  name: zfspv-snap\nspec:\n  volumeSnapshotClassName: zfspv-snapclass\n  source:\n    persistentVolumeClaimName: csi-zfspv\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get volumesnapshot.snapshot\n# \u67E5\u770B\u5FEB\u7167\nkubectl get zfssnap -n openebs\nzfs list -t all\n"})}),"\n",(0,i.jsx)(n.h2,{id:"data-engine",children:"Data Engine"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/libcstor",children:"cStor"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Apache-2.0, C"}),"\n",(0,i.jsx)(n.li,{children:"IOs on ZVOL/uZFS over network"}),"\n",(0,i.jsx)(n.li,{children:"synchronous replication, snapshots and clones"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/jiva",children:"Jiva"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Apache-2.0, Go"}),"\n",(0,i.jsx)(n.li,{children:"iSCSI Distributed Block Storage Controller"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/longhorn/longhorn-engine",children:"longhorn/longhorn-engine"})," fork"]}),"\n",(0,i.jsxs)(n.li,{children:["SCSI \u57FA\u4E8E ",(0,i.jsx)(n.a,{href:"https://github.com/gostor/gotgt",children:"gostor/gotgt"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/mayastor",children:"Mayastor"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Apache-2.0, Rust"}),"\n",(0,i.jsxs)(n.li,{children:["cloud native declarative data plane\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"abstract storage resources - Storage unification"}),"\n",(0,i.jsx)(n.li,{children:"Low latency"}),"\n",(0,i.jsx)(n.li,{children:"support Micro-VM based containers"}),"\n",(0,i.jsx)(n.li,{children:"Programmatic based storage access"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"NVMe SSD"}),"\n",(0,i.jsx)(n.li,{children:"SPDK, NVMe-oF"}),"\n",(0,i.jsx)(n.li,{children:"Linux kernel 5.4+ - nvme-tcp, ext4, optionally xfs"}),"\n",(0,i.jsx)(n.li,{children:"x86-64, SSE4.2"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/maya",children:"Maya"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"non-csi - 3.0 \u5E9F\u5F03"}),"\n",(0,i.jsx)(n.li,{children:"\u4F7F\u7528 CStore CSI \u6216 Jiva CSI"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"csi",children:"CSI"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openebs/cstor-operators",children:"cStor"})}),"\n",(0,i.jsxs)(n.li,{children:["Local PV - ",(0,i.jsx)(n.a,{href:"https://openebs.io/docs/main/concepts/casengines#local-engines",children:"https://openebs.io/docs/main/concepts/casengines#local-engines"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"hostpath"}),"\n",(0,i.jsx)(n.li,{children:"device"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv",children:"ZFS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u8282\u70B9\u4E0A\u521B\u5EFA ZPOOL - SC"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"LVM"}),"\n",(0,i.jsx)(n.li,{children:"Rawfile"}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"abbr."}),(0,i.jsx)(n.th,{children:"stand for"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CAS"}),(0,i.jsx)(n.td,{children:"Container Attached Storage"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CSPC"}),(0,i.jsx)(n.td,{children:"CStorPoolCluster"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CSI"}),(0,i.jsx)(n.td,{children:"Container Storage Interface"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Storage Pool Claim"}),(0,i.jsx)(n.td,{children:"SPC"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CSP"}),(0,i.jsx)(n.td,{children:"cStor Storage Pool"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CV"}),(0,i.jsx)(n.td,{children:"cStor Volume"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CVR"}),(0,i.jsx)(n.td,{children:"cStor Volume Replica"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SPDK"}),(0,i.jsx)(n.td,{children:"Intel Storage Performance Development Kit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MSN"}),(0,i.jsx)(n.td,{children:"Mayastor Node"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"localpv-zfs",children:"LocalPV ZFS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv",children:"openebs/zfs-localpv"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u8282\u70B9\u4E0A\u521B\u5EFA ZPOOL - SC"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 FS\u3001Block"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 \u5FEB\u7167\u3001\u514B\u9686\u3001Resize"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 Velero \u5907\u4EFD\u6062\u590D"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5EFA\u8BAE\u8282\u70B9\u4E0A\u5173\u95ED zfs import"}),"\n",(0,i.jsxs)(n.li,{children:["\u76EE\u524D\u4E0D\u652F\u6301\u8FC1\u79FB - syncoid\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv/issues/291",children:"openebs/zfs-localpv#291"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/openebs/zfs-localpv/issues/219",children:"openebs/zfs-localpv#219"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfs-localpv.yaml"',children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: openebs-zfspv\nparameters:\n  # zfs \u53C2\u6570\n  recordsize: '4k'\n  # volblocksize: \"4k\" # zvol \u4F7F\u7528\u8BE5\u53C2\u6570\n  compression: 'off'\n  dedup: 'off'\n  fstype: 'zfs' # \u5176\u4ED6 fs \u4F1A\u521B\u5EFA\u4E3A zvol\n  poolname: 'zfspv-pool' # \u5339\u914D\u521B\u5EFA\u7684\u540D\u5B57\nprovisioner: zfs.csi.openebs.io\nallowedTopologies:\n  - matchLabelExpressions:\n      # \u9650\u5B9A\u8282\u70B9\n      - key: kubernetes.io/hostname\n        values:\n          - zfspv-node1\n          - zfspv-node2\n      # \u81EA\u5B9A\u4E49 key\n      - key: openebs.io/rack\n        values:\n          - rack1\n# \u9ED8\u8BA4\u4F7F\u7528 zfs scheduler - VolumeWeighted, CapacityWeighted\n# \u53EF\u4F7F\u7528 kubernetes scheduler - pod \u8282\u70B9\u4EB2\u548C\nvolumeBindingMode: WaitForFirstConsumer\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="csi-zfspv.yaml"',children:"kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: csi-zfspv\nspec:\n  storageClassName: openebs-zfspv\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 4Gi\n"})}),"\n",(0,i.jsx)(n.h3,{id:"snapshot",children:"snapshot"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfspv-snapclass.yaml"',children:"kind: VolumeSnapshotClass\napiVersion: snapshot.storage.k8s.io/v1beta1\nmetadata:\n  name: zfspv-snapclass\n  annotations:\n    snapshot.storage.kubernetes.io/is-default-class: 'true'\ndriver: zfs.csi.openebs.io\ndeletionPolicy: Delete\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfspv-snap.yaml"',children:"apiVersion: snapshot.storage.k8s.io/v1beta1\nkind: VolumeSnapshot\nmetadata:\n  name: zfspv-snap\nspec:\n  volumeSnapshotClassName: zfspv-snapclass\n  source:\n    persistentVolumeClaimName: csi-zfspv\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get volumesnapshot.snapshot\n# \u8282\u70B9\u4E0A\u4E5F\u53EF\u4EE5\u67E5\u770B\u5FEB\u7167\nzfs list -t all\n"})}),"\n",(0,i.jsx)(n.h3,{id:"clone",children:"clone"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfspv-clone.yaml"',children:"kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: zfspv-clone\nspec:\n  storageClassName: openebs-zfspv\n  dataSource:\n    # clone \u81EA snapshot\n    name: zfspv-snap\n    kind: VolumeSnapshot\n    apiGroup: snapshot.storage.k8s.io\n    # clone \u81EA volume\n    name: zfspv-pvc\n    kind: PersistentVolumeClaim\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 4Gi\n"})}),"\n",(0,i.jsx)(n.h3,{id:"backuprestore",children:"Backup/Restore"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9700\u8981 Velero"}),"\n",(0,i.jsx)(n.li,{children:"\u9700\u8981 openebs/velero-plugin \u63D2\u4EF6"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="zfspv-full.yaml"',children:"apiVersion: velero.io/v1\nkind: VolumeSnapshotLocation\nmetadata:\n  name: zfspv-full\n  namespace: velero\nspec:\n  provider: openebs.io/zfspv-blockstore\n  config:\n    bucket: velero\n    prefix: zfs\n    incrBackupCount: '3' # number of incremental backups we want to have\n    namespace: openebs # this is the namespace where ZFS-LocalPV creates all the CRs, passed as OPENEBS_NAMESPACE env in the ZFS-LocalPV deployment\n    provider: aws\n    region: minio\n    s3ForcePathStyle: 'true'\n    s3Url: http://minio.velero.svc:9000\n"})}),"\n",(0,i.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.h2,{id:"driver-name-zfscsiopenebsio-not-found-in-the-list-of-registered-csi-drivers",children:"driver name zfs.csi.openebs.io not found in the list of registered CSI drivers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u786E\u4FDD driver \u5B58\u5728\nkubectl get csinodes -oyaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"driver null \u53EF\u80FD\u662F\u6CE8\u518C\u51FA\u95EE\u9898\u4E86"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u53EF\u5C1D\u8BD5\u5220\u9664 openebs-zfs-localpv-node \u7684 Pod\nkubectl delete csinodes NODEID\nkubectl get pods -A -l role=openebs-zfs -owide\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8FD8\u6709\u95EE\u9898\uFF0C\u5E94\u8BE5\u662F kubelet \u76EE\u5F55\u914D\u7F6E\u4E0D\u5BF9\uFF0C\u9ED8\u8BA4\u662F /var/lib/kubelet\uFF0C\u4F46 k0s\u3001rke\u3001k3s \u9700\u8981\u4FEE\u6539\u3002"})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},17776:function(e,n,s){s.d(n,{R:()=>o,x:()=>t});var l=s(7378);let i={},r=l.createContext(i);function o(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);