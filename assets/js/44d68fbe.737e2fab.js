"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["37221"],{6194:function(n,e,o){o.r(e),o.d(e,{assets:()=>a,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var i=o(92175),l=o(86106),t=o(17776);let r={slug:"hello-cgo",title:"Hello CGO",tags:["\u5F00\u53D1","Golang"]},s="Hello CGO",a={authorsImageUrls:[]},d=[{value:"Tips",id:"tips",level:2},{value:"\u521D\u8BD5",id:"\u521D\u8BD5",level:2}];function c(n){let e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h2,{id:"tips",children:"Tips"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://gist.github.com/zchee/b9c99695463d8902cd33",children:"\u7C7B\u578B\u8F6C\u6362"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u521D\u8BD5",children:"\u521D\u8BD5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u751F\u6210 libdemo.so libdemo.h\ngo build -buildmode=c-shared -o libdemo.so ./demo.go\n# \u7F16\u8BD1 main\ngo build main.go\n./main\n\n# macos - \u67E5\u770B\u5185\u5BB9\nnm libdemo.so | grep hello -i\n# linux\nnm libdemo.so\n# windows\ndumpbin /EXPORTS libdemo.dll\n\n# windows \u4EA4\u53C9\u7F16\u8BD1 - \u9700\u8981\u5B89\u88C5 mingw\nbrew install mingw-w64\n\n# 32 \u4F4D \u4EA4\u53C9\u7F16\u8BD1\nGOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build -buildmode=c-shared -o libdemo.dll ./demo.go\nGOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build main.go\n\n# macos wine \u4E0D\u652F\u6301 32 \u4F4D - mingw \u7248\u672C\u4F4E\u4E0D\u652F\u6301 64 \u4F4D\n# mac \u4F1A\u51FA\u73B0\u5F02\u5E38 cc1: sorry, unimplemented: 64-bit mode not compiled in\n# \u901A\u8FC7 docker \u7F16\u8BD1\ndocker run --rm -v $HOME/go:/root/go -v $PWD:/host -w /host wener/go:win sh\n\nGOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build -buildmode=c-shared -o libdemo.dll ./demo.go\nGOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build main.go\n\n# \u56DE\u5230 mac \u4F7F\u7528 wine \u6267\u884C\n# wine \u65E0\u6CD5\u5728 macos \u4E0A\u7F16\u8BD1\u5B89\u88C5 - \u7CFB\u7EDF\u7248\u672C\u95EE\u9898 - \u9700\u8981\u4F7F\u7528 cask \u5B89\u88C5\nbrew cask install wine-stable\nwine64 main.exe\n\n# wine 4.0 \u521D\u59CB\u5316 dll \u5931\u8D25\n# 0010:fixme:winsock:set_dont_fragment IP_DONTFRAGMENT for IPv4 not supported in this platform\n# 0009:err:module:attach_dlls "libdemo.dll" failed to initialize, aborting\n# 0009:err:module:attach_dlls Initializing dlls for L"Z:\\\\Users\\\\wener\\\\demo\\\\main.exe" failed, status c0000005\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"demo.go"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'package main\n\nimport "C"\n\n//export Version\nfunc Version() int32 {\n	return 123\n}\n\n//export Hello\nfunc Hello(name *C.char) *C.char {\n	return C.CString("Hello "+C.GoString(name)+"!")\n}\n\nfunc main() {}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"main.go"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'package main\n\nimport "fmt"\n\n/*\n#cgo CFLAGS: -I.\n#cgo LDFLAGS: -L. -ldemo\n#include "libdemo.h"\n*/\nimport "C"\n\nfunc main() {\n	fmt.Printf("Int %v String %v\\n",C.Version(), C.GoString(C.Hello(C.CString("Wener"))))\n}\n'})})]})}function m(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}},17776:function(n,e,o){o.d(e,{R:()=>r,x:()=>s});var i=o(7378);let l={},t=i.createContext(l);function r(n){let e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),i.createElement(t.Provider,{value:e},n.children)}},92175:function(n){n.exports=JSON.parse('{"permalink":"/story/hello-cgo","editUrl":"https://github.com/wenerme/wener/edit/master/story/../story/2020/2020-05-28-hello-cgo.md","source":"@site/../story/2020/2020-05-28-hello-cgo.md","title":"Hello CGO","description":"Tips","date":"2020-05-28T00:00:00.000Z","tags":[{"inline":true,"label":"\u5F00\u53D1","permalink":"/story/tags/\u5F00\u53D1"},{"inline":true,"label":"Golang","permalink":"/story/tags/golang"}],"readingTime":1.44,"hasTruncateMarker":false,"authors":[],"frontMatter":{"slug":"hello-cgo","title":"Hello CGO","tags":["\u5F00\u53D1","Golang"]},"unlisted":false,"prevItem":{"title":"\u4E00\u5468 K3S \u5B66\u4E60\u5FC3\u5F97","permalink":"/story/k3s-one-week"},"nextItem":{"title":"Wener\'s APIs","permalink":"/story/wener-apis"}}')}}]);