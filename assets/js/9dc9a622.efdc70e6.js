"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["73150"],{55409:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>t,toc:()=>c,default:()=>u,metadata:()=>r,assets:()=>d,contentTitle:()=>o});var r=JSON.parse('{"id":"devops/kubernetes/distro/k0s/k0s-faq","title":"K0S FAQ","description":"kubeconfig","source":"@site/../notes/devops/kubernetes/distro/k0s/k0s-faq.md","sourceDirName":"devops/kubernetes/distro/k0s","slug":"/devops/kubernetes/distro/k0s/faq","permalink":"/notes/devops/kubernetes/distro/k0s/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/distro/k0s/k0s-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1758158840000,"frontMatter":{"tags":["FAQ"]},"sidebar":"docs","previous":{"title":"k0s","permalink":"/notes/devops/kubernetes/distro/k0s/"},"next":{"title":"k0sctl","permalink":"/notes/devops/kubernetes/distro/k0s/k0sctl"}}'),s=i(86106),l=i(17776);let t={tags:["FAQ"]},o="K0S FAQ",d={},c=[{value:"kubeconfig",id:"kubeconfig",level:2},{value:"\u624B\u52A8\u4E0B\u8F7D\u5B89\u88C5",id:"\u624B\u52A8\u4E0B\u8F7D\u5B89\u88C5",level:2},{value:"Control plane vs. Worker",id:"control-plane-vs-worker",level:2},{value:"konnectivity-server.sock: socket: too many open files",id:"konnectivity-serversock-socket-too-many-open-files",level:2},{value:"cgroups: cgroup deleted: unknown",id:"cgroups-cgroup-deleted-unknown",level:2},{value:"Failed to run kubelet failed to run Kubelet: mountpoint for cpu not found",id:"failed-to-run-kubelet-failed-to-run-kubelet-mountpoint-for-cpu-not-found",level:2},{value:"cni plugin not initialized",id:"cni-plugin-not-initialized",level:2},{value:"no IP ranges specified",id:"no-ip-ranges-specified",level:2},{value:"kube-router Failed to watch i/o timeout",id:"kube-router-failed-to-watch-io-timeout",level:2},{value:"k0s controller --single vs --enable-worker",id:"k0s-controller---single-vs---enable-worker",level:2},{value:"konnectivity-server.sock: bind: address already in use",id:"konnectivity-serversock-bind-address-already-in-use",level:2},{value:"failed to get initial kubelet config with join token: failed to get kubelet config from API: Unauthorized&quot;",id:"failed-to-get-initial-kubelet-config-with-join-token-failed-to-get-kubelet-config-from-api-unauthorized",level:2},{value:"coredns fatal plugin/loop: Loop detected for zone",id:"coredns-fatal-pluginloop-loop-detected-for-zone",level:2},{value:"kill all",id:"kill-all",level:2},{value:"\u7F51\u7EDC\u914D\u7F6E\u95EE\u9898",id:"\u7F51\u7EDC\u914D\u7F6E\u95EE\u9898",level:2},{value:"Error while reading from Writer: bufio.Scanner: token too long  component=kubelet",id:"error-while-reading-from-writer-bufioscanner-token-too-long--componentkubelet",level:2},{value:"\u624B\u52A8\u542F\u52A8",id:"\u624B\u52A8\u542F\u52A8",level:2},{value:"failed to run kube-router: Failed to create network routing controller: failed to determine if ipset set kube-router-pod-subnets exists: ipset v7.15: Kernel error received: Invalid argument",id:"failed-to-run-kube-router-failed-to-create-network-routing-controller-failed-to-determine-if-ipset-set-kube-router-pod-subnets-exists-ipset-v715-kernel-error-received-invalid-argument",level:2},{value:"failed to reserve container name  is reserved for",id:"failed-to-reserve-container-name--is-reserved-for",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"k0s-faq",children:"K0S FAQ"})}),"\n",(0,s.jsx)(n.h2,{id:"kubeconfig",children:"kubeconfig"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat /var/lib/k0s/pki/admin.conf\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u624B\u52A8\u4E0B\u8F7D\u5B89\u88C5",children:"\u624B\u52A8\u4E0B\u8F7D\u5B89\u88C5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ver=$(curl https://docs.k0sproject.io/stable.txt)\ncurl -LO "https://echo.wener.cc/https://github.com/k0sproject/k0s/releases/download/${ver}/k0s-${ver}-amd64"\nchmod 755 k0s-${ver}-amd64\ncp $(which k0s) k0s.last\nsudo mkdir -p /usr/local/bin/\nsudo cp k0s-${ver}-amd64 /usr/local/bin/k0s\n\ncurl -LOC- "https://echo.wener.cc/https://github.com/k0sproject/k0s/releases/download/${ver}/k0s-airgap-bundle-${ver}-amd64"\nmkdir -p /var/lib/k0s/images\nsudo cp k0s-airgap-bundle-${ver}-amd64 /var/lib/k0s/images/bundle_file\n\nsudo k0s sysinfo\n'})}),"\n",(0,s.jsx)(n.h2,{id:"control-plane-vs-worker",children:"Control plane vs. Worker"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Control plane\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F5C\u4E3A\u5176\u4ED6\u7EC4\u5EFA\u7684 \u5B88\u62A4\u8FDB\u7A0B/supervisor - \u4E0D\u8C03\u5EA6\u5DE5\u4F5C\u8D1F\u8F7D"}),"\n",(0,s.jsx)(n.li,{children:"\u4E0D\u9700\u8981\u5BB9\u5668\u5F15\u64CE\u3001kubelet"}),"\n",(0,s.jsx)(n.li,{children:"kubectl get node \u770B\u4E0D\u5230"}),"\n",(0,s.jsx)(n.li,{children:"\u7EF4\u62A4 kine/etcd, api-server, scheduler, controller-manager, konnectivity-server, k0s-api"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.k0sproject.io/main/high-availability/",children:"Control Plane High Availability"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Worker\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8FD0\u884C kubelet"}),"\n",(0,s.jsx)(n.li,{children:"\u4F9D\u8D56 cri - \u9ED8\u8BA4\u4F60 containerd+runc"}),"\n",(0,s.jsx)(n.li,{children:"\u8C03\u5EA6\u5DE5\u4F5C\u8D1F\u8F7D"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"konnectivity-serversock-socket-too-many-open-files",children:"konnectivity-server.sock: socket: too many open files"}),"\n",(0,s.jsx)(n.p,{children:"\u68C0\u67E5 ulimit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat /proc/$(pidof konnectivity-server)/limits\n# \u5F53\u524D\u6253\u5F00\u6587\u4EF6\u6570\nls /proc/$(pidof konnectivity-server)/fd | wc -l\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cgroups-cgroup-deleted-unknown",children:"cgroups: cgroup deleted: unknown"}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-run-kubelet-failed-to-run-kubelet-mountpoint-for-cpu-not-found",children:"Failed to run kubelet failed to run Kubelet: mountpoint for cpu not found"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ls /sys/fs/cgroup\nservice cgroups start\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cni-plugin-not-initialized",children:"cni plugin not initialized"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u68C0\u67E5 kube-proxy pod \u662F\u5426\u542F\u52A8"}),"\n",(0,s.jsx)(n.h2,{id:"no-ip-ranges-specified",children:"no IP ranges specified"}),"\n",(0,s.jsx)(n.h2,{id:"kube-router-failed-to-watch-io-timeout",children:"kube-router Failed to watch i/o timeout"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Failed to watch *v1.Node: failed to list *v1.Node: Get "https://10.96.0.1:443/api/v1/nodes?limit=500&resourceVersion=0": dial tcp 10.96.0.1:443: i/o timeout\n'})}),"\n",(0,s.jsx)(n.h2,{id:"k0s-controller---single-vs---enable-worker",children:"k0s controller --single vs --enable-worker"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["--single\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u51CF\u5C11\u90E8\u5206 leader \u9009\u53D6\u903B\u8F91"}),"\n",(0,s.jsx)(n.li,{children:"\u4E0D\u53EF\u4EE5\u6DFB\u52A0 worker"}),"\n",(0,s.jsx)(n.li,{children:"etcd \u9ED8\u8BA4\u4F7F\u7528 kine - \u53EF\u914D\u7F6E\u4F7F\u7528 etcd"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["--enable-worker\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6B63\u5E38\u8282\u70B9"}),"\n",(0,s.jsx)(n.li,{children:"\u53EF\u540E\u7EED\u6DFB\u52A0 worker"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"konnectivity-serversock-bind-address-already-in-use",children:"konnectivity-server.sock: bind: address already in use"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679C\u6CA1\u6709\u88AB\u4F7F\u7528\uFF0C\u5219\u53EF\u4EE5\u5B89\u5168\u5220\u9664"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo lsof -f -- /run/k0s/konnectivity-server/konnectivity-server.sock\nunlink /run/k0s/konnectivity-server/konnectivity-server.sock\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679C\u88AB\u4F7F\u7528\u4E86\uFF0C\u5219\u8003\u8651\u4E4B\u524D\u7684 process \u662F\u5426\u672A\u6B63\u5E38\u9000\u51FA\uFF0Ckill \u5373\u53EF\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-get-initial-kubelet-config-with-join-token-failed-to-get-kubelet-config-from-api-unauthorized",children:'failed to get initial kubelet config with join token: failed to get kubelet config from API: Unauthorized"'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u542F\u52A8\u5931\u8D25\uFF0C\u505C\u6B62\uFF0C\u518D\u6B21\u542F\u52A8\u65F6\u53EF\u80FD\u53D1\u751F"}),"\n",(0,s.jsx)(n.li,{children:"kubelet \u7684 token \u6709\u65F6\u6548\uFF0C\u53EF\u80FD\u5DF2\u7ECF\u8FC7\u671F\u4E86\uFF0C\u53EF\u5220\u9664\u91CD\u542F\uFF0C\u4F1A\u91CD\u65B0\u521B\u5EFA"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"k0s stop\nrm /var/lib/k0s/kubelet-bootstrap.conf\nk0s start\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/k0sproject/k0s/issues/1524#issuecomment-1044287529",children:"https://github.com/k0sproject/k0s/issues/1524#issuecomment-1044287529"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"coredns-fatal-pluginloop-loop-detected-for-zone",children:"coredns fatal plugin/loop: Loop detected for zone"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5FAA\u73AF resolve \u68C0\u6D4B - \u4E00\u822C\u662F /etc/resolv.conf \u914D\u7F6E\u4E86 127.0.0.1 \u5BFC\u81F4"}),"\n",(0,s.jsx)(n.li,{children:"\u4FEE\u6539 /etc/resolv.conf \u7136\u540E\u5220\u9664 pod \u5373\u53EF"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://coredns.io/plugins/loop/",children:"https://coredns.io/plugins/loop/"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"kill-all",children:"kill all"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"k0s stop\n# \u5E94\u8BE5 pkill \u6740\u6389\u8FDB\u7A0B\u6811\n# killall /var/lib/k0s/bin/containerd-shim-runc-v2\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["containerd-shim \u6B8B\u7559 ",(0,s.jsx)(n.a,{href:"https://github.com/containerd/containerd/issues/768",children:"containerd#768"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/kubespray/blob/master/roles/container-engine/docker/files/cleanup-docker-orphans.sh",children:"kubespray/roles/container-engine/docker/files/cleanup-docker-orphans"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u7F51\u7EDC\u914D\u7F6E\u95EE\u9898",children:"\u7F51\u7EDC\u914D\u7F6E\u95EE\u9898"}),"\n",(0,s.jsx)(n.p,{children:"\u56E0\u4E3A\u670D\u52A1\u5668\u6709\u591A lan\uFF0C\u914D\u7F6E\u4E86\u8DEF\u7531\u7B56\u7565\uFF0C\u4ECE 10gbe \u8FDB\u6765\u7684\u4ECE 10gbe \u51FA\u53BB"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"auto eth4\niface eth4 inet static\n  address 192.168.1.10\n  netmask 255.255.252.0\n  gateway 192.168.1.1\n  mtu 9000\n  pre-up ip ro li tab tgbe &>/dev/null || echo '10 tgbe' >> /etc/iproute2/rt_tables\n  post-up ip ru add from 192.168.1.10 table tgbe\n  post-up ip ro add default via 192.168.76.1 dev eth4 table tgbe\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5BFC\u81F4 kube \u65E0\u6CD5\u81EA\u8EAB\u8BBF\u95EE\u5230 api\uFF0C\u56E0\u4E3A\u4E0D\u518D\u4E00\u4E2A\u8DEF\u7531\u8868\u91CC\uFF0C\u65E0\u6CD5\u4ECE 192.168.1.10 \u8BBF\u95EE\u5230 10.96.0.1\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u79FB\u9664\u89C4\u5219\u540E\u5219\u4E00\u5207\u6062\u590D\u6B63\u5E38\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ip ru del from 192.168.1.10\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-while-reading-from-writer-bufioscanner-token-too-long--componentkubelet",children:"Error while reading from Writer: bufio.Scanner: token too long  component=kubelet"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ps aux | grep keubelt\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/k0sproject/k0s/issues/2669",children:"k0sproject/k0s#2669"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"fix v1.25.6+"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u6709\u53EF\u80FD configmap \u592A\u5927\u5BFC\u81F4"}),"\n",(0,s.jsx)(n.li,{children:"k0s v1.23 - \u91CD\u542F\u540E\u65E0\u6CD5\u518D\u542F\u52A8"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7CFB\u7EDF\u91CD\u542F\u540E\u89E3\u51B3"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u518D\u6B21\u91CD\u542F k0s \u51FA\u73B0\u76F8\u540C\u95EE\u9898"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u624B\u52A8\u542F\u52A8",children:"\u624B\u52A8\u542F\u52A8"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo k0s controller --config=/etc/k0s/k0s.yaml --enable-dynamic-config=true --enable-worker=true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-run-kube-router-failed-to-create-network-routing-controller-failed-to-determine-if-ipset-set-kube-router-pod-subnets-exists-ipset-v715-kernel-error-received-invalid-argument",children:"failed to run kube-router: Failed to create network routing controller: failed to determine if ipset set kube-router-pod-subnets exists: ipset v7.15: Kernel error received: Invalid argument"}),"\n",(0,s.jsx)(n.h2,{id:"failed-to-reserve-container-name--is-reserved-for",children:"failed to reserve container name  is reserved for"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/containerd/containerd/issues/4604#issuecomment-1027293621",children:"https://github.com/containerd/containerd/issues/4604#issuecomment-1027293621"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},17776:function(e,n,i){i.d(n,{R:()=>t,x:()=>o});var r=i(7378);let s={},l=r.createContext(s);function t(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);