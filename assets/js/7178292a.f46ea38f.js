"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["131615"],{182711:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>o,default:()=>p,metadata:()=>i,assets:()=>d,contentTitle:()=>l});var i=JSON.parse('{"id":"os/virt/qemu-network","title":"QEMU Networking","description":"qemu-networking}","source":"@site/../notes/os/virt/qemu-network.md","sourceDirName":"os/virt","slug":"/os/virt/qemu-network","permalink":"/notes/os/virt/qemu-network","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/virt/qemu-network.md","tags":[{"inline":true,"label":"Virtualization","permalink":"/notes/tags/virtualization"},{"inline":true,"label":"QEMU","permalink":"/notes/tags/qemu"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"Bridge","permalink":"/notes/tags/bridge"},{"inline":true,"label":"TAP","permalink":"/notes/tags/tap"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"QEMU Networking","tags":["Virtualization","QEMU","Network","Bridge","TAP"]},"sidebar":"docs","previous":{"title":"QEMU Devices Reference","permalink":"/notes/os/virt/qemu-device"},"next":{"title":"QEMU on macOS","permalink":"/notes/os/virt/qemu-osx"}}'),r=t(486106),s=t(917776);let a={title:"QEMU Networking",tags:["Virtualization","QEMU","Network","Bridge","TAP"]},l="QEMU Networking {#qemu-networking}",d={},o=[{value:"User Networking (SLIRP)",id:"user-networking-slirp",level:2},{value:"TAP Networking",id:"tap-networking",level:2},{value:"Setup TAP/Bridge",id:"setup-tapbridge",level:3},{value:"MacVTap",id:"macvtap",level:2},{value:"Bridge Helper",id:"bridge-helper",level:2},{value:"VDE (Virtual Distributed Ethernet)",id:"vde-virtual-distributed-ethernet",level:2},{value:"Tuning",id:"tuning",level:2}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"qemu-networking",children:"QEMU Networking"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://wiki.qemu.org/Documentation/Networking",children:"Networking Documentation - QEMU Wiki"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://virt.kernelnewbies.org/MacVTap",children:"MacVTap - Kernel Newbies"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"qemu-system-x86_64 -nic model=help\nqemu-system-x86_64 -netdev ?\n"})}),"\n",(0,r.jsx)(n.h2,{id:"user-networking-slirp",children:"User Networking (SLIRP)"}),"\n",(0,r.jsx)(n.p,{children:"Default, easiest, no root required. Slower."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Forward host 8080 to guest 80\n-netdev user,id=mynet0,hostfwd=tcp::8080-:80 -device e1000,netdev=mynet0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tap-networking",children:"TAP Networking"}),"\n",(0,r.jsx)(n.p,{children:"Requires root/capabilities. High performance."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Basic TAP\n-netdev tap,id=net0,script=no,downscript=no,ifname=tap0 \\\n  -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:56\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setup-tapbridge",children:"Setup TAP/Bridge"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"modprobe tun tap\nip link add br0 type bridge\nip tuntap add dev tap0 mode tap\nip link set dev tap0 master br0\nip link set dev eth0 master br0\nip link set dev br0 up\n"})}),"\n",(0,r.jsx)(n.h2,{id:"macvtap",children:"MacVTap"}),"\n",(0,r.jsx)(n.p,{children:"Combines tun/tap and bridge."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ip link add link eth1 name macvtap0 type macvtap mode bridge\nsudo ip link set macvtap0 address 1a:46:0b:ca:bc:7b up\nsudo ip link show macvtap0\n\n# Launch QEMU with MacVTap (using file descriptors)\n# Requires getting tap fd index\n-netdev tap,id=net0,script=no,downscript=no,ifname=tap$(< /sys/class/net/macvtap0/ifindex) \\\n  -device virtio-net-pci,netdev=net0,mac=$(< /sys/class/net/macvtap0/address)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"bridge-helper",children:"Bridge Helper"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Allow bridge\necho 'allow virbr0' >> /etc/qemu/bridge.conf\n\n-netdev bridge,id=net0,br=virbr0 -device virtio-net,netdev=net0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"vde-virtual-distributed-ethernet",children:"VDE (Virtual Distributed Ethernet)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http://vde.sourceforge.net/",children:"VDE on SourceForge"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vde_switch -tap tap0 -daemon -mod 660 -group users\nip link set tap0 up\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tuning",children:"Tuning"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Enable IP Forwarding\nsysctl net.ipv4.ip_forward=1\nsysctl net.ipv4.conf.all.proxy_arp=1\n"})})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>l});var i=t(7378);let r={},s=i.createContext(r);function a(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);