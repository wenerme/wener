"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["6614"],{64519:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>d,default:()=>o,metadata:()=>l,assets:()=>a,contentTitle:()=>c});var l=JSON.parse('{"id":"devops/infra/ansible/README","title":"Ansible","description":"- ansible \u662F\u4EC0\u4E48\uFF1F","source":"@site/../notes/devops/infra/ansible/README.md","sourceDirName":"devops/infra/ansible","slug":"/devops/infra/ansible/","permalink":"/notes/devops/infra/ansible/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/infra/ansible/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1693463269000,"frontMatter":{"title":"Ansible"},"sidebar":"docs","previous":{"title":"\u57FA\u7840\u8BBE\u65BD","permalink":"/notes/devops/infra/"},"next":{"title":"\u963F\u91CC\u4E91","permalink":"/notes/devops/infra/ansible/alicloud"}}'),i=s(86106),r=s(17776);let t={title:"Ansible"},c="Ansible",a={},d=[{value:"\u5B89\u88C5",id:"\u5B89\u88C5",level:2},{value:"ansible.cfg",id:"ansiblecfg",level:2},{value:"\u53D8\u91CF\u67E5\u627E\u8DEF\u5F84",id:"\u53D8\u91CF\u67E5\u627E\u8DEF\u5F84",level:2},{value:"\u6700\u4F73\u5B9E\u8DF5",id:"\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"Tips",id:"tips",level:2}];function h(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"ansible",children:"Ansible"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/ansible/ansible",children:"ansible"})," \u662F\u4EC0\u4E48\uFF1F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"GPL-3.0, Python"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u52A8\u5316 \u670D\u52A1\u5F00\u901A\u3001\u914D\u7F6E\u7BA1\u7406\u3001\u5E94\u7528\u90E8\u7F72 \u5DE5\u5177"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0 Infrastructure as code - \u57FA\u7840\u8BBE\u65BD\u5373\u4EE3\u7801"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 Linux\u3001Windows \u53CA \u7F51\u7EDC\u8BBE\u5907"}),"\n",(0,i.jsx)(e.li,{children:"\u5305\u542B\u5927\u91CF\u7684\u63D2\u4EF6\u548C\u4E09\u65B9\u96C6\u6210"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7CFB\u7EDF\u8981\u6C42\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u63A7\u5236\u8282\u70B9 - python linix/windows"}),"\n",(0,i.jsx)(e.li,{children:"\u7BA1\u7406\u8282\u70B9 - python sftp/scp"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u6CE8\u610F \u26A0\uFE0F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5206\u7EC4\u540D\u5305\u542B ",(0,i.jsx)(e.code,{children:"-"})," \u4F1A\u544A\u8B66\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"force_valid_group_names=ignore"})," \u53EF\u5173\u95ED"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["docker_container \u6A21\u5757\u7F51\u7EDC\u6709\u6240\u8C03\u6574 - \u4E4B\u540E\u9ED8\u8BA4\u4E0D\u4F1A\u6DFB\u52A0 default \u7F51\u7EDC - \u4E0E docker \u4FDD\u6301\u4E00\u76F4\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5EFA\u8BAE ",(0,i.jsx)(e.code,{children:"networks_cli_compatible=yes"})," \u63D0\u524D\u4E0E docker \u7F51\u7EDC\u4FDD\u6301\u4E00\u81F4"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u5EFA\u8BAE\u4F7F\u7528 yaml \u5199 inventory - \u6BD4 ini \u7684\u6A21\u5F0F\u597D\u7BA1\u7406 - \u7ED3\u6784\u4E5F\u66F4\u52A0\u6E05\u6670"}),"\n",(0,i.jsxs)(e.li,{children:["\u76F8\u540C set_fact \u4E0D\u80FD\u4E92\u76F8\u4F9D\u8D56 ",(0,i.jsx)(e.a,{href:"https://github.com/ansible/ansible/issues/40239",children:"#40239"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/leucos/ansible-tuto",children:"Ansible tutorial"})}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/collections/index.html",children:"List all modules"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["collection ",(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html",children:"ansible.builtin"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://raw.githubusercontent.com/ansible/ansible/devel/examples/ansible.cfg",children:"ansible.cfg"})," \u53EF\u7528\u7684 ansible.cfg \u914D\u7F6E"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53EF\u7528\u73AF\u5883\u53D8\u91CF",(0,i.jsx)(e.a,{href:"https://github.com/ansible/ansible/blob/devel/lib/ansible/constants.py",children:"\u5217\u8868"})]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html",children:"YAML Syntax"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/community/other_tools_and_programs.html",children:"Other Tools and Programs"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/apenella/go-ansible",children:"apenella/go-ansible"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5B66\u4E60\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/geerlingguy/ansible-for-devops",children:"geerlingguy/ansible-for-devops"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u754C\u9762\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/notes/devops/infra/ansible/semaphor",children:"ansible-semaphore/semaphore"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Go \u5B9E\u73B0"}),"\n",(0,i.jsxs)(e.li,{children:["\u6709 Web \u754C\u9762 \u548C ",(0,i.jsx)(e.a,{href:"https://ansible-semaphore.github.io/semaphore/",children:"API"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/ansible/awx",children:"ansible/awx"})," - Ansible Tower \u4E0A\u6E38\u5F00\u6E90\u9879\u76EE\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF Docker Compose \u542F\u52A8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u73AF\u5883\u53D8\u91CF\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"ANSIBLE_INVENTORY"})," - \u9017\u53F7\u5206\u9694\u7684\u4ED3\u5E93\u6E90"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"DEFAULT_HOST_LIST"})," - \u9ED8\u8BA4\u4ED3\u5E93\u6E90 - ",(0,i.jsx)(e.code,{children:"inventory"})," \u914D\u7F6E"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# ping \u6240\u6709\u8282\u70B9\nansible all -m ping\n# -i \u6307\u5B9A\u4ED3\u5E93\nansible all -m ping -i hosts\n# ping \u672C\u5730 - \u6307\u5B9A\u89E3\u91CA\u5668\nansible localhost -m ping -e 'ansible_python_interpreter=/usr/bin/python3'\n# \u6267\u884C\u547D\u4EE4\nansible all -a date -i hosts\n\n# ansible_facts \u5185\u5BB9\nansible localhost -m setup\n\n# \u8282\u70B9\u4E0A\u672C\u5730\u8BBE\u7F6E\u7684\u5185\u5BB9 - \u6587\u4EF6\u4E3A ini \u683C\u5F0F\n# /etc/ansible/facts.d/preferences.fact\nansible hostname -m setup -a \"filter=ansible_local\"\n\n# docker \u542F\u52A8\u73AF\u5883\ndocker run --rm -it \\\n  -e TZ=Asia/Shanghai \\\n  -v $HOME/.ansible:/root/.ansible \\\n  -v $PWD:/host -w /host \\\n  --name ansible wener/ansible\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Command"}),(0,i.jsx)(e.th,{children:"Desc"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible"}),(0,i.jsx)(e.td,{children:"\u6267\u884C AdHoc \u547D\u4EE4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-config"}),(0,i.jsx)(e.td,{children:"\u67E5\u770B\u5F53\u524D\u6240\u6709\u914D\u7F6E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-connection"}),(0,i.jsx)(e.td,{children:"\u8FDE\u63A5\u5230\u8FDC\u7A0B\u8BBE\u5907"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-console"}),(0,i.jsx)(e.td,{children:"REPL \u65B9\u5F0F\u6267\u884C Ansible Task"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-doc"}),(0,i.jsx)(e.td,{children:"\u6587\u6863\u67E5\u8BE2"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-galaxy"}),(0,i.jsx)(e.td,{children:"Role \u548C Collection \u4F9D\u8D56\u7BA1\u7406"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-inventory"}),(0,i.jsx)(e.td,{children:"\u67E5\u8BE2\u673A\u5668\u6E05\u5355"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-playbook"}),(0,i.jsx)(e.td,{children:"\u6267\u884C Playbook"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-pull"}),(0,i.jsx)(e.td,{children:"\u914D\u5408 cron \u4ECE VSC \u62C9\u53D6 playbook \u7136\u540E\u672C\u5730\u6267\u884C - \u9002\u7528\u4E8E\u5927\u89C4\u6A21\u5468\u671F\u6027\u4EFB\u52A1\u6267\u884C"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-test"}),(0,i.jsx)(e.td,{children:"Role \u548C Collection \u5F00\u53D1\u7684\u6D4B\u8BD5\u5DE5\u5177"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ansible-vault"}),(0,i.jsx)(e.td,{children:"Ansible \u52A0\u5BC6\u6570\u636E\u64CD\u4F5C"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"\u5B89\u88C5",children:"\u5B89\u88C5"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"2.10 \u9700\u8981\u5148\u5378\u8F7D ansible \u518D\u5B89\u88C5"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html",children:"Installing Ansible"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# macOS\nCFLAGS=-Qunused-arguments CPPFLAGS=-Qunused-arguments pip install --user ansible\n\n# 2.10\npip uninstall ansible\npip install ansible\n"})}),"\n",(0,i.jsx)(e.h2,{id:"ansiblecfg",children:"ansible.cfg"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/reference_appendices/config.html",children:"Ansible Configuration Settings"})}),"\n",(0,i.jsxs)(e.li,{children:["\u67E5\u627E\u987A\u5E8F\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ANSIBLE_CONFIG"}),"\n",(0,i.jsx)(e.li,{children:"ansible.cfg"}),"\n",(0,i.jsx)(e.li,{children:"~/.ansible.cfg"}),"\n",(0,i.jsx)(e.li,{children:"/etc/ansible/ansible.cfg"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ini",children:"# \u7F13\u5B58 facts\n[defaults]\ngathering = smart\n# \u7F13\u5B58\u65F6\u95F4 - \u79D2\nfact_caching_timeout = 86400\n# \u7F13\u5B58\u5230 redis\n# pip install redis\nfact_caching = redis\n# \u7F13\u5B58\u5230 json \u6587\u4EF6\nfact_caching = jsonfile\nfact_caching_connection = /path/to/cachedir\n\n# \u517C\u5BB9 docker network - \u5982\u679C\u6307\u5B9A\u4E86\u7F51\u7EDC\u4E0D\u6DFB\u52A0\u9ED8\u8BA4\u7F51\u7EDC\nnetworks_cli_compatible=yes\n# \u4E0D\u6821\u9A8C\u5206\u7EC4\u540D\u5B57 \u5141\u8BB8\u5305\u542B `-'\nforce_valid_group_names=ignore\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ansible_sudo_pass"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u53D8\u91CF\u67E5\u627E\u8DEF\u5F84",children:"\u53D8\u91CF\u67E5\u627E\u8DEF\u5F84"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable",children:"Variable precedence: Where should I put a variable?"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6700\u4F73\u5B9E\u8DF5",children:"\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html",children:"Best Practices"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://spacelift.io/blog/ansible-playbooks",children:"Working with Ansible Playbooks \u2013 Tips & Tricks with Examples"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"tips",children:"Tips"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4F7F\u7528 merge ",(0,i.jsx)(e.a,{href:"http://docs.ansible.com/ansible/intro_configuration.html#hash-behaviour",children:"hash_behaviour"})," \u53EF\u5408\u5E76\u5BF9\u8C61\u914D\u7F6E"]}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>c});var l=s(7378);let i={},r=l.createContext(i);function t(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);