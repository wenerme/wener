"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["445455"],{755879:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>d,assets:()=>c,contentTitle:()=>i});var d=JSON.parse('{"id":"db/relational/sqlite/sqlite-faq","title":"SQLite FAQ","description":"- \u4E0D\u652F\u6301\u6DFB\u52A0\u975E\u5E38\u91CF\u9ED8\u8BA4\u503C\u7684\u5217","source":"@site/../notes/db/relational/sqlite/sqlite-faq.md","sourceDirName":"db/relational/sqlite","slug":"/db/relational/sqlite/faq","permalink":"/notes/db/relational/sqlite/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/sqlite/sqlite-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1763888060000,"frontMatter":{"title":"SQLite FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"SQLean","permalink":"/notes/db/relational/sqlite/sqlean"},"next":{"title":"TiDB","permalink":"/notes/db/relational/tidb"}}'),s=t(486106),l=t(917776);let r={title:"SQLite FAQ",tags:["FAQ"]},i="SQLite FAQ",c={},a=[{value:"DSN",id:"dsn",level:2},{value:"attempt to write a readonly database",id:"attempt-to-write-a-readonly-database",level:2},{value:"\u5220\u9664\u4E0D\u652F\u6301 WHERE \u548C ORDER",id:"\u5220\u9664\u4E0D\u652F\u6301-where-\u548C-order",level:2},{value:"Golang database is locked (5) (SQLITE_BUSY)",id:"golang-database-is-locked-5-sqlite_busy",level:2},{value:"sqlite \u4FEE\u590D",id:"sqlite-\u4FEE\u590D",level:2},{value:"35% faster than fs",id:"35-faster-than-fs",level:2},{value:"BLOB or Hex TEXT",id:"blob-or-hex-text",level:2},{value:"cannot drop UNIQUE column",id:"cannot-drop-unique-column",level:2},{value:"count slow",id:"count-slow",level:2}];function o(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sqlite-faq",children:"SQLite FAQ"})}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4E0D\u652F\u6301\u6DFB\u52A0\u975E\u5E38\u91CF\u9ED8\u8BA4\u503C\u7684\u5217\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cannot add a column with non-constant default"}),"\n",(0,s.jsxs)(n.li,{children:["\u4E0D\u53EF\u4EE5 ",(0,s.jsx)(n.code,{children:"alter table tab add column my_time timestamp default current_timestamp;"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["timestamp\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"current_timestamp \u8FD4\u56DE\u7684\u662F text"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"strftime('%s', current_timestamp)"})," \u8FD4\u56DE\u7684\u662F integer"]}),"\n",(0,s.jsx)(n.li,{children:"\u53EF\u4EE5\u4F7F\u7528 real \u5B58\u50A8\u9AD8\u7CBE\u5EA6 - \u5305\u542B ms/\u03BCs/ns"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"datetime('now')"})," \u8FD4\u56DE  ",(0,s.jsx)(n.code,{children:"YYYY-MM-DD HH:mm:ss"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"pragma journal_mode;                -- \u67E5\u770B/\u8BBE\u7F6E\u65E5\u5FD7\u6A21\u5F0F\uFF08\u5982 WAL, DELETE \u7B49\uFF09\npragma synchronous;                 -- \u4E8B\u52A1\u540C\u6B65\u7EA7\u522B\uFF0C\u5F71\u54CD\u6027\u80FD\u548C\u7A33\u5B9A\u6027\uFF08FULL/NORMAL/OFF\uFF09\npragma cache_size;                  -- \u8BBE\u7F6E\u9875\u7F13\u5B58\u5927\u5C0F\uFF08\u5355\u4F4D\u9875\u6570\uFF0C\u8D1F\u503C\u4EE3\u8868 KB\uFF09\npragma temp_store;                  -- \u4E34\u65F6\u8868/\u7D22\u5F15\u7684\u5B58\u50A8\u65B9\u5F0F\uFF08DEFAULT, MEMORY, FILE\uFF09\npragma foreign_keys;                -- \u662F\u5426\u542F\u7528\u5916\u952E\u652F\u6301 (ON/OFF)\npragma mmap_size;                   -- \u6620\u5C04\u6587\u4EF6\u5927\u5C0F\uFF0C\u63D0\u5347\u67E5\u8BE2\u6027\u80FD\npragma busy_timeout = 5000;         -- \u8BBE\u7F6E\u6570\u636E\u5E93\u88AB\u9501\u65F6\u65F6\u7684\u7B49\u5F85\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\npragma optimize;                    -- \u81EA\u52A8\u6267\u884C\u5206\u6790\u548C\u4F18\u5316\u547D\u4EE4\npragma page_size;                   -- \u5355\u9875\u5927\u5C0F\uFF08\u9ED8\u8BA4 4096\uFF09\uFF0C\u4E00\u822C\u65E0\u9700\u4FEE\u6539\npragma wal_autocheckpoint = 1000;   -- WAL \u65E5\u5FD7\u81EA\u52A8 checkpoint \u9891\u7387\uFF08\u5355\u4F4D\u9875\uFF09\npragma auto_vacuum;                 -- \u5783\u573E\u56DE\u6536\u6A21\u5F0F\uFF0C\u8282\u7701\u78C1\u76D8\u7A7A\u95F4\n\npragma journal_mode = WAL;\npragma synchronous = NORMAL;\n\n-- \u67E5\u770B PRAGMA \u5F53\u524D\u72B6\u6001\npragma pragma_list;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select hex(randomblob(16));\nselect lower(hex(randomblob(16)));\n-- \u4F2A UUIv4\nselect lower(hex(randomblob(4))) || '-' || lower(hex(randomblob(2))) || '-4' || substr(lower(hex(randomblob(2))),2) || '-' || substr('89ab',abs(random()) % 4 + 1, 1) || substr(lower(hex(randomblob(2))),2) || '-' || lower(hex(randomblob(6)));\n-- \u4F2A UUIv7\nSELECT\n  -- timestamp\n  format('%08x', ((strftime('%s') * 1000) >> 16)) || '-' ||\n  format('%04x', ((strftime('%s') * 1000) + ((strftime('%f') * 1000) % 1000)) & 0xffff) || '-' ||\n  -- version\n  format('%04x', 0x7000 + abs(random()) % 0x0fff) || '-' ||\n  -- variant\n  format('%04x', 0x8000 + abs(random()) % 0x3fff) || '-' ||\n  -- randomness\n  format('%012x', abs(random()) >> 16) AS uuid7;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"create table if not exists message_log\n(\n  id            text        not null default (lower(hex(randomblob(16)))) primary key,\n  uid           uuid        not null default (lower(hex(randomblob(4))) || '-' || lower(hex(randomblob(2))) || '-4' || substr(lower(hex(randomblob(2))),2) || '-' || substr('89ab',abs(random()) % 4 + 1, 1) || substr(lower(hex(randomblob(2))),2) || '-' || lower(hex(randomblob(6)))),\n  created_at    timestamptz not null default current_timestamp,\n  updated_at    timestamptz not null default current_timestamp,\n  deleted_at    timestamptz,\n  tid           text        not null default 'org_00000000000000000000000000',\n  eid           text,\n\n  user_id       text,\n  session_id    text,\n  connection_id text,\n  message_seq   bigint,\n  url           text,\n  port          integer,\n  seq           bigint,\n  type          bigint,\n  name          text,\n  direction     text,\n  data          json,\n  data_hash     text,\n  remaining     int,\n  key           text unique,\n  size          integer,\n  flags         json,\n  metadata      json,\n  payload       bytea,\n\n  attributes    jsonb       not null default '{}',\n  properties    jsonb       not null default '{}',\n  extensions    jsonb       not null default '{}',\n  unique (tid, eid)\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"dsn",children:"DSN"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"modernc.org/sqlite"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"param"}),(0,s.jsx)(n.th,{children:"value"}),(0,s.jsx)(n.th,{children:"desc"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vfs"})}),(0,s.jsx)(n.td,{children:"VFS \u6A21\u5757\u540D\u79F0"}),(0,s.jsxs)(n.td,{children:["\u6307\u5B9A\u8981\u4F7F\u7528\u7684 Virtual File System (VFS) \u6A21\u5757\u540D\u79F0\u3002\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u4F7F\u7528\u9ED8\u8BA4 VFS\u3002\u5982\u679C\u6307\u5B9A\u591A\u4E2A ",(0,s.jsx)(n.code,{children:"vfs"})," \u53C2\u6570\u4E14\u503C\u4E0D\u540C\uFF0C\u4F1A\u8FD4\u56DE\u9519\u8BEF\u3002"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"ro"})," \u6216 ",(0,s.jsx)(n.code,{children:"readonly"})]}),(0,s.jsx)(n.td,{children:"\u4EE5\u53EA\u8BFB\u6A21\u5F0F\u6253\u5F00\u6570\u636E\u5E93 (SQLITE_OPEN_READONLY)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"rw"})," \u6216 ",(0,s.jsx)(n.code,{children:"readwrite"})]}),(0,s.jsx)(n.td,{children:"\u4EE5\u8BFB\u5199\u6A21\u5F0F\u6253\u5F00\u6570\u636E\u5E93 (SQLITE_OPEN_READWRITE)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"rwc"})}),(0,s.jsx)(n.td,{children:"\u4EE5\u8BFB\u5199\u6A21\u5F0F\u6253\u5F00\u6570\u636E\u5E93\uFF0C\u5982\u679C\u4E0D\u5B58\u5728\u5219\u521B\u5EFA (SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"memory"})}),(0,s.jsx)(n.td,{children:"\u6253\u5F00\u5185\u5B58\u6570\u636E\u5E93 (SQLITE_OPEN_MEMORY | SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"shared"})}),(0,s.jsxs)(n.td,{children:["\u542F\u7528\u5171\u4EAB\u7F13\u5B58\u6A21\u5F0F (SQLITE_OPEN_SHAREDCACHE)\uFF0C\u53EF\u4E0E\u57FA\u7840\u6A21\u5F0F\u7EC4\u5408\u4F7F\u7528\uFF0C\u5982 ",(0,s.jsx)(n.code,{children:"rwc+shared"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"private"})}),(0,s.jsxs)(n.td,{children:["\u542F\u7528\u79C1\u6709\u7F13\u5B58\u6A21\u5F0F (SQLITE_OPEN_PRIVATECACHE)\uFF0C\u53EF\u4E0E\u57FA\u7840\u6A21\u5F0F\u7EC4\u5408\u4F7F\u7528\uFF0C\u5982 ",(0,s.jsx)(n.code,{children:"memory+private"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nomutex"})}),(0,s.jsx)(n.td,{children:"\u7981\u7528\u4E92\u65A5\u9501 (SQLITE_OPEN_NOMUTEX)\uFF0C\u53EF\u4E0E\u57FA\u7840\u6A21\u5F0F\u7EC4\u5408\u4F7F\u7528"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fullmutex"})}),(0,s.jsx)(n.td,{children:"\u542F\u7528\u5B8C\u6574\u4E92\u65A5\u9501\u6A21\u5F0F (SQLITE_OPEN_FULLMUTEX)\uFF0C\u53EF\u4E0E\u57FA\u7840\u6A21\u5F0F\u7EC4\u5408\u4F7F\u7528"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_mode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"wal"})}),(0,s.jsx)(n.td,{children:"\u542F\u7528 WAL \u6A21\u5F0F (SQLITE_OPEN_WAL)\uFF0C\u53EF\u4E0E\u57FA\u7840\u6A21\u5F0F\u7EC4\u5408\u4F7F\u7528"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_pragma"})}),(0,s.jsx)(n.td,{children:"PRAGMA \u8BED\u53E5"}),(0,s.jsxs)(n.td,{children:["\u6267\u884C PRAGMA \u8BED\u53E5\u6765\u914D\u7F6E\u6570\u636E\u5E93\u884C\u4E3A\u3002\u53EF\u4EE5\u6307\u5B9A\u591A\u6B21\uFF0C\u6BCF\u4E2A\u503C\u90FD\u4F1A\u4F5C\u4E3A ",(0,s.jsx)(n.code,{children:"PRAGMA ..."})," \u8BED\u53E5\u6267\u884C\u3002\u591A\u4E2A ",(0,s.jsx)(n.code,{children:"_pragma"})," \u53C2\u6570\u4F1A\u88AB\u6392\u5E8F\u6267\u884C\uFF0C",(0,s.jsx)(n.code,{children:"busy_timeout"})," \u76F8\u5173\u7684 PRAGMA \u4F1A\u4F18\u5148\u6267\u884C\uFF0C\u5176\u4ED6 PRAGMA \u6309\u5B57\u5178\u5E8F\u6267\u884C\uFF08\u4E0D\u533A\u5206\u5927\u5C0F\u5199\uFF09\u3002"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_time_format"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sqlite"})}),(0,s.jsxs)(n.td,{children:["\u4F7F\u7528 SQLite \u683C\u5F0F\uFF08\u683C\u5F0F 7\uFF09\u5199\u5165\u65F6\u95F4\u503C\uFF0C\u5305\u542B\u65F6\u533A\u4FE1\u606F\u3002\u683C\u5F0F\uFF1A",(0,s.jsx)(n.code,{children:"2006-01-02 15:04:05.999999999-07:00"}),"\u3002\u5982\u679C\u672A\u6307\u5B9A\uFF0C\u4F7F\u7528 Go \u7684 ",(0,s.jsx)(n.code,{children:"time.Time.String()"})," \u683C\u5F0F\u3002"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_time_integer_format"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"unix"})}),(0,s.jsxs)(n.td,{children:["\u5C06\u65F6\u95F4\u503C\u5B58\u50A8\u4E3A Unix \u65F6\u95F4\u6233\uFF08\u79D2\uFF09\u3002\u5982\u679C\u8BBE\u7F6E\u4E86\u6B64\u53C2\u6570\uFF0C\u65F6\u95F4\u5C06\u5B58\u50A8\u4E3A\u6574\u6570\u800C\u4E0D\u662F\u5B57\u7B26\u4E32\u3002\u5982\u679C\u540C\u65F6\u8BBE\u7F6E\u4E86 ",(0,s.jsx)(n.code,{children:"_time_format"})," \u548C ",(0,s.jsx)(n.code,{children:"_time_integer_format"}),"\uFF0C\u4F18\u5148\u4F7F\u7528\u6574\u6570\u683C\u5F0F\u3002"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_time_integer_format"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"unix_milli"})}),(0,s.jsx)(n.td,{children:"\u5C06\u65F6\u95F4\u503C\u5B58\u50A8\u4E3A Unix \u65F6\u95F4\u6233\uFF08\u6BEB\u79D2\uFF09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_time_integer_format"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"unix_micro"})}),(0,s.jsx)(n.td,{children:"\u5C06\u65F6\u95F4\u503C\u5B58\u50A8\u4E3A Unix \u65F6\u95F4\u6233\uFF08\u5FAE\u79D2\uFF09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_time_integer_format"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"unix_nano"})}),(0,s.jsx)(n.td,{children:"\u5C06\u65F6\u95F4\u503C\u5B58\u50A8\u4E3A Unix \u65F6\u95F4\u6233\uFF08\u7EB3\u79D2\uFF09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_inttotime"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"1"}),", ",(0,s.jsx)(n.code,{children:"t"}),", ",(0,s.jsx)(n.code,{children:"T"}),", ",(0,s.jsx)(n.code,{children:"TRUE"}),", ",(0,s.jsx)(n.code,{children:"true"}),", ",(0,s.jsx)(n.code,{children:"True"})]}),(0,s.jsxs)(n.td,{children:["\u542F\u7528\u5C06\u6574\u6570\u5217\uFF08DATE, DATETIME, TIMESTAMP\uFF09\u4ECE\u6574\u6570\u8F6C\u6362\u4E3A\u65F6\u95F4\u7684\u529F\u80FD\u3002\u5F53\u542F\u7528\u65F6\uFF0C\u5982\u679C\u5B57\u6BB5\u5305\u542B\u6574\u6570\uFF08int64\uFF09\uFF0C\u4F1A\u81EA\u52A8\u8F6C\u6362\u4E3A ",(0,s.jsx)(n.code,{children:"time.Time"}),"\u3002\u7528\u4E8E\u517C\u5BB9\u6027\u573A\u666F\uFF0C\u5C06\u6574\u6570\u65F6\u95F4\u6233\u8BFB\u53D6\u4E3A\u65F6\u95F4\u7C7B\u578B\u3002"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_inttotime"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"0"}),", ",(0,s.jsx)(n.code,{children:"f"}),", ",(0,s.jsx)(n.code,{children:"F"}),", ",(0,s.jsx)(n.code,{children:"FALSE"}),", ",(0,s.jsx)(n.code,{children:"false"}),", ",(0,s.jsx)(n.code,{children:"False"})]}),(0,s.jsx)(n.td,{children:"\u7981\u7528\u6574\u6570\u8F6C\u65F6\u95F4\u529F\u80FD"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_txlock"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"deferred"})}),(0,s.jsxs)(n.td,{children:["\u5EF6\u8FDF\u9501\u5B9A\uFF08\u9ED8\u8BA4\u503C\uFF09\u3002\u503C\u4E0D\u533A\u5206\u5927\u5C0F\u5199\u3002\u53C2\u8003\uFF1A",(0,s.jsx)(n.a,{href:"https://www.sqlite.org/lang_transaction.html#deferred_immediate_and_exclusive_transactions",children:"https://www.sqlite.org/lang_transaction.html#deferred_immediate_and_exclusive_transactions"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_txlock"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"immediate"})}),(0,s.jsx)(n.td,{children:"\u7ACB\u5373\u9501\u5B9A\u3002\u503C\u4E0D\u533A\u5206\u5927\u5C0F\u5199\u3002"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"_txlock"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"exclusive"})}),(0,s.jsx)(n.td,{children:"\u72EC\u5360\u9501\u5B9A\u3002\u503C\u4E0D\u533A\u5206\u5927\u5C0F\u5199\u3002"})]})]})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.sqlite.org/pragma.html",children:"https://www.sqlite.org/pragma.html"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.sqlite.org/lang_datefunc.html#time_values",children:"https://www.sqlite.org/lang_datefunc.html#time_values"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"attempt-to-write-a-readonly-database",children:"attempt to write a readonly database"}),"\n",(0,s.jsx)(n.p,{children:"\u53EF\u80FD\u662F\u6743\u9650\u4E0D\u8DB3"}),"\n",(0,s.jsx)(n.h2,{id:"\u5220\u9664\u4E0D\u652F\u6301-where-\u548C-order",children:"\u5220\u9664\u4E0D\u652F\u6301 WHERE \u548C ORDER"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u9700\u8981\u4ECE\u6E90\u7801\u7F16\u8BD1 ",(0,s.jsx)(n.a,{href:"https://www.sqlite.org/compile.html#enable_update_delete_limit",children:"SQLITE_ENABLE_UPDATE_DELETE_LIMIT"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"golang-database-is-locked-5-sqlite_busy",children:"Golang database is locked (5) (SQLITE_BUSY)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"db.SetMaxOpenConns(1)\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u9700\u8981\u4E0D\u540C\u8868\u5E76\u884C\u64CD\u4F5C\uFF0C\u8003\u8651\u4F7F\u7528\u591A\u4E2A sqlite \u6587\u4EF6"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/mattn/go-sqlite3/issues/274#issuecomment-191597862",children:"https://github.com/mattn/go-sqlite3/issues/274#issuecomment-191597862"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sqlite-\u4FEE\u590D",children:"sqlite \u4FEE\u590D"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'echo ".dump" | sqlite old.db | sqlite new.db\n'})}),"\n",(0,s.jsx)(n.h2,{id:"35-faster-than-fs",children:"35% faster than fs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["read\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"avg 10KB"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["write\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"wal"}),"\n",(0,s.jsx)(n.li,{children:"synchronous=NORMAL"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.sqlite.org/fasterthanfs.html",children:"https://www.sqlite.org/fasterthanfs.html"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"blob-or-hex-text",children:"BLOB or Hex TEXT"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["BLOB - \u5B58\u50A8\u66F4\u5C11\u5185\u5BB9\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528\u8C03\u8BD5\u4E0D\u65B9\u4FBF"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Hex TEXT - \u5B58\u50A8\u66F4\u591A\u5185\u5BB9\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u66F4\u591A IO\uFF0C\u66F4\u6162"}),"\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528\u8C03\u8BD5\u53CB\u597D"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"cannot-drop-unique-column",children:"cannot drop UNIQUE column"}),"\n",(0,s.jsx)(n.p,{children:"SQLite \u4E0D\u652F\u6301 drop unique \u5217\uFF0C\u53EA\u6709\u5C1D\u8BD5 rename \u8868\uFF0C\u5EFA\u7ACB\u65B0\u8868\u89E3\u51B3\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"count-slow",children:"count slow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u5982\u679C\u6CA1\u8FDB\u884C\u8FC7\u5220\u9664\uFF0C\u90A3 max(rowid)=count\nselect max(rowid) from tab;\n-- \u907F\u514D count(*) - expain \u4F1A\u53D1\u73B0\u6267\u884C\u903B\u8F91\u4E0D\u540C\nselect count(rowid) from tab;\n"})})]})}function h(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},917776:function(e,n,t){t.d(n,{R:()=>r,x:()=>i});var d=t(7378);let s={},l=d.createContext(s);function r(e){let n=d.useContext(l);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),d.createElement(l.Provider,{value:n},e.children)}}}]);