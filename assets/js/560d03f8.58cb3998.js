"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["705956"],{875754:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>u,metadata:()=>s,assets:()=>c,contentTitle:()=>o});var s=JSON.parse('{"id":"queue/nats/nats-client","title":"Client","description":"- NodeJS","source":"@site/../notes/queue/nats/nats-client.md","sourceDirName":"queue/nats","slug":"/queue/nats/client","permalink":"/notes/queue/nats/client","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/queue/nats/nats-client.md","tags":[{"inline":true,"label":"Client","permalink":"/notes/tags/client"},{"inline":true,"label":"SDK","permalink":"/notes/tags/sdk"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1709694572000,"frontMatter":{"tags":["Client","SDK"]},"sidebar":"docs","previous":{"title":"nats","permalink":"/notes/queue/nats/cli"},"next":{"title":"NATS Conf","permalink":"/notes/queue/nats/conf"}}'),l=t(486106),i=t(917776);let r={tags:["Client","SDK"]},o="Client",c={},a=[{value:"Request/Reply",id:"requestreply",level:2},{value:"NodeJS Websocket",id:"nodejs-websocket",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"client",children:"Client"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["NodeJS\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["nats - ",(0,l.jsx)(n.strong,{children:"\u4E0D\u652F\u6301 websocket"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["NodeJS/Browser - Websocket\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"nats.ws"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5B98\u65B9 Client\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"WebSocket"}),"\n",(0,l.jsx)(n.li,{children:"C, C#, Crystal, Deno, Elixir, Go, Java, Nginx, NodeJS, Ruby, Pure Ruby"}),"\n",(0,l.jsx)(n.li,{children:"Python Asyncio, Python Torando, Rust"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Connectors/Utils\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5B98\u65B9: Spark, Redis PubSub, Kafka Bridge, MQ Series Bridge, Replicator"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://nats.io/download/",children:"Clients"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"// \u6700\u591A 10 \u6B21\u91CD\u8FDE\nexport const DEFAULT_MAX_RECONNECT_ATTEMPTS = 10;\n// \u91CD\u8FDE\u968F\u673A\u95F4\u9694\u8303\u56F4\nexport const DEFAULT_JITTER = 100;\n// jitter for tls\nexport const DEFAULT_JITTER_TLS = 1000;\n// Ping interval\nexport const DEFAULT_PING_INTERVAL = 2 * 60 * 1000; // 2 minutes\nexport const DEFAULT_MAX_PING_OUT = 2;\n\n// DISCONNECT Parameters, 2 sec wait, 10 tries\n// \u91CD\u8FDE\u95F4\u9694\nexport const DEFAULT_RECONNECT_TIME_WAIT = 2 * 1000;\n\n// \u91CD\u8FDE\u95F4\u9694\u8BA1\u7B97\u903B\u8F91\nconst reconnectDelayHandler = () => {\n  let extra = options.tls ? options.reconnectJitterTLS : options.reconnectJitter;\n  if (extra) {\n    extra++;\n    extra = Math.floor(Math.random() * extra);\n  }\n  return options.reconnectTimeWait + extra;\n};\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/nats-io/nats.deno/blob/main/nats-base-client/options.ts",children:"https://github.com/nats-io/nats.deno/blob/main/nats-base-client/options.ts"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"requestreply",children:"Request/Reply"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Request/Reply\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"client: subscribe INBOX"}),"\n",(0,l.jsx)(n.li,{children:"client: publish subject"}),"\n",(0,l.jsx)(n.li,{children:"server: reply -> publish(msg.replay) -> client.INBOX"}),"\n",(0,l.jsx)(n.li,{children:"client: handle reply"}),"\n",(0,l.jsx)(n.li,{children:"client: unsubscribe INBOX"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"nodejs-websocket",children:"NodeJS Websocket"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ts",children:"function polyfillWebSocket(ws?: any): MaybePromise<boolean> {\n  const globalThis = getGlobalThis();\n  if ('WebSocket' in globalThis) {\n    return false;\n  }\n  if (ws) {\n    const { WebSocket } = ws;\n    Object.assign(globalThis, { WebSocket });\n  }\n  return import('ws').then((ws) => polyfillWebSocket(ws));\n}\n\nconst { connect } = await import('nats.ws');\nconst client = await connect({\n  servers: ['wss://nats.example.com:443'],\n});\nconsole.log(client.stats());\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>r,x:()=>o});var s=t(7378);let l={},i=s.createContext(l);function r(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);