"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["58014"],{89850:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>c,toc:()=>h,default:()=>x,metadata:()=>l,assets:()=>t,contentTitle:()=>d});var l=JSON.parse('{"id":"db/column/clickhouse/clickhouse-sql","title":"Clickhouse SQL","description":"REST API","source":"@site/../notes/db/column/clickhouse/clickhouse-sql.md","sourceDirName":"db/column/clickhouse","slug":"/db/column/clickhouse/sql","permalink":"/notes/db/column/clickhouse/sql","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/column/clickhouse/clickhouse-sql.md","tags":[{"inline":true,"label":"SQL","permalink":"/notes/tags/sql"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1686920980000,"frontMatter":{"tags":["SQL"]},"sidebar":"docs","previous":{"title":"ClickHouse FAQ","permalink":"/notes/db/column/clickhouse/faq"},"next":{"title":"CQL","permalink":"/notes/db/column/cql"}}'),s=i(86106),r=i(17776);let c={tags:["SQL"]},d="Clickhouse SQL",t={},h=[{value:"REST API",id:"rest-api",level:2},{value:"\u6570\u636E\u7C7B\u578B",id:"data-types",level:2},{value:"Query",id:"query",level:2},{value:"JSON",id:"json",level:2},{value:"Alter Table JSON NO_SUCH_COLUMN_IN_TABLE",id:"alter-table-json-no_such_column_in_table",level:3},{value:"Database Engines",id:"database-engines",level:2},{value:"Table Engine",id:"table-engine",level:2},{value:"MergeTree",id:"mergetree",level:3},{value:"Log Family",id:"log-family",level:3},{value:"Special",id:"special",level:3},{value:"S3",id:"s3",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Mutation",id:"mutation",level:2},{value:"SELECT *",id:"select-",level:2},{value:"Cannot iterate over non-finalized ColumnObject",id:"cannot-iterate-over-non-finalized-columnobject",level:2},{value:"Memory limit (for query) exceeded",id:"memory-limit-for-query-exceeded",level:2},{value:"SQLite database file path must be inside &#39;user_files&#39; directory. (PATH_ACCESS_DENIED)",id:"sqlite-database-file-path-must-be-inside-user_files-directory-path_access_denied",level:2},{value:"To execute this query it&#39;s necessary to have grant CREATE USER ON",id:"to-execute-this-query-its-necessary-to-have-grant-create-user-on",level:2},{value:"FINAL",id:"final",level:2}];function a(n){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"clickhouse-sql",children:"Clickhouse SQL"})}),"\n",(0,s.jsx)(e.h2,{id:"rest-api",children:"REST API"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"echo 'SELECT version()' | curl 'http://localhost:8123/' --data-binary @-\n\ncurl 'http://192.168.66.61:8123?query=select%20version()'\ncurl --get http://192.168.66.61:8123 --data-urlencode 'query=select version()'\n"})}),"\n",(0,s.jsx)(e.h2,{id:"data-types",children:"\u6570\u636E\u7C7B\u578B"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u652F\u6301\u8303\u578B\u7684\u5F3A\u7C7B\u578B Schema"}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["UInt8, UInt16, UInt32, UInt64, UInt256, Int8, Int16, Int32, Int64, Int128, Int256\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Int8 \u2014 TINYINT, BOOL, BOOLEAN, INT1."}),"\n",(0,s.jsx)(e.li,{children:"Int16 \u2014 SMALLINT, INT2."}),"\n",(0,s.jsx)(e.li,{children:"Int32 \u2014 INT, INT4, INTEGER."}),"\n",(0,s.jsx)(e.li,{children:"Int64 \u2014 BIGINT"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Float32, Float64\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"FLOAT, DOUBLE"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S), Decimal256(S)\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"P - precision - [ 1 : 76 ]"}),"\n",(0,s.jsx)(e.li,{children:"S - scale - [ 0 : P ]"}),"\n",(0,s.jsx)(e.li,{children:"P [ 1 : 9 ] - Decimal32(S)"}),"\n",(0,s.jsx)(e.li,{children:"P [ 10 : 18 ] - Decimal64(S)"}),"\n",(0,s.jsx)(e.li,{children:"P [ 19 : 38 ] - Decimal128(S)"}),"\n",(0,s.jsx)(e.li,{children:"P [ 39 : 76 ] - Decimal256(S)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Boolean\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"UInt8 - 0,1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["String\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5982\u679C\u521B\u5EFA VARCHAR(255) \u4F1A\u5FFD\u7565\u957F\u5EA6"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"FixedString(N) - N bytes"}),"\n",(0,s.jsx)(e.li,{children:"UUID"}),"\n",(0,s.jsxs)(e.li,{children:["Date\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"2byte, days since 1970-01-01"}),"\n",(0,s.jsx)(e.li,{children:"\u6700\u5927 2148 \u5E74"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DateTime([timezone])"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"unix timestamp"}),"\n",(0,s.jsx)(e.li,{children:"\u6700\u5927 2105 \u5E74"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DateTime64(precision, [timezone])"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Int64, epoch"}),"\n",(0,s.jsx)(e.li,{children:"precision=3 \u5219\u662F\u6BEB\u79D2\u7EA7"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Enum('k1'=1,'k2'=2)"})}),"\n",(0,s.jsxs)(e.li,{children:["LowCardinality(data_type)\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"change internal to dictionary-encoded"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["array(T) - ",(0,s.jsx)(e.code,{children:"[]"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"AggregateFunction(name, types_of_arguments\u2026)"})}),"\n",(0,s.jsx)(e.li,{children:"Nested - \u5D4C\u5957\u7C7B\u578B - \u7C7B\u4F3C\u5B9A\u4E49\u4E00\u4E2A struct"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"tuple(T1, T2, ...)"})}),"\n",(0,s.jsxs)(e.li,{children:["\u7279\u6B8A\u7C7B\u578B\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Set"}),"\n",(0,s.jsx)(e.li,{children:"Nothing"}),"\n",(0,s.jsx)(e.li,{children:"Interval"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u57DF\u7C7B\u578B\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"IPv4, IPv6"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Geo \u7C7B\u578B\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Point, Ring, Polygon, MultiPolygon"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"Map(key, value)"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"query",children:"Query"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"select version();\n\nselect currentDatabase();\nselect currentProfiles();\nselect currentUser();\nselect currentRoles();\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["CREATE TABLE\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ENGINE"}),"\n",(0,s.jsxs)(e.li,{children:["\u5217\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"DEFAULT - \u8BBE\u7F6E\u9ED8\u8BA4\u503C"}),"\n",(0,s.jsx)(e.li,{children:"MATERIALIZED"}),"\n",(0,s.jsxs)(e.li,{children:["ALIAS - \u522B\u540D\u5217 - \u4E0D\u5305\u542B\u5728 ",(0,s.jsx)(e.code,{children:"*"})]}),"\n",(0,s.jsx)(e.li,{children:"EPHEMERAL - \u4E0D\u4F1A\u5B58\u50A8\uFF0C\u4E0D\u80FD\u88AB SELECT \u5728 CREATE \u53EF\u4EE5\u88AB\u5F15\u7528"}),"\n",(0,s.jsxs)(e.li,{children:["compression_codec\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9ED8\u8BA4 lz4"}),"\n",(0,s.jsx)(e.li,{children:"NONE, LZ4"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"LZ4HC(9)"})," - 1-12, \u63A8\u8350 4-9"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ZSTD(1)"})," - 1-22"]}),"\n",(0,s.jsx)(e.li,{children:"DEFLATE_QPL"}),"\n",(0,s.jsxs)(e.li,{children:["\u7279\u6B8A\u7F16\u7801\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Delta(delta_bytes)"})}),"\n",(0,s.jsx)(e.li,{children:"DoubleDelta"}),"\n",(0,s.jsx)(e.li,{children:"Gorilla - XOR - Gorilla TSDB"}),"\n",(0,s.jsx)(e.li,{children:"FPC"}),"\n",(0,s.jsx)(e.li,{children:"T64"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u52A0\u5BC6\u7F16\u7801\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"AES_128_GCM_SIV"}),"\n",(0,s.jsx)(e.li,{children:"AES-256-GCM-SIV"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"TTL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["REPLACE TABLE\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u53EA\u6709 Atomic \u5F15\u64CE\u53EF\u4EE5"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Dictionaries - ",(0,s.jsx)(e.code,{children:"key -> attributes"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources",children:"\u5916\u90E8"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Local file"}),"\n",(0,s.jsx)(e.li,{children:"Executable File"}),"\n",(0,s.jsx)(e.li,{children:"Executable Pool"}),"\n",(0,s.jsx)(e.li,{children:"HTTP(s)"}),"\n",(0,s.jsxs)(e.li,{children:["DBMS\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ODBC"}),"\n",(0,s.jsx)(e.li,{children:"MySQL"}),"\n",(0,s.jsx)(e.li,{children:"ClickHouse"}),"\n",(0,s.jsx)(e.li,{children:"MongoDB"}),"\n",(0,s.jsx)(e.li,{children:"Redis"}),"\n",(0,s.jsx)(e.li,{children:"Cassandra"}),"\n",(0,s.jsx)(e.li,{children:"PostgreSQL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"json",children:"JSON"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["JSON -> ",(0,s.jsx)(e.code,{children:"Object('json')"})]}),"\n",(0,s.jsx)(e.li,{children:"\u76EE\u524D\u8FD8\u6709\u5F88\u591A\u95EE\u9898"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SET allow_experimental_object_type=1;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/sql-reference/functions/json-functions/",children:"JSON Functions"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/guides/developer/working-with-json",children:"Working with JSON"})}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"alter-table-json-no_such_column_in_table",children:"Alter Table JSON NO_SUCH_COLUMN_IN_TABLE"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/ClickHouse/ClickHouse/issues/38517",children:"https://github.com/ClickHouse/ClickHouse/issues/38517"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/ClickHouse/ClickHouse/issues/37730",children:"https://github.com/ClickHouse/ClickHouse/issues/37730"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"database-engines",children:"Database Engines"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Atomic"}),"\n",(0,s.jsx)(e.li,{children:"MySQL"}),"\n",(0,s.jsx)(e.li,{children:"MaterializedMySQL"}),"\n",(0,s.jsx)(e.li,{children:"Lazy"}),"\n",(0,s.jsx)(e.li,{children:"PostgreSQL"}),"\n",(0,s.jsx)(e.li,{children:"MaterializedPostgreSQL"}),"\n",(0,s.jsx)(e.li,{children:"Replicated"}),"\n",(0,s.jsx)(e.li,{children:"SQLite"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE DATABASE sqlite_database\nENGINE = SQLite('db_path');\n"})}),"\n",(0,s.jsx)(e.h2,{id:"table-engine",children:"Table Engine"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"MergeTree Family"}),(0,s.jsx)(e.th,{children:"Log Family"}),(0,s.jsx)(e.th,{children:"Integrations"}),(0,s.jsx)(e.th,{children:"Special"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"MergeTree"}),(0,s.jsx)(e.td,{children:"StripeLog"}),(0,s.jsx)(e.td,{children:"ODBC"}),(0,s.jsx)(e.td,{children:"Distributed"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"ReplacingMergeTree"}),(0,s.jsx)(e.td,{children:"Log"}),(0,s.jsx)(e.td,{children:"JDBC"}),(0,s.jsx)(e.td,{children:"MaterializedView"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SummingMergeTree"}),(0,s.jsx)(e.td,{children:"TinyLog"}),(0,s.jsx)(e.td,{children:"MySQL"}),(0,s.jsx)(e.td,{children:"Dictionary"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"AggregatingMergeTree"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"MongoDB"}),(0,s.jsx)(e.td,{children:"Merge"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"CollapsingMergeTree"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"HDFS"}),(0,s.jsx)(e.td,{children:"File"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"VersionedCollapsingMergeTree"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"S3"}),(0,s.jsx)(e.td,{children:"Null"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"GraphiteMergeTree"}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"Kafka"}),(0,s.jsx)(e.td,{children:"Set"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"EmbeddedRocksDB"}),(0,s.jsx)(e.td,{children:"Join"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"RabbitMQ"}),(0,s.jsx)(e.td,{children:"URL"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"PostgreSQL"}),(0,s.jsx)(e.td,{children:"View"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"Memory"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{}),(0,s.jsx)(e.td,{children:"Buffer"})]})]})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/engines/table-engines/",children:"Table Engines"})}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"mergetree",children:"MergeTree"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["MergeTree - \u5EFA\u8BAE\u7528\u4E8E\u5355\u8282\u70B9\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5217\u5B58\u50A8"}),"\n",(0,s.jsx)(e.li,{children:"\u57FA\u4E8E PK \u6392\u5E8F"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u526F\u672C"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u91C7\u6837"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301 TTL"}),"\n",(0,s.jsx)(e.li,{children:"\u81EA\u5B9A\u4E49\u5206\u7247"}),"\n",(0,s.jsx)(e.li,{children:"sparse primary index"}),"\n",(0,s.jsx)(e.li,{children:"secondary data-skipping indexes"}),"\n",(0,s.jsxs)(e.li,{children:["\u7D22\u5F15\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"annoy - \u7A7A\u95F4"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ORDER BY tuple()"})," \u8868\u793A\u4E0D\u9700\u8981\u6392\u5E8F"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"TTL create_time + INTERVAL 1 MONTH"})}),"\n",(0,s.jsxs)(e.li,{children:["SETTINGS\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"index_granularity=8192"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u7C7B\u4F3C LSM tree \u7ED3\u6784\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"optimize table tbl final;"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"compaction"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Replicated*"})," - \u526F\u672C - \u7528\u4E8E\u591A\u8282\u70B9\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"table \u7EF4\u5EA6"}),"\n",(0,s.jsx)(e.li,{children:"\u5305\u542B: INSERT, ALTER"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u6570\u636E\u53BB\u91CD"}),"\n",(0,s.jsxs)(e.li,{children:["\u4E0D\u5305\u542B: CREATE, DROP, ATTACH, DETACH, RENAME\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"RENAME - \u53EF\u4EE5\u8BA9\u526F\u672C\u8868\u540D\u5B57\u4E0D\u540C"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replacingmergetree/",children:"ReplacingMergeTree([ver])"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u57FA\u4E8E sorting key \u53BB\u91CD\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5728 compaction/optimize \u65F6 - \u8017\u65F6\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E0D\u4E00\u5B9A\u80FD\u6EE1\u8DB3\u5B9E\u65F6\u8981\u6C42"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u4E0D\u540C\u8282\u70B9\u4E0D\u80FD\u53BB\u91CD"}),"\n",(0,s.jsx)(e.li,{children:"\u5206\u5E03\u5F0F\u65F6 \u53EF\u80FD\u76F8\u540C key \u5728\u4E0D\u540C\u8282\u70B9"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u9ED8\u8BA4 \u4FDD\u7559\u6700\u540E\u63D2\u5165"}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679C\u7ED9\u5B9A\u4E86 ver \u5219\u4F1A\u57FA\u4E8E ver \u6392\u5E8F\u9009\u62E9\u6700\u7EC8\u4FDD\u7559\u7684\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["ver \u7C7B\u578B\u4E3A ",(0,s.jsx)(e.code,{children:"UInt*"}),", ",(0,s.jsx)(e.code,{children:"Date"}),", ",(0,s.jsx)(e.code,{children:"DateTime"}),", ",(0,s.jsx)(e.code,{children:"DateTime64"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["CollapsingMergeTree\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u57FA\u4E8E Sign \u5220\u9664\u91CD\u590D - \u53EF\u4EE5\u591A\u4E2A\u76F8\u540C\u6570\u636E"}),"\n",(0,s.jsx)(e.li,{children:"Sign = 1 - state"}),"\n",(0,s.jsx)(e.li,{children:"Sign = -1 - cancel"}),"\n",(0,s.jsx)(e.li,{children:"\u6570\u636E\u91CF\u5927\u65F6\u53EF\u80FD\u5BFC\u81F4 out-of-order \u95EE\u9898"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["VersionedCollapsingMergeTree\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728 CollapsingMergeTree \u4E4B\u4E0A\u6DFB\u52A0\u7248\u672C\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["SummingMergeTree\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u57FA\u4E8E PK \u9884\u805A\u5408"}),"\n",(0,s.jsx)(e.li,{children:"\u805A\u5408\u9664\u4E86 PK \u4EE5\u5916\u7684\u6240\u6709\u5217"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679C\u7C7B\u578B \u4E0D\u80FD sum\uFF0C\u5219\u968F\u673A\u9009\u62E9\u4E00\u4E2A\u503C"}),"\n",(0,s.jsxs)(e.li,{children:["\u7528\u4E8E\u52A0\u901F\u67E5\u8BE2\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8BE6\u7EC6\u4FE1\u606F\u4F7F\u7528 MergeTree \u5B58\u50A8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["AggregatingMergeTree\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u81EA\u5B9A\u4E49\u5408\u5E76\u805A\u5408\u903B\u8F91 - \u7C7B\u4F3C SummingMergeTree"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"log-family",children:"Log Family"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Append sequence"}),"\n",(0,s.jsx)(e.li,{children:"\u4E0D\u652F\u6301 Delete & Update"}),"\n",(0,s.jsx)(e.li,{children:"\u4E0D\u652F\u6301 Index"}),"\n",(0,s.jsx)(e.li,{children:"\u4E0D\u652F\u6301 Atomic writing"}),"\n",(0,s.jsx)(e.li,{children:"insert block select"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["TinyLog\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E0D\u80FD \u5E76\u884C \u8BFB"}),"\n",(0,s.jsx)(e.li,{children:"\u67E5\u8BE2\u6027\u80FD\u5DEE"}),"\n",(0,s.jsx)(e.li,{children:"\u683C\u5F0F\u7B80\u5355\uFF0C\u9002\u5408\u4E34\u65F6\u4F7F\u7528"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["StripLog\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u80FD \u5E76\u884C\u8BFB"}),"\n",(0,s.jsx)(e.li,{children:"\u6027\u80FD\u4F18\u4E8E TinyLog"}),"\n",(0,s.jsx)(e.li,{children:"\u4EE5\u5217\u683C\u5F0F\u5B58\u50A8\u4E3A\u5355\u4E2A\u5927\u6587\u4EF6"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Log\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7C7B\u4F3C StripLog - \u6BCF\u4E2A\u5217\u5355\u72EC\u6587\u4EF6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"special",children:"Special"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Memory\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9002\u5408\u4E0D\u9700\u8981\u6301\u4E45\u5316\u7684\u5C0F\u8868"}),"\n",(0,s.jsx)(e.li,{children:"\u4E34\u65F6\u8868"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Buffer\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Buffer \u6EE1\u540E flush \u5230\u78C1\u76D8"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["File\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u76F4\u63A5\u8BFB\u53D6\u6587\u4EF6"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Null\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E22\u5F03\u6570\u636E"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"s3",children:"S3"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- PostgreSQL\n-- =======================\n-- connect table\n-- insert, select\nCREATE TABLE\n  db_in_ch.table1 (id UInt64, column1 String) ENGINE = PostgreSQL(\n    'postgres-host.domain.com:5432',\n    'db_in_psg',\n    'table1',\n    'clickhouse_user',\n    'ClickHouse_123'\n  );\n\n-- materialized\n-- replica of the database\nSET\n  allow_experimental_database_materialized_postgresql = 1;\n\nCREATE DATABASE db1_postgres ENGINE = MaterializedPostgreSQL(\n  'postgres-host.domain.com:5432',\n  'db1',\n  'clickhouse_user',\n  'ClickHouse_123'\n) SETTINGS materialized_postgresql_tables_list = 'table1';\n\n-- S3\n-- =========================\n-- \u5143\u4FE1\u606F _path, _file\nSELECT\n  *\nFROM\n  s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_*.gz',\n    'TabSeparatedWithNames'\n  )\nLIMIT\n  10;\n\n-- \u5199\u5165\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  )\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  10000;\n\n-- \u5199\u5165\u591A\u4E2A\u6587\u4EF6\nINSERT INTO\n  FUNCTION s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/csv/trips_{_partition_id}.csv.lz4',\n    's3_key',\n    's3_secret',\n    'CSV'\n  ) PARTITION BY rand() % 10\nSELECT\n  *\nFROM\n  trips\nLIMIT\n  100000;\n\n-- engine\nCREATE TABLE\n  trips_dest (\n    `trip_id` UInt32,\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_datetime` DateTime,\n    `tip_amount` Float32,\n    `total_amount` Float32\n  ) ENGINE = S3('<bucket path>/trips.bin', 'Native');\n"})}),"\n",(0,s.jsx)(e.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u901A\u8FC7 ",(0,s.jsx)(e.code,{children:"COPY (SELECT ...) TO STDOUT"})," \u5B9E\u73B0"]}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301 Materialized - \u521D\u6B21\u540C\u6B65\u540E\u540E\u7EED\u901A\u8FC7 WAL \u66F4\u65B0"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"mutation",children:"Mutation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- 0 async, 1 sync\nset mutations_sync=0;\n\nselect * from system.mutations;\n"})}),"\n",(0,s.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(e.h2,{id:"select-",children:"SELECT *"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4E0D\u5305\u542B MATERIALIZED \u548C ALIAS"}),"\n",(0,s.jsx)(e.li,{children:"\u5927\u6570\u636E\u91CF\u65F6\u5F88\u5C11\u4F7F\u7528"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"cannot-iterate-over-non-finalized-columnobject",children:"Cannot iterate over non-finalized ColumnObject"}),"\n",(0,s.jsx)(e.p,{children:"JSON \u5217\u6709\u95EE\u9898"}),"\n",(0,s.jsx)(e.h2,{id:"memory-limit-for-query-exceeded",children:"Memory limit (for query) exceeded"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"max_memory_usage=10GB"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u9700\u8981\u5168\u90E8\u6570\u636E\u52A0\u8F7D\u5230\u5185\u5B58\u57FA\u4E8E PK \u6392\u5E8F\nINSERT INTO table\nSELECT x,y,z FROM source;\n\n-- \u6392\u67E5\nSHOW PROCESSLIST;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"set max_block_size=512, max_threads=1, max_rows_to_read=512;"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"sqlite-database-file-path-must-be-inside-user_files-directory-path_access_denied",children:"SQLite database file path must be inside 'user_files' directory. (PATH_ACCESS_DENIED)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9ED8\u8BA4 /var/lib/clickhouse/user_files/"}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#server_configuration_parameters-user_files_path",children:"https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#server_configuration_parameters-user_files_path"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"to-execute-this-query-its-necessary-to-have-grant-create-user-on",children:"To execute this query it's necessary to have grant CREATE USER ON"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["users.xml\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"<access_management>1</access_management>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"final",children:"FINAL"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- force collapsing, dedup, operation\nSELECT * FROM events FINAL;\n"})}),"\n",(0,s.jsx)(e.h1,{id:"snippets",children:"Snippets"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"SET describe_extend_object_types=1\nDESCRIBE tab\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"TableSize"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT table,\n       formatReadableSize(sum(bytes_on_disk))           as disk_size,\n       formatReadableSize(sum(data_compressed_bytes))   as compressed_size,\n       formatReadableSize(sum(data_uncompressed_bytes)) as uncompressed_size,\n       min(min_date)                                    as min_date,\n       max(max_date)                                    as max_date\nFROM system.parts\nWHERE active\nGROUP BY table\nORDER BY sum(bytes_on_disk) DESC;\n"})})]})}function x(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},17776:function(n,e,i){i.d(e,{R:()=>c,x:()=>d});var l=i(7378);let s={},r=l.createContext(s);function c(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);