"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["945856"],{617599:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>h,metadata:()=>r,assets:()=>o,contentTitle:()=>d});var r=JSON.parse('{"id":"web/editor/craftjs","title":"craft.js","description":"- prevwong/craft.js","source":"@site/../notes/web/editor/craftjs.md","sourceDirName":"web/editor","slug":"/web/editor/craftjs","permalink":"/notes/web/editor/craftjs","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/editor/craftjs.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"craft.js"},"sidebar":"docs","previous":{"title":"CodeMirror","permalink":"/notes/web/editor/codemirror"},"next":{"title":"Draftjs","permalink":"/notes/web/editor/draftjs"}}'),t=s(486106),i=s(917776);let l={title:"craft.js"},d="craft.js",o={},c=[{value:"Internal",id:"internal",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Failed to execute &#39;contains&#39; on &#39;Node&#39;: parameter 1 is not of type &#39;Node&#39;.",id:"failed-to-execute-contains-on-node-parameter-1-is-not-of-type-node",level:3},{value:"Input Cursor Jump (Reverse)",id:"input-cursor-jump-reverse",level:3}];function a(e){let n={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"craftjs",children:"craft.js"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/prevwong/craft.js",children:"prevwong/craft.js"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MIT, React"}),"\n",(0,t.jsx)(n.li,{children:"drag and drop page editors"}),"\n",(0,t.jsx)(n.li,{children:"\u7F16\u8F91\u6A21\u5F0F\u5BF9\u73B0\u6709\u7EC4\u4EF6\u4FB5\u5165"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["@craftjs/core\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"150kb - self 30kb + @craftjs/utils 13kb + lodash 96kb + immer + nanoid"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/prevwong/reka.js",children:"prevwong/reka.js"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u65B0\u7684\u72B6\u6001\u7BA1\u7406+\u5E8F\u5217\u5316"}),"\n",(0,t.jsx)(n.li,{children:"mobx"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5BF9\u73B0\u6709\u7EC4\u4EF6\u4FB5\u5165"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.del,{children:["\u6682\u4E0D\u652F\u6301 Reaact 18 StrictMode ",(0,t.jsx)(n.a,{href:"https://github.com/prevwong/craft.js/issues/404",children:"#404"})]})}),"\n"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:'import React from "react";\nimport {Editor, Frame, Canvas, Selector} from "@craftjs/core";\n\nconst TextComponent = ({text}) => {\n  const { connectors: { connect, drag }, isClicked, actions: {setProp} } = useNode(\n    (state) => ({\n      isClicked: state.event.selected,\n    })\n  );\n\n  return (\n    <div ref={dom => connect(drag(dom))}>\n      <h2>{text}</h2>\n      {\n        isClicked ? (\n          <Modal>\n            <input\n              type="text"\n              value={text}\n              onChange={e => setProp(e.target.value)}\n            />\n          </Modal>\n        )\n      }\n    </div>\n  )\n}\n\nconst Container = () => {\n  const { actions: {add}, query: { createNode, node } } = useEditor();\n  const { id, connectors: {drag, connect} } = useNode();\n  return (\n    <div ref={dom => connect(drag(dom))}>\n      <a onClick={() => {\n        const { data: {type, props}} = node(id).get();\n        add(\n          createNode(React.createElement(type, props));\n        );\n      }}>\n        Make a copy of me\n      </a>\n    </div>\n  )\n}\n\nconst SaveButton = () => {\n  const { query } = useEditor();\n  return <a onClick={() => console.log(query.serialize()) }>Get JSON</a>\n}\n\nconst App = () => {\n  return (\n    <div>\n      <header>Editor</header>\n      <Editor>\n        <Frame resolver={{TextComponent, Container}}>\n          <Canvas>\n            <TextComponent text="I\'m already rendered here" />\n          </Canvas>\n        </Frame>\n        <SaveButton/>\n      </Editor>\n    </div>\n  )\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"internal",children:"Internal"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["useMethos \u57FA\u4E8E ",(0,t.jsx)(n.a,{href:"https://github.com/pelotom/use-methods",children:"pelotom/use-methods"})," \u505A\u4E86\u4E00\u5B9A\u8C03\u6574\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u52A0\u4E86 QueryMethods - \u7528\u4E8E\u67E5\u8BE2\u72B6\u6001"}),"\n",(0,t.jsx)(n.li,{children:"\u52A0\u4E86\u72B6\u6001\u8BA2\u9605\u673A\u5236"}),"\n",(0,t.jsxs)(n.li,{children:["\u539F\u59CB userMethods \u8FD4\u56DE ",(0,t.jsx)(n.code,{children:"[state, callbacks]"}),", \u73B0\u5728\u7684\u8FD4\u56DE ",(0,t.jsx)(n.code,{children:"[actions, query, watcher, getState]"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u7406\u89E3 ",(0,t.jsx)(n.code,{children:"useMethos"})," \u5BF9\u770B\u61C2 useEditor \u548C useNode \u975E\u5E38\u6709\u5E2E\u52A9"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Editor\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u914D\u7F6E\u9879\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"onRender - \u6E32\u67D3 hoc"}),"\n",(0,t.jsx)(n.li,{children:"resolver - \u7EC4\u4EF6\u5217\u8868"}),"\n",(0,t.jsx)(n.li,{children:"enabled - \u662F\u5426\u542F\u7528\u7F16\u8F91"}),"\n",(0,t.jsx)(n.li,{children:"indicator - \u7EBF\u6761\u989C\u8272 - success \u548C error"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u72B6\u6001\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"nodes - \u6240\u6709\u8282\u70B9"}),"\n",(0,t.jsx)(n.li,{children:"events - \u4E8B\u4EF6\u72B6\u6001"}),"\n",(0,t.jsx)(n.li,{children:"options - \u914D\u7F6E\u9879"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["API \u901A\u8FC7 useMethods \u5B9E\u73B0 - actions\u3001queries\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4E3B\u8981\u662F\u7EF4\u62A4 node \u7684\u7ED3\u6784 - \u589E\u3001\u5220\u3001\u6539\u3001\u67E5"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Events\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'\u4E8B\u4EF6\u5904\u7406 - "select" | "hover" | "drag" | "drop" | "create"'}),"\n",(0,t.jsx)(n.li,{children:"\u7EF4\u62A4\u8282\u70B9\u4E0A\u7684\u4E8B\u4EF6\u72B6\u6001"}),"\n",(0,t.jsx)(n.li,{children:"\u7EF4\u62A4 drop \u7684 \u6807\u8BC6\u52A8\u753B"}),"\n",(0,t.jsx)(n.li,{children:"\u903B\u8F91\u76F8\u5BF9\u590D\u6742"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"NodeElement \u4F1A\u57FA\u4E8E id \u5BF9\u8282\u70B9\u8FDB\u884C memo"}),"\n",(0,t.jsx)(n.li,{children:"NodeHandlers \u4F1A\u4ECE\u4E8B\u4EF6\u673A\u5236\u884D\u751F\u51FA\u9488\u5BF9\u8282\u70B9\u7684\u4E8B\u4EF6\u5904\u7406"}),"\n",(0,t.jsxs)(n.li,{children:["Canvas\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u66FF\u4EE3\u7EC4\u4EF6\uFF0C\u76F8\u5F53\u4E8E\u7EC4\u4EF6\u7684 decorator\u3001hoc"}),"\n",(0,t.jsx)(n.li,{children:"\u521D\u59CB\u5316\u5185\u90E8\u7EC4\u4EF6"}),"\n",(0,t.jsx)(n.li,{children:"\u7EF4\u62A4 ID \u6620\u5C04\u5173\u7CFB"}),"\n",(0,t.jsx)(n.li,{children:"\u4F9D\u8D56 internalEditor \u548C internalNode \u7EF4\u62A4\u72B6\u6001"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["useInternalNode\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4ECE NodeContext \u66B4\u9732\u989D\u5916\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["NodeContext\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5305\u542B id, related, connectors"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["UserComponent\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9644\u52A0\u989D\u5916\u914D\u7F6E\u4FE1\u606F\u7684\u7EC4\u4EF6"}),"\n",(0,t.jsx)(n.li,{children:"name"}),"\n",(0,t.jsx)(n.li,{children:"rules - \u63A7\u5236\u62D6\u62C9\u884C\u4E3A"}),"\n",(0,t.jsx)(n.li,{children:"related"}),"\n",(0,t.jsx)(n.li,{children:"defaultProps"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Node - \u8282\u70B9\u4FE1\u606F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"id"}),"\n",(0,t.jsx)(n.li,{children:"data"}),"\n",(0,t.jsx)(n.li,{children:"events - selected\u3001dragged\u3001hovered"}),"\n",(0,t.jsx)(n.li,{children:"dom"}),"\n",(0,t.jsx)(n.li,{children:"related"}),"\n",(0,t.jsx)(n.li,{children:"rules - canDrag\u3001canMoveIn\u3001canMoveOut"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["NodeData - \u8282\u70B9\u6570\u636E\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"props"}),"\n",(0,t.jsx)(n.li,{children:"type"}),"\n",(0,t.jsx)(n.li,{children:"name"}),"\n",(0,t.jsx)(n.li,{children:"displayName"}),"\n",(0,t.jsx)(n.li,{children:"isCanvas"}),"\n",(0,t.jsx)(n.li,{children:"parent"}),"\n",(0,t.jsx)(n.li,{children:"index"}),"\n",(0,t.jsx)(n.li,{children:"nodes"}),"\n",(0,t.jsx)(n.li,{children:"hidden"}),"\n",(0,t.jsx)(n.li,{children:"custom"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u5E8F\u5217\u5316\u4F1A\u6392\u51FA\u9ED8\u8BA4\u7684 type\u3001props\u3001isCanvas\u3001name \u7136\u540E\u5E8F\u5217\u5316\u7EC4\u4EF6"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://craft.js.org/r/docs/acknowledgements/",children:"Acknowledgements"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://craft.js.org/r/docs/concepts/nodes/",children:"Concepts: Nodes"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"failed-to-execute-contains-on-node-parameter-1-is-not-of-type-node",children:"Failed to execute 'contains' on 'Node': parameter 1 is not of type 'Node'."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7ED1\u5B9A\u7684\u8282\u70B9\u7C7B\u578B\u4E0D\u5BF9"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"input-cursor-jump-reverse",children:"Input Cursor Jump (Reverse)"}),"\n",(0,t.jsxs)(n.p,{children:["This happens in React when you have a ",(0,t.jsx)(n.code,{children:"contentEditable"})," element which consumes a state/prop, and you update that state/prop ",(0,t.jsx)(n.code,{children:"onKeyUp"}),". When the state/prop value changes, React will re-render the element again, thus you'll lose the caret position."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Solution: Use ",(0,t.jsx)(n.a,{href:"https://github.com/lovasoa/react-contenteditable",children:"react-contenteditable"})," component to solve this issue."]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},917776:function(e,n,s){s.d(n,{R:()=>l,x:()=>d});var r=s(7378);let t={},i=r.createContext(t);function l(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);