"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["754512"],{274195:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>i,default:()=>p,metadata:()=>s,assets:()=>o,contentTitle:()=>c});var s=JSON.parse('{"id":"devops/kubernetes/app/app-cookbook","title":"K8S Apps","description":"debug","source":"@site/../notes/devops/kubernetes/app/app-cookbook.md","sourceDirName":"devops/kubernetes/app","slug":"/devops/kubernetes/app/cookbook","permalink":"/notes/devops/kubernetes/app/cookbook","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/app/app-cookbook.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1609350815000,"frontMatter":{"id":"app-cookbook","title":"K8S Apps"},"sidebar":"docs","previous":{"title":"Kubernetes App Essentials","permalink":"/notes/devops/kubernetes/app/"},"next":{"title":"Argo","permalink":"/notes/devops/kubernetes/app/argo/"}}'),a=r(486106),t=r(917776);let l={id:"app-cookbook",title:"K8S Apps"},c,o={},i=[{value:"debug",id:"debug",level:2},{value:"helm",id:"helm",level:2},{value:"metallb",id:"metallb",level:2},{value:"cert-manager",id:"cert-manager",level:2},{value:"ingress-nginx",id:"ingress-nginx",level:2},{value:"rancher",id:"rancher",level:2}];function d(e){let n={code:"code",h2:"h2",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"debug",children:"debug"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get pod -w --all-namespaces\nkubectl get events -w --all-namespaces\n\nsource <(kubectl completion bash)\nsource <(helm completion bash)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"helm",children:"helm"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# alpine 3.12 \u5B89\u88C5 helm\napk add helm -X https://mirrors.aliyun.com/alpine/edge/testing/\n\n# K3S\nexport KUBECONFIG=/etc/rancher/k3s/k3s.yaml\n\nhelm repo add wener https://charts.wener.tech\nhelm search repo wener/\n\n# \u8865\u5168\nsource <(helm completion bash)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"metallb",children:"metallb"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# registry \u9ED8\u8BA4\u5199\u4E86 docker.io\ncat <<YAML > metallb.values.yaml\ncontroller:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nspeaker:\n  image:\n    registry: docker.mirrors.ustc.edu.cn\nconfigInline:\n  address-pools:\n  - name: default\n    protocol: layer2\n    # default address space\n    addresses:\n    - 10.10.128.0/18\nYAML\n\nhelm upgrade -i metallb wener/metallb -n metallb-system --create-namespace -f metallb.values.yaml\n"})}),"\n",(0,a.jsx)(n.h2,{id:"cert-manager",children:"cert-manager"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# direct install crd\ncat <<YAML > cert-manager.values.yaml\ninstallCRDs: true\nYAML\n\nhelm upgrade -i cert-manager wener/cert-manager -n cert-manager --create-namespace -f cert-manager.values.yaml\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ingress-nginx",children:"ingress-nginx"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# DaemonSet hostPort 80\ncat <<YAML > ingress-nginx.values.yaml\nconfig:\n  hide-headers: "Server"\ncontroller:\n  image:\n    # use mirror\n    # k8s.gcr.io/ingress-nginx/controller\n    repository: registry.cn-hongkong.aliyuncs.com/cmi/ingress-nginx_controller\n    # disable digest\n    digest: ""\n  kind: DaemonSet\n  hostPort:\n    enabled: true\n  metrics:\n    enabled: false\n    # kube-prometheus\n    serviceMonitor:\n      enabled: true\n  prometheusRule:\n    enabled: false\n  admissionWebhooks:\n    patch:\n      image:\n        repository: registry.cn-hongkong.aliyuncs.com/cmi/jettech_kube-webhook-certgen\nYAML\n\nhelm upgrade -i ingress-nginx wener/ingress-nginx -n ingress-nginx --create-namespace -f ingress-nginx.values.yaml\n'})}),"\n",(0,a.jsx)(n.h2,{id:"rancher",children:"rancher"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\n# latest\n# helm repo add rancher https://releases.rancher.com/server-charts/latest\n# stable\nhelm repo add rancher https://releases.rancher.com/server-charts/stable\n\n# https://rancher.com/docs/rancher/v2.x/en/installation/resources/chart-options\ncat <<YAML > rancher.values.yaml\nhostname: rancher.my.corp\n\n# use cert-manager\n# privateCA: true\n# rancher mirror\nsystemDefaultRegistry: registry.cn-hangzhou.aliyuncs.com\n# 1 for test only - default 3\nreplicas: 1\nYAML\n\nhelm upgrade -i rancher rancher/rancher -n cattle-system --create-namespace -f rancher.values.yaml\n\n# \u67E5\u770B\u5B89\u88C5\u72B6\u6001\nkubectl -n cattle-system rollout status deploy/rancher\n# \u9A8C\u8BC1\u5B89\u88C5\nkubectl -n cattle-system get deploy rancher\n\n# \u8F6C\u53D1\u8BBF\u95EE rancher\nkubectl port-forward -n cattle-system svc/rancher --address 0.0.0.0 8080:80\n"})})]})}function p(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},917776:function(e,n,r){r.d(n,{R:()=>l,x:()=>c});var s=r(7378);let a={},t=s.createContext(a);function l(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);