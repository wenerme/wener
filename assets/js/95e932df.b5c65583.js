"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["457107"],{813579:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>i,toc:()=>c,default:()=>j,metadata:()=>s,assets:()=>a,contentTitle:()=>l});var s=JSON.parse('{"id":"web/script/lib/ajv","title":"ajv","description":"- ajv-validator/ajv","source":"@site/../notes/web/script/lib/ajv.md","sourceDirName":"web/script/lib","slug":"/web/script/lib/ajv","permalink":"/notes/web/script/lib/ajv","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/script/lib/ajv.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1745546888000,"frontMatter":{"title":"ajv"},"sidebar":"docs","previous":{"title":"acorn","permalink":"/notes/web/script/lib/acorn"},"next":{"title":"awilix","permalink":"/notes/web/script/lib/awilix"}}'),d=r(486106),t=r(917776);let i={title:"ajv"},l="ajv",a={},c=[{value:"standalone validation code",id:"standalone-validation-code",level:2},{value:"addKeyword",id:"addkeyword",level:2},{value:"due to error strict mode: unknown keyword",id:"due-to-error-strict-mode-unknown-keyword",level:2},{value:"ajv schema with key or id already exists",id:"ajv-schema-with-key-or-id-already-exists",level:2},{value:"strict mode: unknown keyword",id:"strict-mode-unknown-keyword",level:2},{value:"\u4FEE\u6539\u6821\u9A8C\u6570\u636E",id:"\u4FEE\u6539\u6821\u9A8C\u6570\u636E",level:2}];function h(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"ajv",children:"ajv"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.a,{href:"https://github.com/ajv-validator/ajv",children:"ajv-validator/ajv"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"JSON Schema \u6821\u9A8C"}),"\n",(0,d.jsxs)(n.li,{children:["\u652F\u6301 JTD serialize/parse\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u7C7B\u4F3C\u4E8E ",(0,d.jsx)(n.a,{href:"https://github.com/fastify/fast-json-stringify",children:"fastify/fast-json-stringify"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.a,{href:"https://github.com/ajv-validator/ajv-keywords",children:"ajv-validator/ajv-keywords"}),"\n\u589E\u52A0\u81EA\u5B9A\u4E49\u5173\u952E\u5B57\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"typeof, instanceof"}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.del,{children:"select, selectCases, selectDefault"})," -> discriminator"]}),"\n",(0,d.jsx)(n.li,{children:"dynamicDefaults"}),"\n",(0,d.jsx)(n.li,{children:"number: range, exclusiveRange"}),"\n",(0,d.jsxs)(n.li,{children:["string: regexp, transform\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"transform \u5141\u8BB8\u9A8C\u8BC1\u65F6\u4FEE\u6539\u5B57\u7B26\u4E32\u5185\u5BB9"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"array: uniqueItemProperties"}),"\n",(0,d.jsx)(n.li,{children:"object: allRequired, anyRequired, oneRequired, patternRequired, prohibited, deepProperties, deepRequired"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://ajv.js.org/json-schema.html",children:"https://ajv.js.org/json-schema.html"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://validatejs.org/",children:"https://validatejs.org/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.admonition,{type:"caution",children:(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u4E0D\u80FD\u6269\u5C55 type"}),"\n",(0,d.jsxs)(n.li,{children:["additionalProperties \u4E0D\u80FD\u9ED8\u8BA4\u4E3A false\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/ajv-validator/ajv/issues/634",children:"ajv-validator/ajv#634"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm add ajv ajv-formats ajv-keywords ajv-errors\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import addFormats from 'ajv-formats';\nimport addKeywords from 'ajv-keywords';\nimport Ajv2020 from 'ajv/dist/2020';\n\nconst ajv = new Ajv2020();\naddFormats(ajv);\naddKeywords(ajv);\n\n// \u6DFB\u52A0\u81EA\u5B9A\u4E49 keyword \u907F\u514D\u5931\u8D25\najv.addKeyword('x-meta');\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"format"}),(0,d.jsx)(n.th,{children:"example"}),(0,d.jsx)(n.th,{children:"description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"ajv-formats"})}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"date"}),(0,d.jsx)(n.td,{children:"2021-01-01"}),(0,d.jsx)(n.td,{children:"RFC3339 full-date"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"time"}),(0,d.jsx)(n.td,{children:"14:30:00+01:00"}),(0,d.jsx)(n.td,{children:"time with optional time-zone."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"date-time"}),(0,d.jsx)(n.td,{children:"2021-01-01T14:30:00+01:00"}),(0,d.jsx)(n.td,{children:"date-time from the same source (time-zone is mandatory)."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"duration"}),(0,d.jsx)(n.td,{children:"P3Y6M4DT12H30M5S"}),(0,d.jsx)(n.td,{children:"RFC3339 duration"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"uri"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.a,{href:"https://example.com",children:"https://example.com"})}),(0,d.jsx)(n.td,{children:"full URI."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"uri-reference"}),(0,d.jsx)(n.td,{children:"/relative/uri"}),(0,d.jsx)(n.td,{children:"URI reference, including full and relative URIs."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"uri-template"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.a,{href:"https://example.com/%7Buser%7D",children:"https://example.com/{user}"})}),(0,d.jsx)(n.td,{children:"RFC6570 URI template"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.del,{children:"url"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.a,{href:"https://example.com",children:"https://example.com"})}),(0,d.jsx)(n.td,{children:"URL record"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"email"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.a,{href:"mailto:user@example.com",children:"user@example.com"})}),(0,d.jsx)(n.td,{children:"email address."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"hostname"}),(0,d.jsx)(n.td,{children:"example.com"}),(0,d.jsx)(n.td,{children:"RFC1034 host name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ipv4"}),(0,d.jsx)(n.td,{children:"192.168.0.1"}),(0,d.jsx)(n.td,{children:"IPv4"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ipv6"}),(0,d.jsx)(n.td,{children:"2001:0db8:85a3:0000:0000:8a2e:0370:7334"}),(0,d.jsx)(n.td,{children:"IPv6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"regex"}),(0,d.jsx)(n.td,{children:"^[a-zA-Z0-9]+$"}),(0,d.jsx)(n.td,{children:"RegExp"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"uuid"}),(0,d.jsx)(n.td,{children:"123e4567-e89b-12d3-a456-426614174000"}),(0,d.jsx)(n.td,{children:"RFC4122 UUID"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"json-pointer"}),(0,d.jsx)(n.td,{children:"/pointer"}),(0,d.jsx)(n.td,{children:"RFC6901 JSON-pointer"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"relative-json-pointer"}),(0,d.jsx)(n.td,{children:"0"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/draft-luff-relative-json-pointer-00",children:"draft"})," relative JSON-pointer"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"ajv-formats-draft2019"})}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"iri"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.a,{href:"https://%E4%BE%8B%E5%AD%90.%E6%B5%8B%E8%AF%95",children:"https://\u4F8B\u5B50.\u6D4B\u8BD5"})}),(0,d.jsx)(n.td,{children:"RFC3987 IRN/Internationalized Resource Identifier"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"iri-reference"}),(0,d.jsx)(n.td,{children:"/relative/\u8DEF\u5F84"}),(0,d.jsx)(n.td,{children:"IRI reference, including full and relative IRIs."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"idn-hostname"}),(0,d.jsx)(n.td,{children:"\u4F8B\u5B50.\u6D4B\u8BD5"}),(0,d.jsx)(n.td,{children:"RFC5890 IDN/Internationalized Domain Name hostname"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"idn-email"}),(0,d.jsx)(n.td,{children:"\u7528\u6237@\u4F8B\u5B50.\u6D4B\u8BD5"}),(0,d.jsx)(n.td,{children:"RFC6531 Internationalized email address"})]})]})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"// \u81EA\u5B9A\u4E49 format\najv.addFormat('identifier', /^a-z\\$_[a-zA-Z$_0-9]*$/);\n// \u4F7F\u7528\u81EA\u5B9A\u4E49\u903B\u8F91\u6821\u9A8C format\najv.addFormat('byte', {\n  type: 'number',\n  validate: (x) => x >= 0 && x <= 255 && x % 1 == 0,\n});\najv.addFormat('int8', {\n  type: 'number',\n  validate: (x) => x >= -128 && x <= 127 && Number.isInteger(x),\n});\n"})}),"\n",(0,d.jsx)(n.h2,{id:"standalone-validation-code",children:"standalone validation code"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u751F\u6210\u72EC\u7ACB\u7684\u51FD\u6570"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm install -g ajv-cli\najv compile -s schema.json -o validate_schema.js\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://ajv.js.org/standalone.html",children:"https://ajv.js.org/standalone.html"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"addkeyword",children:"addKeyword"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://ajv.js.org/keywords.html",children:"https://ajv.js.org/keywords.html"})}),"\n"]}),"\n",(0,d.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,d.jsx)(n.h2,{id:"due-to-error-strict-mode-unknown-keyword",children:"due to error strict mode: unknown keyword"}),"\n",(0,d.jsx)(n.h2,{id:"ajv-schema-with-key-or-id-already-exists",children:"ajv schema with key or id already exists"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C schema \u6709 ",(0,d.jsx)(n.code,{children:"$id"})," \u53EF\u80FD\u4F1A\u51FA\u73B0"]}),"\n",(0,d.jsx)(n.li,{children:"\u5982\u679C schema \u662F\u901A\u8FC7\u53CD\u5E8F\u5217\u5316\u751F\u6210\u7684\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u91CD\u590D - ref \u4E0D\u4E00\u6837\u4F46 id \u4E00\u6837"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"strict-mode-unknown-keyword",children:"strict mode: unknown keyword"}),"\n",(0,d.jsx)(n.p,{children:"\u672A\u77E5\u5173\u952E\u5B57\uFF0C\u9700\u8981\u6DFB\u52A0\u5173\u952E\u5B57\u652F\u6301"}),"\n",(0,d.jsx)(n.h2,{id:"\u4FEE\u6539\u6821\u9A8C\u6570\u636E",children:"\u4FEE\u6539\u6821\u9A8C\u6570\u636E"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"\u7C7B\u4F3C zod.parse \u80FD\u5F97\u5230\u4E00\u4E2A\u89E3\u6790\u540E\u7684\u6EE1\u8DB3\u9A8C\u8BC1\u8981\u6C42\u7684\u5BF9\u8C61\uFF0C\u4E0D\u8FC7 zod \u4E0D\u4F1A\u4FEE\u6539\u4F20\u5165\u5BF9\u8C61\uFF0Cajv \u53EA\u80FD\u901A\u8FC7\u4FEE\u6539\u4F20\u5165\u5BF9\u8C61\u5B9E\u73B0\uFF0C\u8FD9\u4E00\u70B9\u4E0A ajv \u6027\u80FD\u66F4\u597D"}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u79FB\u9664\u989D\u5916"}),"\n",(0,d.jsx)(n.li,{children:"\u6DFB\u52A0 defaults"}),"\n",(0,d.jsx)(n.li,{children:"\u5F3A\u5236\u7C7B\u578B\u8F6C\u6362"}),"\n",(0,d.jsxs)(n.li,{children:["coerceTypes=true|'array'\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["array \u652F\u6301 ",(0,d.jsx)(n.code,{children:"x"})," <-> ",(0,d.jsx)(n.code,{children:"[x]"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"const ajv = new Ajv({ removeAdditional: true, useDefaults: true, coerceTypes: 'array' });\n\nconst schema = {\n  type: 'object',\n  additionalProperties: false,\n  properties: {\n    foo: { type: 'array', items: { type: 'number' } },\n    bar: { type: 'boolean' },\n    num: { type: 'number' },\n    name: { type: 'string', default: 'wener' },\n  },\n};\n\nconst data = { foo: '1', bar: 'false', rm: true, num: '10' };\n\nconst validate = ajv.compile(schema);\n\n// true\nconsole.log(validate(data));\n// {foo: [1], bar: false, num: 10, name: \"wener\"}\nconsole.log(data);\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://runkit.com/npm/ajv",children:"https://runkit.com/npm/ajv"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://ajv.js.org/guide/modifying-data.html",children:"https://ajv.js.org/guide/modifying-data.html"})}),"\n"]})]})}function j(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},917776:function(e,n,r){r.d(n,{R:()=>i,x:()=>l});var s=r(7378);let d={},t=s.createContext(d);function i(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);