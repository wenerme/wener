"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["1695"],{38586:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>h,metadata:()=>t,assets:()=>o,contentTitle:()=>r});var t=JSON.parse('{"id":"db/relational/mysql/README","title":"MySQL","description":"- Common MySQL Queries","source":"@site/../notes/db/relational/mysql/README.md","sourceDirName":"db/relational/mysql","slug":"/db/relational/mysql/","permalink":"/notes/db/relational/mysql/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/mysql/README.md","tags":[{"inline":true,"label":"Topic","permalink":"/notes/tags/topic"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1726657654000,"frontMatter":{"title":"MySQL","tags":["Topic"]},"sidebar":"docs","previous":{"title":"MSSQL","permalink":"/notes/db/relational/mssql/"},"next":{"title":"MySQL CLI","permalink":"/notes/db/relational/mysql/mysq-cli"}}'),s=l(86106),i=l(17776);let a={title:"MySQL",tags:["Topic"]},r="MySQL",o={},c=[{value:"mysql cli",id:"mysql-cli",level:3},{value:"FAQ",id:"faq",level:2},{value:"[1071] - Specified key was too long; max key length is 767 bytes",id:"1071---specified-key-was-too-long-max-key-length-is-767-bytes",level:3},{value:"Got a packet bigger than &#39;max_allowed_packet&#39; bytes",id:"got-a-packet-bigger-than-max_allowed_packet-bytes",level:3},{value:"\u5FEB\u901F\u6570\u636E\u5BFC\u5165",id:"\u5FEB\u901F\u6570\u636E\u5BFC\u5165",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"mysql",children:"MySQL"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://www.artfulsoftware.com/infotree/queries.php",children:"Common MySQL Queries"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u7528\u6237\u53EF\u767B\u9646\u72B6\u51B5\nselect host,user from mysql.user;\n\n-- \u8BBE\u7F6E binlog \u8D85\u65F6\u65F6\u95F4\nSET GLOBAL expire_logs_days=7\n\n-- \u67E5\u770B\u6240\u6709\u7684 binlog\nSHOW BINARY LOGS;\n-- \u6E05\u9664\u4E00\u4E2A binlog \u6587\u4EF6\nPURGE BINARY LOGS TO 'mysql-bin.00123';\n-- \u6E05\u7A7A\u6240\u6709 binlog\nPURGE BINARY LOGS BEFORE NOW();\n\n-- \u67E5\u770B\u7528\u6237\nSELECT User,host FROM mysql.user;\n\n-- \u521B\u5EFA\u7528\u6237\nCREATE USER 'wener'@'localhost' IDENTIFIED BY 'qaz';\nGRANT ALL PRIVILEGES ON *.* TO 'wener'@'localhost' WITH GRANT OPTION;\n\n-- \u521B\u5EFA\u4E00\u4E2A\u53EF\u4EE5\u8FDC\u7A0B\u4F7F\u7528\u7684\u8D26\u6237\nCREATE USER 'root'@'%' IDENTIFIED BY 'root';\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'%';\nGRANT ALL PRIVILEGES ON cbh.* TO 'root'@'%' identified by 'root' WITH GRANT OPTION;\n\n-- \u8BBE\u7F6E\u5BC6\u7801\nSET PASSWORD FOR 'root'@'%' = PASSWORD('root');\n-- \u5220\u9664\u5BC6\u7801\nSET PASSWORD FOR 'root'@'%' = PASSWORD('');\n\n-- \u4F7F\u6743\u9650\u751F\u6548\nFLUSH PRIVILEGES;\n\n-- \u521B\u5EFA\u7ED3\u6784\u76F8\u540C\u7684\u8868\ncreate table name like old_tab;\ncreate table name select * from old_tab where 1=2;\n\n-- MYSQL \u83B7\u53D6\u6570\u636E\u5E93\u7684\u5927\u5C0F\nSELECT table_schema                                        \"DB Name\",\n   Round(Sum(data_length + index_length) / 1024 / 1024, 2) \"DB Size in MB\"\nFROM   information_schema.tables\nGROUP  BY table_schema;\n\n-- \u53EF\u4EE5\u4F7F\u7528\u73AF\u5883\u53D8\u91CF\u6765\u6307\u5B9A\u5BC6\u7801,\u907F\u514D\u547D\u4EE4\u884C\u4E0A\u7684\u8B66\u544A\n-- MYSQL_PWD=$password\n\n-- \u67E5\u770B\u5F53\u524D\u8FDE\u63A5\u6570\nSHOW STATUS WHERE `variable_name` = 'Threads_connected'\nshow processlist\n"})}),"\n",(0,s.jsx)(n.h3,{id:"mysql-cli",children:"mysql cli"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"source myfile.sql\n"})}),"\n",(0,s.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h3,{id:"1071---specified-key-was-too-long-max-key-length-is-767-bytes",children:"[1071] - Specified key was too long; max key length is 767 bytes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"utf8 3*255 = 765 < 767"}),"\n",(0,s.jsx)(n.li,{children:"utf8mb4 4*191 = 764 < 767"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"INNODB utf8 VARCHAR(255)\nINNODB utf8mb4 VARCHAR(191)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"got-a-packet-bigger-than-max_allowed_packet-bytes",children:"Got a packet bigger than 'max_allowed_packet' bytes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728\u6570\u636E\u5BFC\u5165\u7684\u65F6\u5019\u53EF\u80FD\u4F1A\u9047\u5230"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SET GLOBAL max_allowed_packet=1073741824;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6216\u8005\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"max_allowed_packet=500M\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5FEB\u901F\u6570\u636E\u5BFC\u5165",children:"\u5FEB\u901F\u6570\u636E\u5BFC\u5165"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://dba.stackexchange.com/q/83125",children:"MySQL any way to import a huge (32 GB) sql dump faster?"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u542F\u52A8\u65F6 ",(0,s.jsx)(n.code,{children:"--innodb-doublewrite=0"})," \u7981\u7528 Double Write Buffer, \u5BFC\u5165\u5B8C\u6210\u540E\u6062\u590D"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"innodb_buffer_pool_size = 4G\ninnodb_log_buffer_size = 256M\ninnodb_log_file_size = 1G\ninnodb_write_io_threads = 16\ninnodb_flush_log_at_trx_commit = 0\n"})})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},17776:function(e,n,l){l.d(n,{R:()=>a,x:()=>r});var t=l(7378);let s={},i=t.createContext(s);function a(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);