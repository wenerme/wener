"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["713069"],{303547:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>s,toc:()=>a,default:()=>c,metadata:()=>i,assets:()=>r,contentTitle:()=>d});var i=JSON.parse('{"id":"os/macos/spotlight","title":"Spotlight","description":"- /System/Volumes/Data/.Spotlight-V100","source":"@site/../notes/os/macos/spotlight.md","sourceDirName":"os/macos","slug":"/os/macos/spotlight","permalink":"/notes/os/macos/spotlight","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/macos/spotlight.md","tags":[{"inline":true,"label":"Daemon","permalink":"/notes/tags/daemon"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1739770930000,"frontMatter":{"tags":["Daemon"]},"sidebar":"docs","previous":{"title":"pmset","permalink":"/notes/os/macos/pmset"},"next":{"title":"MIPS \u67B6\u6784","permalink":"/notes/os/mips"}}'),l=t(486106),o=t(917776);let s={tags:["Daemon"]},d="Spotlight",r={},a=[{value:"mds_stores",id:"mds_stores",level:2},{value:"spotlightknowledged high CPU",id:"spotlightknowledged-high-cpu",level:2}];function h(e){let n={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"spotlight",children:"Spotlight"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/System/Volumes/Data/.Spotlight-V100"}),"\n",(0,l.jsx)(n.li,{children:"/System/Volumes/Data/.Spotlight-V100/VolumeConfiguration.plist"}),"\n",(0,l.jsx)(n.li,{children:"/.Spotlight-V100/Store-V1/Exclusions.plist"}),"\n",(0,l.jsx)(n.li,{children:"/.Spotlight-V100/VolumeConfiguration.plist"}),"\n",(0,l.jsx)(n.li,{children:"mdutil"}),"\n",(0,l.jsx)(n.li,{children:"mdfind"}),"\n",(0,l.jsx)(n.li,{children:"mdimport"}),"\n",(0,l.jsx)(n.li,{children:"mdls"}),"\n",(0,l.jsx)(n.li,{children:"mds_stores"}),"\n",(0,l.jsx)(n.li,{children:"mds"}),"\n",(0,l.jsx)(n.li,{children:"mdbulkimport"}),"\n",(0,l.jsx)(n.li,{children:"mdflagwriter"}),"\n",(0,l.jsx)(n.li,{children:"mdsync"}),"\n",(0,l.jsx)(n.li,{children:"mdworker"}),"\n",(0,l.jsx)(n.li,{children:"mdworker_shared"}),"\n",(0,l.jsx)(n.li,{children:"mdwrite"}),"\n",(0,l.jsx)(n.li,{children:"mddiagnose"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"kMD*"})}),"\n",(0,l.jsxs)(n.li,{children:["\u7279\u6B8A\u6587\u4EF6\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"*.noIndex"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.del,{children:".metadata_never_index"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.del,{children:".nosync"})," - iCloud \u4E0D\u540C\u6B65"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mdutil -as  # \u6240\u6709 Volume \u7684\u72B6\u6001\nmdutil -s / # \u6307\u5B9A Volume \u7684\u72B6\u6001\n\n# \u8BBF\u95EE\u60C5\u51B5\nsudo fs_usage -w | grep Spotlight\n\n# \u91CD\u542F Spotlight\n# Not privileged to stop service.\nsudo launchctl stop com.apple.metadata.mds\nsudo launchctl start com.apple.metadata.mds\n\nsudo mdutil -a -i off # \u5173\u95ED\u7D22\u5F15\nsudo mdutil -a -i on  # \u91CD\u65B0\u5F00\u542F\u7D22\u5F15\n\nsudo mdutil -i off /Volumes/YourDisk # \u5173\u95ED\u6307\u5B9A\u78C1\u76D8\u7D22\u5F15\n\nsudo mdutil -Ea # \u91CD\u5EFA\u7D22\u5F15\n\n# sudo mdutil -i off $HOME # \u6392\u9664\u76EE\u5F55\n# sudo mdutil -i off /Users/\n# sudo mdutil -i off /private/\n\nsudo mdutil -a -i off # \u5173\u95ED\u6240\u6709\u78C1\u76D8\u7D22\u5F15\n\n# \u5173\u95ED\u670D\u52A1\nsudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist\n\nmdutil -t $PWD\nmdutil -L / # \u5217\u51FA\u7D22\u5F15\u76EE\u5F55\n\n# sudo defaults write /.Spotlight-V100/Store-V1/Exclusions Exclusions -array-add path/to/exclude\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Usage: mdutil -pEsa -i (on|off) -d volume ...\n       mdutil -t {volume-path | deviceid} fileid\n        Utility to manage Spotlight indexes.\n        -i (on|off)    Turn indexing on or off.\n        -d             Disable Spotlight activity for volume (re-enable using -i on).\n        -E             Erase and rebuild index.\n        -s             Print indexing status.\n        -a             Apply command to all stores on all volumes.\n        -t             Resolve files from file id with an optional volume path or device id.\n        -p             Publish metadata.\n        -V vol         Apply command to all stores on the specified volume.\n        -v             Display verbose information.\n        -r plugins     Ask the server to reimport files for UTIs claimed by the listed plugin.\n        -L volume-path List the directory contents of the Spotlight index on the specified volume.\n        -P volume-path Dump the VolumeConfig.plist for the specified volume.\n        -X volume-path Remove the Spotlight index directory on the specified volume.  Does not disable indexing.\n                       Spotlight will reevaluate volume when it is unmounted and remounted, the\n                       machine is rebooted, or an explicit index command such as 'mdutil -i' or 'mdutil -E' is\n                       run for the volume.\nNOTE: Run as owner for network homes, otherwise run as root.\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://developer.apple.com/library/archive/documentation/Carbon/Conceptual/SpotlightQuery/Concepts/QueryFormat.html",children:"https://developer.apple.com/library/archive/documentation/Carbon/Conceptual/SpotlightQuery/Concepts/QueryFormat.html"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"mds_stores",children:"mds_stores"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Spotlight Metadata Server Stores"}),"\n",(0,l.jsx)(n.li,{children:"\u7D22\u5F15\u6587\u4EF6\u65F6\u4F1A\u5360\u7528\u5927\u91CF\u8D44\u6E90"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"spotlightknowledged-high-cpu",children:"spotlightknowledged high CPU"}),"\n",(0,l.jsx)(n.p,{children:"\u6B63\u5728\u7D22\u5F15"})]})}function c(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},917776:function(e,n,t){t.d(n,{R:()=>s,x:()=>d});var i=t(7378);let l={},o=i.createContext(l);function s(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);