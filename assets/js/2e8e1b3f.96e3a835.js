"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["90684"],{201051:function(n,e,a){a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>d});var t=a(248683),r=a(486106),o=a(917776);let s={slug:"ubuntu-home",title:"Ubuntu \u5BB6\u7528"},i="Ubuntu \u5BB6\u7528",l={authorsImageUrls:[]},d=[{value:"caddy.Dockerfile",id:"caddydockerfile",level:3},{value:"grafana.ini",id:"grafanaini",level:3},{value:"prom.yaml",id:"promyaml",level:3},{value:"Caddyfile",id:"caddyfile",level:3}];function c(n){let e={code:"code",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Ubuntu \u684C\u9762\u7248"}),"\n",(0,r.jsxs)(e.li,{children:["\u5B89\u88C5\u81F3\u5C11\u9700\u8981 ",(0,r.jsx)(e.code,{children:"1024*768"})," \u7684\u663E\u793A\u5668"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"apt update\napt upgrade\napt dist-upgrade\n\n# \u684C\u9762\u7248\u6CA1\u6709 sshd\napt install -y openssh-server\n\n############\n# brew\n############\nbrew install gcc redis tmux mosh\n\n############\n# \u5BB9\u5668\u670D\u52A1\u914D\u7F6E\n############\n# \u4F7F\u7528\u963F\u91CC\u63D0\u4F9B\u7684\u4ED3\u5E93\u8FDB\u884C\u5B89\u88C5\u4F1A\u975E\u5E38\u5FEB\ncurl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -\n# \u5B89\u88C5\u5B8C\u6BD5\u540E\u4E3A\u5F53\u524D\u7528\u6237\u6DFB\u52A0\u6743\u9650,\u9700\u8981\u9000\u51FA\u91CD\u65B0\u767B\u5F55\u624D\u80FD\u751F\u6548\nsudo usermod -aG docker $USER\n\n# \u5B89\u88C5\u5B8C\u6210\u5EFA\u8BAE\u9009\u62E9\u4E00\u5BB6\u5BB9\u5668\u955C\u50CF,\u6BD4\u5982 https://cr.console.aliyun.com \u6216\u8005 daocloud\n\ndocker pull gogs/gogs\ndocker network create --subnet=172.18.1.0/24 home-net\n\n# \u51C6\u5907\u6570\u636E\u76EE\u5F55\nsudo mkdir /data\nsudo chown $USER:$USER /data\ncd /data\n\n# ==========\n# \u76D1\u63A7\u914D\u7F6E\n# ==========\ndocker pull grafana/grafana\ndocker pull prom/container-exporter\ndocker pull prom/prometheus\n\ndocker run --net home-net --ip 172.18.1.10 -d --restart always -v /etc/localtime:/etc/localtime:ro \\\n    -v $PWD/grafana:/var/lib/grafana \\\n    -v $PWD/grafana.ini:/etc/grafana/grafana.ini \\\n    --name grafana grafana/grafana\n\nnohup node_exporter 2>node_exporter.log &\n\ndocker run -d --net home-net --ip 172.18.1.21 \\\n    -v /sys/fs/cgroup:/cgroup \\\n    -v /var/run/docker.sock:/var/run/docker.sock \\\n    --name container-exporter prom/container-exporter\n\ndocker run --net home-net --ip 172.18.1.20 -d --restart always -v /etc/localtime:/etc/localtime:ro \\\n    -v $PWD/prom:/prometheus \\\n    -v $PWD/prom.yaml:/etc/prometheus/prometheus.yml \\\n    --name prom prom/prometheus\n\n# Web \u670D\u52A1\n# \u9009\u62E9\u9700\u8981\u7684 Caddy \u63D2\u4EF6\u7528\u4E8E\u6784\u5EFA\u5BB9\u5668\nmkdir -p /tmp/caddy && cd /tmp/caddy\nwget 'https://caddyserver.com/download/build?os=linux&arch=amd64&features=cors%2Cexpires%2Cfilemanager%2Cgit%2Chugo%2Cipfilter%2Cjsonp%2Cjwt%2Clocale%2Cmailout%2Cminify%2Cmultipass%2Cprometheus%2Cratelimit%2Crealip%2Csearch%2Cupload' -O caddy.tar.gz\ntar -zxvf caddy.tar.gz\n\ndocker build -t home/caddy -f caddy.Dockerfile .\ncd -\n\ndocker run --net home-net --ip 172.18.1.30  -d --restart always -v /etc/localtime:/etc/localtime:ro \\\n    -v $PWD/Caddyfile:/etc/Caddyfile \\\n    -v $PWD/caddy:/data \\\n    -v $HOME/.caddy:/root/.caddy \\\n    -p 80:80 -p 443:443 \\\n    --name web home/caddy\n\n\n\n"})}),"\n",(0,r.jsx)(e.h3,{id:"caddydockerfile",children:"caddy.Dockerfile"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Dockerfile",children:'FROM alpine\nMAINTAINER wener <wener@wener.me>\n\nCOPY caddy /app/caddy\n\nVOLUME     [ "/data" ]\nWORKDIR    /data\n\nEXPOSE 2015\nEXPOSE 2000\nENTRYPOINT ["/app/caddy"]\nCMD ["-conf","/etc/Caddyfile","-log","./internal/log"]\n'})}),"\n",(0,r.jsx)(e.h3,{id:"grafanaini",children:"grafana.ini"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:'##################### Grafana Configuration Example #####################\n#\n# Everything has defaults so you only need to uncomment things you want to\n# change\n\n# possible values : production, development\n; app_mode = production\n\n# instance name, defaults to HOSTNAME environment variable value or hostname if HOSTNAME var is empty\n; instance_name = ${HOSTNAME}\n\n#################################### Paths ####################################\n[paths]\n# Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)\n#\n;data = /var/lib/grafana\n#\n# Directory where grafana can store logs\n#\n;logs = /var/log/grafana\n#\n# Directory where grafana will automatically scan and look for plugins\n#\n;plugins = /var/lib/grafana/plugins\n\n#\n#################################### Server ####################################\n[server]\n# Protocol (http or https)\n;protocol = http\n\n# The ip address to bind to, empty will bind to all interfaces\n;http_addr =\n\n# The http port  to use\n;http_port = 3000\n\n# The public facing domain name used to access grafana from a browser\ndomain = d.yikaiye.com\n\n# Redirect to correct domain if host header does not match domain\n# Prevents DNS rebinding attacks\n;enforce_domain = false\n\n# \u4F7F\u7528 /monitor \u4F5C\u4E3A\u8DEF\u5F84,\u4EE5\u4FBF\u4E8E\u53CD\u5411\u4EE3\u7406\n;root_url = %(protocol)s://%(domain)s:%(http_port)s/\nroot_url = /monitor\n\n# Log web requests\n;router_logging = false\n\n# the path relative working path\n;static_root_path = public\n\n# enable gzip\nenable_gzip = true\n\n# https certs & key file\n;cert_file =\n;cert_key =\n\n#################################### Database ####################################\n[database]\n# Either "mysql", "postgres" or "sqlite3", it\'s your choice\n;type = sqlite3\n;host = 127.0.0.1:3306\n;name = grafana\n;user = root\n;password =\n\n# For "postgres" only, either "disable", "require" or "verify-full"\n;ssl_mode = disable\n\n# For "sqlite3" only, path relative to data_path setting\n;path = grafana.db\n\n#################################### Session ####################################\n[session]\n# Either "memory", "file", "redis", "mysql", "postgres", default is "file"\n;provider = file\n\n# Provider config options\n# memory: not have any config yet\n# file: session dir path, is relative to grafana data_path\n# redis: config like redis server e.g. `addr=127.0.0.1:6379,pool_size=100,db=grafana`\n# mysql: go-sql-driver/mysql dsn config string, e.g. `user:password@tcp(127.0.0.1:3306)/database_name`\n# postgres: user=a password=b host=localhost port=5432 dbname=c sslmode=disable\n;provider_config = sessions\n\n# Session cookie name\n;cookie_name = grafana_sess\n\n# If you use session in https only, default is false\n;cookie_secure = false\n\n# Session life time, default is 86400\n;session_life_time = 86400\n\n#################################### Analytics ####################################\n[analytics]\n# Server reporting, sends usage counters to stats.grafana.org every 24 hours.\n# No ip addresses are being tracked, only simple counters to track\n# running instances, dashboard and error counts. It is very helpful to us.\n# Change this option to false to disable reporting.\n;reporting_enabled = true\n\n# Set to false to disable all checks to https://grafana.net\n# for new vesions (grafana itself and plugins), check is used\n# in some UI views to notify that grafana or plugin update exists\n# This option does not cause any auto updates, nor send any information\n# only a GET request to http://grafana.net to get latest versions\ncheck_for_updates = true\n\n# Google Analytics universal tracking code, only enabled if you specify an id here\n;google_analytics_ua_id =\n\n#################################### Security ####################################\n[security]\n# default admin user, created on startup\n;admin_user = admin\n\n# default admin password, can be changed before first start of grafana,  or in profile settings\n;admin_password = admin\n\n# used for signing\n;secret_key = SW2YcwTIb9zpOOhoPsMm\n\n# Auto-login remember days\n;login_remember_days = 7\n;cookie_username = grafana_user\n;cookie_remember_name = grafana_remember\n\n# disable gravatar profile images\n;disable_gravatar = false\n\n# data source proxy whitelist (ip_or_domain:port separated by spaces)\n;data_source_proxy_whitelist =\n\n[snapshots]\n# snapshot sharing options\nexternal_enabled = false\n;external_snapshot_url = https://snapshots-origin.raintank.io\n;external_snapshot_name = Publish to snapshot.raintank.io\n\n#################################### Users ####################################\n[users]\n# \u7981\u7528\u6CE8\u518C\u529F\u80FD\nallow_sign_up = false\n\n# \u4E0D\u5141\u8BB8\u975E\u7BA1\u7406\u5458\u521B\u5EFA\u7EC4\u7EC7\nallow_org_create = false\n\n# Set to true to automatically assign new users to the default organization (id 1)\nauto_assign_org = true\n\n# Default role new users will be automatically assigned (if disabled above is set to true)\nauto_assign_org_role = Viewer\n\n# Background text for the user field on the login page\nlogin_hint = \u7528\u6237\u540D\n\n# Default UI theme ("dark" or "light")\ndefault_theme = light\n\n#################################### Anonymous Auth ##########################\n[auth.anonymous]\n# enable anonymous access\nenabled = false\n\n# specify organization name that should be used for unauthenticated users\n;org_name = Main Org.\n\n# specify role for unauthenticated users\n;org_role = Viewer\n\n#################################### Auth Proxy ##########################\n[auth.proxy]\n;enabled = false\n;header_name = X-WEBAUTH-USER\n;header_property = username\n;auto_sign_up = true\n\n#################################### Basic Auth ##########################\n[auth.basic]\n;enabled = true\n\n#################################### SMTP / Emailing ##########################\n[smtp]\n;enabled = false\n;host = localhost:25\n;user =\n;password =\n;cert_file =\n;key_file =\n;skip_verify = false\n;from_address = admin@grafana.localhost\n\n[emails]\n;welcome_email_on_sign_up = false\n\n#################################### Logging ##########################\n[log]\n# Either "console", "file", "syslog". Default is console and  file\n# Use space to separate multiple modes, e.g. "console file"\n;mode = console, file\n\n# Either "trace", "debug", "info", "warn", "error", "critical", default is "info"\n;level = info\n\n# For "console" mode only\n[log.console]\n;level =\n\n# log line format, valid options are text, console and json\n;format = console\n\n# For "file" mode only\n[log.file]\n;level =\n\n# log line format, valid options are text, console and json\n;format = text\n\n# This enables automated log rotate(switch of following options), default is true\n;log_rotate = true\n\n# Max line number of single file, default is 1000000\n;max_lines = 1000000\n\n# Max size shift of single file, default is 28 means 1 << 28, 256MB\n;max_size_shift = 28\n\n# Segment log daily, default is true\n;daily_rotate = true\n\n# Expired days of log file(delete after max days), default is 7\n;max_days = 7\n\n[log.syslog]\n;level =\n\n# log line format, valid options are text, console and json\n;format = text\n\n# Syslog network type and address. This can be udp, tcp, or unix. If left blank, the default unix endpoints will be used.\n;network =\n;address =\n\n# Syslog facility. user, daemon and local0 through local7 are valid.\n;facility =\n\n# Syslog tag. By default, the process\' argv[0] is used.\n;tag =\n\n\n#################################### AMQP Event Publisher ##########################\n[event_publisher]\n;enabled = false\n;rabbitmq_url = amqp://localhost/\n;exchange = grafana_events\n\n;#################################### Dashboard JSON files ##########################\n[dashboards.json]\n;enabled = false\n;path = /var/lib/grafana/dashboards\n\n#################################### Internal Grafana Metrics ##########################\n# Metrics available at HTTP API Url /api/metrics\n[metrics]\n# Disable / Enable internal metrics\n;enabled           = true\n\n# Publish interval\n;interval_seconds  = 10\n\n# Send internal metrics to Graphite\n; [metrics.graphite]\n; address = localhost:2003\n; prefix = prod.grafana.%(instance_name)s.\n\n#################################### Internal Grafana Metrics ##########################\n# Url used to to import dashboards directly from Grafana.net\n[grafana_net]\nurl = https://grafana.net\n'})}),"\n",(0,r.jsx)(e.h3,{id:"promyaml",children:"prom.yaml"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"global:\n  scrape_interval: 5s\n  # Attach these labels to any time series or alerts when communicating with\n  # external systems (federation, remote storage, Alertmanager).\n  external_labels:\n    monitor: 'dev-monitor'\n\nrule_files:\n  - mysql.rules\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: 'prometheus'\n\n    # Override the global default and scrape targets from this job every 5 seconds.\n    scrape_interval: 5s\n\n    static_configs:\n      - targets: ['localhost:9090']\n\n  - job_name: container_exporter\n    static_configs:\n      - targets: ['172.18.1.21:9104']\n\n  - job_name: node_exporter\n    static_configs:\n      - targets: ['172.18.1.1:9100']\n\n  - job_name: caddy\n    static_configs:\n      - targets: ['172.18.1.30:2000']\n"})}),"\n",(0,r.jsx)(e.h3,{id:"caddyfile",children:"Caddyfile"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:":80 {\n  log internal/access.log {\n      rotate {\n          size 50\n          age  14\n          keep 10\n      }\n  }\n  prometheus :2000\n  root .\n  internal ./internal\n  filemanager /file {\n    show file/\n  }\n  proxy /monitor 172.18.1.10:3000 {\n    without /monitor\n    transparent\n  }\n}\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'\n$ sudo vim /etc/udev/rules.d/75-persistent-net-generator.rules\n\nSUBSYSTEM=="net", ACTION=="add", ATTR{address}=="f0:42:1c:85:07:41", NAME="eth0"\nsudo vim /etc/network/interfaces\n\n'})})]})}function u(n={}){let{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},917776:function(n,e,a){a.d(e,{R:()=>s,x:()=>i});var t=a(7378);let r={},o=t.createContext(r);function s(n){let e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(o.Provider,{value:e},n.children)}},248683:function(n){n.exports=JSON.parse('{"permalink":"/story/ubuntu-home","editUrl":"https://github.com/wenerme/wener/edit/master/story/../story/2017/2017-02-09-ubuntu-home.md","source":"@site/../story/2017/2017-02-09-ubuntu-home.md","title":"Ubuntu \u5BB6\u7528","description":"- Ubuntu \u684C\u9762\u7248","date":"2017-02-09T00:00:00.000Z","tags":[],"readingTime":7.12,"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"ubuntu-home","title":"Ubuntu \u5BB6\u7528"},"unlisted":false,"prevItem":{"title":"Google API Design Guide","permalink":"/story/google-api-design-guide"},"nextItem":{"title":"\u8FDB\u51FB\u7684\u7A0B\u5E8F\u733F","permalink":"/story/attack-on-programmer"}}')}}]);