"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["492921"],{900707:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>c,toc:()=>d,default:()=>a,metadata:()=>i,assets:()=>o,contentTitle:()=>t});var i=JSON.parse('{"id":"service/auth/kratos","title":"Kratos","description":"- ory/kratos \u662F\u4EC0\u4E48 ?","source":"@site/../notes/service/auth/kratos.md","sourceDirName":"service/auth","slug":"/service/auth/kratos","permalink":"/notes/service/auth/kratos","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/auth/kratos.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1657531736000,"frontMatter":{"title":"Kratos"},"sidebar":"docs","previous":{"title":"Louketo Proxy","permalink":"/notes/service/auth/keycloak/louketo-proxy"},"next":{"title":"LADP","permalink":"/notes/service/auth/ldap/"}}'),l=s(486106),r=s(917776);let c={title:"Kratos"},t="Kratos",o={},d=[{value:"Flow",id:"flow",level:2},{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:2},{value:"SDK",id:"sdk",level:2},{value:"Serve",id:"serve",level:2},{value:"Get Started",id:"get-started",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"kratos",children:"Kratos"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/ory/kratos",children:"ory/kratos"})," \u662F\u4EC0\u4E48 ?\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"API first \u7528\u6237\u7BA1\u7406"}),"\n",(0,l.jsxs)(n.li,{children:["Identity Infrastructure Service\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5BF9\u6BD4 Identity and Access Management (IAM), Identity Management (IdM), Identity Provider (IP/IdP), Identity as a Service (IDaaS)"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Username + Password -> Cookie, Token"}),"\n",(0,l.jsx)(n.li,{children:"Email + Password -> Cookie, Token"}),"\n",(0,l.jsx)(n.li,{children:"Passwordless login -> Cookie, Token"}),"\n",(0,l.jsx)(n.li,{children:"\u53EF\u5F53\u4F5C\u5E93\u6765\u4F7F\u7528"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4E3B\u8981\u89E3\u51B3\u95EE\u9898\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u51ED\u8BC1\u7BA1\u7406 - \u5BC6\u7801\u3001\u6062\u590D\u90AE\u7BB1\u3001\u5B89\u5168\u95EE\u9898"}),"\n",(0,l.jsx)(n.li,{children:"\u8BA4\u8BC1 - \u5B89\u5168\u767B\u5F55\u3001\u4F1A\u8BDD\u3001\u8BBE\u5907"}),"\n",(0,l.jsx)(n.li,{children:"\u8D26\u53F7\u4FE1\u606F\u7BA1\u7406 - profile\u3001\u90AE\u7BB1\u3001\u5BC6\u7801"}),"\n",(0,l.jsx)(n.li,{children:"\u8D26\u53F7\u7BA1\u7406 - CRUD"}),"\n",(0,l.jsx)(n.li,{children:"\u8EAB\u4EFD\u4FE1\u606F\u7BA1\u7406 - \u540D\u5B57\u3001\u7167\u7247\u3001\u751F\u65E5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u9002\u7528\u573A\u666F\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4E0D\u6D89\u53CA\u7B2C\u4E09\u65B9\u767B\u9646\uFF0C\u5E0C\u671B\u767B\u9646\u540E\u62FF\u5230 Token"}),"\n",(0,l.jsx)(n.li,{children:"Self-service Login and Registration"}),"\n",(0,l.jsx)(n.li,{children:"Multi-Factor Authentication"}),"\n",(0,l.jsx)(n.li,{children:"Account Verification"}),"\n",(0,l.jsx)(n.li,{children:"Account Recovery"}),"\n",(0,l.jsx)(n.li,{children:"Profile and Account Management"}),"\n",(0,l.jsx)(n.li,{children:"Admin APIs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4E0D\u8981\u5728\u6D4F\u89C8\u5668\u4F7F\u7528 API flow - \u4F7F\u7528 HTML ",(0,l.jsx)(n.strong,{children:"form"})]}),"\n",(0,l.jsx)(n.li,{children:"\u76EE\u524D\u4E0D\u652F\u6301 MFA - \u591A\u56E0\u7D20\u9A8C\u8BC1 - \u4E0D\u652F\u6301\u77ED\u4FE1"}),"\n",(0,l.jsx)(n.li,{children:"\u524D\u7AEF\u9700\u8981\u81EA\u884C\u5B9E\u73B0\uFF0C\u4F46\u76F8\u5BF9\u5BB9\u6613"}),"\n"]})}),"\n",(0,l.jsx)(n.h2,{id:"flow",children:"Flow"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6CE8\u518C\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/registration/browser"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u767B\u9646\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/login/browser"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u6CE8\u9500"}),"\n",(0,l.jsxs)(n.li,{children:["\u9A8C\u8BC1\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/self-service/verification/methods/link?token=${TOKEN}"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"User Settings"}),"\n",(0,l.jsx)(n.li,{children:"Account Recovery"}),"\n",(0,l.jsx)(n.li,{children:"Address Verification"}),"\n",(0,l.jsx)(n.li,{children:"User-Facing Error"}),"\n",(0,l.jsx)(n.li,{children:"2FA / MFA"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5BC6\u7801\u53C2\u6570\nkratos hashers argon2 calibrate 1s\n"})}),"\n",(0,l.jsx)(n.h2,{id:"sdk",children:"SDK"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.ory.sh/kratos/docs/reference/api/",children:"REST API"})}),"\n",(0,l.jsxs)(n.li,{children:["Go ",(0,l.jsx)(n.a,{href:"https://github.com/ory/kratos-client-go",children:"client"})]}),"\n",(0,l.jsxs)(n.li,{children:["Admin\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7CFB\u7EDF\u4FE1\u606F\u63A5\u53E3\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/health/alive"}),"\n",(0,l.jsx)(n.li,{children:"/health/ready"}),"\n",(0,l.jsx)(n.li,{children:"/metrics/prometheus"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4E1A\u52A1\u63A5\u53E3\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/identities"}),"\n",(0,l.jsx)(n.li,{children:"/recovery/link"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Public\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/schemas/{id}"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/browser/flows/logout"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/browser/flows/registration/strategies/oidc/settings/connections"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/errors?error=string"}),"\n",(0,l.jsx)(n.li,{children:"/version"}),"\n",(0,l.jsxs)(n.li,{children:["\u767B\u9646/login \u6D41\u7A0B\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/login/browser - \u521D\u59CB\u5316\u6D4F\u89C8\u5668\u767B\u9646\u6D41\u7A0B"}),"\n",(0,l.jsxs)(n.li,{children:["/self-service/login/api - \u521D\u59CB\u5316 API \u767B\u9646\u6D41\u7A0B\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4E0D\u8981\u5728\u6D4F\u89C8\u5668\u4F7F\u7528"}),"\n",(0,l.jsx)(n.li,{children:"\u7528\u4E8E \u79FB\u52A8\u8BBE\u5907\uFF0C\u667A\u80FD\u7535\u89C6 \u7B49"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/self-service/login/flows?flow=string"})," - \u83B7\u53D6\u6CE8\u518C\u6D41\u7A0B\u4FE1\u606F"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/self-service/login/methods/password?flow=string"})," - \u5B8C\u6210\u5BC6\u7801\u767B\u9646\u6D41\u7A0B"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6CE8\u518C/registration \u6D41\u7A0B\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/registration/browser"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/registration/api"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/self-service/registration/flows?flow=string"})}),"\n",(0,l.jsx)(n.li,{children:"/self-service/registration/methods/password"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6062\u590D/recovery \u6D41\u7A0B\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/recovery/browser"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/recovery/api"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/self-service/recovery/flows?id=string"})}),"\n",(0,l.jsx)(n.li,{children:"/self-service/recovery/methods/link"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u8BBE\u7F6E/setting\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/settings/api"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/settings/browser/flows"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/settings/flows?id=string"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/settings/methods/password - \u4FEE\u6539\u5BC6\u7801"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/settings/methods/profile - \u4FEE\u6539\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u9A8C\u8BC1/verification\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/self-service/verification/api"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/verification/browser"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/verification/flows?id=string"}),"\n",(0,l.jsx)(n.li,{children:"/self-service/verification/methods/link"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4F1A\u8BDD\u7BA1\u7406\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DELETE /sessions - ",(0,l.jsx)(n.code,{children:'{"session_token": "string"}'})]}),"\n",(0,l.jsx)(n.li,{children:"GET /sessions/whoami"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"serve",children:"Serve"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"export DSN=sqlite:///tmp/kratos.sqlite?_fk=true\n./kratos -c ./contrib/quickstart/kratos/email-password migrate sql -e --yes\nLOG_LEVEL=trace ./kratos serve -c /etc/config/kratos/kratos.yml --dev\n"})}),"\n",(0,l.jsx)(n.h2,{id:"get-started",children:"Get Started"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/ory/kratos.git\ncd kratos\n# \u5207\u6362\u5230\u6700\u65B0\u7248\u672C\ngit checkout v0.5.4-alpha.1\n\ndocker pull oryd/kratos:latest-sqlite\ndocker pull oryd/kratos-selfservice-ui-node:latest\n# 4455 - http://github.com/ory/kratos-selfservice-ui-node\n# 4433 - Kratos Public API\n# 4434 - Kratos Admin API\n# 4436 - https://github.com/mailslurper - \u5F00\u53D1\u7528\u7684 SMTP \u670D\u52A1\u5668\n# \u5165\u53E3 http://127.0.0.1:4455/dashboard\ndocker-compose -f quickstart.yml -f quickstart-standalone.yml up --build --force-recreate\n\n# \u6E05\u7406\ndocker-compose -f quickstart.yml down -v\ndocker-compose -f quickstart.yml rm -fsv\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["/dashboard -> /auth/login\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u672A\u767B\u5F55\u91CD\u5B9A\u5411"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["/auth/login -> ",(0,l.jsx)(n.a,{href:"http://127.0.0.1:4433/self-service/login/browser",children:"http://127.0.0.1:4433/self-service/login/browser"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u65E0 flowid \u91CD\u5B9A\u5411"}),"\n",(0,l.jsx)(n.li,{children:"\u8BBE\u7F6E cookie csrf_token"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["-> ",(0,l.jsx)(n.code,{children:"/auth/login?flow=<flow_id>"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u663E\u793A\u767B\u9646"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["-> ",(0,l.jsx)(n.code,{children:"http://kratos:4434/self-service/login/flows?id=<flow_id>"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8868\u5355\u63D0\u4EA4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u767B\u9646\u4FE1\u606F\ncurl -s "http://127.0.0.1:4434/self-service/login/flows?id=<flow_id>" | jq\n\n# \u6CE8\u518C\u4FE1\u606F\ncurl -s "http://127.0.0.1:4434/self-service/registration/flows?id=<flow_id>" | jq\n'})})]})}function a(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},917776:function(e,n,s){s.d(n,{R:()=>c,x:()=>t});var i=s(7378);let l={},r=i.createContext(l);function c(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);