"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["88694"],{36330:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>h,metadata:()=>s,assets:()=>o,contentTitle:()=>a});var s=JSON.parse('{"id":"os/virt/libvirt/libvirt-faq","title":"Libvirt\u5E38\u89C1\u95EE\u9898","description":"- domain xml","source":"@site/../notes/os/virt/libvirt/libvirt-faq.md","sourceDirName":"os/virt/libvirt","slug":"/os/virt/libvirt/faq","permalink":"/notes/os/virt/libvirt/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/virt/libvirt/libvirt-faq.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1667482099000,"frontMatter":{"id":"libvirt-faq","title":"Libvirt\u5E38\u89C1\u95EE\u9898"},"sidebar":"docs","previous":{"title":"Libvirt Domain","permalink":"/notes/os/virt/libvirt/dom"},"next":{"title":"Libvirt \u7F51\u7EDC","permalink":"/notes/os/virt/libvirt/net"}}'),r=i(86106),t=i(17776);let l={id:"libvirt-faq",title:"Libvirt\u5E38\u89C1\u95EE\u9898"},a="Libvirt FAQ",o={},d=[{value:"CPU \u8D44\u6E90\u914D\u989D",id:"cpu-\u8D44\u6E90\u914D\u989D",level:2},{value:"\u91CD\u542F\u7F51\u7EDC",id:"\u91CD\u542F\u7F51\u7EDC",level:2},{value:"\u5904\u7406 libvirt hang \u7684\u95EE\u9898",id:"\u5904\u7406-libvirt-hang-\u7684\u95EE\u9898",level:2},{value:"\u5B9E\u65F6\u4FEE\u6539\u7F51\u7EDC\u914D\u7F6E",id:"\u5B9E\u65F6\u4FEE\u6539\u7F51\u7EDC\u914D\u7F6E",level:2},{value:"\u78C1\u76D8\u7A7A\u95F4\u6269\u5BB9",id:"\u78C1\u76D8\u7A7A\u95F4\u6269\u5BB9",level:2},{value:"Refusing to undefine while domain managed save image exists",id:"refusing-to-undefine-while-domain-managed-save-image-exists",level:2},{value:"host-model vs host-passthrough",id:"host-model-vs-host-passthrough",level:2},{value:"\u52A8\u6001 CPU \u548C\u5185\u5B58",id:"\u52A8\u6001-cpu-\u548C\u5185\u5B58",level:2},{value:"At least one numa node has to be configured when enabling memory hotplug",id:"at-least-one-numa-node-has-to-be-configured-when-enabling-memory-hotplug",level:2},{value:"console \u6CA1\u6709\u7EC8\u7AEF",id:"console-\u6CA1\u6709\u7EC8\u7AEF",level:2},{value:"guest CPU doesn&#39;t match specification: missing features: spec-ctrl,stibp,ssbd",id:"guest-cpu-doesnt-match-specification-missing-features-spec-ctrlstibpssbd",level:2},{value:"\u83B7\u53D6\u4E3B\u673A IP",id:"\u83B7\u53D6\u4E3B\u673A-ip",level:2},{value:"\u514B\u9686\u4E3B\u673A\u7684\u6CE8\u610F\u4E8B\u9879",id:"\u514B\u9686\u4E3B\u673A\u7684\u6CE8\u610F\u4E8B\u9879",level:2},{value:"\u7F51\u7EDC",id:"\u7F51\u7EDC",level:2},{value:"\u9ED8\u8BA4\u7F51\u7EDC",id:"\u9ED8\u8BA4\u7F51\u7EDC",level:3},{value:"\u57FA\u672C\u914D\u7F6E",id:"\u57FA\u672C\u914D\u7F6E",level:3},{value:"\u4F7F\u7528\u73B0\u6709\u5BBF\u4E3B\u673A\u6865\u63A5\u7F51\u7EDC",id:"\u4F7F\u7528\u73B0\u6709\u5BBF\u4E3B\u673A\u6865\u63A5\u7F51\u7EDC",level:3},{value:"\u4F7F\u7528 macvtap",id:"\u4F7F\u7528-macvtap",level:3},{value:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361",id:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361",level:3},{value:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361\u4E0B\u6302\u8F7D\u7684\u865A\u62DF\u7F51\u5361",id:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361\u4E0B\u6302\u8F7D\u7684\u865A\u62DF\u7F51\u5361",level:3},{value:"\u57DF",id:"\u57DF",level:2},{value:"\u663E\u5B58\u8C03\u6574",id:"\u663E\u5B58\u8C03\u6574",level:3},{value:"\u52A8\u6001\u5185\u5B58",id:"\u52A8\u6001\u5185\u5B58",level:3},{value:"memory ballooning",id:"memory-ballooning",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",cpu:"cpu",feature:"feature",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",model:"model",p:"p",pre:"pre",strong:"strong",ul:"ul",vendor:"vendor",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"libvirt-faq",children:"Libvirt FAQ"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["domain ",(0,r.jsx)(n.a,{href:"https://libvirt.org/formatdomain.html",children:"xml"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u7F51\u7EDC ",(0,r.jsx)(n.a,{href:"https://libvirt.org/formatnetwork.html",children:"xml"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u4E09\u79CD\u914D\u7F6E\u72B6\u6001\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["live - \u8FD0\u884C\u72B6\u6001\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4FEE\u6539\u7ACB\u5373\u751F\u6548"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["inactive - \u4E0D\u6D3B\u8DC3\u7684\u72B6\u6001\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4FEE\u6539\u9700\u8981\u91CD\u542F\u540E\u751F\u6548"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["current - \u5F53\u524D\u72B6\u6001\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6307\u5411 live \u6216 inactive"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"uuid \u548C mac \u7C7B\u5B57\u6BB5\u5982\u679C\u6CA1\u6709\uFF0C\u5219\u5BFC\u5165\u7684\u65F6\u5019\u751F\u6210"}),"\n",(0,r.jsx)(n.li,{children:"\u4E0D\u8981\u4F7F\u7528\u975E root virsh"}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"cpu-\u8D44\u6E90\u914D\u989D",children:"CPU \u8D44\u6E90\u914D\u989D"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003 ",(0,r.jsx)(n.a,{href:"https://libvirt.org/formatdomain.html#elementsCPUTuning",children:"CPUTuning"})]}),"\n",(0,r.jsx)(n.li,{children:"shares - \u6BCF\u4E2A vCPU"}),"\n",(0,r.jsx)(n.li,{children:"period\u3001quota - \u6BCF\u4E2A vCPU\uFF0C\u4F46\u4F1A\u9996 quota \u5B9A\u4E49\u9650\u5236"}),"\n",(0,r.jsx)(n.li,{children:"emulator_period\u3001emulator_quota - \u6BCF\u4E2A\u6A21\u62DF\u7EBF\u7A0B\uFF0C\u4E3B\u673A 40-80% \u6027\u80FD"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u91CD\u542F\u7F51\u7EDC",children:"\u91CD\u542F\u7F51\u7EDC"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://aboullaite.me/effectively-restarting-kvm-libvirt-network/",children:"https://aboullaite.me/effectively-restarting-kvm-libvirt-network/"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/aboullaite/useful-scripts/blob/master/kvm-restart-network.sh",children:"https://github.com/aboullaite/useful-scripts/blob/master/kvm-restart-network.sh"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'NET_NAME=default\nNET_HOOK=/etc/libvirt/hooks/qemu\n\nvirsh net-destroy $NET_NAME\nvirsh net-start $NET_NAME\n\nVMS=$( virsh list | tail -n +3 | head -n -1 | awk \'{ print $2; }\' )\n\nfor m in $VMS ; do\n\n    echo "$m"\n    MAC_ADDR=$(virsh domiflist "$m" |grep -o -E "([0-9a-f]{2}:){5}([0-9a-f]{2})")\n    NET_MODEL=$(virsh domiflist "$m" | tail -n +3 | head -n -1 | awk \'{ print $4; }\')\n\n    set +e\n    virsh detach-interface "$m" network --mac "$MAC_ADDR" && sleep 3\n    virsh attach-interface "$m" network $NET_NAME --mac "$MAC_ADDR" --model "$NET_MODEL"\n    set -e\n    [ ! -e $NET_HOOK ] || {\n      $NET_HOOK "$m" stopped && sleep 3\n      $NET_HOOK "$m" start\n    }\ndone\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5904\u7406-libvirt-hang-\u7684\u95EE\u9898",children:"\u5904\u7406 libvirt hang \u7684\u95EE\u9898"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://gitlab.alpinelinux.org/alpine/aports/-/issues/11602",children:"https://gitlab.alpinelinux.org/alpine/aports/-/issues/11602"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'if [ "$1" = \'start\' ]; then\n  modprobe tun\n  sleep 1\n  service virtlogd start\n  sleep 1\n  service virtqemud start\n  sleep 1\n  service virtnetworkd start\n  sleep 1\n  service virtstoraged start\n  sleep 1\n  service libvirtd start\nelif [ "$1" = \'stop\' ]; then\n  service libvirtd stop\n  sleep 1\n  service virtlogd stop\n  sleep 1\n  service virtstoraged stop\n  sleep 1\n  service virtnetworkd stop\n  sleep 1\n  service virtqemud stop\n  killall -9 dnsmasq\nelse\n  printf "Usage $0: start | stop\\n"\nfi\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5B9E\u65F6\u4FEE\u6539\u7F51\u7EDC\u914D\u7F6E",children:"\u5B9E\u65F6\u4FEE\u6539\u7F51\u7EDC\u914D\u7F6E"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u7ACB\u5373\u751F\u6548\uFF0C\u4E0D\u9700\u8981\u91CD\u542F\nvirsh net-update --config --live default add ip-dhcp-host \\\n  \"<host mac='52:54:00:01:02:03' name='xyz.example.com' ip='192.168.122.25'/>\"\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u78C1\u76D8\u7A7A\u95F4\u6269\u5BB9",children:"\u78C1\u76D8\u7A7A\u95F4\u6269\u5BB9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"virsh blockresize DOMAIN FULL_DISK_PATH 1000G\n\n# \u4F7F\u7528 QEMU \u65B9\u5F0F\n# \u5F53\u524D vm Disk \u4FE1\u606F\n# \u6CE8\u610F alias - \u4F8B\u5982 virtio-disk0\nvirsh dumpxml test | xpath -e /domain/devices/disk\n\n# drive-<alias> \u5373\u4E3A\u5B9E\u9645 disk\nvirsh qemu-monitor-command test block_resize drive-virtio-disk0 100G --hmp\n"})}),"\n",(0,r.jsx)(n.h2,{id:"refusing-to-undefine-while-domain-managed-save-image-exists",children:"Refusing to undefine while domain managed save image exists"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"virsh managedsave-remove vm\nvirsh undefine vm\n"})}),"\n",(0,r.jsx)(n.h2,{id:"host-model-vs-host-passthrough",children:"host-model vs host-passthrough"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.reddit.com/r/VFIO/comments/a20bf7/hostmodel_vs_hostpassthrough_super_poor_cache/",children:"https://www.reddit.com/r/VFIO/comments/a20bf7/hostmodel_vs_hostpassthrough_super_poor_cache/"})}),"\n",(0,r.jsx)(n.h2,{id:"\u52A8\u6001-cpu-\u548C\u5185\u5B58",children:"\u52A8\u6001 CPU \u548C\u5185\u5B58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<maxMemory slots='16' unit='GiB'>64</maxMemory>\n<memory unit='GiB'>32</memory>\n<currentMemory unit='GiB'>32</currentMemory>\n<vcpu placement='static' current='8'>16</vcpu>\n<cpu>\n  <numa>\n    <cell id='0' cpus='0-8' memory='32' unit='GiB'/>\n  </numa>\n  \x3c!-- \u5176\u4ED6\u5185\u5BB9 --\x3e\n</cpu>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"at-least-one-numa-node-has-to-be-configured-when-enabling-memory-hotplug",children:"At least one numa node has to be configured when enabling memory hotplug"}),"\n",(0,r.jsx)(n.p,{children:"\u914D\u7F6E\u70ED\u63D2\u62D4\u5185\u5B58\u540E\u9700\u8981\u914D\u7F6E numa"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<cpu>\n  <numa>\n    <cell id='0' cpus='0-8' memory='4' unit='GiB'/>\n  </numa>\n  \x3c!-- \u5176\u4ED6\u5185\u5BB9 --\x3e\n</cpu>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"console-\u6CA1\u6709\u7EC8\u7AEF",children:"console \u6CA1\u6709\u7EC8\u7AEF"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u786E\u4FDD\u5B9A\u4E49\u6709 Serial"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<serial type='pty'>\n  <target port='0'/>\n</serial>\n<console type='pty'>\n  <target type='serial' port='0'/>\n</console>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679C\u8FD8\u662F\u6CA1\u6709\uFF0C\u5219\u5C1D\u8BD5\u6DFB\u52A0 kernel \u53C2\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"console=tty0 console=ttyS0\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6216"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"console=ttyS0,19200 earlyprint=serial,ttyS0,19200\n"})}),"\n",(0,r.jsx)(n.h2,{id:"guest-cpu-doesnt-match-specification-missing-features-spec-ctrlstibpssbd",children:"guest CPU doesn't match specification: missing features: spec-ctrl,stibp,ssbd"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.berrange.com/posts/2018/06/29/cpu-model-configuration-for-qemu-kvm-on-x86-hosts/",children:"https://www.berrange.com/posts/2018/06/29/cpu-model-configuration-for-qemu-kvm-on-x86-hosts/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/include/asm/cpufeatures.h",children:"https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/include/asm/cpufeatures.h"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://unix.stackexchange.com/questions/43539/what-do-the-flags-in-proc-cpuinfo-mean",children:"https://unix.stackexchange.com/questions/43539/what-do-the-flags-in-proc-cpuinfo-mean"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"\x3c!-- \u6700\u7B80\u5355\u7684\u4FEE\u590D\u65B9\u5F0F\u662F\u4F7F\u7528\u4E3B\u673A\u7684\u6A21\u578B --\x3e\n<cpu mode='host-model'/>\n"})}),"\n",(0,r.jsxs)(n.cpu,{mode:"host-model",children:["\n    ",(0,r.jsx)(n.model,{fallback:"forbid",children:"core2duo"}),"\n"]}),"\n  ",(0,r.jsxs)(n.cpu,{mode:"host-model",check:"partial",children:["\n    ",(0,r.jsx)(n.model,{fallback:"forbid",children:"IvyBridge-IBRS"}),"\n    ",(0,r.jsx)(n.vendor,{children:"Intel"}),"\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"ss",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"pcid",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"hypervisor",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"arat",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"tsc_adjust",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"umip",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"xsaveopt",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"pdpe1gb",children:["\n    ",(0,r.jsxs)(n.feature,{policy:"require",name:"stibp",children:["\n    ",(0,r.jsx)(n.feature,{policy:"require",name:"ssbd",children:"\n  "})]})]})]})]})]})]})]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u83B7\u53D6\u4E3B\u673A-ip",children:"\u83B7\u53D6\u4E3B\u673A IP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u4E3B\u673A\u540D\u5B57\nHOSTNAME=base\nMAC=$(virsh domiflist $HOSTNAME | awk \u2018{ print $5 }\u2019 | tail -2 | head -1)\narp -a | grep $MAC | awk '{ print $2 }' | sed \u2018s/[()]//g\u2019\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u514B\u9686\u4E3B\u673A\u7684\u6CE8\u610F\u4E8B\u9879",children:"\u514B\u9686\u4E3B\u673A\u7684\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u6301\u4E45\u5316\u7684\u7F51\u5361\u4FE1\u606F - alpine \u9ED8\u8BA4\u6CA1\u6709\nrm -f /etc/udev/rules.d/70-persistent-net.rules\n\n# \u5220\u9664 ssh \u7684 host id\nrm -rf /etc/ssh/ssh_host_*\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/cloning_virtual_machines",children:"CLONING VIRTUAL MACHINES"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u7F51\u7EDC",children:"\u7F51\u7EDC"}),"\n",(0,r.jsx)(n.h3,{id:"\u9ED8\u8BA4\u7F51\u7EDC",children:"\u9ED8\u8BA4\u7F51\u7EDC"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<network>\n  <name>default</name>\n  <uuid/>\n  <forward mode='nat'>\n    <nat>\n      <port start='1024' end='65535'/>\n    </nat>\n  </forward>\n  <bridge name='virbr0' stp='on' delay='0'/>\n  <mac/>\n  <ip address='192.168.122.1' netmask='255.255.255.0'>\n    <dhcp>\n      \x3c!-- DHCP \u8303\u56F4 --\x3e\n      <range start='192.168.122.2' end='192.168.122.254'/>\n      \x3c!-- \u9759\u6001 IP --\x3e\n      \x3c!-- <host mac='52:54:00:70:d9:ee' name='myhost' ip='192.168.122.10'/> --\x3e\n    </dhcp>\n  </ip>\n</network>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u57FA\u672C\u914D\u7F6E",children:"\u57FA\u672C\u914D\u7F6E"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"connections - \u5F53\u524D\u8FDE\u63A5\u6570 \u5728\u8FD0\u884C\u4E2D\u7684\u7F51\u7EDC\u770B\u5F97\u5230"}),"\n",(0,r.jsx)(n.li,{children:"libvirt \u4F1A\u7EF4\u62A4\u4E00\u4E2A dnsmasq \u5B9E\u4F8B"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<network ipv6='yes' trustGuestRxFilters='no' connections='10'>\n  \x3c!-- \u57FA\u672C\u5143\u6570\u636E --\x3e\n  <name>default</name>\n  <uuid>3e3fce45-4f53-4fa7-bb32-11f34168b82b</uuid>\n  <metadata>\n    <app1:foo xmlns:app1=\"http://app1.org/app1/\">..</app1:foo>\n    <app2:bar xmlns:app2=\"http://app1.org/app2/\">..</app2:bar>\n  </metadata>\n  \x3c!-- \u8FDE\u63A5\u6027\u914D\u7F6E --\x3e\n  <mtu size=\"9000\"/>\n  \x3c!-- QoS --\x3e\n  <bandwidth>\n    <inbound floor='500' average='1000' peak='5000' burst='5120'/>\n    <outbound average='128' peak='256' burst='256'/>\n  </bandwidth>\n  \x3c!-- \u9759\u6001\u8DEF\u7531 --\x3e\n  <ip address=\"192.168.122.1\" netmask=\"255.255.255.0\">\n    <dhcp>\n      <range start=\"192.168.122.128\" end=\"192.168.122.254\"/>\n      <host mac=\"00:16:3e:77:e2:ed\" name=\"foo.example.com\" ip=\"192.168.122.10\"/>\n    </dhcp>\n    \x3c!-- tftp --\x3e\n  </ip>\n  <route address=\"192.168.222.0\" prefix=\"24\" gateway=\"192.168.122.2\"/>\n  \x3c!-- \u5730\u5740 - \u53EA\u652F\u6301\u9694\u79BB \u5373 \u975E forward --\x3e\n  \x3c!-- \u6865\u63A5\u7F51\u5361\u8BBE\u5907\u7684 MAC --\x3e\n  <mac address='00:16:3E:5D:C7:9E'/>\n  <domain name=\"example.com\"/>\n  \x3c!-- enable \u9ED8\u8BA4\u5F00\u542F --\x3e\n  \x3c!-- forwardPlainNames \u5982\u679C\u5173\u95ED\u5219\u4E0D\u4F1A\u5904\u7406\u4E0D\u5E26 . \u7684\u540D\u5B57 --\x3e\n  <dns enable='yes' forwardPlainNames='yes'>\n    <txt name=\"example\" value=\"example value\"/>\n    <forwarder addr=\"8.8.8.8\"/>\n    <forwarder domain='example.com' addr=\"8.8.4.4\"/>\n    <forwarder domain='www.example.com'/>\n    <srv service='name' protocol='tcp' domain='test-domain-name' target='.'\n      port='1024' priority='10' weight='10'/>\n    <host ip='192.168.122.2'>\n      <hostname>myhost</hostname>\n      <hostname>myhostalias</hostname>\n    </host>\n  </dns>\n  \x3c!-- \u81EA\u5B9A\u4E49 dnsmasq \u5C5E\u6027 --\x3e\n  <dnsmasq:options>\n    <dnsmasq:option value=\"foo=bar\"/>\n    <dnsmasq:option value=\"cname=*.foo.example.com,master.example.com\"/>\n  </dnsmasq:options>\n</network>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528\u73B0\u6709\u5BBF\u4E3B\u673A\u6865\u63A5\u7F51\u7EDC",children:"\u4F7F\u7528\u73B0\u6709\u5BBF\u4E3B\u673A\u6865\u63A5\u7F51\u7EDC"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<network>\n  <name>host-bridge</name>\n  <forward mode="bridge"/>\n  <bridge name="br0"/>\n</network>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528-macvtap",children:"\u4F7F\u7528 macvtap"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7C7B\u4F3C\u4E8E\u6865\u63A5\uFF0C\u4F46\u4E0D\u9700\u8981\u4E3B\u673A\u5B58\u5728\u6865\u63A5\u7F51\u5361"}),"\n",(0,r.jsx)(n.li,{children:"\u4E3B\u673A\u8BE5\u7F51\u5361\u4E0E\u865A\u62DF\u673A\u4E0D\u4E92\u901A"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<network>\n  <name>direct-macvtap</name>\n  <forward mode="bridge">\n    <interface dev="eth0"/>\n    <interface dev="eth1"/>\n  </forward>\n</network>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361",children:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<network>\n  <name>host-passthrough</name>\n  \x3c!-- \u8BBE\u5907\u6C60 --\x3e\n  <forward mode='passthrough'>\n    <interface dev='eth10'/>\n    <interface dev='eth11'/>\n    <interface dev='eth12'/>\n    <interface dev='eth13'/>\n    <interface dev='eth14'/>\n  </forward>\n</network>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361\u4E0B\u6302\u8F7D\u7684\u865A\u62DF\u7F51\u5361",children:"\u4F7F\u7528\u4E3B\u673A\u7F51\u5361\u4E0B\u6302\u8F7D\u7684\u865A\u62DF\u7F51\u5361"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<network>\n  <name>host-passthrough-vnet</name>\n  <forward mode='passthrough'>\n    <pf dev='eth0'/>\n  </forward>\n</network>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u57DF",children:"\u57DF"}),"\n",(0,r.jsx)(n.h3,{id:"\u663E\u5B58\u8C03\u6574",children:"\u663E\u5B58\u8C03\u6574"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"kvm \u53EF\u4EE5\u4F7F\u7528 cirrus \u505A\u66F4\u597D\u7684\u663E\u793A"}),"\n",(0,r.jsx)(n.li,{children:"\u6CE8\u610F\u663E\u5B58\u5927\u5C0F - \u8FC7\u5C0F\u4F1A\u5BFC\u81F4\u663E\u793A\u51FA\u95EE\u9898"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<video>\n  <model type='cirrus' vram='9216' heads='1'/>\n  <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\n</video>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u52A8\u6001\u5185\u5B58",children:"\u52A8\u6001\u5185\u5B58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<maxMemory slots='16' unit='GiB'>16</maxMemory>\n\x3c!-- memory \u548C currentMemory \u53C2\u6570\u53EF\u9009 --\x3e\n\x3c!-- <memory unit='GiB'>8</memory> --\x3e\n\x3c!-- \u521D\u59CB\u5185\u5B58 --\x3e\n\x3c!-- <currentMemory unit='GiB'>2</currentMemory> --\x3e\n\x3c!-- \u70ED\u63D2\u62D4\u9700\u8981 numa --\x3e\n<cpu>\n  <numa>\n    <cell id='0' cpus='0-2' memory='1' unit='GiB'/>\n  </numa>\n</cpu>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://medium.com/@juergen_thomann/558f1c635972",children:"Memory hotplug with Qemu/KVM and libvirt"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"memory-ballooning",children:"memory ballooning"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.linux-kvm.org/page/Projects/auto-ballooning",children:"https://www.linux-kvm.org/page/Projects/auto-ballooning"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"-device virtio-balloon,automatic=true"})}),"\n",(0,r.jsx)(n.li,{children:"deflate-on-oom=on"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://libvirt.org/formatdomain.html#elementsMemBalloon",children:"https://libvirt.org/formatdomain.html#elementsMemBalloon"})}),"\n",(0,r.jsx)(n.li,{children:"\u9ED8\u8BA4\u6DFB\u52A0"}),"\n",(0,r.jsx)(n.li,{children:"When you use KVM and want to overcommit memory you can try to enable \u201Ckernel same-page merging\u201D (KSM) in the linux kernel on the hypervisor."}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://packages.debian.org/stretch/ksmtuned",children:"https://packages.debian.org/stretch/ksmtuned"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<memballoon model='virtio' autodeflate='on'>\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},17776:function(e,n,i){i.d(n,{R:()=>l,x:()=>a});var s=i(7378);let r={},t=s.createContext(r);function l(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);