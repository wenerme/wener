"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["86123"],{94920:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>d,default:()=>a,metadata:()=>i,assets:()=>p,contentTitle:()=>c});var i=JSON.parse('{"id":"web/dev/pnpm","title":"pnpm","description":"- pnpm","source":"@site/../notes/web/dev/pnpm.md","sourceDirName":"web/dev","slug":"/web/dev/pnpm","permalink":"/notes/web/dev/pnpm","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/dev/pnpm.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1753172183000,"frontMatter":{"title":"pnpm"},"sidebar":"docs","previous":{"title":"nx","permalink":"/notes/web/dev/nx"},"next":{"title":"prettier","permalink":"/notes/web/dev/prettier"}}'),l=s(86106),r=s(17776);let t={title:"pnpm"},c="pnpm",p={},d=[{value:"\u914D\u7F6E",id:"config",level:2},{value:".npmrc",id:"npmrc",level:2},{value:"node-linker",id:"node-linker",level:2},{value:".pnpmfile.cjs",id:"pnpmfilecjs",level:3},{value:"workspace",id:"workspace",level:2},{value:"store server",id:"store-server",level:2},{value:"Dockerfile",id:"dockerfile",level:2},{value:"license",id:"license",level:2},{value:"Typescript FAQ",id:"typescript-faq",level:2},{value:"Type error: The inferred type of &#39;trpc&#39; cannot be named without a reference to &#39;react-query&#39;. This is likely not portable. A type annotation is necessary.",id:"type-error-the-inferred-type-of-trpc-cannot-be-named-without-a-reference-to-react-query-this-is-likely-not-portable-a-type-annotation-is-necessary",level:3},{value:"pnpm-lock.yaml",id:"pnpm-lockyaml",level:2},{value:"Protocol",id:"protocol",level:2},{value:"packageManager",id:"packagemanager",level:2},{value:"ERR_PNPM_MODIFIED_DEPENDENCY\u2009 Packages in the store have been mutated",id:"err_pnpm_modified_dependency-packages-in-the-store-have-been-mutated",level:2},{value:"EEXIST: file already exists, symlink @next/env",id:"eexist-file-already-exists-symlink-nextenv",level:2},{value:"node_modules \u76F8\u540C\u5305\u5305\u542B\u591A\u4E2A\u76EE\u5F55",id:"node_modules-\u76F8\u540C\u5305\u5305\u542B\u591A\u4E2A\u76EE\u5F55",level:2},{value:"peer deps",id:"peer-deps",level:2},{value:"npm ci",id:"npm-ci",level:2},{value:"\u5E73\u53F0\u53C2\u6570",id:"\u5E73\u53F0\u53C2\u6570",level:2},{value:"Cannot read properties of undefined (reading &#39;startsWith&#39;)",id:"cannot-read-properties-of-undefined-reading-startswith",level:2}];function o(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"pnpm",children:"pnpm"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm",children:"pnpm"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"since 2017"}),"\n",(0,l.jsx)(e.li,{children:"\u901F\u5EA6\u5FEB\u3001\u8282\u7701\u7A7A\u95F4"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Store - ",(0,l.jsx)(e.code,{children:"pnpm store path"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Windows ~/AppData/Local/pnpm/store"}),"\n",(0,l.jsx)(e.li,{children:"macOS ~/Library/pnpm/store"}),"\n",(0,l.jsx)(e.li,{children:"Linux ~/.local/share/pnpm/store"}),"\n",(0,l.jsxs)(e.li,{children:["\u9879\u76EE\u4E0B\u865A\u62DF Store ./node_modules/.pnpm\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"hardlink \u5230\u5168\u5C40 store"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:".pnpm-store"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/next/symlinked-node-modules-structure",children:"content-addressable storage"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301 workspace \u5F15\u7528 - ",(0,l.jsx)(e.code,{children:'"button": "workspace:1.0.0",'})]}),"\n",(0,l.jsxs)(e.li,{children:[".npmrc - ",(0,l.jsx)(e.a,{href:"https://pnpm.io/npmrc",children:"https://pnpm.io/npmrc"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"workspace \u8981\u6C42\u5FC5\u987B\u5B58\u5728"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5168\u5C40\u914D\u7F6E\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"~/.config/pnpm/rc"}),"\n",(0,l.jsx)(e.li,{children:"~/Library/Preferences/pnpm/rc"}),"\n",(0,l.jsx)(e.li,{children:"~/AppData/Local/pnpm/config/rc"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u91C7\u7528"}),": next.js, vite, vue3\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u56E0\u4E3A yarn 2+/berry \u53D8\u5316\u592A\u5927\uFF0C\u65E0\u6CD5\u4F7F\u7528 - \u540C\u65F6 yarn v1 \u5F00\u53D1\u505C\u6EDE\uFF0C\u5BFC\u81F4\u5927\u91CF\u9879\u76EE\u8FC1\u79FB pnpm"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/benchmarks",children:"https://pnpm.io/benchmarks"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/motivation#creating-a-non-flat-node_modules-directory",children:"https://pnpm.io/motivation#creating-a-non-flat-node_modules-directory"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://blog.logrocket.com/javascript-package-managers-compared/",children:"https://blog.logrocket.com/javascript-package-managers-compared/"})}),"\n",(0,l.jsxs)(e.li,{children:["migration stories\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/vercel/next.js/pull/37259",children:"vercel/next.js#37259"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4ECE yarn v1 \u8FC1\u79FB\u5230 pnpm \u5B89\u88C5\u65F6\u95F4\u51CF\u534A"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://divriots.com/blog/switching-to-pnpm",children:"https://divriots.com/blog/switching-to-pnpm"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/blob/main/packages/git-utils/src/index.ts",children:"https://github.com/pnpm/pnpm/blob/main/packages/git-utils/src/index.ts"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["pnpm store path\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ED8\u8BA4\u4F1A\u5728\u76F8\u540C\u78C1\u76D8 - \u56E0\u4E3A hardlink \u9700\u8981\u76F8\u540C\u78C1\u76D8"}),"\n",(0,l.jsx)(e.li,{children:"\u56E0\u6B64\u60F3\u8981\u5229\u7528 pnpm \u7684\u7279\u6027\uFF0C\u9700\u8981\u5728\u540C\u4E00\u78C1\u76D8\u4E0B - \u5BB9\u5668\u7F13\u5B58\u573A\u666F\u4F1A\u4E0D\u592A\u597D\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"windows \u4F7F\u7528 junctions / soft link"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Typescript \u53EF\u80FD\u68C0\u6D4B\u4E0D\u5230\u7C7B\u578B\uFF0C\u51FA\u73B0\u7C7B\u578B\u5F02\u5E38 ",(0,l.jsx)(e.a,{href:"https://github.com/microsoft/TypeScript/issues/29808",children:"TypeScript#29808"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5C1D\u8BD5 ",(0,l.jsx)(e.code,{children:'"preserveSymlinks": true'})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsx)(e.admonition,{type:"info",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65B0\u7248\u672C\u652F\u6301\u4F7F\u7528 pnpm-workspace.yaml \u914D\u7F6E pnpm"}),"\n",(0,l.jsxs)(e.li,{children:["pnpm monorepo docker support ",(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/1637",children:"#1637"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"monorepo \u65E0\u6CD5\u5206\u79BB\u5355\u4E2A\u6A21\u5757\u4F9D\u8D56\uFF0C\u4F1A\u5305\u542B\u6240\u6709\u4F9D\u8D56"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["Support workspaces from package.json ",(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/2255",children:"#2255"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"yarn & pnpm \u4F7F\u7528\u4E0D\u540C\u7684\u540D\u8BCD\u63CF\u8FF0"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"import npm \u9879\u76EE\u65F6\uFF0C\u65E7\u7684\u4F9D\u8D56\u653E\u5230 node_modules/.ignored"}),"\n"]})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm i -g pnpm\n# by corepack\n# corepack prepare pnpm --activate\n\n# \u57FA\u672C\u64CD\u4F5C\u540C npm\n\npnpm install --filter @wener/demo # \u9009\u62E9\u6027\u5B89\u88C5\npnpm env use --global lts         # \u4F7F\u7528 LTS \u7248\u672C Node.js\n\npnpm root # \u8FD4\u56DE\u5F53\u524D node_modules \u8DEF\u5F84\npnpm bin  # \u8FD4\u56DE\u5F53\u524D node_modules/.bin \u8DEF\u5F84\n\npnpm -r run fmt # \u9012\u5F52\u8FD0\u884C fmt\n\n# store \u7BA1\u7406\n# ==========\npnpm store status\n# pnpm store add <package> # \u7B49\u540C\u4E8E pnpm add\npnpm store prune # \u79FB\u9664\u672A\u5F15\u7528\u7684\u5305\npnpm store path  # \u8DEF\u5F84\n\n\n#\nnpm_config_include_workspace_root=true pnpm -r exec pwd\n# clean\nnpm_config_include_workspace_root=true pnpm -r exec rm -rf node_modules\n\n# \u5168\u5C40\u914D\u7F6E\npnpm config list --global\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",metastring:'title=".npmrc"',children:"strict-peer-dependencies = false\nauto-install-peers = true\npublic-hoist-pattern[]=*jest*\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"~/Library/pnpm"}),"\n",(0,l.jsx)(e.li,{children:"NODE_PATH=$HOME/Library/pnpm/global/5/.pnpm/node_modules"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"config",children:"\u914D\u7F6E"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"pnpm-workspace.yaml"}),"\n",(0,l.jsx)(e.li,{children:"package.json"}),"\n",(0,l.jsx)(e.li,{children:"~/.config/pnpm/rc"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"strict-peer-dependencies"}),"\n",(0,l.jsxs)(e.li,{children:["auto-install-peers\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8FC1\u79FB\u65F6\u53EF\u4EE5\u5F00\u542F\uFF0C\u4E4B\u540E\u5EFA\u8BAE\u5173\u95ED"}),"\n",(0,l.jsx)(e.li,{children:"missing non-optional peer dependencies are automatically installed"}),"\n",(0,l.jsxs)(e.li,{children:["\u53EF\u80FD\u5BFC\u81F4\u95EE\u9898\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/5144#issuecomment-1207261343",children:"https://github.com/pnpm/pnpm/issues/5144#issuecomment-1207261343"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["legacy-peer-deps\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"NPMv7 \u914D\u7F6E"}),"\n",(0,l.jsx)(e.li,{children:"\u6062\u590D\u4E3A NPMv4 - NPMv6 \u884C\u4E3A"}),"\n",(0,l.jsx)(e.li,{children:"bypass peerDependency auto-installation"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://stackoverflow.com/a/66620869/1870054",children:"https://stackoverflow.com/a/66620869/1870054"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "engines": {\n    "node": ">=16",\n    "pnpm": ">=7"\n  },\n  "dependenciesMeta": {\n    "button": {\n      // \u5F3A\u5236\u6CE8\u5165\uFF0C\u800C\u4E0D\u662F\u8F6F\u8FDE\u63A5 - \u9002\u7528\u4E8E\u4F9D\u8D56\u57FA\u7840\u5E93\u7248\u672C\u4E0D\u540C\u65F6\n      "injected": true\n    }\n  },\n  "peerDependenciesMeta": {\n    "bar": {\n      // \u5141\u8BB8 peer \u4F9D\u8D56\u4E0D\u5B58\u5728\n      "optional": true\n    }\n  },\n  // \u8986\u76D6 publish \u914D\u7F6E - \u751F\u6210 publish \u7528\u7684 package.json - \u5F00\u53D1\u65F6\u5C31\u53EF\u4EE5 "main": "src/index.ts"\n  "publishConfig": {\n    "main": "lib/index.js",\n    // types \u4E5F\u53EF\u4EE5\n    "typings": "lib/index.d.ts",\n    // bin, exports, module, browser, esnext, es2015, umd:main, typesVersions, cpu, os\n    // \u4FEE\u6539 publish \u7684\u57FA\u7840\u9ED8\u8BA4 - \u9ED8\u8BA4\u65F6\u5F53\u524D\u76EE\u5F55\uFF0C\u76EE\u5F55\u4E0B\u5305\u542B package.json\n    // "directory": "dist",\n    // chmod +x - \u9ED8\u8BA4\u53EA\u6709 bin \u4E0B\u7684\u53EF\u6267\u884C\n    "executableFiles": ["./dist/shim.js"]\n  },\n\n  "pnpm": {\n    // \u4F9D\u8D56\u8986\u76D6\n    "overrides": {\n      "foo": "^1.0.0", // \u7248\u672C\u4F9D\u8D56\u8986\u76D6\n      "quux": "npm:@myorg/quux@^1.0.0", // \u4F9D\u8D56\u4FEE\u6539\n      "bar@^2.1.0": "3.0.0", // \u7248\u672C\u4FEE\u6539\n      "qar@1>zoo": "2" // \u95F4\u63A5\u4F9D\u8D56\u7248\u672C\u4FEE\u6539\n    },\n    // \u6269\u5C55\u4F9D\u8D56\u7684\u4F9D\u8D56\n    // pnpm \u548C yarn \u7EF4\u62A4\u7684\u6269\u5C55\u5E93\n    // https://github.com/yarnpkg/berry/blob/master/packages/yarnpkg-extensions/sources/index.ts\n    "packageExtensions": {\n      "react-redux@1": {\n        "peerDependencies": {\n          "react-dom": "*"\n        },\n        "optionalDependencies": {},\n        "dependencies": {},\n        "peerDependenciesMeta": {}\n      }\n    },\n    "peerDependencyRules": {\n      "ignoreMissing": ["react"], // \u5982\u679C peer \u4F9D\u8D56\u4E0D\u5B58\u5728\u4E0D\u63D0\u793A\n      "allowedVersions": { "react": "17" } // \u5141\u8BB8 peer \u4F9D\u8D56\u7248\u672C - \u4F4E\u7248\u672C\u5B89\u88C5\u9AD8\u7248\u672C\u4E0D\u62A5\u9519\n    },\n    // \u5FFD\u7565 \u4F9D\u8D56 \u7684\u6784\u5EFA\u64CD\u4F5C -  preinstall, install, postinstall\n    "neverBuiltDependencies": ["fsevents", "level"],\n    // \u4E0E neverBuiltDependencies \u76F8\u53CD\n    "onlyBuiltDependencies": ["fsevents"]\n  }\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"npmrc",children:".npmrc"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",metastring:'title="\u63A8\u8350\u914D\u7F6E"',children:"strict-peer-dependencies = false\nauto-install-peers = true\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",metastring:'title="\u5168\u90E8\u914D\u7F6E\u9879"',children:"hoist=true\n# \u4F9D\u8D56\u63D0\u5347\u5230 node_modules/.pnpm - \u9690\u85CF\u6A21\u5757\u76EE\u5F55\n# \u4F8B\u5982\n# hoist-pattern[]=*eslint*\nhoist-pattern[]=*\n\n# \u4F9D\u8D56\u63D0\u5347\u5230 node_modules/\npublic-hoist-pattern[]=*eslint*\npublic-hoist-pattern[]=*prettier*\n\n# \u5141\u8BB8 node_modules \u5185\u6A21\u5757\u8BBF\u95EE\u672A\u58F0\u660E\u4F9D\u8D56\nshamefully-hoist=false\n\n# Windows ~/AppData/Local/pnpm/store\n# macOS ~/Library/pnpm/store\n# Linux ~/.local/share/pnpm/store\n# store-dir\n\nmodules-dir=node_modules\n# isolated - node_modules/.pnpm\n# hoisted - \u5E73\u5766 node_modules \u7ED3\u6784\uFF0C\u65E0 symlink - \u540C npm\n# pnp - \u65E0 node_modules, \u63A8\u8350\u540C\u65F6\u8BBE\u7F6E symlink=false\nnode-linker=isolated\nsymlink=true\nenable-modules-dir=true\n\nvirtual-store-dir=node_modules/.pnpm\n# auto, hardlink, copy, clone\npackage-import-method=auto\n# \u5206\u949F - \u9ED8\u8BA4 7 \u5929\nmodules-cache-max-age=10080\n\n# \u751F\u6210 pnpm-lock.yaml\nlockfile=true\nprefer-frozen-lockfile=true\n\n\n# highest, time-based, lowest-direct\n# time-based \u9700\u8981 registry-supports-time-field\n# https://github.com/npm/registry/blob/master/docs/responses/package-metadata.md#full-metadata-format\nresolution-mode=highest\n# Verdaccio v5.15.1+\nregistry-supports-time-field=false\n\n\n# symlink \u5230\u6839\u76EE\u5F55 node_modules \u540E\u5C31\u4E0D symlink \u5230\u5B50\u76EE\u5F55\ndedupe-direct-deps=false\n\n\n\n\n# true if node-linker=hoisted\n# node_modules/.bin\nprefer-symlinked-executables=\nverify-store-integrity=true\n\n# https://github.com/yarnpkg/berry/blob/master/packages/yarnpkg-extensions/sources/index.ts\nignore-compatibility-db=false\n# \u8BBE\u7F6E NODE_PATH\nextend-node-path=true\n\n# Peer Dependency\n# ===============\n# \u5B89\u88C5 non-optional peer dependencies\nauto-install-peers=false\nstrict-peer-dependencies=true\ndedupe-peer-dependents=true\nstrict-peer-dependencies=false\nresolve-peers-from-workspace-root=true\n\n# CLI\n# ===\n# auto, always, never\ncolor=auto\n# no-color\n# debug, info, warn, error\nloglevel=info\nuse-beta-cli=false\n# pnpm i -> pnpm i -r\nrecursive-install=true\nengine-strict=false\n# npm-path\n\n# Build Settings\n# ==============\nchild-concurrency=5\nside-effects-cache=true\nside-effects-cache-readonly=false\nunsafe-perm=false\n\n# Node.js\n# =======\nuse-node-version=\nnode-version=\n# release, rc, nightly, v8-canary\n# node-mirror:<releaseDir>=https://nodejs.org/download/<releaseDir>/\n\n# Misc\n# ====\nuse-running-store-server=false\nsave-prefix=^\ntag=latest\n# <path to node>/pnpm-global\nglobal-dir=\nglobal-bin-dir=\nstate-dir=$XDG_STATE_HOME/pnpm\ncache-dir=$XDG_CACHE_HOME/pnpm\nuse-stderr=false\nupdate-notifier=true\n\n# \u4EE5\u4E0B\u540C npm \u914D\u7F6E\nregistry=https://registry.npmjs.org/\n# <scope>:registry\n# <URL>:_authToken\n# <URL>:tokenHelper\n# <URL>:always-auth\n\n# ca=\n# cafile=\n# cert=\n# key=\n# strict-ssl\n\n# git-shallow-hosts=['github.com', 'gist.github.com', 'gitlab.com', 'bitbucket.com', 'bitbucket.org']\n# local-address\n# https-proxy\n# proxy\n# noproxy\n# maxsockets\n\nnetwork-concurrency=16\nfetch-retries=2\n# fetch-retry-factor,mintimeout,maxtimeout,\n# fetch-tomeout\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/vercel/next.js/blob/canary/.npmrc",children:"https://github.com/vercel/next.js/blob/canary/.npmrc"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"node-linker",children:"node-linker"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["isolated\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6240\u6709\u7684\u4F9D\u8D56\u5B89\u88C5\u5230 node_modules/.pnpm, \u7136\u540E symlink \u5230\u9879\u76EE"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["hoisted\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5E73\u5766 node_modules \u7ED3\u6784\uFF0C\u65E0 symlink\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E0D symlink \u4F1A\u4EA7\u751F\u975E\u5E38\u591A\u4F9D\u8D56\u5B89\u88C5"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u540C npm/yarn classic"}),"\n",(0,l.jsxs)(e.li,{children:["\u76EE\u524D bun \u6709 symlink \u95EE\u9898 ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/1760",children:"https://github.com/oven-sh/bun/issues/1760"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["pnp\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65E0 node_modules, \u63A8\u8350\u540C\u65F6\u8BBE\u7F6E symlink=false"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://yarnpkg.com/features/pnp",children:"https://yarnpkg.com/features/pnp"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"pnpmfilecjs",children:".pnpmfile.cjs"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/pnpmfile",children:"https://pnpm.io/pnpmfile"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"workspace",children:"workspace"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5982\u679C\u7248\u672C\u5339\u914D\u4F1A\u9ED8\u8BA4\u4F7F\u7528\u5DE5\u4F5C\u7A7A\u95F4\u6A21\u5757 - npm \u5E38\u7528 ",(0,l.jsx)(e.code,{children:"*"})]}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679C\u6307\u5B9A\u7248\u672C\u4E0D\u5339\u914D\u5219\u89E3\u6790\u5931\u8D25"}),"\n",(0,l.jsxs)(e.li,{children:["\u4F7F\u7528 workspace: \u534F\u8BAE\u53EF\u5F3A\u5236\u4F7F\u7528\u5DE5\u4F5C\u7A7A\u95F4\u6A21\u5757\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5982\u679C link-workspace-packages \u4E3A false\uFF0C\u5219\u53EA\u6709\u4F7F\u7528 worksapce: \u534F\u8BAE\u624D\u4F1A link"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",metastring:'title="pnpm-workspace.yaml"',children:"packages:\n  - 'apps/*'\n  - 'packages/*'\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/workspaces",children:"https://pnpm.io/workspaces"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"store-server",children:"store server"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[".npmrc \u53EF\u914D\u7F6E ",(0,l.jsx)(e.code,{children:"use-running-store-server=true"})," \u4F7F\u7528 store server"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# start stop status\n# --background\n# --network-concurrency\n# --protocol=auto\n# --store-dir=$HOME/.pnpm-store\n# --[no-]lock \u9501\u5B9A\u6587\u4EF6\uFF0C\u907F\u514D\u5916\u90E8\u8FDB\u7A0B\u4FEE\u6539\n# --ignore-stop-requests\n# --ignore-upload-requests\npnpm server start --port=5813\n"})}),"\n",(0,l.jsx)(e.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:16\n\nRUN curl -f https://get.pnpm.io/v7.1.8.js | node - add --global pnpm\n\nCOPY pnpm-lock.yaml ./\n\n# \u4F7F\u7528 fetch \u4F7F docker \u6784\u5EFA\u4F9D\u8D56\u66F4\u5C11\n# \u6B63\u5E38 install \u9700\u8981 .npmrc package.json pnpm-lock.yaml .pnpmfile.cjs package.json\nRUN pnpm fetch --prod\n\nADD . ./\nRUN pnpm install -r --offline --prod\n\nEXPOSE 8080\nCMD [ "node", "server.js" ]\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/3114",children:"#3114"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"license",children:"license"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"@pnpm/license-scanner"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"typescript-faq",children:"Typescript FAQ"}),"\n",(0,l.jsx)(e.p,{children:"\u4E3B\u8981\u662F pnpm symlink \u5F15\u8D77\u95EE\u9898"}),"\n",(0,l.jsx)(e.h3,{id:"type-error-the-inferred-type-of-trpc-cannot-be-named-without-a-reference-to-react-query-this-is-likely-not-portable-a-type-annotation-is-necessary",children:"Type error: The inferred type of 'trpc' cannot be named without a reference to 'react-query'. This is likely not portable. A type annotation is necessary."}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/microsoft/TypeScript/issues/29808",children:"https://github.com/microsoft/TypeScript/issues/29808"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/microsoft/TypeScript/issues/42873",children:"https://github.com/microsoft/TypeScript/issues/42873"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/microsoft/TypeScript/issues/47663",children:"https://github.com/microsoft/TypeScript/issues/47663"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"pnpm-lockyaml",children:"pnpm-lock.yaml"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/blob/main/lockfile/types/src/lockfileFileTypes.ts",children:"https://github.com/pnpm/pnpm/blob/main/lockfile/types/src/lockfileFileTypes.ts"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"protocol",children:"Protocol"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["workspace:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["link-workspace-packages=false \u65F6\u5FC5\u987B\u8981\u660E\u786E\u6307\u5B9A workspace:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ED8\u8BA4 false"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["alias ",(0,l.jsx)(e.code,{children:'"bar": "workspace:foo@*"'})," - bar \u6307\u5411 foo\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["publish \u4F1A\u53D8\u4E3A ",(0,l.jsx)(e.code,{children:'"bar": "npm:foo@1.0.0"'})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301\u76F8\u5BF9\u8DEF\u5F84 ",(0,l.jsx)(e.code,{children:'"foo": "workspace:../foo"'})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["file:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"hard link"}),"\n",(0,l.jsx)(e.li,{children:"\u4F1A\u5B89\u88C5\u4F9D\u8D56"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpm add ./package.tar.gz"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["link:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"symlink"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u4F1A\u5B89\u88C5\u4F9D\u8D56"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpm link"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpm add ./some-directory"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpm add https://github.com/indexzero/forever/tarball/v0.5.6"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["npm:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"alias - `pnpm add lodash@npm:awesome-lodas"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["catalog:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"catalog:"})," = ",(0,l.jsx)(e.code,{children:"catalog:default"})," -> catalog"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"catalog:react17"})," -> catalogs.react17"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5F15\u7528\u5728 ",(0,l.jsx)(e.code,{children:"pnpm-workspace.yaml"})," \u5B9A\u4E49\u7684 ",(0,l.jsx)(e.code,{children:"catalog"}),", ",(0,l.jsx)(e.code,{children:"catalogs"})," \u7248\u672C"]}),"\n",(0,l.jsx)(e.li,{children:"\u7EDF\u4E00\u7248\u672C\u7BA1\u7406\uFF0C\u65B9\u4FBF\u5347\u7EA7\uFF0C\u51CF\u5C11 merge conflict"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpx codemod pnpm/catalog"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["git:\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"pnpm add kevva/is-positive"})}),"\n",(0,l.jsxs)(e.li,{children:["Commit ",(0,l.jsx)(e.code,{children:"pnpm add kevva/is-positive#97edff6f525f192a3f83cea1944765f769ae2678"})]}),"\n",(0,l.jsxs)(e.li,{children:["Branch ",(0,l.jsx)(e.code,{children:"pnpm add kevva/is-positive#master"})]}),"\n",(0,l.jsxs)(e.li,{children:["Branch relative to refs ",(0,l.jsx)(e.code,{children:"pnpm add zkochan/is-negative#heads/canary"})]}),"\n",(0,l.jsxs)(e.li,{children:["Tag ",(0,l.jsx)(e.code,{children:"pnpm add zkochan/is-negative#2.0.1"})]}),"\n",(0,l.jsxs)(e.li,{children:["V prefix tag ",(0,l.jsx)(e.code,{children:"pnpm add andreineculau/npm-publish-git#v0.0.7"})]}),"\n",(0,l.jsxs)(e.li,{children:["semver ",(0,l.jsx)(e.code,{children:"pnpm add zkochan/is-negative#semver:1.0.0"})]}),"\n",(0,l.jsxs)(e.li,{children:["subpath ",(0,l.jsx)(e.code,{children:"pnpm add RexSkz/test-git-subdir-fetch#path:/packages/simple-react-app"})]}),"\n",(0,l.jsxs)(e.li,{children:["git+ssh ",(0,l.jsx)(e.code,{children:"pnpm add git+ssh://git@github.com:zkochan/is-negative.git#2.0.1"})]}),"\n",(0,l.jsxs)(e.li,{children:["git+https ",(0,l.jsx)(e.code,{children:"pnpm add https://github.com/zkochan/is-negative.git#2.0.1"})]}),"\n",(0,l.jsxs)(e.li,{children:["providers ",(0,l.jsx)(e.code,{children:"pnpm add github:zkochan/is-negative"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"github, gitlab, bitbucket"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u591A\u4E2A\u53C2\u6570 ",(0,l.jsx)(e.code,{children:"pnpm add RexSkz/test-git-subdir-fetch.git#beta&path:/packages/simple-react-app"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"packagemanager",children:"packageManager"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ini",metastring:'title=".npmrc"',children:"# packageManager \u540D\u5B57\u5339\u914D pnpm v9.2.0+\n# COREPACK_ENABLE_STRICT=0 \u7981\u7528\npackage-manager-strict=true # \u5982\u679C\u4E0D\u662F pnpm \u5219 pnpm \u6267\u884C\u4F1A\u62A5\u9519\n\n# \u7248\u672C\u5339\u914D v9.2.0\npackage-manager-strict-version=false\n# \u81EA\u52A8\u4E0B\u8F7D\u5BF9\u5E94\u7248\u672C v9.7.0\nmanage-package-manager-versions=false\nmanage-package-manager-versions=true # v10+\n"})}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpx"})," -> ",(0,l.jsx)(e.code,{children:"pnpm dlx"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpm dlx"})," - \u4E0B\u8F7D\u5E76\u6267\u884C"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpm create react-app my-app"})," -> ",(0,l.jsx)(e.code,{children:"pnpm dlx create-react-app my-app"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpm exec"})," \u4E0D\u4F1A\u4E0B\u8F7D\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"node_modules/.bin"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpm start"})," -> ",(0,l.jsx)(e.code,{children:"pnpm run start"})]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"pnpm test"})," -> ",(0,l.jsx)(e.code,{children:"pnpm run test"})]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"err_pnpm_modified_dependency-packages-in-the-store-have-been-mutated",children:"ERR_PNPM_MODIFIED_DEPENDENCY\u2009 Packages in the store have been mutated"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"pnpm store status"})," \u65F6\u51FA\u73B0"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"pnpm install --force # refetch\n"})}),"\n",(0,l.jsx)(e.h2,{id:"eexist-file-already-exists-symlink-nextenv",children:"EEXIST: file already exists, symlink @next/env"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u4F7F\u7528 nextjs outputStandalone \u65F6\uFF0C\u7B2C\u4E8C\u6B21\u6784\u5EFA\u51FA\u73B0\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u4E34\u65F6\u89E3\u51B3\u529E\u6CD5 \u6216 \u4E0D\u7528 outputStandalone\n# \u5220\u9664 nextjs \u6240\u5728 moudle \u5373\u53EF\nrm -rf ./node_modules/.pnpm/*\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/4663",children:"https://github.com/pnpm/pnpm/issues/4663"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"node_modules-\u76F8\u540C\u5305\u5305\u542B\u591A\u4E2A\u76EE\u5F55",children:"node_modules \u76F8\u540C\u5305\u5305\u542B\u591A\u4E2A\u76EE\u5F55"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E0D\u540C\u7684 peer deps \u4F1A\u521B\u5EFA\u76EE\u5F55"}),"\n",(0,l.jsx)(e.li,{children:"\u901A\u8FC7\u5728 root package.json \u4E2D\u6DFB\u52A0 pnpm.overrides \u6765\u89E3\u51B3 - \u5168\u5C40\u7EDF\u4E00\u7248\u672C"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/5807",children:"https://github.com/pnpm/pnpm/issues/5807"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pnpm.io/how-peers-are-resolved",children:"https://pnpm.io/how-peers-are-resolved"})}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"grep '^\\s*/' pnpm-lock.yaml | sort -u | tr -d ' '\n\ngrep '^\\s*/' pnpm-lock.yaml | sort -u | tr -d ' ' | grep -E '[0-9.]+_' -C 1\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["e.g.\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"@nestjs/platform-fastify -> fastify@4.15.0"}),"\n",(0,l.jsx)(e.li,{children:"fastify@4.17.0"}),"\n",(0,l.jsx)(e.li,{children:"\u4F1A\u5BFC\u81F4\u4E24\u4EFD fastify - \u5BFC\u81F4\u7248\u672C\u4E0D\u5339\u914D"}),"\n",(0,l.jsx)(e.li,{children:"graphql - Cannot use GraphQLScalarType from another module or realm"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5E26\u5168\u5C40\u72B6\u6001\u7684\u4E0D\u80FD\u6709\u591A\u4E2A\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"@mikro-orm/postgresql"}),"\n",(0,l.jsx)(e.li,{children:"@mikro-orm/core"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4EE5\u524D\u5168\u5C40\u5339\u914D\u7684\u4E0D\u80FD\u6709\u591A\u4E2A\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F8B\u5982 nestjs \u9700\u8981\u5339\u914D\u4F9D\u8D56"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"ls -d node_modules/.pnpm/graphql@*\nls -d node_modules/.pnpm/@mikro-orm*\n\npnpm tsx --experimental-network-imports ./dup.ts\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",metastring:'title="dup.ts"',children:"import fs from 'node:fs';\nimport YAML from 'https://esm.sh/yaml@2.5.0';\n\nlet lock = YAML.parse(fs.readFileSync('./pnpm-lock.yaml', 'utf8'));\n\nconst deps = Object.entries(lock.packages).map(([id, spec]) => {\n  let idx = id.lastIndexOf('@');\n  let name = id.slice(0, idx);\n  let version = id.slice(idx + 1);\n  return { name, version, spec, id };\n});\n\nlet dups: Record<string, { name: string; version: string; id: string; spec: any }[]> = {};\nfor (const dep of deps) {\n  dups[dep.name] ||= [];\n  dups[dep.name].push(dep);\n}\n\nlet out: string[] = [];\n\nObject.entries(dups).forEach(([k, v]) => {\n  if (v.length > 1) {\n    out.push(\n      `- ${k} - ${v\n        .map((v) => v.version)\n        .sort()\n        .join(', ')}`,\n    );\n  }\n});\n\nconsole.log(out.join('\\n'));\nconsole.log(\n  [\n    `pkgs: ${Object.keys(lock.packages).length}`,\n    `unique pkg: ${Object.keys(dups).length}`,\n    `dups: ${Object.values(dups).filter((v) => v.length > 1).length}`,\n  ].join(' '),\n);\n"})}),"\n",(0,l.jsx)(e.h2,{id:"peer-deps",children:"peer deps"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npx install-peerdeps --pnpm <your-package>\n"})}),"\n",(0,l.jsx)(e.h2,{id:"npm-ci",children:"npm ci"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"pnpm i --frozen-lockfile\nCI=true pnpm i\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["CI \u68C0\u6D4B\u903B\u8F91 ",(0,l.jsx)(e.a,{href:"https://github.com/watson/ci-info/blob/20fae89d2bdeb0e5dd70e6a9e8d2647764e6ff04/index.js#L56-L69",children:"https://github.com/watson/ci-info/blob/20fae89d2bdeb0e5dd70e6a9e8d2647764e6ff04/index.js#L56-L69"})]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5E73\u53F0\u53C2\u6570",children:"\u5E73\u53F0\u53C2\u6570"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"pnpm install --config.platform=linux --config.architecture=x64\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/pnpm/pnpm/issues/5965",children:"https://github.com/pnpm/pnpm/issues/5965"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"cannot-read-properties-of-undefined-reading-startswith",children:"Cannot read properties of undefined (reading 'startsWith')"})]})}function a(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>c});var i=s(7378);let l={},r=i.createContext(l);function t(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);