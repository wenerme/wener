"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["17196"],{59600:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>d,default:()=>h,metadata:()=>i,assets:()=>o,contentTitle:()=>c});var i=JSON.parse('{"id":"os/linux/init/s6","title":"s6","description":"- s6","source":"@site/../notes/os/linux/init/s6.md","sourceDirName":"os/linux/init","slug":"/os/linux/init/s6","permalink":"/notes/os/linux/init/s6","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/init/s6.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1619595507000,"frontMatter":{"title":"s6"},"sidebar":"docs","previous":{"title":"OpenRC","permalink":"/notes/os/linux/init/openrc"},"next":{"title":"Process supervision","permalink":"/notes/os/linux/init/supervision"}}'),r=s(86106),l=s(17776);let t={title:"s6"},c="s6",o={},d=[];function a(n){let e={a:"a",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"s6",children:"s6"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://skarnet.org/software/s6/",children:"s6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"size: 765952"}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://pkgs.alpinelinux.org/package/edge/main/x86_64/s6",children:"https://pkgs.alpinelinux.org/package/edge/main/x86_64/s6"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/skarnet/s6",children:"skarnet/s6"})}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/just-containers/s6-overlay",children:"just-containers/s6-overlay"})," - s6 overlay for containers (includes execline, s6-linux-utils & a custom init)"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://skarnet.org/software/s6/why.html",children:"Why another supervision suite ?"})}),"\n",(0,r.jsxs)(e.li,{children:["\u5176\u4ED6\u6A21\u5757\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"s6-linux-init init"}),"\n",(0,r.jsx)(e.li,{children:"s6-rc \u670D\u52A1\u4F9D\u8D56\u7BA1\u7406"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["gentoo wiki ",(0,r.jsx)(e.a,{href:"https://wiki.gentoo.org/wiki/S6",children:"S6"})]}),"\n",(0,r.jsxs)(e.li,{children:["s6-supervise\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5B9E\u73B0 supervisor \u529F\u80FD"}),"\n",(0,r.jsx)(e.li,{children:"\u63A5\u6536 servicedir \u4F5C\u4E3A\u53C2\u6570"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["s6-svscan\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u76D1\u89C6\u4E00\u7EC4\u8FDB\u7A0B"}),"\n",(0,r.jsx)(e.li,{children:"\u63A5\u6536 scandir \u4F5C\u4E3A\u53C2\u6570"}),"\n",(0,r.jsxs)(e.li,{children:["2.3 \u4E4B\u524D\u9ED8\u8BA4\u6BCF 5s \u4F1A\u626B\u63CF\u4E00\u6B21 - \u4E4B\u540E\u9700\u8981\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"-t ms"})," \u6307\u5B9A - SIGALARM \u89E6\u53D1\u626B\u63CF"]}),"\n",(0,r.jsx)(e.li,{children:"\u53EF\u901A\u8FC7 s6-svscanctl \u63A7\u5236"}),"\n",(0,r.jsxs)(e.li,{children:["\u9488\u5BF9\u6BCF\u4E2A\u626B\u63CF\u5230\u7684 ",(0,r.jsx)(e.code,{children:"servicedir"})," \u542F\u52A8 s6-supervise"]}),"\n",(0,r.jsxs)(e.li,{children:["\u63A7\u5236\u6587\u4EF6\u4F4D\u4E8E ",(0,r.jsx)(e.code,{children:".s6-svscan"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["s6-log\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u65E5\u5FD7\u5DE5\u5177"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"s6-log '!processor-script arg1 arg2' ./dirname"})," \u7B49\u540C\u4E8E\u8C03\u7528 ",(0,r.jsx)(e.code,{children:"execlineb -Pc 'processor-script arg1 arg2'"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.skarnet.org/software/s6/servicedir.html",children:"servicedir"})," - \u670D\u52A1\u76EE\u5F55 - \u8868\u793A\u5B9A\u4E49\u7684\u4E00\u4E2A\u670D\u52A1 - \u9664\u4E86 run \u811A\u672C\u5176\u4ED6\u5B58\u5728\u53EF\u9009\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"run - \u542F\u52A8\u811A\u672C"}),"\n",(0,r.jsx)(e.li,{children:"down - \u505C\u6B62\u811A\u672C"}),"\n",(0,r.jsx)(e.li,{children:"log - \u5B50\u76EE\u5F55\u6216\u7B26\u53F7\u94FE\u63A5"}),"\n",(0,r.jsxs)(e.li,{children:["finish - \u6BCF\u6B21\u8FDB\u7A0B\u7ED3\u675F\u540E\u7684\u6E05\u7406\u5DE5\u4F5C\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u63A5\u53D7\u4E24\u4E2A\u53C2\u6570: exitCode \u6216 256 \u8868\u793A\u4FE1\u53F7, \u4FE1\u53F7"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"timeout-finish - \u8FD0\u884C\u8D85\u65F6\u56DE\u8C03 - \u63A5\u53D7\u4E00\u4E2A\u53C2\u6570: \u8FD0\u884C\u65F6\u95F4\u6BEB\u79D2 - \u9ED8\u8BA4 5s \u8D85\u65F6"}),"\n",(0,r.jsx)(e.li,{children:"nosetsid - \u4E0D\u8C03\u7528 setsid - \u5B50\u7EBF\u7A0B\u4F1A\u8FD0\u884C\u5728 s6-supervise \u7684\u4F1A\u8BDD"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://www.skarnet.org/software/s6/scandir.html",children:"scandir"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4E0D\u63A8\u8350\u5C06\u670D\u52A1\u4ED3\u5E93\u4F5C\u4E3A\u626B\u63CF\u76EE\u5F55"}),"\n",(0,r.jsx)(e.li,{children:"\u4E00\u822C\u5728\u626B\u63CF\u76EE\u5F55\u4E0B\u8FDB\u884C\u8F6F\u94FE\u63A5"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# services \u670D\u52A1\u4ED3\u5E93\n# run \u8FD0\u884C\u670D\u52A1\u76EE\u5F55\nmkdir services run\n\n# \u542F\u52A8 - \u6BCF 10s \u626B\u63CF\u4E00\u6B21\ns6-svscan $PWD/run -t 10000\n\n# \u5B9A\u4E49\u4E00\u4E2A\u670D\u52A1\n# ====================\ninstall -Dv /dev/null services/ncat-echo/run\ncat <<SH >services/ncat-echo/run\n#!/usr/bin/env execlineb -P\nncat -e /bin/cat -k -l 8080\nSH\n# \u542F\u52A8\u670D\u52A1\nln -s ../services/ncat-echo run/\ns6-svscanctl -a run\n# \u670D\u52A1\u72B6\u6001\ns6-svstat services/ncat-echo\ns6-svstat -o up,wantedup,normallyup,ready,paused,pid,exitcode,signal,signum,updownsince,readysince,updownfor,readyfor services/ncat-echo\n# \u505C\u6B62\u670D\u52A1\ns6-svc -dx services/ncat-echo\nunlink run/ncat-echo\n\n# \u5E38\u7528\u811A\u672C\n# ====================\n# \u6240\u6709\u670D\u52A1\u72B6\u6001\nfor svc in services/*; do echo -n $(basename $svc)' ';s6-svok $svc && echo ok || echo down;done\n"})})]})}function h(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>c});var i=s(7378);let r={},l=i.createContext(r);function t(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);