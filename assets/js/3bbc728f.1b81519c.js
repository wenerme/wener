"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["33381"],{941:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>o,toc:()=>c,default:()=>p,metadata:()=>s,assets:()=>r,contentTitle:()=>a});var s=JSON.parse('{"id":"languages/php/php-faq","title":"PHP FAQ","description":"Timezone","source":"@site/../notes/languages/php/php-faq.md","sourceDirName":"languages/php","slug":"/languages/php/faq","permalink":"/notes/languages/php/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/php/php-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1730187174000,"frontMatter":{"title":"PHP FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"Debug","permalink":"/notes/languages/php/debug"},"next":{"title":"PHP FPM","permalink":"/notes/languages/php/fpm"}}'),t=i(86106),l=i(17776);let o={title:"PHP FAQ",tags:["FAQ"]},a="PHP FAQ",r={},c=[{value:"Timezone",id:"timezone",level:2},{value:"redis session",id:"redis-session",level:2},{value:"\u5F3A\u5236\u7C7B\u578B",id:"\u5F3A\u5236\u7C7B\u578B",level:2},{value:"Connection to `ssl://pecl.php.net:443&#39; failed: Unable to find the socket transport &quot;ssl&quot; - did you forget to enable it when you configured PHP",id:"connection-to-sslpeclphpnet443-failed-unable-to-find-the-socket-transport-ssl---did-you-forget-to-enable-it-when-you-configured-php",level:2},{value:"sodium_crypto_aead_aes256gcm_decrypt",id:"sodium_crypto_aead_aes256gcm_decrypt",level:2},{value:"Allowed memory size of 134217728 bytes exhausted (tried to allocate 65011744 bytes)",id:"allowed-memory-size-of-134217728-bytes-exhausted-tried-to-allocate-65011744-bytes",level:2},{value:"epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while sending request to upstream",id:"epoll_wait-reported-that-client-prematurely-closed-connection-so-upstream-connection-is-closed-too-while-sending-request-to-upstream",level:2},{value:"Declaration of Monolog\\Logger must be compatible with PsrExt\\Log\\LoggerInterface",id:"declaration-of-monologlogger-must-be-compatible-with-psrextlogloggerinterface",level:2},{value:"ZipArchive \u6587\u4EF6\u540D\u4E71\u7801",id:"ziparchive-\u6587\u4EF6\u540D\u4E71\u7801",level:2},{value:"Alpine iconv",id:"alpine-iconv",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"php-faq",children:"PHP FAQ"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"php -m    # \u67E5\u770B\u5DF2\u7ECF\u52A0\u8F7D\u7684\u6A21\u5757\nphp --ini # \u67E5\u770B\u914D\u7F6E\u6587\u4EF6\nphp -i    # phpinfo\nphp -r 'echo \"Hello, World!\\n\";'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"timezone",children:"Timezone"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9ED8\u8BA4\u4F7F\u7528 TZ \u73AF\u5883\u53D8\u91CF"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\ndate_default_timezone_set('Asia/Shanghai');\n\n$script_tz = date_default_timezone_get();\nif (strcmp($script_tz, ini_get('date.timezone'))){\n    echo '\u65F6\u533A\u4E0EINI\u914D\u7F6E \u4E0D\u540C';\n} else {\n    echo '\u65F6\u533A\u4E0EINI\u914D\u7F6E \u76F8\u540C'\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"php.ini"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:'[Date]\n; Defines the default timezone used by the date functions\n; http://php.net/date.timezone\n; https://www.php.net/manual/en/timezones.asia.php\ndate.timezone = "Asia/Shanghai"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"redis-session",children:"redis session"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-a-redis-server-as-a-session-handler-for-php-on-ubuntu-14-04",children:"How to Set Up a Redis Server as a Session Handler for PHP on Ubuntu 14.04"})}),"\n",(0,t.jsx)(n.li,{children:"php5-redis"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"/etc/php5/fpm/php.ini"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:'session.save_handler = redis\n# key \u683C\u5F0F\n# PHPREDIS_SESSION:j9rsgtde6st2rqb6lu5u6f4h83\nsession.save_path = "tcp://10.10.1.1:6379?auth=yourverycomplexpasswordhere"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5F3A\u5236\u7C7B\u578B",children:"\u5F3A\u5236\u7C7B\u578B"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?\ndeclare(strict_types=1)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/language.types.declarations.php#language.types.declarations.strict",children:"strict_types"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4E0D\u5141\u8BB8 \u5F31\u7C7B\u578B \u7C7B\u578B\u8F6C\u6362"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"connection-to-sslpeclphpnet443-failed-unable-to-find-the-socket-transport-ssl---did-you-forget-to-enable-it-when-you-configured-php",children:'Connection to `ssl://pecl.php.net:443\' failed: Unable to find the socket transport "ssl" - did you forget to enable it when you configured PHP'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apk add php7-openssl\n"})}),"\n",(0,t.jsx)(n.h2,{id:"sodium_crypto_aead_aes256gcm_decrypt",children:"sodium_crypto_aead_aes256gcm_decrypt"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apk add php7-sodium\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"sodium_crypto_aead_aes256gcm_is_available()"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"allowed-memory-size-of-134217728-bytes-exhausted-tried-to-allocate-65011744-bytes",children:"Allowed memory size of 134217728 bytes exhausted (tried to allocate 65011744 bytes)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["php.ini\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"memory_limit=128M"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?\nini_set('memory_limit', '-1');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"epoll_wait-reported-that-client-prematurely-closed-connection-so-upstream-connection-is-closed-too-while-sending-request-to-upstream",children:"epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while sending request to upstream"}),"\n",(0,t.jsx)(n.h2,{id:"declaration-of-monologlogger-must-be-compatible-with-psrextlogloggerinterface",children:"Declaration of Monolog\\Logger must be compatible with PsrExt\\Log\\LoggerInterface"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apk del php82-pecl-psr\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"psr-4 \u5DF2\u7ECF\u5F03\u7528\uFF1F"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ziparchive-\u6587\u4EF6\u540D\u4E71\u7801",children:"ZipArchive \u6587\u4EF6\u540D\u4E71\u7801"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\n$zip = new ZipArchive();\nif ($zip->open('./test.zip') === TRUE) {\n    $numFiles = $zip->numFiles;\n\n    for ($i = 0; $i < $numFiles; $i++) {\n        $statInfo = $zip->statIndex($i, ZipArchive::FL_ENC_RAW);\n        $encoding = mb_detect_encoding($statInfo['name'], array(\"UTF-8\", \"GBK\", \"ISO-8859-1\", \"ASCII\"));\n        // CP936=GBK\n        echo \"Encoding: \" . $encoding . PHP_EOL;\n        // $filename = iconv($encoding, 'UTF-8//IGNORE', $statInfo['name']);\n        // php-intl, icu\n        $filename = mb_convert_encoding($statInfo['name'], 'UTF-8', $encoding);\n        echo \"\u6587\u4EF6\u540D: \" . $filename . PHP_EOL;\n    }\n\n    $zip->close();\n} else {\n    echo '\u65E0\u6CD5\u6253\u5F00 ZIP \u6587\u4EF6';\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["mb_list_encodings\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u663E\u793A\u6240\u6709\u652F\u6301\u7684\u7F16\u7801"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"alpine-iconv",children:"Alpine iconv"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:'iconv(): Wrong encoding, conversion from "CP936" to "UTF-8//IGNORE" is not allowed'}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F7F\u7528 mb_convert_encoding \u66FF\u4EE3 iconv"}),"\n",(0,t.jsx)(n.li,{children:"PHP7.2+ \u4F7F\u7528 icu \u66FF\u4EE3 libiconv"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apk del icu-data-en   # php83-intl\napk add icu-data-full # php83-intl\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u65E7\u7248\u672C - \u73B0\u5728\u6CA1\u6709 2021 \u79FB\u9664\u4E86 preloadable_libiconv.so\nLD_PRELOAD=/usr/lib/preloadable_libiconv.so php test.php\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/docker-library/php/issues/1121",children:"https://github.com/docker-library/php/issues/1121"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gitlab.alpinelinux.org/alpine/aports/-/issues/12328",children:"https://gitlab.alpinelinux.org/alpine/aports/-/issues/12328"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},17776:function(e,n,i){i.d(n,{R:()=>o,x:()=>a});var s=i(7378);let t={},l=s.createContext(t);function o(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);