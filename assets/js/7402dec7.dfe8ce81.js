"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["524044"],{222571:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>c,toc:()=>o,default:()=>a,metadata:()=>i,assets:()=>d,contentTitle:()=>l});var i=JSON.parse('{"id":"web/script/lib/socketio","title":"SocketIO","description":"- socketio/socket.io","source":"@site/../notes/web/script/lib/socketio.md","sourceDirName":"web/script/lib","slug":"/web/script/lib/socketio","permalink":"/notes/web/script/lib/socketio","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/script/lib/socketio.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1692169664000,"frontMatter":{"title":"SocketIO"},"sidebar":"docs","previous":{"title":"sharp","permalink":"/notes/web/script/lib/sharp"},"next":{"title":"superjson","permalink":"/notes/web/script/lib/superjson"}}'),r=s(486106),t=s(917776);let c={title:"SocketIO"},l="SocketIO",d={},o=[{value:"Protocol",id:"protocol",level:2},{value:"namespace vs room",id:"namespace-vs-room",level:2}];function h(n){let e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"socketio",children:"SocketIO"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/socketio/socket.io",children:"socketio/socket.io"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"real-time bidirectional event-based communication"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"https://github.com/socketio/socket.io-redis-adapter",children:"socketio/socket.io-redis-adapter"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"pub/sub"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"socket.io#/#"})," - broadcast"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"socket.io#/#room21#"})," - room"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"<prefix>#<namespace>#*"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"<prefix>-request#<namespace>#"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"<prefix>-response#<namespace>#"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://admin.socket.io/",children:"https://admin.socket.io/"})}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"protocol",children:"Protocol"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"WEBSOCKET wss://example.com/socket.io/?EIO=3&transport=websocket\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["EIO - \u7248\u672C - 3/4\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"EngineIO v2 -> SocketIO v0.9"}),"\n",(0,r.jsx)(e.li,{children:"EngineIO v3 -> SocketIO v1, v2"}),"\n",(0,r.jsxs)(e.li,{children:["EngineIO v4 -> SocketIO v3\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["reverse ping/pong\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"server -> client"}),"\n",(0,r.jsx)(e.li,{children:"\u56E0\u4E3A client \u7684 timer \u4E0D\u4E00\u5B9A\u9760\u8C31"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"long-polling base64 binary data"}),"\n",(0,r.jsxs)(e.li,{children:["record separator ",(0,r.jsx)(e.code,{children:"\\x1e"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4E4B\u524D\u4F7F\u7528 length - \u5BF9\u4E8E\u975E utf16 \u5BA2\u6237\u7AEF\u5B9E\u73B0\u4E0D\u53CB\u597D"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"transport - \u4F20\u8F93\u534F\u8BAE - websocket/polling"}),"\n",(0,r.jsx)(e.li,{children:"sid - session id"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"polling"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"Content-Type: application/octet-stream"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"Content-Type: text/plain; charset=UTF-8"})}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"<packet type>[<data>]<separator><packet type>[<data>]<separator><packet type>[<data>][...]"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["separator=",(0,r.jsx)(e.code,{children:"\\x1e"})," - ",(0,r.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/C0_and_C1_control_codes#Field_separators",children:"Record Separator"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"WebSocket"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"<packet type>[<data>]"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'<- 0{"sid":"258c675c-a211-4bd4-a861-7b2ae022309e","upgrades":["websocket"],"pingInterval":25000,"pingTimeout":60000}\n<- 40\n\n-> 2\n<- 3\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"engine.io type"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"N"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"0"}),(0,r.jsx)(e.td,{children:"open"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"1"}),(0,r.jsx)(e.td,{children:"close"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"2"}),(0,r.jsx)(e.td,{children:"ping"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"3"}),(0,r.jsx)(e.td,{children:"pong"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"4"}),(0,r.jsx)(e.td,{children:"message"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"5"}),(0,r.jsx)(e.td,{children:"upgrade"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"6"}),(0,r.jsx)(e.td,{children:"noop"})]})]})]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.em,{children:"open"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "sid": "lv_VI97HAXpY6yYWAAAC",\n  "upgrades": ["websocket"],\n  "pingInterval": 25000,\n  "pingTimeout": 20000,\n  "maxPayload": 1000000\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"socket.io action"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"N"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"0"}),(0,r.jsx)(e.td,{children:"CONNECT"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"1"}),(0,r.jsx)(e.td,{children:"DISCONNECT"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"2"}),(0,r.jsx)(e.td,{children:"EVENT"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"3"}),(0,r.jsx)(e.td,{children:"ACK"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"4"}),(0,r.jsx)(e.td,{children:"ERROR"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"5"}),(0,r.jsx)(e.td,{children:"BINARY_EVENT"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"6"}),(0,r.jsx)(e.td,{children:"BINARY_ACK"})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"40"})," -> message/CONNECT"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'-> { type: CONNECT, namespace: "/admin", data: { "token": "123" } }\n<- { type: CONNECT, namespace: "/admin", data: { sid: "iLnRaVGHY4B75TeVAAAB" } }\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"type, namespace, data"}),"\n",(0,r.jsx)(e.li,{children:"CONNECT -> CONNECT,CONNECT_ERROR"}),"\n",(0,r.jsx)(e.li,{children:"EVENT, BINARY_EVENT -> ACK, BINARY_ACK"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"<packet type>[<# of binary attachments>-][<namespace>,][<acknowledgment id>][JSON-stringified payload without binary]\n\n+ binary attachments extracted\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.em,{children:"\u7F16\u7801"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{ "type": "CONNECT", "namespace": "/admin", "data": { "sid": "oSO0OpakMV_3jnilAAAA" } }\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'0/admin,{"sid":"oSO0OpakMV_3jnilAAAA"}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u53C2\u8003"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/socketio/socket.io-protocol",children:"https://github.com/socketio/socket.io-protocol"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/socketio/engine.io-protocol",children:"https://github.com/socketio/engine.io-protocol"})}),"\n"]}),"\n",(0,r.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(e.h2,{id:"namespace-vs-room",children:"namespace vs room"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u76F8\u540C\u70B9"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u547D\u540D\u7A7A\u95F4\u548C\u623F\u95F4\u90FD\u662F\u5728\u670D\u52A1\u7AEF\u521B\u5EFA"}),"\n",(0,r.jsx)(e.li,{children:"\u670D\u52A1\u5668\u53EA\u4F1A\u5C06\u6D88\u606F\u5206\u53D1\u7ED9\u8FDE\u63A5\u5230\u4E86\u76F8\u5E94\u547D\u540D\u7A7A\u95F4\u548C\u623F\u95F4\u7684\u5BA2\u6237\u7AEF"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u4E0D\u540C\u70B9"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4E00\u4E2A\u547D\u540D\u7A7A\u95F4\u4E00\u4E2A\u8FDE\u63A5,\u4E00\u4E2A\u547D\u540D\u7A7A\u95F4\u4E0B\u7684\u623F\u95F4\u5171\u4EAB\u4E00\u4E2A\u8FDE\u63A5"}),"\n",(0,r.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u53EF\u4EFB\u610F\u79BB\u5F00\u623F\u95F4,\u4F46\u8981\u79BB\u5F00\u547D\u540D\u7A7A\u95F4\u53EA\u80FD\u65AD\u5F00\u8FDE\u63A5"}),"\n",(0,r.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u53EA\u80FD\u8FDE\u63A5\u5230\u670D\u52A1\u5668\u4E0A\u5DF2\u7ECF\u5B58\u5728\u7684\u547D\u540D\u7A7A\u95F4"}),"\n",(0,r.jsx)(e.li,{children:"\u53EA\u80FD\u5728\u670D\u52A1\u5668\u7AEF\u8FDB\u5165\u623F\u95F4,\u4F46\u5B9E\u73B0\u4E00\u4E2A\u4ECE\u5BA2\u6237\u7AEF\u63A7\u5236\u670D\u52A1\u7AEF\u52A0\u5165\u623F\u95F4\u7684\u547D\u4EE4\u5F88\u7B80\u5355."}),"\n",(0,r.jsx)(e.li,{children:"\u547D\u540D\u7A7A\u95F4\u53EF\u8FDB\u884C\u6388\u6743\u9A8C\u8BC1"}),"\n",(0,r.jsx)(e.li,{children:"\u623F\u95F4\u867D\u7136\u4E0D\u652F\u6301\u6388\u6743\u9A8C\u8BC1,\u4F46\u81EA\u5B9A\u4E49\u4E00\u4E2A\u6388\u6743\u9A8C\u8BC1\u8FD8\u662F\u5F88\u5BB9\u6613\u7684."}),"\n",(0,r.jsx)(e.li,{children:"\u623F\u95F4\u662F\u547D\u540D\u7A7A\u95F4\u7684\u4E00\u90E8\u5206,\u9ED8\u8BA4\u4E3A 'global' \u547D\u540D\u7A7A\u95F4"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u56E0\u6B64\u4F7F\u7528\u547D\u540D\u7A7A\u95F4\u6700\u597D\u4F7F\u7528\u670D\u52A1\u5668\u4E0A\u5DF2\u7ECF\u5B9A\u4E49\u597D\u7684,\u800C\u623F\u95F4\u4E3B\u8981\u7528\u4E8E\u52A8\u6001\u521B\u5EFA\u7684."}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"http://stackoverflow.com/questions/10930286",children:"http://stackoverflow.com/questions/10930286"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://divillysausages.com/2015/07/12/an-intro-to-socket-io/",children:"https://divillysausages.com/2015/07/12/an-intro-to-socket-io/"})}),"\n"]})]})}function a(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},917776:function(n,e,s){s.d(e,{R:()=>c,x:()=>l});var i=s(7378);let r={},t=i.createContext(r);function c(n){let e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);