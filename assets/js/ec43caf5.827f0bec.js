"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["10072"],{47189:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>i,toc:()=>d,default:()=>h,metadata:()=>r,assets:()=>a,contentTitle:()=>l});var r=JSON.parse('{"id":"service/auth/authz/casbin","title":"Casbin","description":"- \u652F\u6301\u7684\u6A21\u5F0F","source":"@site/../notes/service/auth/authz/casbin.md","sourceDirName":"service/auth/authz","slug":"/service/auth/authz/casbin","permalink":"/notes/service/auth/authz/casbin","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/auth/authz/casbin.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1633860901000,"frontMatter":{"title":"Casbin"},"sidebar":"docs","previous":{"title":"TOTP","permalink":"/notes/service/auth/authn/totp"},"next":{"title":"CASL","permalink":"/notes/service/auth/authz/casl"}}'),t=s(86106),c=s(17776);let i={title:"Casbin"},l="Casbin",a={},d=[{value:"\u6A21\u578B",id:"\u6A21\u578B",level:2},{value:"\u5185\u7F6E\u51FD\u6570",id:"\u5185\u7F6E\u51FD\u6570",level:3},{value:"\u793A\u4F8B",id:"\u793A\u4F8B",level:2}];function o(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"casbin",children:"Casbin"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u652F\u6301\u7684\u6A21\u5F0F\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ACL - \u8D85\u7EA7\u7528\u6237, \u65E0\u7528\u6237, \u65E0\u8D44\u6E90"}),"\n",(0,t.jsx)(n.li,{children:"RBAC - \u8D44\u6E90\u89D2\u8272, \u79DF\u6237\u89D2\u8272"}),"\n",(0,t.jsx)(n.li,{children:"ABAC"}),"\n",(0,t.jsx)(n.li,{children:"RESTful \u8DEF\u5F84"}),"\n",(0,t.jsx)(n.li,{children:"\u62D2\u7EDD\u4F18\u5148"}),"\n",(0,t.jsx)(n.li,{children:"\u4F18\u5148\u7EA7"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u914D\u7F6E\u5206\u4E3A \u6A21\u578B\u5B9A\u4E49\u3001Policy\u3001\u89D2\u8272 - Policy \u548C \u89D2\u8272\u914D\u7F6E\u53EF\u9009"}),"\n",(0,t.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/casbin/casdoor",children:"casbin/casdoor"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5E26 UI \u7684\u4E2D\u5FC3\u5316 SSO \u5E73\u53F0"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://casbin.org/docs/zh-CN/tutorials",children:"\u6559\u7A0B"})}),"\n",(0,t.jsxs)(n.li,{children:["Golang\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u6C42\u503C\u4F7F\u7528 ",(0,t.jsx)(n.a,{href:"https://github.com/Knetic/govaluate",children:"Knetic/govaluate"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u6A21\u578B",children:"\u6A21\u578B"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"PERM (Policy, Effect, Request, Matcher)"}),"\n",(0,t.jsx)(n.li,{children:"Request - r - \u81F3\u5C11\u5305\u542B subject, object, action"}),"\n",(0,t.jsxs)(n.li,{children:["Policy - p - \u5B9A\u4E49\u8BBF\u95EE\u7B56\u7565\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7B56\u7565\u5185\u5BB9\u5747\u4E3A string"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Matcher - m - Request \u548C Policy \u5339\u914D\u89C4\u5219\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F8B\u5982 m = r.sub == p.sub && r.act == p.act && r.obj == p.obj"}),"\n",(0,t.jsxs)(n.li,{children:["\u5982\u679C\u5339\u914D\u5219\u8FD4\u56DE ",(0,t.jsx)(n.code,{children:"p.eft"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Effect - e - \u5F71\u54CD - \u5141\u8BB8\u3001\u62D2\u7EDD\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4F8B\u5982 ",(0,t.jsx)(n.code,{children:"e = some(where(p.eft == allow))"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4EFB\u610F\u4E00\u4E2A policy \u5141\u8BB8"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u4F8B\u5982 ",(0,t.jsx)(n.code,{children:"e = some(where (p.eft == allow)) && !some(where (p.eft == deny))"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6CA1\u6709\u62D2\u7EDD\u4E14\u6709\u4E00\u4E2A\u5141\u8BB8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"# \u8BF7\u6C42\u5B9A\u4E49 - \u5B9A\u4E49\u8BF7\u6C42 Enforce \u53C2\u6570\u542B\u4E49\n# \u53EA\u80FD\u5B9A\u4E49\u4E00\u4E2A\n[request_definition]\nr = sub, obj, act\n\n# \u7B56\u7565\u5B9A\u4E49 - \u5B9A\u4E49 Policy \u89C4\u5219\u5217\u8868\u53C2\u6570\u542B\u4E49\n# \u53EA\u80FD\u5B9A\u4E49\u4E00\u4E2A\n[policy_definition]\np = sub, obj, act\n\n# \u5408\u5E76\u591A\u4E2A\u7B56\u7565\u7ED3\u679C\n# \u53EA\u80FD\u5B9A\u4E49\u4E00\u4E2A\n[policy_effect]\ne = some(where (p.eft == allow))\n\n# \u5339\u914D\u8BF7\u6C42\u548C\u7B56\u7565\n# \u53EA\u80FD\u5B9A\u4E49\u4E00\u4E2A\n# \u53EF\u4EE5\u8FD0\u884C\u65F6\u6307\u5B9A\n[matchers]\nm = r.sub == p.sub && r.obj == p.obj && r.act == p.act\n\n# \u89D2\u8272\u5B9A\u4E49 - \u51B3\u5B9A\u53C2\u6570\u4E2A\u6570\n# \u53EF\u5B9A\u4E49\u591A\u4E2A\n# \u5C06 a \u6620\u5C04\u4E3A b \u7684\u8FC7\u7A0B\n[role_definition]\n# \u4F8B\u5982 g(r.sub, p.sub)\ng = _, _\n# \u4F8B\u5982 g2(r.sub, p.sub, r.dom)\ng2 = _, _, _\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"policy.csv"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csv",children:"p, alice, data1, read\np, bob, data1, read\n\ng, alice, data_group_admin\ng2, data1, data_group, t1\ng2, data2, data_group, t2\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u7B56\u7565\u89C4\u5219\uFF0C\u542B\u4E49\u5728 policy_definition \u548C role_definition \u5B9A\u4E49\uFF0C\u6240\u6709\u89C4\u5219\u53C2\u6570\u90FD\u4F1A\u5F53\u4F5C ",(0,t.jsx)(n.strong,{children:"\u5B57\u7B26\u4E32"})," \u5904\u7406\u3002"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"p = sub, obj, act, eft"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"policy \u89C4\u5219\u53EF\u6DFB\u52A0\u4F18\u5148\u7EA7, \u4E0D\u8BBE\u7F6E\u5219\u987A\u5E8F\u4E3A\u4F18\u5148\u7EA7"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csv",children:"p, 10, data2_allow_group, data2, read, deny\np, 10, data2_allow_group, data2, write, allow\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u5185\u7F6E\u51FD\u6570",children:"\u5185\u7F6E\u51FD\u6570"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u5185\u5EFA\u51FD\u6570\u7B7E\u540D\u90FD\u662F ",(0,t.jsx)(n.code,{children:"bool function(string arg1, string arg2)"})]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"name"}),(0,t.jsx)(n.th,{children:"demo"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyMatch"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyMatch("/alice_data/resource1","/alice_data/*")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyGet"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyGet("/alice_data/resource1","/alice_data/*")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyMatch2"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyMatch2("/alice_data/resource1","/alice_data/:resource")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyGet2"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyGet2("/alice_data/resource1","/alice_data/:resource")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyMatch3"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyMatch3("/alice_data/resource1","/alice_data/{resource}")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"keyMatch4"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'keyMatch4("/alice_data/123/book/123","/alice_data/{id}/book/{id}")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"globMatch"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'globMatch("/alice_data/resource1","/alice_data/*")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ipMatch"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'ipMatch("192.168.2.123","192.168.2.0/24")'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"regexMatch"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'regexMatch("abc","^a.*?b$")'})})]})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4F7F\u7528\u53C2\u8003 ",(0,t.jsx)(n.a,{href:"https://github.com/casbin/casbin/blob/master/util/builtin_operators_test.go",children:"util/builtin_operators_test.go"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u793A\u4F8B",children:"\u793A\u4F8B"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:'[matchers]\n# \u6700\u57FA\u7840\u5339\u914D\u903B\u8F91 - Policy \u4F5C\u4E3A ACL\nm = r.sub == p.sub && r.obj == p.obj && r.act == p.act\n\n# \u652F\u6301\u8D85\u7EA7\u7BA1\u7406\u5458\nm = r.sub == p.sub && r.obj == p.obj && r.act == p.act || r.sub == "root"\n# \u89D2\u8272\u5224\u65AD\nm = g(r.sub, p.sub) && r.obj == p.obj && r.act == p.act\n# \u8D44\u6E90\u89D2\u8272\nm = g(r.sub, p.sub) && g2(r.obj, p.obj) && r.act == p.act\n# \u79DF\u6237\nm = g(r.sub, p.sub, r.dom) && r.dom == p.dom && r.obj == p.obj && r.act == p.act\n\n# \u6CA1\u6709 \u7528\u6237/subject - \u53EA\u5224\u65AD\u5BF9\u8C61\u548C\u64CD\u4F5C\nm = r.obj == p.obj && r.act == p.act\n\n# \u6CA1\u6709 \u8D44\u6E90/obj\nm = r.sub == p.sub && r.act == p.act\n\n# ABAC - \u57FA\u4E8E\u5C5E\u6027\u63A7\u5236\nm = r.sub == r.obj.Owner\n\n# RESTful \u8DEF\u5F84\u5339\u914D\nm = r.sub == p.sub && keyMatch(r.obj, p.obj) && regexMatch(r.act, p.act)\n\n[policy_effect]\n# \u53EA\u8981\u6709\u540C\u610F\u5373\u53EF\ne = some(where (p.eft == allow))\n# \u62D2\u7EDD\u4F18\u5148\ne = !some(where (p.eft == deny))\n# \u6709\u540C\u610F\u4E14\u6CA1\u6709\u62D2\u7EDD\ne = some(where (p.eft == allow)) && !some(where (p.eft == deny))\n\n# \u4F18\u5148\u5224\u65AD - p \u5B9A\u4E49\u987A\u5E8F\u9690\u542B\u4F18\u5148\u7EA7\uFF0C\u6216\u8005 p \u89C4\u5219\u7B2C\u4E00\u4E2A\u53C2\u6570\u8BBE\u7F6E\u4E3A\u4F18\u5148\u7EA7\n# p = sub, obj, act, eft\ne = priority(p.eft) || deny\n'})})]})}function h(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},17776:function(e,n,s){s.d(n,{R:()=>i,x:()=>l});var r=s(7378);let t={},c=r.createContext(t);function i(e){let n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);