"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["43533"],{86576:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>c,toc:()=>h,default:()=>a,metadata:()=>s,assets:()=>t,contentTitle:()=>d});var s=JSON.parse('{"id":"db/relational/postgresql/postgresql-acl","title":"ACL","description":"- CREATE USER \u662F CREATE ROLE \u7684\u522B\u540D","source":"@site/../notes/db/relational/postgresql/postgresql-acl.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/acl","permalink":"/notes/db/relational/postgresql/acl","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-acl.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1755485818000,"frontMatter":{"title":"ACL"},"sidebar":"docs","previous":{"title":"Supabase PostgreSQL Image","permalink":"/notes/db/relational/postgresql/postgres-supabase"},"next":{"title":"PostgreSQL Admin","permalink":"/notes/db/relational/postgresql/admin"}}'),r=l(86106),i=l(17776);let c={title:"ACL"},d="PostgreSQL ACL",t={},h=[{value:"ROLE \u5C5E\u6027",id:"role-\u5C5E\u6027",level:2},{value:"list grants",id:"list-grants",level:2},{value:"list role settings",id:"list-role-settings",level:2},{value:"list policy",id:"list-policy",level:2}];function E(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"postgresql-acl",children:"PostgreSQL ACL"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CREATE USER"})," \u662F ",(0,r.jsx)(n.code,{children:"CREATE ROLE"})," \u7684\u522B\u540D"]}),"\n"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["DATABASE - \u6570\u636E\u5E93\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CONNECT"})," - \u5141\u8BB8\u7528\u6237\u8FDE\u63A5\u5230\u6570\u636E\u5E93\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CREATE"})," - \u5141\u8BB8\u7528\u6237\u5728\u6570\u636E\u5E93\u4E2D\u521B\u5EFA\u65B0\u7684 Schema\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TEMPORARY"})," / ",(0,r.jsx)(n.code,{children:"TEMP"})," - \u5141\u8BB8\u7528\u6237\u5728\u6B64\u6570\u636E\u5E93\u4E2D\u521B\u5EFA\u4E34\u65F6\u8868\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["SCHEMA - \u6A21\u5F0F\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"USAGE"})," - \u5141\u8BB8\u7528\u6237\u8BBF\u95EE Schema \u4E2D\u7684\u5BF9\u8C61\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CREATE"})," - \u5141\u8BB8\u7528\u6237\u5728\u6B64 Schema \u4E2D\u521B\u5EFA\u65B0\u5BF9\u8C61\uFF08\u5982\u8868\u3001\u89C6\u56FE\u3001\u51FD\u6570\u7B49\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["TABLE - \u8868\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SELECT"})," - \u5141\u8BB8\u4ECE\u8868\u6216\u7279\u5B9A\u5217\u8BFB\u53D6\u6570\u636E\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"INSERT"})," - \u5141\u8BB8\u5411\u8868\u4E2D\u63D2\u5165\u65B0\u884C\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"UPDATE"})," - \u5141\u8BB8\u66F4\u65B0\u8868\u4E2D\u5DF2\u6709\u7684\u884C\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DELETE"})," - \u5141\u8BB8\u4ECE\u8868\u4E2D\u5220\u9664\u884C\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TRUNCATE"})," - \u5141\u8BB8\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"TRUNCATE"})," \u547D\u4EE4\u5FEB\u901F\u6E05\u7A7A\u8868\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"REFERENCES"})," - \u5141\u8BB8\u521B\u5EFA\u6307\u5411\u6B64\u8868\u7684\u5916\u952E\u7EA6\u675F\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TRIGGER"})," - \u5141\u8BB8\u5728\u8868\u4E0A\u521B\u5EFA\u89E6\u53D1\u5668\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["COLUMN - \u5217\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SELECT"})," - \u5141\u8BB8\u4ECE\u7279\u5B9A\u5217\u8BFB\u53D6\u6570\u636E\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"INSERT"})," - \u5141\u8BB8\u5728 ",(0,r.jsx)(n.code,{children:"INSERT"})," \u547D\u4EE4\u4E2D\u4E3A\u7279\u5B9A\u5217\u63D0\u4F9B\u503C\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"UPDATE"})," - \u5141\u8BB8\u5728 ",(0,r.jsx)(n.code,{children:"UPDATE"})," \u547D\u4EE4\u4E2D\u66F4\u65B0\u7279\u5B9A\u5217\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"REFERENCES"})," - \u5141\u8BB8\u521B\u5EFA\u6307\u5411\u6B64\u5217\u7684\u5916\u952E\u7EA6\u675F\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["SEQUENCE - \u5E8F\u5217\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"USAGE"})," - \u5141\u8BB8\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"currval"})," \u548C ",(0,r.jsx)(n.code,{children:"nextval"})," \u51FD\u6570\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SELECT"})," - \u5141\u8BB8\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"currval"})," \u51FD\u6570\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"UPDATE"})," - \u5141\u8BB8\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"nextval"})," \u548C ",(0,r.jsx)(n.code,{children:"setval"})," \u51FD\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["FUNCTION / PROCEDURE - \u51FD\u6570 / \u8FC7\u7A0B\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"EXECUTE"})," - \u5141\u8BB8\u8C03\u7528\u51FD\u6570\u6216\u8FC7\u7A0B\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["VIEW - \u89C6\u56FE\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u6743\u9650\u4E0E\u8868\uFF08TABLE\uFF09\u7684\u6743\u9650\u7C7B\u4F3C\uFF08",(0,r.jsx)(n.code,{children:"SELECT"}),", ",(0,r.jsx)(n.code,{children:"INSERT"}),", ",(0,r.jsx)(n.code,{children:"UPDATE"})," \u7B49\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["TYPE - \u7C7B\u578B\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"USAGE"})," - \u5141\u8BB8\u4F7F\u7528\u81EA\u5B9A\u4E49\u7C7B\u578B\uFF08\u4F8B\u5982\uFF0C\u5728\u521B\u5EFA\u8868\u3001\u51FD\u6570\u6216\u8FDB\u884C\u7C7B\u578B\u8F6C\u6362\u65F6\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["TABLESPACE - \u8868\u7A7A\u95F4\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CREATE"})," - \u5141\u8BB8\u5728\u6B64\u8868\u7A7A\u95F4\u4E2D\u521B\u5EFA\u6570\u636E\u5E93\u5BF9\u8C61\uFF08\u5982\u8868\u3001\u7D22\u5F15\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User -> Role - \u65B0\u7248\u90FD\u662F ROLE"}),"\n",(0,r.jsxs)(n.li,{children:["\u5C5E\u6027\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["LOGIN - \u53EF\u767B\u5F55 - ",(0,r.jsx)(n.code,{children:"CREATE USER"})," \u9ED8\u8BA4\u5305\u542B LOGIN"]}),"\n",(0,r.jsxs)(n.li,{children:["INHERIT - \u662F\u5426\u7EE7\u627F\u6743\u9650 IN ROLE - \u9ED8\u8BA4 \u5F00\u542F\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9ED8\u8BA4\u7EE7\u627F PUBLIC"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"SUPERUSER"}),"\n",(0,r.jsx)(n.li,{children:"CREATEDB"}),"\n",(0,r.jsx)(n.li,{children:"CREATEROLE"}),"\n",(0,r.jsx)(n.li,{children:"REPLICATION LOGIN"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"PASSWORD 'password' | PASSWORD NULL"})}),"\n",(0,r.jsx)(n.li,{children:"BYPASSRLS - RLS \u4E0D\u751F\u6548"}),"\n",(0,r.jsx)(n.li,{children:"CONNECTION LIMIT - \u8FDE\u63A5\u6570\u9650\u5236"}),"\n",(0,r.jsx)(n.li,{children:"VALID UNTIL 'timestamp'"}),"\n",(0,r.jsx)(n.li,{children:"IN ROLE - \u8D4B\u4E88\u89D2\u8272"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ROLE role"})," - \u6DFB\u52A0\u5176\u4ED6\u89D2\u8272\u5230\u8BE5\u5206\u7EC4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ADMIN role"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7C7B\u4F3C ROLE, \u4F46\u5141\u8BB8\u8BE5\u89D2\u8272\u6DFB\u52A0\u5176\u4ED6\u6210\u5458\u5230\u8BE5\u7EC4"}),"\n",(0,r.jsxs)(n.li,{children:["\u5141\u8BB8 ",(0,r.jsx)(n.code,{children:"role"})," \u6DFB\u52A0\u5176\u4ED6\u6210\u5458\u5230\u8BE5\u7EC4"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u9884\u8BBE\u89D2\u8272\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"pg_read_all_data"}),"\n",(0,r.jsx)(n.li,{children:"pg_read_all_settings"}),"\n",(0,r.jsx)(n.li,{children:"pg_read_all_stats"}),"\n",(0,r.jsx)(n.li,{children:"pg_write_all_data"}),"\n",(0,r.jsx)(n.li,{children:"pg_stat_scan_tables - ACCESS SHARE"}),"\n",(0,r.jsx)(n.li,{children:"pg_monitor -> pg_read_all_settings, pg_read_all_stats, pg_stat_scan_tables"}),"\n",(0,r.jsx)(n.li,{children:"pg_database_owner"}),"\n",(0,r.jsx)(n.li,{children:"pg_signal_backend - \u53D6\u6D88\u67E5\u8BE2\u3001\u7EC8\u6B62\u4F1A\u8BDD"}),"\n",(0,r.jsx)(n.li,{children:"pg_read_server_files - COPY"}),"\n",(0,r.jsx)(n.li,{children:"pg_write_server_files"}),"\n",(0,r.jsx)(n.li,{children:"pg_execute_server_program"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["GRANT - ",(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/ddl-priv.html",children:"Privileges"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u89D2\u8272\u6743\u9650\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8868 - SELECT | INSERT | UPDATE | DELETE | TRUNCATE | REFERENCES | TRIGGER\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5141\u8BB8\u521B\u5EFA\u5916\u952E\u9650\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u5141\u8BB8\u521B\u5EFA TRIGGER"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"\u5217 - SELECT | INSERT | UPDATE | REFERENCES"}),"\n",(0,r.jsx)(n.li,{children:"\u5E8F\u5217 - USAGE | SELECT | UPDATE"}),"\n",(0,r.jsx)(n.li,{children:"\u6570\u636E\u5E93 - CREATE | CONNECT | TEMPORARY | TEMP"}),"\n",(0,r.jsx)(n.li,{children:"Schema - CREATE | USAGE"}),"\n",(0,r.jsx)(n.li,{children:"Domain - USAGE"}),"\n",(0,r.jsx)(n.li,{children:"FDW - USAGE"}),"\n",(0,r.jsx)(n.li,{children:"FOREIGN SERVER - USAGE"}),"\n",(0,r.jsx)(n.li,{children:"FUNCTION, PROCEDURE, ROUTINE - EXECUTE"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"PUBLIC=\u6240\u6709\u89D2\u8272"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["POLICY - \u8868 RLS\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PERMISSIVE - OR \u5408\u5E76 - \u9ED8\u8BA4"}),"\n",(0,r.jsx)(n.li,{children:"RESTRICTIVE - AND \u5408\u5E76"}),"\n",(0,r.jsxs)(n.li,{children:["USING - \u68C0\u67E5 SELECT \u548C ",(0,r.jsx)(n.code,{children:"INSERT/UPDATE \u2026 RETURNING"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"false - \u884C\u4E0D\u663E\u793A"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["WITH CHECK - \u68C0\u67E5 INSERT \u548C UPDATE - \u9ED8\u8BA4\u4F7F\u7528 USING \u6761\u4EF6\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"false - \u51FA\u9519"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"RULE - \u91CD\u5199\u8BED\u53E5"}),"\n",(0,r.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-grant.html",children:"GRANT"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-alterrole.html",children:"ALTER ROLE"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-createrole.html",children:"CREATE ROLE"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-alterdefaultprivileges.html",children:"ALTER DEFAULT PRIVILEGES"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5F71\u54CD\u672A\u6765\u521B\u5EFA\u5BF9\u8C61\uFF0C\u4E0D\u5F71\u54CD\u73B0\u5728"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-createuser.html",children:"CREATE USER"})}),"\n",(0,r.jsxs)(n.li,{children:["postgrest ",(0,r.jsx)(n.a,{href:"https://postgrest.org/en/stable/auth.html",children:"auth"})]}),"\n",(0,r.jsxs)(n.li,{children:["pgconf us 2019 ",(0,r.jsx)(n.a,{href:"https://postgresconf.org/system/events/document/000/000/996/pgconf_us_2019.pdf",children:"Row Level Security"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["set_config \u662F\u4E0D\u80FD\u88AB\u63A7\u5236\u7684\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RLS \u9488\u5BF9 current_user - \u7EF4\u62A4\u5F88\u591A\u7528\u6237\u8BB0\u5F55"}),"\n",(0,r.jsx)(n.li,{children:"RLS \u9488\u5BF9 \u5339\u914D\u5BC6\u7801 \u8BB0\u5F55 - db \u8BA1\u7B97\u91CF\u66F4\u5927"}),"\n",(0,r.jsxs)(n.li,{children:["RLS \u9488\u5BF9 current_settings - \u7B80\u5355\u65B9\u4FBF\uFF0C\u4F46\u4E0D\u53EF\u5BF9\u5916\u66B4\u9732\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4E5F\u53EF\u4EE5\u540C\u65F6\u9488\u5BF9 current_user - \u4F18\u5148\u4F7F\u7528\u4ECE current_user \u63D0\u53D6\u7684\u4FE1\u606F"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"tid bigint := coalesce(nullif(current_setting('tenant.id', true), '')::bigint,((regexp_match(current_user, 'tenant_(\\d+)$'))[1])::bigint)"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"RLS \u9488\u5BF9 \u7528\u6237 \u4F7F\u7528\u9759\u6001\u503C - \u6027\u80FD\u6700\u597D\uFF0C\u53EF\u63D0\u524D\u4F18\u5316\u67E5\u8BE2"}),"\n",(0,r.jsx)(n.li,{children:"RLS \u9700\u8981\u8003\u8651\u505A\u5230 \u79DF\u6237 \u7EF4\u5EA6\u8FD8\u662F \u7528\u6237 \u7EF4\u5EA6"}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"create role wener login password 'wener'; -- \u53EF\u767B\u5F55\u7528\u6237\ncreate role admin; -- \u4E0D\u53EF\u767B\u5F55\u89D2\u8272\ngrant admin to wener; -- \u628A wener \u52A0\u5165 admin \u5206\u7EC4\n-- \u7ED9\u5206\u7EC4\u52A0\u6743\u9650\uFF0C\u6210\u5458\u4E5F\u4F1A\u5F97\u5230\u6743\u9650\ngrant all on all tables in schema public to admin;\n\n-- \u4E0D\u53EF\u4EE5\u7528\u4E8E SECURITY DEFINER\n-- SET [ SESSION | LOCAL ] ROLE NONE|role_name\nSET ROLE wener; -- \u4FEE\u6539 current_user\nRESET ROLE;     -- \u6062\u590D\n\n-- \u7C7B\u4F3C\u4E8E SET ROLE\n-- \u8BBE\u7F6E\u540E\uFF0C\u4E0B\u6B21 SET ROLE \u4F1A\u6821\u9A8C\u662F\u5426\u6709\u6743\u9650\uFF0C\u800C SET ROLE \u5219\u662F\u57FA\u4E8E\u6700\u5F00\u59CB\u7684\u6743\u9650\u5224\u65AD\n-- SET LOCAL \u53EF\u4EE5\u7528\u4E8E SECURITY DEFINER\n-- SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT|user_name\nSET SESSION AUTHORIZATION wener;\nRESET SESSION AUTHORIZATION\n"})}),"\n",(0,r.jsx)(n.h2,{id:"role-\u5C5E\u6027",children:"ROLE \u5C5E\u6027"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'select current_user; -- \u5F53\u524D\u7528\u6237\n\n-- \u63A7\u5236\u53EF\u89C1\u8303\u56F4\n-- \u9ED8\u8BA4 "$user", public\nshow search_path;\n-- \u9488\u5BF9 ROLE \u8BBE\u7F6E\nalter role demo_app_web set search_path = app_web,public;\n\n-- \u9488\u5BF9 ROLE \u8BBE\u7F6E SESSION \u53D8\u91CF\n-- \u26A0\uFE0F \u53EA\u6709\u5728 LOGIN \u624D\u751F\u6548\uFF0CSET ROLE \u548C SET SESSION AUTHORIZATION \u4E0D\u751F\u6548\u3002\nalter role demo_t_500 set tenant.id = 500;\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"search_path \u53EF\u9488\u5BF9 ROLE, DATABASE \u8BBE\u7F6E"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"list-grants",children:"list grants"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT grantee, grantor, table_schema, table_name, privilege_type\nFROM information_schema.role_table_grants\nWHERE table_schema NOT IN ('pg_catalog', 'information_schema', 'columnar')\n  AND table_name NOT IN ('citus_tables');\n"})}),"\n",(0,r.jsx)(n.h2,{id:"list-role-settings",children:"list role settings"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT r.rolname, d.datname, rs.setconfig\nFROM pg_db_role_setting rs\n         LEFT JOIN pg_roles r ON r.oid = rs.setrole\n         LEFT JOIN pg_database d ON d.oid = rs.setdatabase;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"list-policy",children:"list policy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT n.nspname                                   AS schemaname,\n       c.relname                                   AS tablename,\n       pol.polname                                 AS policyname,\n       CASE\n           WHEN pol.polpermissive THEN 'PERMISSIVE'::text\n           ELSE 'RESTRICTIVE'::text\n           END                                     AS permissive,\n       CASE\n           WHEN pol.polroles = '{0}'::oid[] THEN string_to_array('public'::text, ''::text)::name[]\n           ELSE ARRAY(SELECT pg_authid.rolname\n                      FROM pg_authid\n                      WHERE pg_authid.oid = ANY (pol.polroles)\n                      ORDER BY pg_authid.rolname)\n           END                                     AS roles,\n       CASE pol.polcmd\n           WHEN 'r'::\"char\" THEN 'SELECT'::text\n           WHEN 'a'::\"char\" THEN 'INSERT'::text\n           WHEN 'w'::\"char\" THEN 'UPDATE'::text\n           WHEN 'd'::\"char\" THEN 'DELETE'::text\n           WHEN '*'::\"char\" THEN 'ALL'::text\n           ELSE NULL::text\n           END                                     AS cmd,\n       pg_get_expr(pol.polqual, pol.polrelid)      AS qual,\n       pg_get_expr(pol.polwithcheck, pol.polrelid) AS with_check\nFROM pg_policy pol\n         JOIN pg_class c ON c.oid = pol.polrelid\n         LEFT JOIN pg_namespace n ON n.oid = c.relnamespace;\n"})})]})}function a(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(E,{...e})}):E(e)}},17776:function(e,n,l){l.d(n,{R:()=>c,x:()=>d});var s=l(7378);let r={},i=s.createContext(r);function c(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);