"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["596672"],{937139:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>a,toc:()=>d,default:()=>o,metadata:()=>i,assets:()=>c,contentTitle:()=>l});var i=JSON.parse('{"id":"java/java-tuning","title":"Tuning","description":"| -X   | for               | default     |","source":"@site/../notes/java/java-tuning.md","sourceDirName":"java","slug":"/java/tuning","permalink":"/notes/java/tuning","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/java/java-tuning.md","tags":[{"inline":true,"label":"Tuning","permalink":"/notes/tags/tuning"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Tuning","tags":["Tuning"]},"sidebar":"docs","previous":{"title":"Observe","permalink":"/notes/java/observe"},"next":{"title":"JDWP","permalink":"/notes/java/jdwp"}}'),t=s(486106),r=s(917776);let a={title:"Tuning",tags:["Tuning"]},l="Java Tuning",c={},d=[{value:"\u5185\u5B58\u9650\u5236",id:"memort-limit",level:2},{value:"GC",id:"gc",level:2},{value:"PrintFlagsFinal",id:"printflagsfinal",level:2},{value:"Flag List Example",id:"flag-list-example",level:3}];function h(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"java-tuning",children:"Java Tuning"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"-X"}),(0,t.jsx)(e.th,{children:"for"}),(0,t.jsx)(e.th,{children:"default"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"-Xms"}),(0,t.jsx)(e.td,{children:"initial heap size"}),(0,t.jsx)(e.td,{})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"-Xmx"}),(0,t.jsx)(e.td,{children:"max heap size"}),(0,t.jsx)(e.td,{children:"25%,\u6700\u592725G"})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"-XX:flag"}),(0,t.jsx)(e.th,{children:"for"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"InitialRAMPercentage"}),(0,t.jsxs)(e.td,{children:["\u521D\u59CB ",(0,t.jsx)(e.strong,{children:"\u5806\u5185\u5B58"})," \u6BD4\u4F8B"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"MaxRAMPercentage"}),(0,t.jsxs)(e.td,{children:["\u6700\u5927 ",(0,t.jsx)(e.strong,{children:"\u5806\u5185\u5B58"})," \u6BD4\u4F8B"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"MinRAMPercentage"}),(0,t.jsxs)(e.td,{children:["\u6700\u5C0F ",(0,t.jsx)(e.strong,{children:"\u5806\u5185\u5B58"})," \u6BD4\u4F8B"]})]})]})]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"-Xmx12g -Xms12g -Xmn8g -XX:MaxMetaspaceSize=512m -XX:MaxDirectMemorySize=256M -XX:+UseContainerSupport -XX:+UseG1GC -XX:MaxGCPauseMillis=200\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"-XX:+UseContainerSupport -XX:InitialRAMPercentage=70.0 -XX:MaxRAMPercentage=70.0 -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:/home/admin/nas/gc-${POD_IP}-$(date '+%s').log -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/nas/dump-${POD_IP}-$(date '+%s').hprof\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"JAVA_TOOL_OPTIONS"}),"\n",(0,t.jsxs)(e.li,{children:["JDK_JAVA_OPTIONS\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Java 9+"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://chriswhocodes.com/",children:"https://chriswhocodes.com/"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://eclipse.dev/openj9/docs/xx_jvm_commands/",children:"https://eclipse.dev/openj9/docs/xx_jvm_commands/"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://www.alibabacloud.com/help/en/sae/latest/best-practices-for-jvm-heap-size-configuration",children:"https://www.alibabacloud.com/help/en/sae/latest/best-practices-for-jvm-heap-size-configuration"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://cloud.tencent.com/developer/article/1198524",children:"https://cloud.tencent.com/developer/article/1198524"})}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"memort-limit",children:"\u5185\u5B58\u9650\u5236"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"java -XshowSettings:vm -version\njava -XX:+PrintFlagsFinal -version\n\njava -XX:+PrintFlagsFinal -version | grep -E 'Container|RAM|HeapSize'\njava -XX:+PrintFlagsFinal -XX:MaxRAMPercentage=100.0 -version | grep -E 'Container|RAM'\n\n# limits\ncat /sys/fs/cgroup/memory/memory.limit_in_bytes\n\n# \u65B0\u7248\u672C JAVA\njava -Xlog:os+container=trace -version\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["UseContainerSupport\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u9ED8\u8BA4\u5F00\u542F"}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"MaxRAMPercentage=25%"})}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"limit"}),(0,t.jsx)(e.th,{children:"MaxRAM"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"< 1GB"}),(0,t.jsx)(e.td,{children:"50%"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"1GB < 2GB"}),(0,t.jsx)(e.td,{children:"512MB"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"> 2GB"}),(0,t.jsx)(e.td,{children:"75%"})]})]})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"-Xcompressedrefs"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"3-bit shift"}),"\n",(0,t.jsx)(e.li,{children:"heap size 25GB \u4E0A\u9650"}),"\n",(0,t.jsxs)(e.li,{children:["\u53EF\u901A\u8FC7 ",(0,t.jsx)(e.code,{children:"-XX:MaxRAMPercentage"})," \u6216\u8005 ",(0,t.jsx)(e.code,{children:"-Xmx"})," \u8986\u76D6"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"-verbose:sizes"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"-Xmx"}),"\n",(0,t.jsxs)(e.li,{children:["-XX:MaxRAMPercentage, -XX:MinRAMPercentage, -XX:InitialRAMPercentage\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Java 8 update 191+"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["-XX:MaxRAMFraction, -XX:MinRAMFraction\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Java 8 update 131 -> Java 8 update 190"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"java -XX:MaxRAMPercentage=50 -XshowSettings:vm -version\n\njava -XshowSettings:vm -version\njava -Xmx512m -XshowSettings:vm -version\njava -XX:+UseContainerSupport -XshowSettings:vm -version\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u9700\u8981/1024\ncat /sys/fs/cgroup/cpu/cpu.shares\n"})}),"\n",(0,t.jsx)(e.h2,{id:"gc",children:"GC"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.oracle.com/en/java/javase/17/gctuning/ergonomics.html",children:"https://docs.oracle.com/en/java/javase/17/gctuning/ergonomics.html"})}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"printflagsfinal",children:"PrintFlagsFinal"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"docker run --rm wener/java java -XX:+PrintFlagsFinal -version\n"})}),"\n",(0,t.jsx)(e.h3,{id:"flag-list-example",children:"Flag List Example"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-plaintext",children:"[Global flags]\n    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   {product}\n    ...\n     intx CICompilerCount                          := 3                                   {product}\n    ...\n    uintx InitialHeapSize                          := 33554432                            {product}\n    ...\n    uintx MaxHeapSize                              := 524288000                           {product}\n    ...\n     bool UseG1GC                                   = false                               {product}\n     bool UseParallelGC                            := true                                {product}\n    ...\n"})})]})}function o(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(h,{...n})}):h(n)}},917776:function(n,e,s){s.d(e,{R:()=>a,x:()=>l});var i=s(7378);let t={},r=i.createContext(t);function a(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);