"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["42707"],{59227:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>c,toc:()=>a,default:()=>p,metadata:()=>i,assets:()=>l,contentTitle:()=>o});var i=JSON.parse('{"id":"web/dev/testing/vitest","title":"vitest","description":"- vitest-dev/vitest","source":"@site/../notes/web/dev/testing/vitest.md","sourceDirName":"web/dev/testing","slug":"/web/dev/testing/vitest","permalink":"/notes/web/dev/testing/vitest","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/dev/testing/vitest.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1724402050000,"frontMatter":{"title":"vitest"},"sidebar":"docs","previous":{"title":"jest","permalink":"/notes/web/dev/testing/jest"},"next":{"title":"turbopack","permalink":"/notes/web/dev/turbopack"}}'),s=t(86106),r=t(17776);let c={title:"vitest"},o="vitest",l={},a=[{value:"In-source testing",id:"in-source-testing",level:2},{value:"\u6027\u80FD\u6D4B\u8BD5",id:"benchmarking",level:2},{value:"conf",id:"conf",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"vitest",children:"vitest"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/vitest-dev/vitest",children:"vitest-dev/vitest"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"chai - assertion"}),"\n",(0,s.jsx)(n.li,{children:"c8/istanbul - coverage"}),"\n",(0,s.jsx)(n.li,{children:"tinyspy - mocking, stubbing, spies"}),"\n",(0,s.jsx)(n.li,{children:"jsdom/happy-dom - DOM & browser API mocking"}),"\n",(0,s.jsx)(n.li,{children:"tinypool - worker"}),"\n",(0,s.jsx)(n.li,{children:"tinybench - benchmarking"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u5DF2\u7ECF\u7528 Vite \u5F00\u53D1\uFF0C\u5219\u975E\u5E38\u63A8\u8350"}),"\n",(0,s.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["webstrom ",(0,s.jsx)(n.a,{href:"https://plugins.jetbrains.com/plugin/19220-vitest-runner",children:"Vitest Runner"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/linux-china/vitest-jetbrains-plugin",children:"linux-china/vitest-jetbrains-plugin"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm i -D @vitest/ui\nvitest --ui\n\n# coverage\nnpm i -D @vitest/coverage-c8\nnpm i -D @vitest/coverage-istanbul\n# runtime\nnpm i -D happy-dom\nnpm i -D jsdom\n# https://www.npmjs.com/package/edge-runtime\n# https://github.com/vercel/edge-runtime\nnpm i -D @edge-runtime/vm\n\nvitest list ./src/           # \u5217\u51FA\u6D4B\u8BD5\nvitest run ./src/            # \u8FD0\u884C\u6D4B\u8BD5 - \u53EA\u8FD0\u884C\u4E00\u6B21\uFF0C\u4E0D watch\nvitest watch                 # = vitest dev - \u68C0\u6D4B\u53D8\u5316\u81EA\u52A8\u8FD0\u884C\nvitest related /src/index.ts # \u53EA\u8FD0\u884C\u76F8\u5173\u6D4B\u8BD5\uFF0C\u53EF\u4EE5\u5728 git lint statge \u914D\u7F6E\u53EA\u9488\u5BF9\u53D8\u5316\u7684\u6587\u4EF6\u5C31\u884C\u6D4B\u8BD5\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="vite.config.ts"',children:"// \u4F7F\u7528 reference \u5219\u4E0D\u9700\u8981\u4ECE vitest/config import\n// import { defineConfig } from 'vitest/config';\n\n/// <reference types=\"vitest\" />\nimport { defineConfig } from 'vitest';\n\nexport default defineConfig({\n  test: {\n    coverage: {\n      provider: 'istanbul', // c8\n    },\n    environment: 'happy-dom', // jsdom, node, edge-runtime\n  },\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "test": "vitest",\n    "coverage": "vitest run --coverage"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"in-source-testing",children:"In-source testing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:'title="src/index.ts"',children:"export function add(...args: number[]) {\n  return args.reduce((a, b) => a + b, 0);\n}\n\n// \u76F4\u63A5\u5C06\u6D4B\u8BD5\u5199\u5728\u4EE3\u7801\u91CC - bundle \u65F6 tree-shake \u6389\nif (import.meta.vitest) {\n  const { it, expect } = import.meta.vitest;\n  it('add', () => {\n    expect(add()).toBe(0);\n    expect(add(1)).toBe(1);\n    expect(add(1, 2, 3)).toBe(6);\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"benchmarking",children:"\u6027\u80FD\u6D4B\u8BD5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { bench, describe } from 'vitest';\n\ndescribe('sort', () => {\n  bench('normal', () => {\n    const x = [1, 5, 4, 2, 3];\n    x.sort((a, b) => {\n      return a - b;\n    });\n  });\n\n  bench('reverse', () => {\n    const x = [1, 5, 4, 2, 3];\n    x.reverse().sort((a, b) => {\n      return a - b;\n    });\n  });\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"conf",children:"conf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import process from 'node:process';\nimport react from '@vitejs/plugin-react';\nimport { loadEnv, PluginOption } from 'vite';\nimport { defineConfig } from 'vitest/config';\n\n// https://vitejs.dev/config/\nexport default ({ mode }: { mode: string }) => {\n  const env = loadEnv(mode, process.cwd(), '');\n  process.env = Object.assign(process.env, env);\n\n  return defineConfig({\n    plugins: [react()] as PluginOption[],\n    resolve: {\n      alias: {\n        '@': new URL('./src/', import.meta.url).pathname,\n      },\n    },\n    test: {\n      server: {\n        deps: {\n          // fix .css extension error\n          // inline: ['@wener/console'],\n        },\n      },\n      deps: {\n        optimizer: {\n          web: {},\n        },\n      },\n    },\n  });\n};\n"})})]})}function p(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},17776:function(e,n,t){t.d(n,{R:()=>c,x:()=>o});var i=t(7378);let s={},r=i.createContext(s);function c(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);