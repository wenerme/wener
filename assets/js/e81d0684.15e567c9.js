"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["5630"],{62812:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>s,toc:()=>p,default:()=>h,metadata:()=>t,assets:()=>c,contentTitle:()=>l});var t=JSON.parse('{"id":"languages/python/poetry","title":"poetry","description":"- python-poetry/poetry","source":"@site/../notes/languages/python/poetry.md","sourceDirName":"languages/python","slug":"/languages/python/poetry","permalink":"/notes/languages/python/poetry","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/languages/python/poetry.md","tags":[{"inline":true,"label":"Package Manager","permalink":"/notes/tags/package-manager"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1742185178000,"frontMatter":{"tags":["Package Manager"]},"sidebar":"docs","previous":{"title":"pip","permalink":"/notes/languages/python/pip"},"next":{"title":"Pydantic","permalink":"/notes/languages/python/pydantic"}}'),o=r(86106),i=r(17776);let s={tags:["Package Manager"]},l="poetry",c={},p=[{value:"Configuration",id:"conf",level:2},{value:"system site-packages",id:"system-site-packages",level:2},{value:"Monorepo",id:"monorepo",level:2},{value:"using requirements.txt",id:"using-requirementstxt",level:2},{value:"Docker",id:"docker",level:2},{value:"Torch CPU only",id:"torch-cpu-only",level:2},{value:"\u53EA\u521D\u59CB\u5316 venv",id:"init-venv-only",level:2},{value:"b&#39;HEAD&#39;",id:"bhead",level:2}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"poetry",children:"poetry"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/python-poetry/poetry",children:"python-poetry/poetry"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"MIT, Python"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"pyproject.toml <- setup.py, requirements.txt, setup.cfg, MANIFEST.in, Pipfile"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"brew install poetry # by macOS Homebrew\npipx install poetry # by pipx\n\npoetry init           # for existing project\npoetry new my-project # for new project\n\n# brew install python@3.12\npython3.12 --version # \u4FEE\u6539 python \u7248\u672C\npoetry env use python3.12\n\npoetry run which python # venv\npoetry run python --version\n\npoetry self update # update poetry\n\npoetry config --list # \u67E5\u770B\u914D\u7F6E\n\n# POETRY_VIRTUALENVS_PATH\npoetry config virtualenvs.path # \u67E5\u770B virtualenvs \u8DEF\u5F84\n# \u53EF\u4EE5\u8003\u8651\u4E0D\u63D0\u4EA4 poetry.toml \u5230\u4ED3\u5E93\npoetry config virtualenvs.create false --local    # \u9879\u76EE\u7EF4\u5EA6\u914D\u7F6E poetry.toml\npoetry config virtualenvs.in-project true --local # \u63A8\u8350 - \u521B\u5EFA\u5230 .venv \u800C\u4E0D\u662F {cache-dir}/virtualenvs\n"})}),"\n",(0,o.jsx)(n.h2,{id:"conf",children:"Configuration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u914D\u7F6E POETRY_CONFIG_DIR, cache-dir\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"~/Library/Application Support/pypoetry"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"%APPDATA%\\pypoetry"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"$XDG_CONFIG_HOME/.config/pypoetry"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"~/.config/pypoetry"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u6570\u636E POETRY_HOME, POETRY_DATA_DIR\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$XDG_DATA_HOME/pypoetry"}),", ",(0,o.jsx)(n.code,{children:"~/.local/share/pypoetry"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"%APPDATA%\\pypoetry"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"~/Library/Application Support/pypoetry"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u7F13\u5B58\u76EE\u5F55 POETRY_CACHE_DIR\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Linux: ",(0,o.jsx)(n.code,{children:"$XDG_CACHE_HOME/pypoetry"}),", ",(0,o.jsx)(n.code,{children:"~/.cache/pypoetry"})]}),"\n",(0,o.jsxs)(n.li,{children:["Windows: ",(0,o.jsx)(n.code,{children:"%LOCALAPPDATA%\\pypoetry"})]}),"\n",(0,o.jsxs)(n.li,{children:["macOS: ",(0,o.jsx)(n.code,{children:"~/Library/Caches/pypoetry"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://python-poetry.org/docs/configuration/#available-settings",children:"https://python-poetry.org/docs/configuration/#available-settings"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"system-site-packages",children:"system site-packages"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"python -m venv --system-site-packages .venv\npoetry env use .venv/bin/python\n"})}),"\n",(0,o.jsx)(n.h2,{id:"monorepo",children:"Monorepo"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://gitlab.com/gerbenoostra/poetry-monorepo/",children:"https://gitlab.com/gerbenoostra/poetry-monorepo/"})}),"\n"]}),"\n",(0,o.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,o.jsx)(n.h2,{id:"using-requirementstxt",children:"using requirements.txt"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'[project]\ndynamic = ["dependencies", "optional-dependencies"]\n[tool.setuptools.dynamic]\ndependencies = {file = ["requirements.txt"]}\noptional-dependencies = {dev = { file = ["requirements-dev.txt"] }}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"docker",children:"Docker"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://miguel-mendez-ai.com/2024/03/12/poetry-torch-docker",children:"https://miguel-mendez-ai.com/2024/03/12/poetry-torch-docker"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"torch-cpu-only",children:"Torch CPU only"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install torch --index-url https://download.pytorch.org/whl/cpu\npip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu\n\n# TORCH_ARCH cu116\npoetry run pip install torch==2.5.0+cpu -f https://download.pytorch.org/whl/torch_stable.html\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"poetry source add --priority explicit pytorch https://download.pytorch.org/whl/cpu\npoetry add --source pytorch torch touchvision\n\npoetry add --source pytorch torch=2.5.0+cpu\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2.2.2 \u4E4B\u540E\u7248\u672C\u5931\u8D25 Unable to find installation candidates for torch"}),"\n",(0,o.jsxs)(n.li,{children:["macOS \u4F1A\u5B89\u88C5\u5931\u8D25\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/python-poetry/poetry/issues/9524",children:"https://github.com/python-poetry/poetry/issues/9524"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Instructions for installing PyTorch ",(0,o.jsx)(n.a,{href:"https://github.com/python-poetry/poetry/issues/6409",children:"python-poetry/poetry#6409"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"\u652F\u6301\u5207\u6362\u7684\u914D\u7F6E\u65B9\u5F0F"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-toml",children:'\n[tool.poetry.group.cpu]\noptional = true\n\n[tool.poetry.group.cpu.dependencies]\ntorch = { version = "^2.5.0", source = "pytorch-cpu", markers = "extra==\'cpu\' and extra!=\'gpu\'" }\n\n[tool.poetry.group.gpu]\noptional = true\n\n[tool.poetry.group.gpu.dependencies]\ntorch = { version = "^2.5.0", source = "pytorch-gpu", markers = "extra==\'gpu\' and extra!=\'cpu\'" }\n\n[tool.poetry.extras]\ncpu = ["torch", "torchvision"]\ngpu = ["torch", "torchvision"]\n\n[[tool.poetry.source]]\nname = "pytorch-cpu"\nurl = "https://download.pytorch.org/whl/cpu"\npriority = "explicit"\n\n[[tool.poetry.source]]\nname = "pytorch-gpu"\nurl = "https://download.pytorch.org/whl/cu121"\npriority = "explicit"\n\n[[tool.poetry.source]]\nname = "pytorch-cuda"\nurl = "https://download.pytorch.org/whl/cu121"\npriority = "explicit"\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"poetry install -E cpu --with cpu --sync\n\npoetry install -E gpu --with gpu --sync\n"})}),"\n",(0,o.jsx)(n.h2,{id:"init-venv-only",children:"\u53EA\u521D\u59CB\u5316 venv"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'poetry run echo "Venv initialized"\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u7528\u4E8E\u5148\u6709 venv, \u7136\u540E\u9700\u8981\u4F7F\u7528 pip \u5B89\u88C5\u90E8\u5206\u4F9D\u8D56, \u7136\u540E\u518D\u4F7F\u7528 poetry \u5B89\u88C5\u7684\u573A\u666F"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u8FDB\u5165 venv \u73AF\u5883\npoetry shell\n"})}),"\n",(0,o.jsx)(n.h2,{id:"bhead",children:"b'HEAD'"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"KeyError"}),"\n",(0,o.jsx)(n.li,{children:"\u8BFB\u53D6 git \u4FE1\u606F\u5931\u8D25"}),"\n",(0,o.jsx)(n.li,{children:"\u5220\u6389 venv \u91CD\u65B0\u5B89\u88C5"}),"\n",(0,o.jsx)(n.li,{children:"\u53EF\u80FD\u662F add git \u4F9D\u8D56\u7684\u65F6\u5019\u88AB\u4E2D\u65AD"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u901A\u5E38\u5220\u9664\u7A7A\u7684 src \u80FD\u89E3\u51B3\nls .venv/src\nrm -rf .venv/src/transformers # \u4F8B\u5982\u6211\u662F transformers \u5B89\u88C5\u65F6\u88AB\u4E2D\u65AD\n# \u91CD\u65B0\u5B89\u88C5 - \u9700\u8981\u975E\u5E38\u4E45\uFF0C\u56E0\u4E3A\u4ED3\u5E93\u5F88\u5927\n# \u907F\u514D clone ~2GB\npoetry add 'git+https://github.com/huggingface/transformers.git'\n\n# \u63A8\u8350 - \u907F\u514D clone, \u4E5F\u80FD\u652F\u6301\u5B9A\u4F4D\u5230 commit\npoetry add https://github.com/huggingface/transformers/archive/refs/heads/main.zip\n\n# \u5982\u679C\u4E0D\u662F\u6807\u51C6 .venv \u53EF\u901A\u8FC7 env \u4FE1\u606F\u627E\u5230\u73AF\u5883\u4F4D\u7F6E\npoetry env info\n\n# \u5982\u679C\u8FD8\u4E0D\u884C\uFF0C\u5219\u91CD\u5EFA\ndeactivate\nrm -rf .venv\neval $(poetry env activate)\n"})})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},17776:function(e,n,r){r.d(n,{R:()=>s,x:()=>l});var t=r(7378);let o={},i=t.createContext(o);function s(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);