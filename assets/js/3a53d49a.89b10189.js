"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["31982"],{70112:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>h,default:()=>a,metadata:()=>i,assets:()=>d,contentTitle:()=>c});var i=JSON.parse('{"id":"web/dev/bun","title":"bun","description":"- oven-sh/bun","source":"@site/../notes/web/dev/bun.md","sourceDirName":"web/dev","slug":"/web/dev/bun","permalink":"/notes/web/dev/bun","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/dev/bun.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1753627141000,"frontMatter":{"title":"bun"},"sidebar":"docs","previous":{"title":"biome","permalink":"/notes/web/dev/biome"},"next":{"title":"Bundle FAQ","permalink":"/notes/web/dev/bundle/faq"}}'),l=s(86106),r=s(17776);let t={title:"bun"},c="bun",d={},h=[{value:"ffi",id:"ffi",level:2},{value:"memory",id:"memory",level:2},{value:"macro",id:"macro",level:2},{value:"compile",id:"compile",level:2},{value:"debug",id:"debug",level:2},{value:"hono",id:"hono",level:2},{value:"Failed to open library. This is usually caused by a missing library or an invalid library path.",id:"failed-to-open-library-this-is-usually-caused-by-a-missing-library-or-an-invalid-library-path",level:2}];function o(n){let e={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"bun",children:"bun"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun",children:"oven-sh/bun"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"MIT, Zig"}),"\n",(0,l.jsx)(e.li,{children:"JavaScriptCore,tinycc,libiconv LGPLv2"}),"\n",(0,l.jsx)(e.li,{children:"boringssl,libarchive,libiconv,lol-html,mimalloc,picohttp,tinycc,uSockets,zlib-cloudflare,libicu,uWebsockets"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["@types/bun, ",(0,l.jsx)(e.del,{children:"bun-types"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"typing"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/SaltyAom/bun-http-framework-benchmark",children:"SaltyAom/bun-http-framework-benchmark"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/awesome-bun",children:"oven-sh/awesome-bun"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.admonition,{type:"caution",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Roadmap ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/159",children:"#159"})]}),"\n",(0,l.jsxs)(e.li,{children:["bun:ffi \u80FD\u529B\u662F\u72EC\u4E00\u65E0\u4E8C\u7684\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53EF\u4EE5\u4E3A\u4E86 ffi \u800C\u4F7F\u7528 bun"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["bun \u76EE\u524D\u8FD8\u4E0D\u9002\u7528\u4E8E\u901A\u7528\u7684\u751F\u4EA7\u73AF\u5883\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u76F8\u5BF9\u6765\u8BF4\uFF0Cbun \u66F4\u9002\u7528\u4E8E\u524D\u7AEF\u9879\u76EE\u800C\u4E0D\u662F\u540E\u7AEF\u9879\u76EE\uFF0C\u56E0\u4E3A \u540E\u7AEF \u9879\u76EE\u901A\u5E38\u9700\u8981\u66F4\u591A\u7684 node \u517C\u5BB9\u6A21\u5757"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["bun \u975E\u5E38\u4E0D\u5EFA\u8BAE\u76F4\u63A5\u7528\u4E8E\u540E\u7AEF\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53EF\u80FD\u4F1A\u9047\u5230\u5404\u5F0F\u5404\u6837\u65E0\u6CD5\u4FEE\u590D\u7684\u9519\u8BEF"}),"\n",(0,l.jsx)(e.li,{children:"\u5E93\u7684\u5F00\u53D1\u8005\u4E00\u822C\u4E5F\u4E0D\u4F1A\u9488\u5BF9 bun \u6D4B\u8BD5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["deploy ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/211",children:"bun#211"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u672A\u5B9E\u73B0 ",(0,l.jsx)(e.del,{children:"dns"}),", ",(0,l.jsx)(e.del,{children:"http2"}),", https, child_process, vm, tls, async_hooks, worker_threads, inspector"]}),"\n",(0,l.jsxs)(e.li,{children:["\u672A\u5B9E\u73B0 HTTP request body streaming\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Streaming upload with fetch ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/6017",children:"#6017"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u517C\u5BB9\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301 vitest ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/4145",children:"#4145"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u652F\u6301 ReactNative ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/123",children:"#123"})]}),"\n",(0,l.jsxs)(e.li,{children:["fetch 100 continue \u95EE\u9898 ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/7428",children:"#7428"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"S3 SDK, fetch \u8BF7\u6C42"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsxs)(e.del,{children:["\u652F\u6301 NestJS ",(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/1641",children:"#1641"})]})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,l.jsx)(e.admonition,{type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"bun \u5D4C\u5165\u4E86 tinycc\uFF0C\u6709 jit \u80FD\u529B\uFF0C\u56E0\u6B64 ffi \u6548\u7387\u975E\u5E38\u9AD8"}),"\n",(0,l.jsx)(e.li,{children:"bun \u8FD8\u5904\u4E8E\u975E\u5E38\u65E9\u671F\u5F00\u53D1\u9636\u6BB5"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528 JavaScriptCore - \u5404\u6709\u4F18\u7F3A\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"bun \u4E00\u4E9B\u70B9\u7684\u6027\u80FD\u5F88\u597D\uFF0C\u4F46\u6574\u4F53\u5E94\u7528\u6027\u80FD\u6BD4\u4E0D\u4E0A node"}),"\n"]})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# Manually Install\n# =======================\n# macOS\ncurl -LO https://github.com/oven-sh/bun/releases/download/bun-v1.2.19/bun-darwin-x64.zip\nunzip bun-darwin-x64.zip\nmv bun-darwin-x64/bun ~/bin/\nxattr -r -d com.apple.quarantine ~/bin/bun\nbun -v\n\nbun upgrade          # \u5347\u7EA7\nbun upgrade --canary # \u5347\u7EA7\u5230\u5C1A\u672A\u53D1\u5E03\u7248\u672C - bun \u5F00\u53D1\u5F88\u5FEB\uFF0C\u53EF\u4EE5\u63D0\u524D\u5C1D\u8BD5\u4E00\u4E9B\u7279\u6027\n\ndocker run --rm -it wener/bun bun -v\ndocker run --rm --init --ulimit memlock=-1:-1 oven/bun # \u5B98\u65B9\u955C\u50CF\ndocker run -it --rm -v $PWD:/host -w /host -p 3000:3000 --entrypoint bash oven/bun:debian\n\n# \u5B89\u88C5\u811A\u672C\ncurl -fsSL https://bun.com/install | bash\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"bun bun src/index.js\n# https://github.com/oven-sh/bun/issues/211\n./node_modules.bun > ./node_modules.js\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm add -D @types/bun\n"})}),"\n",(0,l.jsx)(e.h2,{id:"ffi",children:"ffi"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u76EE\u524D\u5E94\u8BE5\u65E0\u6CD5\u5C06 number \u8F6C\u6362\u4E3A Pointer"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"// \u6CE8\u610F\u8F6C\u6362\u4E3A CString \u9700\u8981 \\0 \u7ED3\u5C3E\nfunction ptrOfStr(s?: string) {\n  return typeof s === 'string' ? ptr(Buffer.from(s + '\\0', 'utf8')) : null;\n}\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["64 bit \u7684 processor \u4F7F\u752852bit \u7684\u5730\u5740\u7A7A\u95F4\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"js \u652F\u6301 53bit \u7684\u6574\u6570"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/64-bit_computing#Limits_of_processors",children:"https://en.wikipedia.org/wiki/64-bit_computing#Limits_of_processors"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u4E0D\u652F\u6301 struct\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/oven-sh/bun/issues/6139",children:"https://github.com/oven-sh/bun/issues/6139"})}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528 toArrayBuffer \u548C read \u6765\u76F4\u63A5\u83B7\u53D6 ptr \u6570\u636E"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"import { viewSource } from 'bun:ffi';\n\n// \u751F\u6210\u7684 C \u4EE3\u7801\nconsole.log(\n  viewSource(\n    {\n      hello_world: {\n        returns: 'float',\n        args: ['float'],\n      },\n    },\n    false,\n  )[0],\n);\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"import { dlopen, FFIType } from 'bun:ffi';\n\n// /lib/x86_64-linux-gnu/libc.so.6\n// /usr/lib/x86_64-linux-gnu/libc.so.6\nconst { printf } = dlopen('libc.so.6', {\n  printf: { args: [FFIType.cstring, FFIType.f64] },\n}).symbols;\n\nprintf(new TextEncoder().encode('%.17f\\n'), 4);\n"})}),"\n",(0,l.jsx)(e.h2,{id:"memory",children:"memory"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://bun.sh/docs/project/benchmarking#measuring-memory-usage",children:"https://bun.sh/docs/project/benchmarking#measuring-memory-usage"})}),"\n",(0,l.jsx)(e.li,{children:"MIMALLOC_SHOW_STATS=1"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"Bun.gc(true); // synchronous\nBun.gc(false); // asynchronous\n"})}),"\n",(0,l.jsx)(e.h2,{id:"macro",children:"macro"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7C7B\u4F3C inline+\u9884\u6267\u884C"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-ts",children:"import { random } from './random.ts' with { type: 'macro' };\n"})}),"\n",(0,l.jsx)(e.h2,{id:"compile",children:"compile"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# --sourcemap --minify --target bun-linux-x64-modern\n# 90MB+\nbun build --compile ./src/main.ts --outfile myapp --external={pg-query-stream,better-sqlite3,tedious,oracledb,mysql2,sqlite3,mysql} --external=@mikro-orm/{migrations,entity-generator,better-sqlite,sqlite,mariadb,mysql,mongodb,seeder}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"debug",children:"debug"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"bun --inspect server.ts\n"})}),"\n",(0,l.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,l.jsx)(e.h2,{id:"hono",children:"hono"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Failed to find Response internal state key\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u68C0\u67E5\u4E0B\u662F\u4E0D\u662F\u7528\u4E86 node \u7684 serve \u800C\u4E0D\u662F Bun.serve"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/honojs/hono/issues/2466",children:"https://github.com/honojs/hono/issues/2466"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"failed-to-open-library-this-is-usually-caused-by-a-missing-library-or-an-invalid-library-path",children:"Failed to open library. This is usually caused by a missing library or an invalid library path."}),"\n",(0,l.jsx)(e.p,{children:"\u68C0\u67E5\u4E0B\u662F\u4E0D\u662F arch \u9519\u4E86\u3002"})]})}function a(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>c});var i=s(7378);let l={},r=i.createContext(l);function t(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);