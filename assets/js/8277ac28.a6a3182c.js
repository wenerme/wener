"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["84870"],{97097:function(n,e,d){d.r(e),d.d(e,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>s,assets:()=>t,contentTitle:()=>o});var s=JSON.parse('{"id":"os/android/android-build","title":"Android Build","description":"- AGP","source":"@site/../notes/os/android/android-build.md","sourceDirName":"os/android","slug":"/os/android/build","permalink":"/notes/os/android/build","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/android/android-build.md","tags":[{"inline":true,"label":"Build","permalink":"/notes/tags/build"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1702882608000,"frontMatter":{"title":"Android Build","tags":["Build"]},"sidebar":"docs","previous":{"title":"Android Awesome","permalink":"/notes/os/android/awesome"},"next":{"title":"Android FAQ","permalink":"/notes/os/android/faq"}}'),l=d(86106),i=d(17776);let r={title:"Android Build",tags:["Build"]},o="Android Build",t={},a=[{value:"env",id:"env",level:2},{value:"SDK",id:"sdk",level:2},{value:"NDK",id:"ndk",level:2},{value:"Build",id:"build",level:2},{value:"Dependant package with key emulator not found",id:"dependant-package-with-key-emulator-not-found",level:2},{value:"Installed Build Tools revision 33.0.0 is corrupted. Remove and install again using the SDK Manager.",id:"installed-build-tools-revision-3300-is-corrupted-remove-and-install-again-using-the-sdk-manager",level:2},{value:"Failed to install the following Android SDK packages as some licences have not been accepted",id:"failed-to-install-the-following-android-sdk-packages-as-some-licences-have-not-been-accepted",level:2},{value:"optimize",id:"optimize",level:2}];function c(n){let e={a:"a",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"android-build",children:"Android Build"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["AGP\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"com.android.tools.build:gradle"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://developer.android.com/studio/command-line",children:"https://developer.android.com/studio/command-line"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/alvr/alpine-android",children:"https://github.com/alvr/alpine-android"})}),"\n",(0,l.jsx)(e.li,{children:"ANDROID_SDK_ROOT"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"env",children:"env"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"env"}),(0,l.jsx)(e.th,{children:"for"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Android SDK"})}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_HOME"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.del,{children:"ANDROID_SDK_ROOT"})}),(0,l.jsx)(e.td,{children:"\u4F7F\u7528 ANDROID_HOME"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_USER_HOME"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"REPO_OS_OVERRIDE"}),(0,l.jsx)(e.td,{children:"windows\u3001macosx\u3001linux"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_NDK_HOME"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.strong,{children:"Emulator"})}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_EMULATOR_HOME"}),(0,l.jsx)(e.td,{children:"=$ANDROID_USER_HOME"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_AVD_HOME"}),(0,l.jsx)(e.td,{children:"=$ANDROID_EMULATOR_HOME/avd/"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_LOG_TAGS"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"HTTP_PROXY"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_VERBOSE"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_HOME"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"ANDROID_EMULATOR_USE_SYSTEM_LIBS"}),(0,l.jsx)(e.td,{})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"CMDLINE_VERSION"}),(0,l.jsx)(e.td,{})]})]})]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["ANDROID_EMULATOR_HOME=ANDROID_USER_HOME\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"$ANDROID_SDK_HOME/.android"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["ANDROID_HOME\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"C:\\Users\\<\u7528\u6237\u540D>\\AppData\\Local\\Android\\Sdk"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"/Users/<\u7528\u6237\u540D>/Library/Android/sdk"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.code,{children:"/home/<\u7528\u6237\u540D>/Android/Sdk"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"$ANDROID_HOME"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"add-ons/"}),"\n",(0,l.jsx)(e.li,{children:"build-tools/ - aapt\u3001dx"}),"\n",(0,l.jsx)(e.li,{children:"emulator/"}),"\n",(0,l.jsx)(e.li,{children:"extras/ - \u9644\u52A0\u7684\u5E93\u548C\u652F\u6301\u6587\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"licenses/"}),"\n",(0,l.jsx)(e.li,{children:"platform-tools/ - Android \u5E73\u53F0\u4EA4\u4E92\u6240\u9700\u7684\u57FA\u672C\u5DE5\u5177 - adb\u3001fastboot"}),"\n",(0,l.jsx)(e.li,{children:"platforms/ - \u6BCF\u4E2A Android \u7248\u672C\u7684 SDK \u5E73\u53F0\u6587\u4EF6 - \u6838\u5FC3\u5E93\u3001API"}),"\n",(0,l.jsx)(e.li,{children:"skins/ - \u6A21\u62DF\u5668\u7684\u76AE\u80A4\u6587\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"sources/ - \u7CFB\u7EDF\u6E90\u7801"}),"\n",(0,l.jsx)(e.li,{children:"system-images/ - \u6A21\u62DF\u5668\u4E0D\u540C\u67B6\u6784\u7684\u7CFB\u7EDF\u955C\u50CF"}),"\n",(0,l.jsx)(e.li,{children:"tools/"}),"\n",(0,l.jsxs)(e.li,{children:["cmdline-tools/ - \u4E0D\u540C\u7248\u672C\u7684\u5DE5\u5177\u96C6\uFF0C\u66FF\u4EE3 tools/\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"sdkmanager"}),"\n",(0,l.jsx)(e.li,{children:"avdmanager"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"aapt - Android Asset Packaging Tool"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://developer.android.com/tools/variables",children:"https://developer.android.com/tools/variables"})}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"export ANDROID_HOME=~/Library/Android/sdk # macOS\n\nexport PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/tools/bin:$ANDROID_HOME/platform-tools\n"})}),"\n",(0,l.jsx)(e.h2,{id:"sdk",children:"SDK"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# JDK 8\nCMDLINE_VERSION="8.0"\nSDK_TOOLS_VERSION="9123335"\n#\nCMDLINE_VERSION="9.0"\nSDK_TOOLS_VERSION="9477386"\n\nexport ANDROID_SDK_ROOT=$PWD\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}/bin:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/extras/google/instantapps\n\ncurl -Lo /tmp/tools.zip https://dl.google.com/android/repository/commandlinetools-linux-${SDK_TOOLS_VERSION}_latest.zip\n\nunzip -qq /tmp/tools.zip -d cmdline-tools\nmv cmdline-tools/cmdline-tools ${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}\nrm /tmp/tools.zip\n\nmkdir -p ~/.android/ && touch ~/.android/repositories.cfg\n\nexport JAVA_HOME=/usr/lib/jvm/java-11-openjdk/\nsdkmanager --version\nyes | sdkmanager --sdk_root=${ANDROID_SDK_ROOT} --licenses\nsdkmanager --sdk_root=${ANDROID_SDK_ROOT} --install "platform-tools" "extras;google;instantapps"\n\n# 28.0.3, 29.0.3, 30.0.3, 31.0.0, 32.0.0, 33.0.2\n# 34.0.0-rc1\nBUILD_TOOLS="30.0.3"\nTARGET_SDK=$BUILD_TOOLS\n\nBUILD_TOOLS="30.0.2"\nTARGET_SDK=32\n\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/build-tools/${BUILD_TOOLS}\n\nsdkmanager --sdk_root="${ANDROID_SDK_ROOT}" --install "build-tools;${BUILD_TOOLS}" "platforms;android-${TARGET_SDK}"\n\nsdkmanager --sdk_root="${ANDROID_SDK_ROOT}" --uninstall emulator\n\nsdkmanager "build-tools;29.0.2" # \u65E0 arm64, 30.0.2 \u4E5F \u65E0\nsdkmanager "build-tools;31.0.0" # \u6709 arm 64\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-groovy",children:'android {\n    buildToolsVersion "33.0.1"\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"ndk",children:"NDK"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://developer.android.com/ndk/downloads",children:"https://developer.android.com/ndk/downloads"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"build",children:"Build"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'export ANDROID_SDK_ROOT=/cache/opt/android/\nexport CMDLINE_VERSION="9.0"\nexport PATH=$PATH:${ANDROID_SDK_ROOT}/cmdline-tools/${CMDLINE_VERSION}/bin:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/extras/google/instantapps\nexport JAVA_HOME=/usr/lib/jvm/java-11-openjdk/\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"./gradlew assembleRelease\n./gradlew assembleDebug\n"})}),"\n",(0,l.jsx)(e.h2,{id:"dependant-package-with-key-emulator-not-found",children:"Dependant package with key emulator not found"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"build-tools 29 emulator \u65E0 arm64"}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/google/android-emulator-container-scripts/issues/192",children:"https://github.com/google/android-emulator-container-scripts/issues/192"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://developer.android.com/studio/releases/emulator#emulator_for_arm64_hosts",children:"https://developer.android.com/studio/releases/emulator#emulator_for_arm64_hosts"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"installed-build-tools-revision-3300-is-corrupted-remove-and-install-again-using-the-sdk-manager",children:"Installed Build Tools revision 33.0.0 is corrupted. Remove and install again using the SDK Manager."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'sdkmanager "build-tools;33.0.0"\nsdkmanager "build-tools;31.0.0"\n\n# \u5347\u7EA7 AGP to 7.x \u6216 d8 -> dx\ncd $ANDROID_SDK_ROOT/build-tools/33.0.0\ncp d8 dx\ncd lib\ncp d8.jar dx.jar\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://stackoverflow.com/questions/68387270",children:"https://stackoverflow.com/questions/68387270"})}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"failed-to-install-the-following-android-sdk-packages-as-some-licences-have-not-been-accepted",children:"Failed to install the following Android SDK packages as some licences have not been accepted"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"yes | sdkmanager --licenses\n"})}),"\n",(0,l.jsx)(e.h2,{id:"optimize",children:"optimize"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"org.gradle.daemon=true\norg.gradle.parallel=true\norg.gradle.caching=true\n\norg.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"--configuration-cache"}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}},17776:function(n,e,d){d.d(e,{R:()=>r,x:()=>o});var s=d(7378);let l={},i=s.createContext(l);function r(n){let e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);