"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["39539"],{75073:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>t,toc:()=>o,default:()=>a,metadata:()=>l,assets:()=>h,contentTitle:()=>d});var l=JSON.parse('{"id":"os/linux/boot/uefi","title":"UEFI","description":"- .efi \u5B58\u50A8\u5728 ESP/EFI System Partition \u5206\u533A","source":"@site/../notes/os/linux/boot/uefi.md","sourceDirName":"os/linux/boot","slug":"/os/linux/boot/uefi","permalink":"/notes/os/linux/boot/uefi","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/boot/uefi.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1676530464000,"frontMatter":{"title":"UEFI"},"sidebar":"docs","previous":{"title":"U-Boot","permalink":"/notes/os/linux/boot/uboot"},"next":{"title":"Build","permalink":"/notes/os/linux/build"}}'),s=i(86106),r=i(17776);let t={title:"UEFI"},d="UEFI",h={},o=[{value:"AlpineLinux",id:"alpinelinux",level:2},{value:"OVMF",id:"ovmf",level:2},{value:"AAVMF",id:"aavmf",level:2},{value:"EFISTUB",id:"efistub",level:2},{value:"Why UEFI / UEFI vs BIOS",id:"why-uefi--uefi-vs-bios",level:2},{value:"you need to load the kernel first",id:"you-need-to-load-the-kernel-first",level:2}];function c(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"uefi",children:"UEFI"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[".efi \u5B58\u50A8\u5728 ESP/EFI System Partition \u5206\u533A\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5206\u533A\u6807\u8BC6 EF"}),"\n",(0,s.jsx)(e.li,{children:"\u5206\u533A\u683C\u5F0F\u4E3A FAT \u6216 FAT32"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"efibootmgr - \u7BA1\u7406 efi \u53D8\u91CF\uFF0C\u63A7\u5236\u4F7F\u7528\u7684\u542F\u52A8\u6587\u4EF6"}),"\n",(0,s.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://edk2-docs.gitbook.io/understanding-the-uefi-secure-boot-chain",children:"Understanding UEFI Secure Boot Chain"})}),"\n",(0,s.jsxs)(e.li,{children:["wikipedia ",(0,s.jsx)(e.a,{href:"https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface",children:"UEFI"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://wiki.alpinelinux.org/wiki/Alpine_and_UEFI",children:"Alpine and UEFI"})}),"\n",(0,s.jsxs)(e.li,{children:["debian ",(0,s.jsx)(e.a,{href:"https://wiki.debian.org/UEFI",children:"UEFI"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://wiki.ubuntu.com/EFIBootLoaders",children:"EFIBootLoaders"})}),"\n",(0,s.jsxs)(e.li,{children:["ubuntu ",(0,s.jsx)(e.a,{href:"https://wiki.ubuntu.com/UEFI/OVMF",children:"UEFI/OVMF"})]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://blog.system76.com/post/139138591598/howto-uefi-qemu-guest-on-ubuntu-xenial-host",children:"Howto: QEMU w/ Ubuntu Xenial host + UEFI guest"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4F7F\u7528 UEFI \u5EFA\u8BAE\u4F7F\u7528 GRUB Bootloader"}),"\n"]})}),"\n",(0,s.jsx)(e.h2,{id:"alpinelinux",children:"AlpineLinux"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6700\u5C0F UEFI/GPT \u5206\u533A"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"mount point"}),(0,s.jsx)(e.th,{children:"type"}),(0,s.jsx)(e.th,{children:"size"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"/boot, /efi"}),(0,s.jsx)(e.td,{children:"EFI Boot"}),(0,s.jsx)(e.td,{children:"260MiB"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"/"}),(0,s.jsx)(e.td,{children:"root"}),(0,s.jsx)(e.td,{children:"1-32 GiB"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"non"}),(0,s.jsx)(e.td,{children:"swap"}),(0,s.jsx)(e.td,{children:"1-2GiB"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"ovmf",children:"OVMF"}),"\n",(0,s.jsx)(e.p,{children:"\u57FA\u4E8E EDK II \u7528\u4E8E\u652F\u6301\u865A\u62DF\u673A EFI \u542F\u52A8\u7684\u56FA\u4EF6"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"OVMF - Open Virtual Machine Firmware"}),"\n",(0,s.jsx)(e.li,{children:"OVMF/OVMF.fd - x86_64 \u5B9E\u9645\u8FD0\u884C\u7684\u56FA\u4EF6"}),"\n",(0,s.jsx)(e.li,{children:"OVMF/OVMF_CODE.fd"}),"\n",(0,s.jsxs)(e.li,{children:["OVMF/OVMF_VARS.fd\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u201Ctemplate\u201D used to emulate persistent NVRAM storage"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"OVMF/QEMU_EFI.fd - aarch64"}),"\n",(0,s.jsx)(e.li,{children:"ovmf/bios.bin - \u8F6F\u8FDE\u63A5\u6307\u5411 OVMF.fd \u6216 QEMU_EFI.fd"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# -pflash path/to/OVMF.fd - emulated flash, fully support UEFI variables\n# -bios bios.bin - variables will be partially emulated, and non-volatile, variables may lose their contents after a reboot\n# -L . - \u540C bios\n# qemu-system-x86_64 -L .\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"apk add ovmf\n# /usr/share/OVMF/\n# /usr/share/ovmf/bios.bin\n"})}),"\n",(0,s.jsx)(e.h2,{id:"aavmf",children:"AAVMF"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["AAVMF - ARM Architecture Virtual Machine Firmware\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"EFI Development Kit II platform that enables UEFI support for QEMU/KVM ARM Virtual Machines."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"UEFI firmware for aarch64 virtual machines"}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Distro"}),(0,s.jsx)(e.th,{children:"Package"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"RHEL/CentOS"}),(0,s.jsx)(e.td,{children:"AAVMF/edk2-aarch64"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Debian/Ubuntu"}),(0,s.jsx)(e.td,{children:"qemu-efi"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"AlpineLinux"}),(0,s.jsx)(e.td,{children:"aavmf"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"efistub",children:"EFISTUB"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4E00\u79CD\u542F\u52A8\u65B9\u5F0F\uFF0C\u5C06 linux \u5185\u6838 \u8F6C\u4E3A efi \u6587\u4EF6\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Linux \u5185\u6838\u53EF\u76F4\u63A5\u901A\u8FC7 EFI \u542F\u52A8"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"Linux 3.3+"}),"\n",(0,s.jsxs)(e.li,{children:["archlinux ",(0,s.jsx)(e.a,{href:"https://wiki.archlinux.org/title/EFISTUB",children:"EFISTUB"})]}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(e.h2,{id:"why-uefi--uefi-vs-bios",children:"Why UEFI / UEFI vs BIOS"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76F8\u540C\u70B9\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u56FA\u4EF6\u63A5\u53E3"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["BIOS\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MBR/Master Boot Record \u5B58\u50A8\u5206\u533A"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["UEFI\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"GPT/GUID partition table \u5206\u533A"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301 2TB \u5B58\u50A8\u8BBE\u5907"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u8D85\u8FC7 4 \u4E2A\u4E3B\u5206\u533A"}),"\n",(0,s.jsx)(e.li,{children:"\u56FA\u4EF6\u652F\u6301\u4F7F\u7CFB\u7EDF\u542F\u52A8\u66F4\u5FEB"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u5B89\u5168\u542F\u52A8 - \u7CFB\u7EDF\u5B8C\u6574\u6027\u68C0\u67E5"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u7F51\u7EDC"}),"\n",(0,s.jsx)(e.li,{children:"\u652F\u6301\u56FE\u5F62\u754C\u9762"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"you-need-to-load-the-kernel-first",children:"you need to load the kernel first"}),"\n",(0,s.jsx)(e.p,{children:"\u6CE8\u610F\u5728\u8FD9\u4E4B\u524D\u7684\u9519\u8BEF"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"error: out of memory\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53EF\u80FD\u662F\u5728 linux \u52A0\u8F7D\u5185\u6838\u65F6\u51FA\u73B0\uFF0C\u9700\u8981\u589E\u52A0\u5185\u5B58\u3002"}),"\n",(0,s.jsx)(e.p,{children:"QEMU \u9ED8\u8BA4\u5185\u5B58\u542F\u52A8 alpine lts efi \u5931\u8D25\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# -accel hvf \u4F1A\u5931\u8D25\nqemu-system-x86_64 -m 2G -bios OVMF/OVMF.fd -hda /dev/rdisk2\n"})})]})}function a(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},17776:function(n,e,i){i.d(e,{R:()=>t,x:()=>d});var l=i(7378);let s={},r=l.createContext(s);function t(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);