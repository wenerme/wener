"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["88835"],{84019:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>o,default:()=>h,metadata:()=>l,assets:()=>c,contentTitle:()=>d});var l=JSON.parse('{"id":"os/windows/wsl","title":"WSL","description":"- WSL2 \u4E3A\u5B8C\u6574\u865A\u62DF\u673A - kernel+rootfs","source":"@site/../notes/os/windows/wsl.md","sourceDirName":"os/windows","slug":"/os/windows/wsl","permalink":"/notes/os/windows/wsl","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/windows/wsl.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1754277663000,"frontMatter":{"title":"WSL"},"sidebar":"docs","previous":{"title":"Windows Remote Management","permalink":"/notes/os/windows/winrm"},"next":{"title":"\u7406\u5FF5","permalink":"/notes/philosophy/"}}'),i=s(86106),r=s(17776);let t={title:"WSL"},d="WSL",c={},o=[{value:"\u542F\u7528 WSL \u529F\u80FD",id:"enable-wsl",level:2},{value:"\u5B89\u88C5 Alpine",id:"install-alpine",level:2},{value:"Windows \u5F00\u53D1\u73AF\u5883",id:"windows-dev",level:2},{value:"IntelliJ",id:"intellij",level:2},{value:"\u5F00\u53D1\u73AF\u5883\u51C6\u5907",id:"dev-env",level:2},{value:"\u7AEF\u53E3\u66B4\u9732",id:"expose-ports",level:2},{value:"Docker \u73AF\u5883",id:"docker",level:2},{value:"\u5F00\u673A\u542F\u52A8 OpenRC",id:"autostart-openrc",level:2},{value:"\u7BA1\u7406",id:"\u7BA1\u7406",level:2},{value:"wslu",id:"wslu",level:2},{value:"wslconfig",id:"wslconfig",level:2},{value:"/etc/wsl.conf",id:"etcwslconf",level:2},{value:"WSL vs WSL2",id:"wsl-vs-wsl2",level:2},{value:"\u9002\u7528\u4E8E Linux \u7684 Windows \u5B50\u7CFB\u7EDF\u5B9E\u4F8B\u5DF2\u7EC8\u6B62",id:"\u9002\u7528\u4E8E-linux-\u7684-windows-\u5B50\u7CFB\u7EDF\u5B9E\u4F8B\u5DF2\u7EC8\u6B62",level:2},{value:"\u7CFB\u7EDF\u627E\u4E0D\u5230\u6307\u5B9A\u8DEF\u5F84",id:"\u7CFB\u7EDF\u627E\u4E0D\u5230\u6307\u5B9A\u8DEF\u5F84",level:2},{value:"\u8FC1\u79FB",id:"\u8FC1\u79FB",level:2},{value:"\u68C0\u6D4B\u662F\u5426\u8FD0\u884C\u5728 WSL",id:"\u68C0\u6D4B\u662F\u5426\u8FD0\u884C\u5728-wsl",level:2},{value:"The Windows Subsystem for Linux has not been enabled.",id:"the-windows-subsystem-for-linux-has-not-been-enabled",level:2},{value:"\u83B7\u53D6\u5F53\u524D\u7528\u6237\u540D",id:"get-current-username",level:2},{value:"alpine networking",id:"alpine-networking",level:2},{value:"Docker network",id:"docker-network",level:2},{value:"Cannot open netlink socket: Protocol not supported",id:"cannot-open-netlink-socket-protocol-not-supported",level:2},{value:"docker RULE_APPEND failed (No such file or directory): rule in chain DOCKER-ISOLATION-STAGE-1",id:"docker-rule_append-failed-no-such-file-or-directory-rule-in-chain-docker-isolation-stage-1",level:2},{value:"The virtual machine could not be started because a required feature is not installed.",id:"the-virtual-machine-could-not-be-started-because-a-required-feature-is-not-installed",level:2}];function a(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"wsl",children:"WSL"})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["WSL2 \u4E3A\u5B8C\u6574\u865A\u62DF\u673A - kernel+rootfs\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8DE8 OS FS \u6027\u80FD\u4E0D\u592A\u597D - ",(0,i.jsx)(e.strong,{children:"\u5EFA\u8BAE\u9879\u76EE\u76F4\u63A5\u653E\u5230 VM \u91CC"})]}),"\n",(0,i.jsx)(e.li,{children:"vsc \u548C jetbrain \u652F\u6301\u76F4\u63A5\u6253\u5F00 wsl \u91CC fs"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u7B49\u540C\u4E8E macOS \u4E0B\u7684 ",(0,i.jsx)(e.a,{href:"/notes/os/virt/lima",children:"lima"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u7EA6\u7B49\u4E8E ",(0,i.jsx)(e.a,{href:"/notes/os/virt/firecracker",children:"firecracker"})," \u6548\u679C"]}),"\n",(0,i.jsxs)(e.li,{children:["WSL2 \u5185\u670D\u52A1\u9700\u8981 portproxy \u624D\u80FD\u88AB\u5916\u90E8\u8BBF\u95EE\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["NIC Bridge mode ",(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL/issues/4150",children:"#4150"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u6587\u6863 ",(0,i.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/windows/wsl/",children:"https://learn.microsoft.com/en-us/windows/wsl/"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u6587\u4EF6\u6D4F\u89C8\u5668\u53EF\u76F4\u63A5 \u6253\u5F00 ",(0,i.jsx)(e.code,{children:"\\\\wsl$\\<DISTRO>"})]}),"\n",(0,i.jsxs)(e.li,{children:["Windows 10 2004\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ms-settings:windowsupdate"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["WSL2\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Windows 10 v1903 b18362"}),"\n",(0,i.jsx)(e.li,{children:"Windows 11 v18362"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"enable-wsl",children:"\u542F\u7528 WSL \u529F\u80FD"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4E0B\u8F7D\u5B89\u88C5 Windows WSL2 Update\n",(0,i.jsx)(e.a,{href:"https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi",children:"https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8BF4\u660E\u6587\u6863 ",(0,i.jsx)(e.a,{href:"https://aka.ms/wsl2kernel",children:"https://aka.ms/wsl2kernel"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'cmd.exe /c ver # \u786E\u8BA4\u5F53\u524D\u7CFB\u7EDF\u7248\u672C\n\n# runas /user:Administrator "cmd.exe"\npowershell -Command "Start-Process cmd -Verb RunAs" # \u4EE5\u7BA1\u7406\u5458\u6743\u9650\u8FD0\u884C\n\n# \u542F\u7528 WSL\ndism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart\n# \u542F\u7528 VM\ndism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart\n\n# dism.exe /online /enable-feature /featurename:Microsoft-Hyper-V-All /all /norestart # \u542F\u7528 Hyper-V\n# Get-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform # \u68C0\u67E5\u662F\u5426\u542F\u7528\n\n# \u91CD\u542F\uFF0C\u5B89\u88C5 Windows WSL2 Update\n\n# \u8BBE\u7F6E\u9ED8\u8BA4 WSL 2\nwsl --set-default-version 2\n'})}),"\n",(0,i.jsx)(e.h2,{id:"install-alpine",children:"\u5B89\u88C5 Alpine"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4E0B\u8F7D\u5B89\u88C5 Alpine ",(0,i.jsx)(e.a,{href:"https://github.com/yuk7/AlpineWSL/releases/download/3.21.3-1/Alpine.zip",children:"https://github.com/yuk7/AlpineWSL/releases/download/3.21.3-1/Alpine.zip"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6CE8\u610F\u653E\u5230\u7A7A\u95F4\u8F83\u5927\u7684\u4F4D\u7F6E"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'wslconfig /list              # \u6240\u6709\u7684 VM\nwslconfig /setdefault Alpine # \u8BBE\u7F6E Alpine \u4E3A\u9ED8\u8BA4\n\nwsl -d Alpine # \u8FDB\u5165 Alpine VM\n\n# \u914D\u7F6E\u7CFB\u7EDF\ncat << EOF > /etc/apk/repositories\nhttps://mirrors.aliyun.com/alpine/v3.21/main\nhttps://mirrors.aliyun.com/alpine/v3.21/community\nEOF\necho "nameserver 223.5.5.5" > /etc/resolv.conf\napk update\napk upgrade -a\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4E0A\u6D77\u4EA4\u5927 ",(0,i.jsx)(e.a,{href:"https://mirrors.sjtug.sjtu.edu.cn/alpine/v3.21/main",children:"https://mirrors.sjtug.sjtu.edu.cn/alpine/v3.21/main"})]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"windows-dev",children:"Windows \u5F00\u53D1\u73AF\u5883"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u63A8\u8350\u7528 ",(0,i.jsx)(e.a,{href:"https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701",children:"Windows Terminal"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 \u591A Tab"}),"\n",(0,i.jsxs)(e.li,{children:["\u4ED3\u5E93 ",(0,i.jsx)(e.a,{href:"https://github.com/microsoft/terminal",children:"microsoft/terminal"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["VSC ",(0,i.jsx)(e.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl",children:"WSL"})," \u6269\u5C55"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL",children:"microsoft/WSL"}),"\n\u95EE\u9898\u6536\u96C6\u4ED3\u5E93"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL2-Linux-Kernel",children:"microsoft/WSL2-Linux-Kernel"}),"\n\u5B9E\u9645 Linux \u5185\u6838"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"intellij",children:"IntelliJ"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Terminal \u76F4\u63A5\u8FDB\u5165 WSL\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E Terminal \u4E3A wsl.exe -d Alpine"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53EF\u4EE5\u6253\u5F00 ",(0,i.jsx)(e.code,{children:"\\\\wsl$"})," \u76EE\u5F55"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://www.jetbrains.com/help/idea/how-to-use-wsl-development-environment-in-product.html",children:"https://www.jetbrains.com/help/idea/how-to-use-wsl-development-environment-in-product.html"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"dev-env",children:"\u5F00\u53D1\u73AF\u5883\u51C6\u5907"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"wsl -d Alpine # \u8FDB\u5165 WSL\n\napk add openssh make rsync bash nano # \u57FA\u7840\u4F9D\u8D56\n# \u5F00\u53D1\u76F8\u5173\u4F9D\u8D56apk add openssh make rsync bash nano\napk add libc6-compat gcompat curl bash ca-certificates openssl ncurses coreutils python3 make gcc g++ libgcc linux-headers grep util-linux binutils findutils\n\nbash # ash -> bash\n\n# SSH \u914D\u7F6E\n# \u540C\u6B65 Windows \u4E0A\u7684 ssh \u5BC6\u94A5\u4FE1\u606F\nUSERNAME=$(/mnt/c/Windows/System32/cmd.exe /c 'echo %USERNAME%' | sed -e 's/\\r//g')\nrsync -a /mnt/c/Users/USERNAME/.ssh/ ~/.ssh/\nchmod 700 ~/.ssh/id_rsa\n# \u540C\u6B65 Windows \u4E0A\u7684 git \u914D\u7F6E\ncp /mnt/c/Users/USERNAME/.gitconfig ~\n\n# Git \u914D\u7F6E\n# \u6CE8\u610F\u4FEE\u6539\u7528\u6237\u540D\u548C\u90AE\u7BB1\ngit config --global user.name \"Author Name\"\ngit config --global user.email \"email@address.com\"\n\n# NodeJS\ncurl -L https://raw.githubusercontent.com/tj/n/master/bin/n -o n\nchmod u+x n\n# install -t /usr/local/bin n\nN_NODE_MIRROR=https://npmmirror.com/mirrors/node-unofficial-builds ./n --arch x64-musl lts\n\n# PHP \u73AF\u5883\napk --no-cache add php81 php81-{bcmath,bz2,calendar,common,ctype,curl,dev,dba,dom,embed,enchant,exif,fileinfo,fpm,ftp,gd,gettext,gmp,iconv,imap,intl,json,ldap,mbstring,mysqli,mysqlnd,odbc,opcache,openssl,pcntl,pdo,pdo_dblib,pdo_mysql,pdo_odbc,pdo_pgsql,pdo_sqlite,pear,pgsql,phar,phpdbg,posix,pspell,session,shmop,simplexml,snmp,soap,sockets,sqlite3,sysvmsg,sysvsem,sysvshm,tidy,tokenizer,xml,xmlreader,xmlwriter,xsl,zip,zlib}\nln -s /usr/bin/php81 /usr/bin/php\n"})}),"\n",(0,i.jsx)(e.h2,{id:"expose-ports",children:"\u7AEF\u53E3\u66B4\u9732"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6BCF\u6B21\u90FD\u9700\u8981"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981 Admin \u6267\u884C"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-batch",metastring:'title="cmd"',children:"start C:\\Windows\\system32\n; \u53F3\u952E\u7BA1\u7406\u5458\u8FD0\u884C cmd.exe\n\n; \u67E5\u770B IP \u5730\u5740\nwsl -d Alpine ifconfig eth0\n; \u6620\u5C04 8000 \u5230 WSL\nnetsh interface portproxy set v4tov4 listenport=8000 listenaddress=0.0.0.0 connectport=8000 connectaddress=\u4E0A\u9762\u7684\u5730\u5740\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"addr=$(ip -4 addr show eth0 | grep -Po '(?<=inet\\s)\\d+(\\.\\d+){3}')\n\nexport PATH=\"$PATH:/usr/lib/wsl/lib:/mnt/c/Windows/system32\"\nnetsh.exe interface portproxy set v4tov4 listenport=80 listenaddress=0.0.0.0 connectport=80 connectaddress=$addr\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"wsl hostname -I             # \u8FD4\u56DE disto \u7684 IP \u5730\u5740\nwsl -d Alpine ifconfig eth0 # \u540C\u7406\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL/issues/4150",children:"https://github.com/microsoft/WSL/issues/4150"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"docker",children:"Docker \u73AF\u5883"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u4E0D\u9700\u8981 Docker Desktop"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'apk add docker openrc\ntee /etc/docker/daemon.json <<- \'EOF\'\n{\n  "builder": {\n    "gc": {\n      "defaultKeepStorage": "20GB",\n      "enabled": true\n    }\n  },\n  "experimental": false,\n  "features": {\n    "buildkit": true\n  },\n  "registry-mirrors": ["https://docker.wener.me"]\n}\nEOF\n\n# use legacy iptables for docker\napk add iptables-legacy\nln $(which iptables-legacy) $(which iptables) -f\nln $(which ip6tables-legacy) $(which ip6tables) -f\n\n# openrc \u542F\u52A8 networking \u9700\u8981\u914D\u7F6E\ntouch /etc/network/interfaces\n\nrc-update add docker default\nopenrc default\n\ndocker ps\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Docker Desktop \u521B\u5EFA\u7684\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"docker-desktop"}),"\n",(0,i.jsx)(e.li,{children:"docker-desktop-data"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"autostart-openrc",children:"\u5F00\u673A\u542F\u52A8 OpenRC"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bat",metastring:'title="start-wsl-alpine-openrc.bat"',children:"@echo off\nREM Alpine \u542F\u52A8 OpenRC\nwsl -d Alpine -u root --exec /sbin/openrc-init\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Win + R ",(0,i.jsx)(e.code,{children:"shell:startup"})," \u76EE\u5F55\u4E0B\u653E\u5165 ",(0,i.jsx)(e.code,{children:"start-wsl-alpine-openrc.bat"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u6216\u8005 WSL \u91CC\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"/mnt/c/Users/$WSLUSER/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"WSLUSER=$(powershell.exe '$env:UserName' | tr -d '\\r')\ncd \"/mnt/c/Users/$WSLUSER/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup\"\n\ntee start-wsl-alpine-openrc.bat <<- 'EOF'\n@echo off\necho Alpine: Starting\nwsl -d Alpine -u root -- uname -a\nwsl -d Alpine -u root -- openrc default\necho Alpine: Started\npause > nul\nEOF\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u7BA1\u7406",children:"\u7BA1\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"wsl -l -v # \u5217\u51FA\u6240\u6709\u7684 WSL \u548C WSL \u7248\u672C\n"})}),"\n",(0,i.jsx)(e.h2,{id:"wslu",children:"wslu"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"cmd"}),(0,i.jsx)(e.th,{children:"for"}),(0,i.jsx)(e.th,{children:"\u793A\u4F8B\u7528\u6CD5"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslview"})}),(0,i.jsx)(e.td,{children:"\u5728 WSL \u4E2D\u8C03\u7528 Windows \u9ED8\u8BA4\u7A0B\u5E8F\u6253\u5F00\u6587\u4EF6\u6216 URL\u3002"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslview https://www.example.com"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslusc"})}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"wslview"})," \u7684\u522B\u540D\uFF0C\u540C\u6837\u7528\u4E8E\u6253\u5F00\u6587\u4EF6\u6216 URL\u3002"]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslusc file.txt"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslvar"})}),(0,i.jsx)(e.td,{children:"\u4ECE Windows \u73AF\u5883\u4E2D\u83B7\u53D6\u73AF\u5883\u53D8\u91CF\u7684\u503C\uFF0C\u4FBF\u4E8E\u5728 WSL \u5185\u8BBF\u95EE Windows \u914D\u7F6E\u3002"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslvar USERNAME"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslupath"})}),(0,i.jsx)(e.td,{children:"\u5728 WSL \u4E0E Windows \u8DEF\u5F84\u4E4B\u95F4\u76F8\u4E92\u8F6C\u6362\uFF08\u4F8B\u5982\u5C06 Windows \u8DEF\u5F84\u8F6C\u6362\u4E3A WSL \u683C\u5F0F\uFF09\u3002"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:'wslupath "C:\\Program Files"'})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslfetch"})}),(0,i.jsx)(e.td,{children:"\u663E\u793A WSL \u7CFB\u7EDF\u4FE1\u606F\uFF0C\u7C7B\u4F3C\u4E8E Linux \u4E0B\u7684 neofetch\uFF0C\u7528\u4E8E\u5FEB\u901F\u4E86\u89E3\u7CFB\u7EDF\u72B6\u6001\u3002"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"wslfetch"})})]})]})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://wslutiliti.es/wslu",children:"https://wslutiliti.es/wslu"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"wslconfig",children:"wslconfig"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"%USERPROFILE%\\.wslconfig"})}),"\n",(0,i.jsx)(e.li,{children:"~/.wslconfig"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u5B58\u9ED8\u8BA4 50%"}),"\n",(0,i.jsx)(e.li,{children:"\u4FEE\u6539\u540E\u5173\u673A\u7B49\u5F85 8s \u540E\u518D\u542F\u52A8"}),"\n",(0,i.jsx)(e.li,{children:"/etc/wsl.conf"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-batch",children:"notepad.exe %USERPROFILE%\\.wslconfig\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ini",metastring:'title="%USERPROFILE%.wslconfig"',children:"[wsl2]\n# \u9ED8\u8BA4 50%\nmemory=26GB\n# \u9ED8\u8BA4\u5185\u5B58\u7684 1/4\nswap=\nswapFile=%USERPROFILE%\\AppData\\Local\\Temp\\swap.vhdx\nkernel=\nkernelModules=\nkernelCommandLine=\nprocessors=\nlocalhostForwarding=true\nsafeMode=false\n# Windows \u80FD\u591F\u56DE\u6536\u5206\u914D\u7ED9 WSL 2 \u865A\u62DF\u673A\u7684\u672A\u4F7F\u7528\u5185\u5B58\npageReporting=true\n# https://github.com/microsoft/wslg \u652F\u6301\nguiApplications=true\n# networkingMode=NAT \u65F6\u5C06 WSL \u8BBE\u7F6E\u4E3A host \u7684 NAT\ndnsProxy=true\n# mirrored\nnetworkingMode=NAT\n# Windows \u9632\u706B\u5899\u89C4\u5219\u4EE5\u53CA\u7279\u5B9A\u4E8E Hyper-V \u6D41\u91CF\u7684\u89C4\u5219\u53EF\u4EE5\u7B5B\u9009 WSL \u7F51\u7EDC\u6D41\u91CF\nfirewall=true\ndnsTunneling=true\n# WLS \u5F3A\u5236\u4F7F\u7528 Windows \u7684 HTTP \u4EE3\u7406\nautoProxy=true\ndefaultVhdSize=1TB\n\n# Windows 11+\ndebugConsole=false\nnestedVirtualization=true\nvmIdleTimeout=60000\n\n[experimental]\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config",children:"https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"etcwslconf",children:"/etc/wsl.conf"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"DrvFs - WSL \u6302\u8F7D Windows \u76D8\u7B26"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ini",children:'[automount]\n# \u81EA\u52A8\u6302\u8F7D Windows \u76D8\u7B26\u5230 /mnt \u4F7F\u7528 DrvFs\nenabled = true\nroot = /mnt/\n# DrvFs \u53C2\u6570\n# uid,gid,umask,fmask,dmask,metadata,case\noptions = ""\n# \u662F\u5426\u5904\u7406 /etc/fstab\nmountFsTab = true\n\n[network]\n# \u751F\u6210 /etc/hosts\ngenerateHosts = true\n# \u751F\u6210 /etc/resolv.conf\ngenerateResolvConf = true\nhostname =\n\n[interop]\n# WSL \u662F\u5426\u652F\u6301\u542F\u52A8 Windows \u8FDB\u7A0B\nenabled = true\n# \u662F\u5426\u5C06 Windows \u8DEF\u5F84\u6DFB\u52A0\u5230 WSL \u7684 PATH \u4E2D\nappendWindowsPath = true\n\n# Windows 18980+\n[user]\n# \u9996\u6B21\u542F\u52A8 WSL \u7684\u7528\u6237\u8EAB\u4EFD\ndefault =\n\n# Windows 11+, Windows Server 2022+\n[boot]\n# \u542F\u52A8 WSL \u65F6\u8FD0\u884C\u7684\u547D\u4EE4\ncommand = ""\n# \u9632\u6B62 WSL \u5728\u542F\u7528 systemd \u65F6\u751F\u6210 systemd \u5355\u5143\nprotectBinfmt=true\n\n[gpu]\nenabled = true\n\n[time]\n# WSL2 \u4F7F\u7528 Windows \u7684\u65F6\u533A\ntimezone = true\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Windows 11"}),"\n",(0,i.jsx)(e.li,{children:"Windows Build 17093+"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/windows/wsl/wsl-config",children:"https://learn.microsoft.com/en-us/windows/wsl/wsl-config"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://gist.github.com/ecarlson94/283102ffd2f2473d41e7c9965be8fdd4",children:"https://gist.github.com/ecarlson94/283102ffd2f2473d41e7c9965be8fdd4"})}),"\n"]}),"\n",(0,i.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/windows/wsl/troubleshooting",children:"https://learn.microsoft.com/en-us/windows/wsl/troubleshooting"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Windows/system32:/mnt/c/Windows:/mnt/c/Windows/System32/Wbem:/mnt/c/Windows/System32/WindowsPowerShell/v1.0/:/mnt/c/Windows/System32/OpenSSH/:/mnt/c/Users/USERNAME/AppData/Local/Microsoft/WindowsApps\nexport PATH="$PATH:/usr/lib/wsl/lib:/mnt/c/Windows/system32:/mnt/c/Windows/System32/WindowsPowerShell/v1.0"\n\n# \u6302\u8F7D\u7F3A\u5C11\u7684\u76D8\u7B26\nsudo mount -t drvfs F: /mnt/f\n'})}),"\n",(0,i.jsx)(e.h2,{id:"wsl-vs-wsl2",children:"WSL vs WSL2"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["WSL\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u975E\u5168\u865A\u62DF\u5316"}),"\n",(0,i.jsx)(e.li,{children:"\u76F8\u540C FS - \u8DE8 OS FS \u66F4\u5FEB"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u8BBF\u95EE USB \u8BBE\u5907"}),"\n",(0,i.jsx)(e.li,{children:"\u76F8\u540C\u7F51\u7EDC\u7A7A\u95F4"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["WSL2 - Windows 11, Windows 10 v1903+,b18362+\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u865A\u62DF\u673A"}),"\n",(0,i.jsx)(e.li,{children:"\u5B8C\u6574 Linux \u5185\u6838"}),"\n",(0,i.jsx)(e.li,{children:"\u5B8C\u6574 syscall \u517C\u5BB9"}),"\n",(0,i.jsx)(e.li,{children:"\u8DE8 OS FS \u6027\u80FD\u5DEE\u4E00\u70B9 - \u5EFA\u8BAE\u76F4\u63A5\u653E\u5230 VM \u91CC"}),"\n",(0,i.jsx)(e.li,{children:"\u7528\u66F4\u591A\u5185\u5B58 - linux \u5185 cache \u4E0D\u4F1A free \u90A3\u4E48\u5FEB"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/windows/wsl/compare-versions",children:"https://learn.microsoft.com/en-us/windows/wsl/compare-versions"})}),"\n",(0,i.jsx)(e.li,{children:"winver"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u9002\u7528\u4E8E-linux-\u7684-windows-\u5B50\u7CFB\u7EDF\u5B9E\u4F8B\u5DF2\u7EC8\u6B62",children:"\u9002\u7528\u4E8E Linux \u7684 Windows \u5B50\u7CFB\u7EDF\u5B9E\u4F8B\u5DF2\u7EC8\u6B62"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"#\nnetsh wincosk reset\n# \u91CD\u542F\u670D\u52A1 HV Host Service\n#\nnet stop LxssManager\nnet start LxssManager\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u7CFB\u7EDF\u627E\u4E0D\u5230\u6307\u5B9A\u8DEF\u5F84",children:"\u7CFB\u7EDF\u627E\u4E0D\u5230\u6307\u5B9A\u8DEF\u5F84"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-batch",children:"wsl --list --all --verbose\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5E94\u8BE5\u662F\u5B89\u88C5\u7684 \u955C\u50CF\u4F4D\u7F6E\u53D1\u751F\u4E86\u53D8\u5316\u6216\u8005\u88AB\u5220\u9664"}),"\n",(0,i.jsx)(e.h2,{id:"\u8FC1\u79FB",children:"\u8FC1\u79FB"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-batch",children:"wsl --export\nwsl --import\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Lxss"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u68C0\u6D4B\u662F\u5426\u8FD0\u884C\u5728-wsl",children:"\u68C0\u6D4B\u662F\u5426\u8FD0\u884C\u5728 WSL"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"/proc/sys/kernel/osrelease"}),"\n",(0,i.jsx)(e.li,{children:"/proc/version"}),"\n",(0,i.jsx)(e.li,{children:"Microsoft, WSL"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"uname -a\n"})}),"\n",(0,i.jsx)(e.h2,{id:"the-windows-subsystem-for-linux-has-not-been-enabled",children:"The Windows Subsystem for Linux has not been enabled."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ERR: The Windows Subsystem for Linux has not been enabled.\nHRESULT: 0x8007019e\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"dism \u542F\u7528\u529F\u80FD\uFF0C\u7136\u540E\u91CD\u542F"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"get-current-username",children:"\u83B7\u53D6\u5F53\u524D\u7528\u6237\u540D"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"powershell.exe '$env:UserName'\ncmd.exe /c \"echo %USERNAME%\"\ncmd.exe /c \"whoami\"\n\n# wsl.locahost\nbasename \"$(wslpath -w ~ | cut -d'\\' -f3)\"\n\napk add wslu\nwslvar USERNAME\n\n# \u6240\u6709\u7528\u6237\nls -l /mnt/c/Users/ | grep -v \"Public\\|Default\" | grep -E '^d' | awk '{print $9}'\n"})}),"\n",(0,i.jsx)(e.h2,{id:"alpine-networking",children:"alpine networking"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"# service docker start\n * Starting networking ...\nifquery: could not parse /etc/network/interfaces\n * ERROR: networking failed to start\n * ERROR: cannot start docker as networking would not start\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"tee /etc/network/interfaces <<- 'EOF'\nauto lo\niface lo inet loopback\n\nauto eth0\nEOF\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"/etc/network/interfaces"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"auto lo\niface lo inet loopback\n\nauto eth0\n"})}),"\n",(0,i.jsx)(e.h2,{id:"docker-network",children:"Docker network"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"sudo dockerd --iptables=false\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL/issues/8450",children:"https://github.com/microsoft/WSL/issues/8450"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"cannot-open-netlink-socket-protocol-not-supported",children:"Cannot open netlink socket: Protocol not supported"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"iproute2 ss"}),"\n",(0,i.jsx)(e.li,{children:"WSL 1 \u95EE\u9898"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"docker-rule_append-failed-no-such-file-or-directory-rule-in-chain-docker-isolation-stage-1",children:"docker RULE_APPEND failed (No such file or directory): rule in chain DOCKER-ISOLATION-STAGE-1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"apk add iptables-legacy\n# /sbin/xtables-nft-multi -> /sbin/xtables-legacy-multi\n# iptables-nft -> iptables-legacy\nln $(which iptables-legacy) $(which iptables) -f\nln $(which ip6tables-legacy) $(which ip6tables) -f\n\nservice docker restart\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"WSL 2"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/microsoft/WSL/issues/6655",children:"https://github.com/microsoft/WSL/issues/6655"})}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"the-virtual-machine-could-not-be-started-because-a-required-feature-is-not-installed",children:"The virtual machine could not be started because a required feature is not installed."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ERR: The virtual machine could not be started because a required feature is not installed.\nHRESULT: 0x80370102\n"})})]})}function h(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>d});var l=s(7378);let i={},r=l.createContext(i);function t(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);