"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["92714"],{5266:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>t,toc:()=>i,default:()=>h,metadata:()=>s,assets:()=>d,contentTitle:()=>o});var s=JSON.parse('{"id":"ops/admin/crontab","title":"crontab","description":"- crontab.guru","source":"@site/../notes/ops/admin/crontab.md","sourceDirName":"ops/admin","slug":"/ops/admin/crontab","permalink":"/notes/ops/admin/crontab","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/ops/admin/crontab.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1706956646000,"frontMatter":{"title":"crontab"},"sidebar":"docs","previous":{"title":"Benchmark","permalink":"/notes/ops/admin/benchmark"},"next":{"title":"fio","permalink":"/notes/ops/admin/fio"}}'),c=r(86106),l=r(17776);let t={title:"crontab"},o="crontab",d={},i=[{value:"\u9ED8\u8BA4\u5468\u671F\u6027\u4EFB\u52A1",id:"\u9ED8\u8BA4\u5468\u671F\u6027\u4EFB\u52A1",level:2},{value:"macOS",id:"macos",level:2},{value:"\u5E38\u89C1\u6E05\u7406",id:"\u5E38\u89C1\u6E05\u7406",level:2},{value:"help",id:"help",level:2}];function a(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"crontab",children:"crontab"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.a,{href:"https://crontab.guru",children:"crontab.guru"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u65F6\u95F4\u7F16\u8F91\u5668"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.a,{href:"https://blog.sanctum.geek.nz/cron-best-practices/",children:"Cron best practices"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://news.ycombinator.com/item?id=30636872",children:"HN"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u975E root/macos \u63A8\u8350\u4F7F\u7528\u4E00\u4E2A\u81EA\u5DF1\u7684 crontab \u6587\u4EF6, \u8FD9\u6837\u4FBF\u4E8E\u7BA1\u7406\nnano ~/.crontab\ncrontab ~/.crontab\ncrontab -l\n\n# \u91CD\u5B9A\u5411\u65E5\u5FD7\nnano /etc/rsyslog.d/50-default.conf\n# \u6DFB\u52A0\n# cron.*\nsudo service rsyslog restart\n\n# \u6216\u8005\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5728 sysylog \u4E2D\u627E\ntail -f /var/log/syslog | grep CRON\n\n# \u4E5F\u53EF\u4EE5\u76F4\u63A5\u5C06\u4EFB\u52A1\u8BBE\u7F6E\u4E3A\u6BCF\u5206\u949F\u6267\u884C\u4E00\u6B21,\u7136\u540E\u5C06 crond \u5728\u524D\u53F0\u6267\u884C,\u6D4B\u8BD5\u65E5\u5FD7\u8F93\u51FA\ncrond -nx test\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"#!/bin/bash\n# \u7B80\u5355\u7684\u670D\u52A1\u81EA\u52A8\u91CD\u542F\n# \u7136\u540E\u6DFB\u52A0\u5230 @reboot \u89C4\u5219\u4E2D\u5C31\u53EF\u4EE5\nuntil myserver; do\n  echo \"Server 'myserver' crashed with exit code $?.  Respawning..\" >&2\n  sleep 1\ndone\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u9ED8\u8BA4\u5468\u671F\u6027\u4EFB\u52A1",children:"\u9ED8\u8BA4\u5468\u671F\u6027\u4EFB\u52A1"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\u5B88\u62A4\u8FDB\u7A0B\u914D\u7F6E /etc/conf.d/crond\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:'\u9ED8\u8BA4 CRON_OPTS="-c /etc/crontabs"'}),"\n",(0,c.jsx)(e.li,{children:'\u53EF\u4EE5\u4FEE\u6539\u4E3A CRON_OPTS="-c /etc/crontabs -L /var/log/crond.log -l 6"'}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"\u9ED8\u8BA4\u4F4D\u7F6E /etc/crontabs"}),"\n",(0,c.jsxs)(e.li,{children:["\u9ED8\u8BA4\u5468\u671F\u6027\u4EFB\u52A1 /etc/crontabs/root\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["/var/spool/cron/ - \u7528\u6237\u76EE\u5F55\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"/var/spool/cron/root"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"/etc/cron.d/ - \u7CFB\u7EDF\u4EFB\u52A1"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["run-parts \u4F1A\u6267\u884C\u4E00\u4E2A\u76EE\u5F55\u4E0B\u7684\u811A\u672C\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u9ED8\u8BA4\u7684 run-parts \u662F busybox \u81EA\u5E26\u7684, \u4E5F\u53EF\u4EE5\u989D\u5916\u5B89\u88C5"}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://pkgs.alpinelinux.org/package/v3.7/main/x86_64/run-parts",children:"https://pkgs.alpinelinux.org/package/v3.7/main/x86_64/run-parts"})}),"\n",(0,c.jsxs)(e.li,{children:["\u68C0\u6D4B\u4E00\u4E2A\u76EE\u5F55\u4E0B\u6709\u54EA\u4E9B\u4F1A\u88AB\u6267\u884C ",(0,c.jsx)(e.code,{children:"run-parts --test /etc/periodic/daily"})]}),"\n",(0,c.jsxs)(e.li,{children:["\u91CC\u9762\u7684\u811A\u672C ",(0,c.jsx)(e.strong,{children:"\u4E0D\u8981"})," \u5305\u542B ",(0,c.jsx)(e.code,{children:".sh"})," \u540E\u7F00\uFF0C\u4E14\u786E\u4FDD\u53EF\u6267\u884C ",(0,c.jsx)(e.code,{children:"chmod +x"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"# \u5F3A\u5236\u6307\u5B9A shell\nSHELL=/bin/sh\n# \u53EF\u5B9A\u4E49\u53D8\u91CF\nMAILTO=wener\n# \u6307\u5B9A\u65F6\u533A\nCRON_TZ=Asia/Shanghai\n\n# \u53EF\u6267\u884C\u4EFB\u610F shell\n\n# \u5B57\u6BB5\u542B\u4E49\n# min	hour	day	month	weekday [runas]	command\n*/15 * * * * run-parts /etc/periodic/15min\n0 * * * * run-parts /etc/periodic/hourly\n0 2 * * * run-parts /etc/periodic/daily\n0 3 * * 6 run-parts /etc/periodic/weekly\n0 5 1 * * run-parts /etc/periodic/monthly\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"# \u6BCF\u4E24\u5468\u4E00\u6B21\n0 4 * * 6 test $((10#$(date +\\%W)\\%2)) -eq 1 && run-parts /etc/periodic/bi-weekly\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"alias"}),(0,c.jsx)(e.th,{children:"for"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@reboot"}),(0,c.jsx)(e.td,{children:"\u91CD\u542F\u540E\u6267\u884C\u4E00\u6B21"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@yearly"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 0 1 1 *"})})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@annually"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 0 1 1 *"})})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@monthly"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 0 1 * *"})})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@weekly"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 0 * * 0"})})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@daily"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 0 * * *"})})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"@hourly"}),(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"0 * * * *"})})]})]})]}),"\n",(0,c.jsx)(e.h2,{id:"macos",children:"macOS"}),"\n",(0,c.jsx)(e.p,{children:"\u867D\u7136\u4E0D\u63A8\u8350\u4F7F\u7528 crontab, \u56E0\u4E3A\u5176\u529F\u80FD\u90FD\u5DF2\u7ECF\u88AB lanuchd \u66FF\u4EE3,\u4F46\u7B80\u5355\u7684\u5DE5\u4F5C\u8FD8\u662F crontab \u66F4\u7B80\u5355"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"http://stackoverflow.com/a/23880156/1870054",children:"http://stackoverflow.com/a/23880156/1870054"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.a,{href:"https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/ScheduledJobs.html",children:"ScheduledJobs"})}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u91CD\u5B9A\u5411 cron \u65E5\u5FD7\nsudo nano /etc/syslog.conf\n# \u6DFB\u52A0\n# cron.* /var/log/cron.log\n\n# \u91CD\u542F syslog\nsudo launchctl unload /System/Library/LaunchDaemons/com.apple.syslogd.plist\nsudo launchctl load /System/Library/LaunchDaemons/com.apple.syslogd.plist\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u5E38\u89C1\u6E05\u7406",children:"\u5E38\u89C1\u6E05\u7406"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Docker GC\ndocker system prune --force\n\n# ZFS scrub\nzpoll scrub main\n"})}),"\n",(0,c.jsx)(e.h2,{id:"help",children:"help"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"$ crond --help\nBusyBox v1.27.2 (2017-11-28 16:17:30 GMT) multi-call binary.\n\nUsage: crond -fbS -l N -d N -L LOGFILE -c DIR\n\n	-f	Foreground\n	-b	Background (default)\n	-S	Log to syslog (default)\n	-l N	Set log level. Most verbose 0, default 8\n	-d N	Set log level, log to stderr\n	-L FILE	Log to FILE\n	-c DIR	Cron dir. Default:/var/spool/cron/crontabs\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"$ crontab --help\nBusyBox v1.27.2 (2017-11-28 16:17:30 GMT) multi-call binary.\n\nUsage: crontab [-c DIR] [-u USER] [-ler]|[FILE]\n\n	-c	Crontab directory\n	-u	User\n	-l	List crontab\n	-e	Edit crontab\n	-r	Delete crontab\n	FILE	Replace crontab by FILE ('-': stdin)\n"})})]})}function h(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(a,{...n})}):a(n)}},17776:function(n,e,r){r.d(e,{R:()=>t,x:()=>o});var s=r(7378);let c={},l=s.createContext(c);function t(n){let e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:t(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);