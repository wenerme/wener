"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["787781"],{369649:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>s,toc:()=>c,default:()=>p,metadata:()=>o,assets:()=>a,contentTitle:()=>l});var o=JSON.parse('{"id":"service/api/buf","title":"buf","description":"- bufbuild/buf","source":"@site/../notes/service/api/buf.md","sourceDirName":"service/api","slug":"/service/api/buf","permalink":"/notes/service/api/buf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/api/buf.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1735615618000,"frontMatter":{"title":"buf"},"sidebar":"docs","previous":{"title":"Apollo Config","permalink":"/notes/service/api/apolloconfig"},"next":{"title":"Dubbo","permalink":"/notes/service/api/dubbo"}}'),i=t(486106),r=t(917776);let s={title:"buf"},l="buf",a={},c=[{value:"Node",id:"node",level:2}];function u(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"buf",children:"buf"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/bufbuild/buf",children:"bufbuild/buf"})}),"\n",(0,i.jsx)(n.li,{children:"BUF_CACHE_DIR"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# macOS\n# protoc-gen-buf-breaking, protoc-gen-buf-lint\nbrew install bufbuild/buf/buf\n# golang\ngo install github.com/bufbuild/buf/cmd/buf@latest\n\nbuf mod init\nbuf mod update\n\nbuf build\n\nbuf build --exclude-source-info -o -#format=json | jq \'.file[] | .package\' | sort | uniq | head\n\nbuf ls-files\nbuf ls-files git://github.com/bufbuild/buf-tour.git#branch=main,subdir=start/petapis\nbuf ls-files buf.build/envoyproxy/protoc-gen-validate\n\nbuf lint\n\nbuf breaking --against ../../.git#branch=main,subdir=start/petapis\nbuf breaking --against "https://github.com/bufbuild/buf-tour/archive/main.zip#strip_components=1,subdir=start/petapis" --config buf.yaml\nbuf build -o - | buf breaking --against -\n\nbuf generate petapis\n\ngo install google.golang.org/protobuf/cmd/protoc-gen-go@latest\ngo install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest\n\ngo install github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway@latest\ngo install github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-openapiv2@latest\ngo install github.com/grpc-ecosystem/protoc-gen-grpc-gateway-ts@latest\ngo install github.com/envoyproxy/protoc-gen-validate@latest\n\nexport BUF_USER=wener\nbuf login\n# ~/.netrc\n# machine buf.build\n#     login $BUF_USER\n#     password $TOKEN\nbuf beta registry repository create buf.build/$BUF_USER/petapis --visibility public\n# buf.yaml\n# name: buf.build/$BUF_USER/petapis\nbuf push\n\ndocker run \\\n  --volume "$(pwd):/workspace" \\\n  --workdir /workspace \\\n  bufbuild/buf build\n\nbuf lint --error-format=config-ignore-yaml\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"version: v1\nlint:\n  use:\n    - DEFAULT\nbreaking:\n  use:\n    - FILE\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"version: v1\ndirectories:\n  - proto\n  - vendor/protoc-gen-validate\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"go-grpc"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"version: v1\nplugins:\n  - name: go\n    out: .\n    opt: paths=source_relative\n  - name: gotag\n    out: .\n    opt: paths=source_relative\n  - name: go-grpc\n    out: .\n    opt: paths=source_relative,require_unimplemented_servers=true\n  - name: grpc-gateway\n    out: .\n    opt:\n      - paths=source_relative\n      - generate_unbound_methods=true\n\n- name: grpc-gateway-ts\n    out: gen/web/api\n    opt: paths=source_relative\n  - name: validate\n    out: .\n    opt: lang=go,paths=source_relative\n\n- name: openapiv2\n    out: openapiv2\n  - name: doc\n    out: gen/doc\n    strategy: all\n    opt: markdown,proto.md\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="buf.gen.yaml"',children:"version: v1\nmanaged:\n  enabled: true\n  cc_enable_arenas: false\n  java_multiple_files: true\nplugins:\n  - name: cpp\n    out: gen/proto/cpp\n  - name: java\n    out: gen/proto/java\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"version: v1\nmanaged:\n  enabled: true\n  # FileOptions\n  # https://github.com/protocolbuffers/protobuf/blob/51405b6b92c2070c8edea1b44c6770e00f7027be/src/google/protobuf/descriptor.proto#L342\n  cc_enable_arenas: false\n  java_multiple_files: false\n  java_package_prefix: com\n  java_string_check_utf8: false\n  optimize_for: CODE_SIZE\n  go_package_prefix:\n    default: github.com/acme/weather/private/gen/proto/go\n    # \u6392\u9664\u6A21\u5757\n    except:\n      - buf.build/googleapis/googleapis\n    override:\n      buf.build/acme/weather: github.com/acme/weather/gen/proto/go\n  override:\n    JAVA_PACKAGE_PREFIX:\n      acme/weather/v1/weather.proto: 'org'\nplugins:\n  - name: go\n    out: gen/proto/go\n    opt: paths=source_relative\n"})}),"\n",(0,i.jsx)(n.h2,{id:"node",children:"Node"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5173\u4E8E\u517C\u5BB9 ts-proto ",(0,i.jsx)(n.a,{href:"https://github.com/connectrpc/connect-es/issues/1030",children:"https://github.com/connectrpc/connect-es/issues/1030"})]}),"\n",(0,i.jsx)(n.li,{children:"\u6CE8\u610F @bufbuild/protobuf @bufbuild/protoc-gen-es \u9700\u8981\u914D\u5408 @connectrpc/connect \u7684\u7248\u672C"}),"\n",(0,i.jsxs)(n.li,{children:["\u6CE8\u610F\u26A0\uFE0F\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"int64,uint64,fixed64,sfixed64,sint64 \u4E3A BigInt"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int64 field = 1 [jstype = JS_STRING]; // \u751F\u6210 string \u7C7B\u578B"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53EF\u4EE5\u5F3A\u5236\u5F97\u5230 string"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"google.protobuf.Struct"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"map<string, string>"})," -> ",(0,i.jsx)(n.code,{children:"Record<string, string>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6CA1\u6709\u4F7F\u7528 Map \u56E0\u4E3A\u5F88\u591A \u5E93\u4E0D\u652F\u6301"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["oneof -> ",(0,i.jsx)(n.code,{children:'{ case:"X", value:"" }'})]}),"\n",(0,i.jsxs)(n.li,{children:["\u4E3B\u8981\u64CD\u4F5C\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"create"}),"\n",(0,i.jsx)(n.li,{children:"fromBinary/toBinary"}),"\n",(0,i.jsx)(n.li,{children:"fromjson/toJson"}),"\n",(0,i.jsx)(n.li,{children:"isMessage"}),"\n",(0,i.jsx)(n.li,{children:"isFieldSet"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u76EE\u524D\u65E0\u6CD5\u751F\u6210 index\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Provide support for top-level exports ",(0,i.jsx)(n.a,{href:"https://github.com/bufbuild/protobuf-es/issues/455",children:"bufbuild/protobuf-es#455"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# @bufbuild/buf\n\n# v1\npnpm add -D @bufbuild/buf @bufbuild/protoc-gen-es@^1 @connectrpc/protoc-gen-connect-es\npnpm add @connectrpc/connect @bufbuild/protobuf@^1\n\n# v2\n# \u4E0D\u518D\u9700\u8981 @connectrpc/protoc-gen-connect-es\npnpm add -D @bufbuild/protoc-gen-es\npnpm add @connectrpc/connect@rc @bufbuild/protobuf @connectrpc/connect-node\n"})})]})}function p(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},917776:function(e,n,t){t.d(n,{R:()=>s,x:()=>l});var o=t(7378);let i={},r=o.createContext(i);function s(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);