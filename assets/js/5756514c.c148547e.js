"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["82464"],{4113:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>h,metadata:()=>t,assets:()=>a,contentTitle:()=>i});var t=JSON.parse('{"id":"web/framework/nextjs/nextjs-cookbook","title":"NextJS Cookbook","description":"- \u5B98\u65B9\u4F8B\u5B50 https://github.com/zeit/next.js/tree/canary/examples","source":"@site/../notes/web/framework/nextjs/nextjs-cookbook.md","sourceDirName":"web/framework/nextjs","slug":"/web/framework/nextjs/cookbook","permalink":"/notes/web/framework/nextjs/cookbook","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/web/framework/nextjs/nextjs-cookbook.md","tags":[{"inline":true,"label":"Cookbook","permalink":"/notes/tags/cookbook"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1702440128000,"frontMatter":{"title":"NextJS Cookbook","tags":["Cookbook"]},"sidebar":"docs","previous":{"title":"NextJS Conf","permalink":"/notes/web/framework/nextjs/conf"},"next":{"title":"NextJS Edge Runtime","permalink":"/notes/web/framework/nextjs/edge"}}'),r=s(86106),o=s(17776);let l={title:"NextJS Cookbook",tags:["Cookbook"]},i="NextJS Cookbook",a={},c=[{value:"\u914D\u7F6E\u95EE\u9898\u6392\u67E5",id:"\u914D\u7F6E\u95EE\u9898\u6392\u67E5",level:2},{value:"\u9875\u9762\u57FA\u7840\u4EE3\u7801",id:"\u9875\u9762\u57FA\u7840\u4EE3\u7801",level:2},{value:"API \u57FA\u7840\u4EE3\u7801",id:"api-\u57FA\u7840\u4EE3\u7801",level:2},{value:"\u9875\u9762\u8DF3\u8F6C",id:"\u9875\u9762\u8DF3\u8F6C",level:2},{value:"SSE - Servr-Send Event",id:"sse---servr-send-event",level:2},{value:"CSS \u5BFC\u5165\u5B57\u4F53",id:"css-\u5BFC\u5165\u5B57\u4F53",level:2},{value:"\u5BFC\u5165 SVG",id:"\u5BFC\u5165-svg",level:2},{value:"\u4F7F\u7528 @svgr/webpack",id:"\u4F7F\u7528-svgrwebpack",level:3},{value:"\u4F7F\u7528 inline-react-svg",id:"\u4F7F\u7528-inline-react-svg",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"nextjs-cookbook",children:"NextJS Cookbook"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5B98\u65B9\u4F8B\u5B50 ",(0,r.jsx)(n.a,{href:"https://github.com/zeit/next.js/tree/canary/examples",children:"https://github.com/zeit/next.js/tree/canary/examples"})]}),"\n",(0,r.jsxs)(n.li,{children:["compose ",(0,r.jsx)(n.a,{href:"https://github.com/JerryCauser/next-compose/blob/master/index.js",children:"https://github.com/JerryCauser/next-compose/blob/master/index.js"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://dev.to/toomuchdesign/next-js-react-router-2kl8",children:"https://dev.to/toomuchdesign/next-js-react-router-2kl8"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// \u5224\u65AD\u670D\u52A1\u7AEF\nconst isServer = typeof window === 'undefined';\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u914D\u7F6E\u95EE\u9898\u6392\u67E5",children:"\u914D\u7F6E\u95EE\u9898\u6392\u67E5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// \u8F93\u51FA Webpack \u7684\u5339\u914D\u89C4\u5219\nconfig.module.rules.forEach((rule) => console.log(`Rule Test ${rule.test} Use`, rule.use));\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u9875\u9762\u57FA\u7840\u4EE3\u7801",children:"\u9875\u9762\u57FA\u7840\u4EE3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import React from 'react';\nimport { NextPage } from 'next';\n\nconst Page: NextPage = () => {\n  return <div></div>;\n};\n\nexport default Page;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"api-\u57FA\u7840\u4EE3\u7801",children:"API \u57FA\u7840\u4EE3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { NextApiRequest, NextApiResponse } from 'next';\n\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.status(200).json({ version: process.env.APP_VERSION || '1.0.0' });\n};\n\nexport default handler;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u9875\u9762\u8DF3\u8F6C",children:"\u9875\u9762\u8DF3\u8F6C"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// \u521D\u59CB\u9636\u6BB5\u8DF3\u8F6C\nPage.getInitialProps = async ({ res }) => {\n  // \u76EE\u6807\u5730\u5740\n  let targetUrl = '...';\n  if (!res) {\n    window.location.href = targetUrl;\n  } else {\n    res.writeHead(302, { Location: targetUrl });\n    res.end();\n  }\n  return {};\n};\n\n// \u9875\u9762\u5185\u8DF3\u8F6C\nfunction MyPage() {\n  const router = useRouter();\n  useEffect(() => {\n    if (!auth) {\n      router.push('...');\n    }\n  }, []);\n}\n\n// API \u8DF3\u8F6C\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.clearCookie('authenticated');\n  res.writeHead(302, { Location: '/login' });\n  res.end();\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"sse---servr-send-event",children:"SSE - Servr-Send Event"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { NextApiRequest, NextApiResponse } from 'next';\n\nexport const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\n// curl -Nv localhost:3000/test/see\n// https://zeit.co/pricing#limits Zeit free only allowed 10s/req\n// NOTE Zeit deploy not works - because the request will be buffered\n// https://github.com/zeit/next.js/issues/9965\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Content-Type', 'text/event-stream;charset=utf-8');\n  res.setHeader('Cache-Control', 'no-cache, no-transform');\n  res.setHeader('X-Accel-Buffering', 'no');\n\n  for (let i = 0; i < 5; i++) {\n    res.write(`data: Hello seq ${i}\\n\\n`);\n    await sleep(1000);\n  }\n  res.end('done\\n');\n};\n\nexport default handler;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:"<!DOCTYPE html>\n<html>\n  <head>\n    <meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\" />\n    <title>EventSource test</title>\n  </head>\n  <body>\n    <h1>EventSource test</h1>\n    <ul></ul>\n\n    <script type=\"text/javascript\">\n      var logger = document.getElementsByTagName('ul')[0],\n        socket = new EventSource('/');\n\n      var log = function (text) {\n        logger.innerHTML += '<li>' + text + '</li>';\n      };\n\n      socket.onopen = function () {\n        log('OPEN');\n      };\n\n      socket.onmessage = function (event) {\n        log('MESSAGE: ' + event.data);\n      };\n\n      socket.addEventListener('update', function (event) {\n        log('UPDATE(' + event.lastEventId + '): ' + event.data);\n      });\n\n      socket.onerror = function (event) {\n        log('ERROR: ' + event.message);\n      };\n    <\/script>\n  </body>\n</html>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"css-\u5BFC\u5165\u5B57\u4F53",children:"CSS \u5BFC\u5165\u5B57\u4F53"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"config.module.rules.push({\n  test: /\\.(eot|woff|woff2|ttf)$/,\n  use: {\n    loader: 'url-loader',\n    options: {\n      limit: 100000,\n      name: '[name].[ext]',\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5BFC\u5165-svg",children:"\u5BFC\u5165 SVG"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"url-loader inline \u4F1A\u751F\u6210 dataurl - react \u53EF\u80FD\u5BFC\u81F4\u5F02\u5E38"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/twopluszero/next-images",children:"next-images"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// Typescript \u786E\u4FDD\u4E0D\u4F1A\u51FA\u73B0\u7C7B\u578B\u9519\u8BEF\ndeclare module '*.svg';\n\ndeclare module '*.png';\ndeclare module '*.jpg';\ndeclare module '*.jpeg';\ndeclare module '*.gif';\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528-svgrwebpack",children:"\u4F7F\u7528 @svgr/webpack"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53EF\u4EE5\u4F7F\u7528 tsconfig \u4E2D\u7684 path"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://react-svgr.com/docs/webpack/",children:"https://react-svgr.com/docs/webpack/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/url-loader/issues/86",children:"https://github.com/webpack-contrib/url-loader/issues/86"})}),"\n",(0,r.jsxs)(n.li,{children:["Base64 \u95EE\u9898\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/gregberge/svgr/issues/361",children:"https://github.com/gregberge/svgr/issues/361"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/gregberge/svgr/issues/404",children:"https://github.com/gregberge/svgr/issues/404"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn add --dev @svgr/webpack babel-loader\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"config.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  use: [\n    {\n      loader: 'babel-loader',\n    },\n    {\n      loader: '@svgr/webpack',\n      options: {\n        babel: false,\n        icon: true,\n      },\n    },\n  ],\n});\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// \u533A\u5206 js \u6216 css \u5BFC\u5165\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  issuer: {\n    test: /\\.[tj]sx?$/,\n  },\n  use: ['babel-loader', '@svgr/webpack', 'file-loader'],\n});\n\nconfig.module.rules.push({\n  test: /\\.svg(\\?v=\\d+\\.\\d+\\.\\d+)?$/,\n  loader: 'url-loader',\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4F7F\u7528-inline-react-svg",children:"\u4F7F\u7528 inline-react-svg"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4E0D\u53EF\u4EE5"})," \u4F7F\u7528 tsconfig \u4E2D\u7684 path"]}),"\n",(0,r.jsx)(n.li,{children:"\u4F1A\u7528 SVGO \u4F18\u5316"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn add --dev babel-plugin-inline-react-svg\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "presets": ["next/babel"],\n  "plugins": ["inline-react-svg"]\n}\n'})})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},17776:function(e,n,s){s.d(n,{R:()=>l,x:()=>i});var t=s(7378);let r={},o=t.createContext(r);function l(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);