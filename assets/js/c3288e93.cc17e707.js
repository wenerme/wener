"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["422759"],{284116:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>l,toc:()=>o,default:()=>x,metadata:()=>s,assets:()=>i,contentTitle:()=>c});var s=JSON.parse('{"id":"service/storage/nextcloud/README","title":"NextCloud","description":"- Primary Storage","source":"@site/../notes/service/storage/nextcloud/README.md","sourceDirName":"service/storage/nextcloud","slug":"/service/storage/nextcloud/","permalink":"/notes/service/storage/nextcloud/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/nextcloud/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1752420691000,"frontMatter":{"title":"NextCloud"},"sidebar":"docs","previous":{"title":"netatalk","permalink":"/notes/service/storage/netatalk"},"next":{"title":"Nextcloud \u914D\u7F6E","permalink":"/notes/service/storage/nextcloud/conf"}}'),d=t(486106),r=t(917776);let l={title:"NextCloud"},c="NextCloud",i={},o=[{value:"Docker",id:"docker",level:2},{value:"ldap",id:"ldap",level:2},{value:"Notes",id:"notes",level:2},{value:"Docker All in One",id:"docker-all-in-one",level:2}];function a(n){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"nextcloud",children:"NextCloud"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.a,{href:"https://docs.nextcloud.com/server/11/admin_manual/configuration_files/primary_storage.html",children:"Primary Storage"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u53EF\u4EE5\u4F7F\u7528 S3 \u6216 Swift \u4F5C\u4E3A\u4E3B\u8981\u5B58\u50A8"}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://github.com/nextcloud/server/tree/master/lib/private/Files/ObjectStore",children:"lib/Files/ObjectStore"})}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.a,{href:"https://docs.nextcloud.com/server/11/admin_manual/configuration_user/user_auth_ldap.html",children:"User Authentication with LDAP"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"The LDAP app is not compatible with the User backend using remote HTTP servers app. You cannot use both of them at the same time."}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.li,{children:"\u6570\u636E\u5E93\u53EF\u4EE5\u4F7F\u7528 SQLite, MySQL, PostGreSQL"}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.a,{href:"https://docs.nextcloud.com/server/12/admin_manual/configuration_server/config_sample_php_parameters.html",children:"Config.php"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://github.com/nextcloud/server/blob/master/config/config.sample.php",children:"config.sample.php"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.li,{children:"\u9ED8\u8BA4\u63A8\u8350\u5E94\u7528 - calendar,contacts,talk,mail,collaborative editing"}),"\n",(0,d.jsxs)(e.li,{children:["\u53D1\u5E03\u53D8\u66F4\u5185\u5BB9 ",(0,d.jsx)(e.a,{href:"https://nextcloud.com/changelog/",children:"https://nextcloud.com/changelog/"})]}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"docker",children:"Docker"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["/var/www/html - \u4E3B\u76EE\u5F55\uFF0C\u9700\u8981\u66F4\u65B0\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"/custom_apps"})," - \u5E94\u7528\u76EE\u5F55 - \u5B89\u88C5\u6216\u66F4\u65B0\u7684\u5E94\u7528"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"/config"})," - \u672C\u5730\u914D\u7F6E"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"/data"})," \u5B9E\u9645\u6570\u636E"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.code,{children:"/themes/<THEME>"})," \u4E3B\u9898"]}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"Env"}),(0,d.jsx)(e.th,{children:"Default"}),(0,d.jsx)(e.th,{children:"Description"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SQLITE_DATABASE"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MYSQL_DATABASE"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MYSQL_USER"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MYSQL_PASSWORD"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MYSQL_HOST"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"POSTGRES_DB"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"POSTGRES_USER"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"POSTGRES_PASSWORD"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"POSTGRES_HOST"}),(0,d.jsx)(e.td,{}),(0,d.jsxs)(e.td,{children:["\u53EF\u4EE5\u5305\u542B\u7AEF\u53E3\uFF0C\u4F8B\u5982 ",(0,d.jsx)(e.code,{children:"postgres:5432"})]})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"NEXTCLOUD_ADMIN_USER"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"NEXTCLOUD_ADMIN_PASSWORD"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"NEXTCLOUD_DATA_DIR"}),(0,d.jsx)(e.td,{children:"/var/www/html/data"}),(0,d.jsx)(e.td,{children:"\u5B58\u50A8\u7528\u6237\u6570\u636E\u7684\u76EE\u5F55"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"NEXTCLOUD_TRUSTED_DOMAINS"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u7A7A\u683C\u5206\u5272\u53EF\u4FE1\u57DF\u540D"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"NEXTCLOUD_UPDATE"}),(0,d.jsx)(e.td,{children:"0"}),(0,d.jsx)(e.td,{children:"\u5982\u679C\u81EA\u5B9A\u4E49\u547D\u4EE4\u542F\u52A8\u9700\u8981\u5F00\u542F\u624D\u4F1A\u66F4\u65B0\uFF0C\u4F7F\u7528\u9ED8\u8BA4 (apache-foreground, php-fpm) \u542F\u52A8\u7684\u65F6\u5019\u4F1A\u89E6\u53D1\u66F4\u65B0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"REDIS_HOST"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"Redis \u7528\u4E8E\u6587\u4EF6\u9501"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"REDIS_HOST_PORT"}),(0,d.jsx)(e.td,{children:"6379"}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_HOST"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_SECURE"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u53EF\u8BBE\u7F6E\u4E3A ssl"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_PORT"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"25 \u6216 SSL 456"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_AUTHTYPE"}),(0,d.jsx)(e.td,{children:"LOGIN"}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_NAME"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"SMTP_PASSWORD"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MAIL_FROM_ADDRESS"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u53D1\u4FE1\u5730\u5740"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"MAIL_DOMAIN"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u4E0D\u8BBE\u7F6E\u5219\u4E3A nextcloud \u7684\u57DF\u540D"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"APACHE_DISABLE_REWRITE_IP"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u8BBE\u7F6E\u4E3A 1 \u7981\u7528 IP \u91CD\u5199"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"TRUSTED_PROXIES"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u7A7A\u683C\u5206\u5272\u7684\u53EF\u4FE1\u4EE3\u7406\uFF0C\u652F\u6301 CIDR"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"OVERWRITEHOST"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u6307\u5B9A host\uFF0C\u7528\u4E8E TRUSTED_PROXIES \u672A\u751F\u6548\u7684\u65F6\u5019"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"OVERWRITEPROTOCOL"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"http https"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"OVERWRITEWEBROOT"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"OVERWRITECONDADDR"}),(0,d.jsx)(e.td,{}),(0,d.jsx)(e.td,{children:"\u590D\u5199\u751F\u6548\u7684\u6765\u6E90\u5730\u5740"})]})]})]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"# \u6307\u5B9A\u6570\u636E\u5E93\u548C\u8D26\u53F7\u5BC6\u7801\u5219\u4E0D\u9700\u8981\u8FDB\u5165\u5230\u5B89\u88C5\u9875\u9762\n# SQLite \u6587\u4EF6\u5728 /var/www/html/data/nextcloud.db\n# \u542F\u52A8\u811A\u672C https://github.com/nextcloud/docker/blob/master/docker-entrypoint.sh\n# \u542F\u52A8\u4F1A\u68C0\u6D4B /var/www/html/version.php \u7248\u672C\u53F7 - \u5982\u679C\u6CA1\u6709\u5219\u8BA4\u4E3A\u662F\u65B0\u5B89\u88C5\n\n# \u5355\u72EC\u76EE\u5F55\u6620\u5C04\ndocker run -it --rm \\\n  -v $PWD/nextcloud/config:/var/www/html/config \\\n  -v $PWD/nextcloud/data:/var/www/html/data \\\n  -v $PWD/nextcloud/themes:/var/www/html/themes \\\n  -v $PWD/nextcloud/custom_apps:/var/www/html/custom_apps \\\n  -v $PWD/nextcloud/html:/var/www/html \\\n  -p 80:80 \\\n  -e SQLITE_DATABASE=nextcloud \\\n  -e NEXTCLOUD_ADMIN_USER=nextcloud \\\n  -e NEXTCLOUD_ADMIN_PASSWORD=nextcloud \\\n  --name nextcloud nextcloud:18\n\n# \u5355\u4E2A\u76EE\u5F55\u6620\u5C04 - \u4F1A\u5B89\u88C5 300M \u5DE6\u53F3 - macos \u8F83\u6162\uFF0C\u8BBF\u95EE\u4E5F\u4F1A\u6162\ndocker run -it --rm \\\n  -v $PWD/nextcloud:/var/www/html \\\n  -p 80:80 \\\n  -e SQLITE_DATABASE=nextcloud \\\n  -e NEXTCLOUD_ADMIN_USER=nextcloud \\\n  -e NEXTCLOUD_ADMIN_PASSWORD=nextcloud \\\n  --name nextcloud nextcloud:18\n\n# \u4F7F\u7528 www-data \u8D26\u53F7\u8FDB\u884C\u64CD\u4F5C\ndocker exec -it -u www-data nextcloud bash\n\n# \u7981\u7528\u610F\u4E49\u4E0D\u5927\u7684\u5E94\u7528\n./occ app:disable firstrunwizard federation nextcloud_announcements support survey_client updatenotification\n# \u7CBE\u9009\u5E38\u7528\u5E94\u7528\nfor i in announcementcenter external impersonate limit_login_to_ip files_automatedtagging files_accesscontrol groupfolders notes user_ldap user_saml; do\n  ./occ app:enable $i\ndone\n\n# \u5B89\u88C5\u5E38\u7528\u5E94\u7528\nfor i in admin_audit extract files_external files_texteditor group_everyone metadata user_ldap user_saml; do\n  ./occ app:enable $i\ndone\n\n# \u5B98\u65B9\u63A8\u8350\u5E94\u7528 - calendar,contacts,talk,mail,collaborative editing\n\n# \u793E\u4EA4\u5E94\u7528\nfor i in circles talk social; do\n  ./occ app:enable $i\ndone\n\n# \u4E8B\u52A1\u5E94\u7528\nfor i in calendar contacts mail deck tasks; do\n  ./occ app:enable $i\ndone\n\n# \u529E\u516C\u5E94\u7528 - \u529F\u80FD\u91CD\u590D\nfor i in onlyoffice richdocuments; do\n  ./occ app:enable $i\ndone\n\n# \u7BA1\u7406\u5E94\u7528\nfor i in occweb; do\n  ./occ app:enable $i\ndone\n\n# \u5DE5\u5177\nfor i in files_rightclick checksum; do\n  ./occ app:enable $i\ndone\n"})}),"\n",(0,d.jsx)(e.h2,{id:"ldap",children:"ldap"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.code,{children:"ldap:set-config <configID> <configKey> <configValue>"})}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"./occ ldap:set-config s01 ldapUserDisplayName2 displayName\n"})}),"\n",(0,d.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://docs.nextcloud.com/server/latest/admin_manual/index.html",children:"admin manual"})}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"docker-all-in-one",children:"Docker All in One"}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.strong,{children:"Note"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u662F\u901A\u8FC7\u5C06 docker \u6620\u5C04\u5230\u5BB9\u5668\u5185\uFF0C\u542F\u52A8 composer \u5B8C\u6210"}),"\n",(0,d.jsx)(e.li,{children:"\u53EF\u4EE5\u53C2\u8003\u903B\u8F91"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["Nextcloud + Office + Backend + ",(0,d.jsx)(e.a,{href:"https://github.com/borgbackup/borg",children:"borg"})," Backup + Imaginary + ClamAV + Full text search"]}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"docker run \\\n  --sig-proxy=false \\\n  --name nextcloud-aio-mastercontainer \\\n  --restart always \\\n  --publish 80:80 \\\n  --publish 8080:8080 \\\n  --publish 8443:8443 \\\n  --volume nextcloud_aio_mastercontainer:/mnt/docker-aio-config \\\n  --volume /var/run/docker.sock:/var/run/docker.sock:ro \\\n  nextcloud/all-in-one:latest\n"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"3478 Turnserver for talk"}),"\n",(0,d.jsx)(e.li,{children:(0,d.jsx)(e.a,{href:"https://github.com/nextcloud/all-in-one",children:"https://github.com/nextcloud/all-in-one"})}),"\n"]})]})}function x(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},917776:function(n,e,t){t.d(e,{R:()=>l,x:()=>c});var s=t(7378);let d={},r=s.createContext(d);function l(n){let e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:l(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);