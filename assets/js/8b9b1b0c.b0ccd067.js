"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["52791"],{90976:function(n,e,c){c.r(e),c.d(e,{frontMatter:()=>r,toc:()=>d,default:()=>a,metadata:()=>l,assets:()=>o,contentTitle:()=>s});var l=JSON.parse('{"id":"service/api/grpc/connect","title":"Connect","description":"- https://connect.build/","source":"@site/../notes/service/api/grpc/connect.md","sourceDirName":"service/api/grpc","slug":"/service/api/grpc/connect","permalink":"/notes/service/api/grpc/connect","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/api/grpc/connect.md","tags":[{"inline":true,"label":"Protocol","permalink":"/notes/tags/protocol"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1736508300000,"frontMatter":{"title":"Connect","tags":["Protocol"]},"sidebar":"docs","previous":{"title":"gRPC","permalink":"/notes/service/api/grpc/"},"next":{"title":"gRPC Awesome","permalink":"/notes/service/api/grpc/awesome"}}'),i=c(86106),t=c(17776);let r={title:"Connect",tags:["Protocol"]},s="Connect",o={},d=[{value:"Awesome",id:"awesome",level:2},{value:"\u534F\u8BAE",id:"protocol",level:2},{value:"connect-es",id:"connect-es",level:2},{value:"connect-web",id:"connect-web",level:2},{value:"connect-go",id:"connect-go",level:2},{value:"\u5B9E\u73B0",id:"\u5B9E\u73B0",level:3},{value:"Why Connect",id:"why-connect",level:2}];function h(n){let e={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"connect",children:"Connect"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://connect.build/",children:"https://connect.build/"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"gRPC \u7ADE\u54C1"}),"\n",(0,i.jsx)(e.li,{children:"\u517C\u5BB9 gRPC, gRPC-Web \u534F\u8BAE"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 bi-streaming - \u4F7F\u7528 gRPC \u534F\u8BAE"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 JSON- \u548C binary-encoded Protobuf"}),"\n",(0,i.jsxs)(e.li,{children:["Connect \u81EA\u8EAB\u534F\u8BAE - \u57FA\u4E8E POST - application/connect+proto\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 Stream - \u4E00\u884C\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u7C7B\u4F3C SSE"}),"\n",(0,i.jsx)(e.li,{children:"\u534F\u8BAE\u548C\u5B9E\u73B0\u66F4\u7B80\u5355"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 HTTP1"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u76EE\u524D\u652F\u6301 Go, Web, Node.js, Swift, Kotlin"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"grpc: application/grpc, application/grpc+proto, application/grpc+json"}),"\n",(0,i.jsx)(e.li,{children:"grpc-web: pplication/grpc-web, application/grpc-web+proto, application/grpc-web+json"}),"\n",(0,i.jsxs)(e.li,{children:["connect\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"unary: application/proto, application/json"}),"\n",(0,i.jsx)(e.li,{children:"striming: application/connect+proto, application/connect+json"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{type:"caution",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Python Implementation ",(0,i.jsx)(e.a,{href:"https://github.com/connectrpc/connectrpc.com/pull/71",children:"connectrpc/connectrpc.com#71"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/mattrobenolt/connect-python",children:"https://github.com/mattrobenolt/connect-python"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/i2y/connecpy",children:"https://github.com/i2y/connecpy"})}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(e.h2,{id:"awesome",children:"Awesome"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://connect.build/docs/protocol/",children:"Connect Protocol Reference"})}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/connectrpc/vanguard-go",children:"connectrpc/vanguard-go"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Apache-2.0, Go"}),"\n",(0,i.jsx)(e.li,{children:"Gateway"}),"\n",(0,i.jsx)(e.li,{children:"REST, gRPC, gRPC-Web, and Connect"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/bufbuild/protobuf-es",children:"bufbuild/protobuf-es"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"JS PB \u5B9E\u73B0"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/bufbuild/connect-crosstest",children:"bufbuild/connect-crosstest"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u517C\u5BB9\u6D4B\u8BD5"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/connectrpc/connect-es",children:"connectrpc/connect-es"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["npm:@connectrpc/connect-node\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u3001\u670D\u52A1\u7AEF"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5BA2\u6237\u7AEF\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"npm:@connectrpc/connect-web"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u670D\u52A1\u7AEF\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"npm:@connectrpc/connect-next"}),"\n",(0,i.jsx)(e.li,{children:"npm:@connectrpc/connect-fastify"}),"\n",(0,i.jsx)(e.li,{children:"npm:@connectrpc/connect-express"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"protocol",children:"\u534F\u8BAE"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-http",children:"POST /<Package>.<Service>/<Method>\n"})}),"\n",(0,i.jsx)(e.h2,{id:"connect-es",children:"connect-es"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["router = ",(0,i.jsx)(e.code,{children:"{handlers,service(),rpc()}"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["handlers - universal handler\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u6240\u6709\u534F\u8BAE - grpc, grpcWeb, connect"}),"\n",(0,i.jsx)(e.li,{children:"\u5305\u542B\u5143\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"service \u6CE8\u518C\u6574\u4E2A service"}),"\n",(0,i.jsx)(e.li,{children:"rpc \u6CE8\u518C\u4E00\u4E2A\u65B9\u6CD5"}),"\n",(0,i.jsxs)(e.li,{children:["handler = \u534F\u8BAE\u534F\u5546 -> interceptor -> impl\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"interceptor \u65E0\u6CD5\u8BBF\u95EE\u5F53\u524D\u7684 impl"}),"\n",(0,i.jsx)(e.li,{children:"invokeUnaryImplementation"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"const next = applyInterceptors(fn,interceptors)"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"return message = next()"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"connect-web",children:"connect-web"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/connectrpc/connect-es",children:"connectrpc/connect-es"})}),"\n",(0,i.jsxs)(e.li,{children:["@bufbuild/connect-web -> connectrpc/connect-es\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"16kB/5kB"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"npm install @bufbuild/protoc-gen-es @bufbuild/protoc-gen-connect-web\n\nPATH=$PATH:$(pwd)/node_modules/.bin\n"})}),"\n",(0,i.jsx)(e.h2,{id:"connect-go",children:"connect-go"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.del,{children:(0,i.jsx)(e.a,{href:"https://github.com/bufbuild/connect-go",children:"bufbuild/connect-go"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 net/http"}),"\n",(0,i.jsx)(e.li,{children:"\u751F\u6210\u4F7F\u7528\u6CDB\u578B"}),"\n",(0,i.jsx)(e.li,{children:"\u{1F31F} Client \u548C Server \u63A5\u53E3\u76F8\u540C - \u65B9\u4FBF\u64CD\u4F5C"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/connectrpc/connect-go",children:"connectrpc/connect-go"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u57FA\u4E8E POST \u7684 connect \u534F\u8BAE\ncurl \\\n  --header "Content-Type: application/json" \\\n  --data \'{"sentence": "I feel happy."}\' \\\n  https://demo.connect.build/buf.connect.demo.eliza.v1.ElizaService/Say\n\n# \u517C\u5BB9 gRPC \u534F\u8BAE\ngrpcurl \\\n  -d \'{"sentence": "I feel happy."}\' \\\n  demo.connect.build:443 \\\n  buf.connect.demo.eliza.v1.ElizaService/Say\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"go install github.com/bufbuild/buf/cmd/buf@latest\ngo install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest\ngo install google.golang.org/protobuf/cmd/protoc-gen-go@latest\ngo install github.com/bufbuild/connect-go/cmd/protoc-gen-connect-go@latest\ngo install github.com/bufbuild/protobuf-es/cmd/protoc-gen-es@latest\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",metastring:'title="buf.gen.yaml:"',children:"version: v1\nplugins:\n  - name: go\n    out: gen\n    opt: paths=source_relative\n  - name: connect-go\n    out: gen\n    opt: paths=source_relative\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5B9E\u73B0",children:"\u5B9E\u73B0"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Handler - \u5F53\u4E2A RPC \u65B9\u6CD5\u5904\u7406\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0 Connect, gRPC, gRPC-Web \u534F\u8BAE"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B ServeHTTP"}),"\n",(0,i.jsxs)(e.li,{children:["\u6784\u9020\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"NewBidiStreamHandler"}),"\n",(0,i.jsx)(e.li,{children:"NewClientStreamHandler"}),"\n",(0,i.jsx)(e.li,{children:"NewServerStreamHandler"}),"\n",(0,i.jsx)(e.li,{children:"NewUnaryHandler"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"why-connect",children:"Why Connect"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"gRPC \u56E0\u4E3A\u8003\u8651 Google \u5185\u90E8\u4F7F\u7528\u548C\u5F00\u6E90\u793E\u533A\u4F7F\u7528\uFF0C\u4E00\u4E9B\u8BBE\u8BA1\u4E0A\u5F88\u4E71\u5F88\u5947\u602A"}),"\n",(0,i.jsx)(e.li,{children:"gRPC \u5C0F\u7248\u672C\u4E5F\u53EF\u80FD\u4E0D\u51FA\u73B0\u517C\u5BB9"}),"\n",(0,i.jsx)(e.li,{children:"gRPC \u5728 Web \u73AF\u5883\u975E\u5E38\u9EBB\u70E6"}),"\n",(0,i.jsx)(e.li,{children:"\u8981\u6C42 HTTP/2 Trailer - \u5BF9\u4F7F\u7528\u73AF\u5883\u3001\u5B9E\u73B0\u8981\u6C42\u82DB\u523B"}),"\n",(0,i.jsxs)(e.li,{children:["vs golang grpc\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E0D\u517C\u5BB9 net/http"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u590D\u6742"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://buf.build/blog/connect-a-better-grpc",children:"https://buf.build/blog/connect-a-better-grpc"})}),"\n"]})]})}function a(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},17776:function(n,e,c){c.d(e,{R:()=>r,x:()=>s});var l=c(7378);let i={},t=l.createContext(i);function r(n){let e=l.useContext(t);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),l.createElement(t.Provider,{value:e},n.children)}}}]);