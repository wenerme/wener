"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["13636"],{87079:function(e,t,n){n.r(t),n.d(t,{frontMatter:()=>r,toc:()=>o,default:()=>d,metadata:()=>s,assets:()=>x,contentTitle:()=>a});var s=JSON.parse('{"id":"db/relational/sqlite/litestream","title":"litestream","description":"- benbjohnson/litestream","source":"@site/../notes/db/relational/sqlite/litestream.md","sourceDirName":"db/relational/sqlite","slug":"/db/relational/sqlite/litestream","permalink":"/notes/db/relational/sqlite/litestream","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/sqlite/litestream.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1678453938000,"frontMatter":{"title":"litestream"},"sidebar":"docs","previous":{"title":"litefs","permalink":"/notes/db/relational/sqlite/litefs"},"next":{"title":"sqlar","permalink":"/notes/db/relational/sqlite/sqlar"}}'),i=n(86106),l=n(17776);let r={title:"litestream"},a="litestream",x={},o=[];function c(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"litestream",children:"litestream"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/benbjohnson/litestream",children:"benbjohnson/litestream"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"SQLite \u589E\u91CF\u5907\u4EFD"}),"\n",(0,i.jsx)(t.li,{children:"\u4F5C\u4E3A disaster recovery"}),"\n",(0,i.jsx)(t.li,{children:"\u652F\u6301\u5B58\u50A8 s3, sftp, file"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["HOW TO\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"litestream \u7EF4\u6301\u4E00\u4E2A \u8BFB \u94FE\u63A5"}),"\n",(0,i.jsxs)(t.li,{children:["\u907F\u514D\u53D1\u751F wal_autocheckpoint - \u9AD8\u5199\u5165\u65F6\u63A8\u8350\u8BBE\u7F6E ",(0,i.jsx)(t.code,{children:"wal_autocheckpoint=0"})]}),"\n",(0,i.jsx)(t.li,{children:"litestream \u540C\u6B65 wal ,\u6267\u884C checkpoint"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"\u5FC5\u987B\u4F7F\u7528 WAL \u6A21\u5F0F"}),"\n",(0,i.jsx)(t.li,{children:"\u5EFA\u8BAE\u5C06 busy_timeout \u8BBE\u7F6E\u4E3A 5000+"}),"\n",(0,i.jsx)(t.li,{children:"\u63A8\u8350 synchronous=NORMAL"}),"\n",(0,i.jsx)(t.li,{children:"\u5F02\u6B65\u526F\u672C - \u9ED8\u8BA4\u540C\u6B65\u95F4\u9694 1s"}),"\n"]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"# macOS brew \u5B89\u88C5\nbrew install benbjohnson/litestream/litestream\n# go install\ngo install github.com/benbjohnson/litestream/cmd/litestream\n# \u4E0B\u8F7D\u5B89\u88C5\ncurl -OL https://github.com/benbjohnson/litestream/releases/download/v0.3.8/litestream-v0.3.8-darwin-amd64.zip\ncurl -OL https://github.com/benbjohnson/litestream/releases/download/v0.3.8/litestream-v0.3.8-linux-amd64-static.tar.gz\n\n\nexport LITESTREAM_ACCESS_KEY_ID=minioadmin\nexport LITESTREAM_SECRET_ACCESS_KEY=minioadmin\n# \u526F\u672C\u5907\u4EFD\nlitestream replicate fruits.db s3://localhost:9000/fruits.db\n# \u5728\u53E6\u5916\u5730\u65B9\u6062\u590D\nlitestream restore -o fruits2.db s3://localhost:9000/fruits.db\n\n# SFTP\nlitestream replicate /path/to/db sftp://USER:PASSWORD@HOST:PORT/PATH\n\n\nlitestream databases          # \u663E\u793A\u914D\u7F6E\u91CC\u7684\u6240\u6709 DB\nlitestream generations DST    # \u663E\u793A DB \u6216 URL \u7684\u72B6\u6001\nlitestream replicate          # \u6240\u6709\nlitestream replicate SRC DST  # \u5355\u4E2A\nlitestream restore DST        # \u6062\u590D\nlitestream snapshots DST      # \u67E5\u770B\u5FEB\u7167\nlitestream wal DST            # \u67E5\u770B WAL \u72B6\u6001\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="/etc/litestream.yml"',children:"# \u5168\u5C40 S3 \u914D\u7F6E\naccess-key-id: AKIAxxxxxxxxxxxxxxxx\nsecret-access-key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx\n# Metrics\naddr: ':9090'\n\ndbs:\n  - path: /var/lib/db1\n    replicas:\n      - name: my_do_replica\n        url: s3://mybkt.litestream.io/db1\n        # url \u6216 \u72EC\u7ACB\u914D\u7F6E\n        type:   s3\n        bucket: mybkt.litestream.io\n        # S3 path - \u5982\u679C\u53EA\u6709 path \u914D\u7F6E\uFF0C\u5219\u4E3A file\n        path:   db\n        region: us-east1\n        access-key-id: AKIAxxxxxxxxxxxxxxxx\n        secret-access-key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx\n        force-path-style:\n        skip-verify:\n\n        retention: 24h\n        retention-check-interval: 1h\n        snapshot-interval:\n        validation-interval: false\n        sync-interval: 1s\n"})})]})}function d(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},17776:function(e,t,n){n.d(t,{R:()=>r,x:()=>a});var s=n(7378);let i={},l=s.createContext(i);function r(e){let t=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(l.Provider,{value:t},e.children)}}}]);