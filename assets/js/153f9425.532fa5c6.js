"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["676167"],{301241:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>d,toc:()=>o,default:()=>h,metadata:()=>i,assets:()=>c,contentTitle:()=>t});var i=JSON.parse('{"id":"os/linux/fs/ext4","title":"ext4","description":"ext4","source":"@site/../notes/os/linux/fs/ext4.md","sourceDirName":"os/linux/fs","slug":"/os/linux/fs/ext4","permalink":"/notes/os/linux/fs/ext4","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/fs/ext4.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1765157611000,"frontMatter":{"title":"ext4"},"sidebar":"docs","previous":{"title":"exFAT","permalink":"/notes/os/linux/fs/exfat"},"next":{"title":"f2fs","permalink":"/notes/os/linux/fs/f2fs"}}'),r=s(486106),l=s(917776);let d={title:"ext4"},t,c={},o=[{value:"ext4",id:"ext4",level:2},{value:"\u6D4B\u8BD5 fs",id:"\u6D4B\u8BD5-fs",level:2},{value:"mke2fs.conf",id:"mke2fsconf",level:2},{value:"resize \u9700\u8981\u6CE8\u610F\u7684\u53C2\u6570",id:"resize-\u9700\u8981\u6CE8\u610F\u7684\u53C2\u6570",level:2},{value:"New size results in too many block group descriptors",id:"new-size-results-in-too-many-block-group-descriptors",level:2},{value:"kernel error",id:"kernel-error",level:2},{value:"online shrink",id:"online-shrink",level:2},{value:"e2image seek_relative: Invalid argument",id:"e2image-seek_relative-invalid-argument",level:2},{value:"dd compress",id:"dd-compress",level:2},{value:"mounted filesystem with ordered data mode. Quota mode: none.",id:"mounted-filesystem-with-ordered-data-mode-quota-mode-none",level:2},{value:"ssd",id:"ssd",level:2},{value:"\u4F18\u5316",id:"\u4F18\u5316",level:2}];function a(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"ext4",children:"ext4"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["man ",(0,r.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man5/ext4.5.html",children:"ext4.5"})]}),"\n",(0,r.jsxs)(e.li,{children:["man ",(0,r.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man8/mke2fs.8.html",children:"mke2fs.8"})]}),"\n",(0,r.jsxs)(e.li,{children:["man ",(0,r.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man8/resize2fs.8.html",children:"resize2fs.8"})]}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man8/e2image.8.html",children:"e2image.8"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://serverfault.com/a/496099/190601",children:"Choose block size"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://linuxreviews.org/Year_2038_Timestamp_Problem",children:"https://linuxreviews.org/Year_2038_Timestamp_Problem"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.admonition,{type:"tip",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["mkfs.ext4 \u9ED8\u8BA4 1k block - \u5BFC\u81F4\u4E0D\u80FD\u8D85\u8FC7 2T\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"1k \u4E00\u822C\u7528\u4E8E U \u76D8 \u8FD9\u79CD\u5B58\u50A8\u6BD4\u8F83\u5C0F\u7684\u8BBE\u5907"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"inode >= 256 \u907F\u514D Y2038 \u95EE\u9898"}),"\n",(0,r.jsxs)(e.li,{children:["resize2fs \u53EF\u4EE5 on-line grow \u4F46 ",(0,r.jsx)(e.strong,{children:"\u4E0D\u80FD on-line shrinking"})]}),"\n",(0,r.jsx)(e.li,{children:"e2image \u53EF\u4EE5\u4ECE QCOW2 \u8BFB\u53D6 - \u4F46\u5982\u679C QCOW2 \u4E0D\u662F\u7531 e2imaghe \u751F\u6210\u5219\u4E0D\u4E00\u5B9A\u652F\u6301"}),"\n",(0,r.jsx)(e.li,{children:"QCOW2 \u4E0D\u662F spare\uFF0C\u56E0\u6B64\u9ED8\u8BA4\u7A7A\u95F4\u66F4\u5C0F\uFF0C\u66F4\u65B9\u4FBF\u4E0B\u8F7D"}),"\n",(0,r.jsx)(e.li,{children:"\u9ED8\u8BA4\u4FDD\u7559 5% \u7A7A\u95F4\u7528\u4E8E root \u7528\u6237\u4F7F\u7528, \u4E5F\u53EF\u4EE5\u907F\u514D\u788E\u7247, \u5982\u679C\u5927\u786C\u76D8\u5E94\u8BE5\u8BBE\u7F6E\u5C0F\u4E00\u70B9"}),"\n"]})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"apk add e2fsprogs e2fsprogs-extra\n\nresize2fs -P /dev/sda3 # \u9884\u4F30 blocks \u6570\u91CF - \u5B9E\u9645\u5927\u5C0F*4K\ntune2fs -l /dev/sda3   # \u67E5\u770B\u4FE1\u606F\ne2fsck -p /dev/sda3    # \u68C0\u6D4B\u4FEE\u590D\n\n# size \u652F\u6301 KMGT\nresize2fs /dev/sda3 100000         # \u7F29\u5C0F\u5206\u533A\ne2image -ra -p /dev/sda1 /dev/sdb1 # \u590D\u5236\u5206\u533A - \u53EA\u590D\u5236\u7528\u5230\u7684\u5757 - \u6548\u7387\u66F4\u9AD8\n\ntune2fs -l /dev/sda3 | grep UUID\n# tune2fs -U random /dev/sdY1 # \u968F\u673A\u751F\u6210 UUID, e2image \u4F1A\u590D\u5236 UUID\n\ne2image -rap /dev/vda3 vda3.img # backup\nresize2fs -P vda3.img\ne2fsck -p vda3.img\ne2fsck -f vda3.img\nresize2fs -p vda3.img 4G\ne2image -rap vda3.img /dev/vdb2\n\nlsof /dev/vdb2 # \u4F7F\u7528\u60C5\u51B5 - \u9700\u8981 apk add lsof\nlsof / | awk '$4 ~ /[0-9].*[wu]/'\n\n# \u6302\u8F7D\u4E3A\u53EA\u8BFB\nmount -f -o remount,ro /mount/point\necho 1 > /sys/block/dm-4/ro\necho 1 > /sys/block/sda/sda2/ro\n# echo u > /proc/sysrq-trigger\n\ntune2fs -O read-only /dev/vda  # \u8BBE\u7F6E\u53EA\u8BFB\ntune2fs -O ^read-only /dev/vda # \u53D6\u6D88\u53EA\u8BFB\n\ntune2fs -U $(uuidgen) /dev/sdb1 # \u4FEE\u6539 UUID\n\nlsblk -x NAME --output NAME,SIZE,VENDOR,FSTYPE,LABEL,UUID,MODE # \u67E5\u770B\u8BBE\u5907\u60C5\u51B5\n\n# dd boot 100MB\n# dd \u540E\u53EF\u4EE5\u91CD\u65B0\u4FEE\u6539\u5206\u533A\ndd if=/dev/vda of=/dev/vdb count=204800 bs=512\ne2image -ra -p /dev/vda3 /dev/vdb2\n\nmount -o remount,ro / # \u4E0D\u80FD\u6210\u529F - \u4ECE ro \u5230 rw \u53EF\u4EE5\nmount | column -t\n\n# 8 inode\nsudo debugfs -R \"stat <8>\" /dev/sda1\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"resize2fs"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-b"}),(0,r.jsx)(e.td,{children:"64bit"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-d debug-flags"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-f"}),(0,r.jsx)(e.td,{children:"force"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-F"}),(0,r.jsx)(e.td,{children:"flush"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-M"}),(0,r.jsx)(e.td,{children:"\u7F29\u5230\u6700\u5C0F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-p"}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u5B8C\u6210\u8FDB\u5EA6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-P"}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u9884\u4F30\u6700\u5C0F blocks \u6570"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-s"}),(0,r.jsx)(e.td,{children:"off 64bit, free blocks"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-S RAID-stride"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-z undo_file"}),(0,r.jsx)(e.td,{})]})]})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["undo_file\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"resize2fs-device.e2undo"}),"\n",(0,r.jsx)(e.li,{children:"E2FSPROGS_UNDO_DIR"}),"\n"]}),"\n"]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"e2image"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-a"}),(0,r.jsx)(e.td,{children:"include file data in image file, \u9ED8\u8BA4\u53EA\u5305\u542B fs metadata"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-b superblock"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-B blocksize"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-c"}),(0,r.jsx)(e.td,{children:"\u5BF9\u6BD4\uFF0C\u76F8\u540C\u5219\u4E0D\u62F7\u8D1D block"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-f"}),(0,r.jsx)(e.td,{children:"force - \u5141\u8BB8 source \u4E3A\u975E readonly \u72B6\u6001"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-I"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-n"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-o src_offset"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-O tgt_offset"}),(0,r.jsx)(e.td,{})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-p"}),(0,r.jsx)(e.td,{children:"\u663E\u793A\u8FDB\u5EA6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-Q"}),(0,r.jsx)(e.td,{children:"QCOW2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-r"}),(0,r.jsx)(e.td,{children:"raw \u683C\u5F0F"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-s"}),(0,r.jsx)(e.td,{})]})]})]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"cmd"}),(0,r.jsx)(e.th,{children:"for"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"e2fsck"}),(0,r.jsx)(e.td,{children:"fsck"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"e2image"}),(0,r.jsx)(e.td,{children:"clone"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"resize2fs"}),(0,r.jsx)(e.td,{children:"resize"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"tune2fs"}),(0,r.jsx)(e.td,{children:"tune"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"\u6D4B\u8BD5-fs",children:"\u6D4B\u8BD5 fs"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"truncate --size 10M test\n\nmkfs.ext4 -v test\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u9009\u62E9 small fs type"}),"\n",(0,r.jsx)(e.li,{children:"block-size 1024"}),"\n",(0,r.jsx)(e.li,{children:"blocks 10240 = 10M"}),"\n",(0,r.jsxs)(e.li,{children:["\u6700\u5927 fs blocks 10485760\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6700\u5927 resize 1024 \u500D = 10240*1024"}),"\n",(0,r.jsx)(e.li,{children:"= blocks per group * inodes per group = 8192*1280"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"fs_types for mke2fs.conf resolution: 'ext4', 'small'\nDiscarding device blocks: done\nDiscard succeeded and will return 0s - skipping inode table wipe\nFilesystem label=\nOS type: Linux\nBlock size=1024 (log=0)\nFragment size=1024 (log=0)\nStride=0 blocks, Stripe width=0 blocks\n2560 inodes, 10240 blocks\n512 blocks (5.00%) reserved for the super user\nFirst data block=1\nMaximum filesystem blocks=10485760\n2 block groups\n8192 blocks per group, 8192 fragments per group\n1280 inodes per group\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"tune2fs -l test\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53EF\u4EE5\u53CD\u63A8 fs \u521D\u59CB\u5316\u65F6\u7684\u5927\u5C0F\uFF0C\u53EF\u5224\u65AD\u6700\u5927\u53EF resize \u7A7A\u95F4"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Block size"}),"\n",(0,r.jsx)(e.li,{children:"Blocks per group"}),"\n",(0,r.jsx)(e.li,{children:"Inodes per group"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"file test\n\nmkfs.ext4 -F -b 4096 test\n"})}),"\n",(0,r.jsx)(e.h2,{id:"mke2fsconf",children:"mke2fs.conf"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"-T \u6307\u5B9A\u7C7B\u578B"}),"\n",(0,r.jsxs)(e.li,{children:["man ",(0,r.jsx)(e.a,{href:"https://man7.org/linux/man-pages/man5/mke2fs.conf.5.html",children:"mke2fs.conf.5"})]}),"\n"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"size"}),(0,r.jsx)(e.th,{children:"type"})]})}),(0,r.jsx)(e.tbody,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"<= 3mb"}),(0,r.jsx)(e.td,{children:"floppy"})]})})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-conf",metastring:'title="/etc/mke2fs.conf"',children:"[defaults]\n	base_features = sparse_super,large_file,filetype,resize_inode,dir_index,ext_attr\n	default_mntopts = acl,user_xattr\n	enable_periodic_fsck = 0\n	blocksize = 4096\n	inode_size = 256\n	inode_ratio = 16384\n\n[fs_types]\n	ext3 = {\n		features = has_journal\n	}\n	ext4 = {\n		features = has_journal,extent,huge_file,flex_bg,metadata_csum,64bit,dir_nlink,extra_isize\n		inode_size = 256\n	}\n	small = {\n		blocksize = 1024\n		inode_ratio = 4096\n	}\n	floppy = {\n		blocksize = 1024\n		inode_size = 128\n		inode_ratio = 8192\n	}\n	big = {\n		inode_ratio = 32768\n	}\n	huge = {\n		inode_ratio = 65536\n	}\n	news = {\n		inode_ratio = 4096\n	}\n	largefile = {\n		inode_ratio = 1048576\n		blocksize = -1\n	}\n	largefile4 = {\n		inode_ratio = 4194304\n		blocksize = -1\n	}\n	hurd = {\n    blocksize = 4096\n    inode_size = 128\n	}\n"})}),"\n",(0,r.jsx)(e.h1,{id:"faq",children:"FAQ"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["ordered - \u9ED8\u8BA4\u6A21\u5F0F\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5143\u6570\u636E\u5199\u5165\u65E5\u5FD7\uFF0C\u800C\u6570\u636E\u5728\u5199\u5165\u78C1\u76D8\u4E4B\u524D\u5148\u5199\u5165\u4E3B\u6587\u4EF6\u7CFB\u7EDF\u3002\u63D0\u4F9B\u4E86\u8F83\u597D\u7684\u6027\u80FD\u548C\u4E00\u81F4\u6027\u6298\u8877\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["journal\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6570\u636E\u548C\u5143\u6570\u636E\u90FD\u5199\u5165\u65E5\u5FD7"}),"\n",(0,r.jsx)(e.li,{children:"\u6700\u9AD8\u7684\u6570\u636E\u4E00\u81F4\u6027\uFF0C\u4F46\u6027\u80FD\u8F83\u4F4E\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["writeback\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4E0D\u4FDD\u8BC1\u6570\u636E\u5728\u5199\u5165\u78C1\u76D8\u524D\u5199\u5165\u65E5\u5FD7\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["journal_data_writeback\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5143\u6570\u636E\u5199\u65E5\u5FD7\uFF0C\u6570\u636E\u5199\u76D8"}),"\n",(0,r.jsxs)(e.li,{children:["\u4F18\u70B9\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6027\u80FD\u66F4\u597D\uFF0C\u7279\u522B\u662F\u5728\u5199\u5165\u5927\u91CF\u6570\u636E\u65F6\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u51CF\u5C11\u4E86\u5BF9 SSD \u7684\u5199\u5165\u6B21\u6570\uFF0C\u53EF\u80FD\u5EF6\u957F SSD \u5BFF\u547D\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u7F3A\u70B9\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5728\u7CFB\u7EDF\u5D29\u6E83\u7684\u60C5\u51B5\u4E0B\uFF0C\u6570\u636E\u4E00\u81F4\u6027\u4FDD\u8BC1\u8F83\u5F31\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u53EF\u80FD\u5BFC\u81F4\u6587\u4EF6\u6570\u636E\u4E22\u5931\u6216\u635F\u574F\uFF0C\u5C3D\u7BA1\u6587\u4EF6\u7CFB\u7EDF\u7ED3\u6784\u4ECD\u7136\u5B8C\u6574\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"resize-\u9700\u8981\u6CE8\u610F\u7684\u53C2\u6570",children:"resize \u9700\u8981\u6CE8\u610F\u7684\u53C2\u6570"}),"\n",(0,r.jsx)(e.p,{children:"mke2fs will attempt to reserve enough space so that the filesystem may grow to 1024 times its initial size. This can be changed using the resize extended option."}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679C\u521D\u59CB\u7A7A\u95F4\u662F 1G\uFF0C\u90A3\u4E48\u9ED8\u8BA4\u6700\u5927\u53EA\u80FD resize \u5230 1T\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"-i"}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"-E resize=max-online-resize"})}),"\n",(0,r.jsx)(e.li,{children:"-m reserved-blocks-percentage"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"new-size-results-in-too-many-block-group-descriptors",children:"New size results in too many block group descriptors"}),"\n",(0,r.jsx)(e.p,{children:"\u6CE8\u610F\uFF0C\u9ED8\u8BA4\u6700\u5927 resize 1024 \u500D\uFF0C\u5982\u679C\u521D\u59CB 1G \u5219\u6700\u5927 1T\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/tytso/e2fsprogs/issues/74#issuecomment-889894735",children:"tytso/e2fsprogs#74"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"e2fsck -f /dev/XXX\nresize2fs /dev/XXX\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6216"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"resize2fs -f /dev/sdb2\n"})}),"\n",(0,r.jsx)(e.h2,{id:"kernel-error",children:"kernel error"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"blk_update_request: critical target error, dev sda, sector 1875240 op 0x1:(WRITE) flags 0x800 phys_seg 2 prio class 0\nAborting journal on device sda2-8.\n\nblk_update_request: critical target error, dev sda, sector 1837056 op 0x1:(WRITE) flags 0x800 phys_seg 1 prio class 0\nBuffer I/O error on dev sda2, logical block 196608, lost sync page write\nJBD2: Error -5 detected when updating journal superblock for sda2-8.\n\nEXT4-fs (sda2): I/O error while writing superblock\nEXT4-fs error (device sda2): ext4_journal_check_start:83: Detected aborted journal\nEXT4-fs (sda2): Remounting filesystem read-only\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5C1D\u8BD5\u4FEE\u590D"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"fsck\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Journal checksum error found in /dev/sda2\nfsck.ext4: unable to set superblock flags on /dev/sda2\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5E94\u8BE5\u662F SD \u5361\u5F02\u5E38\u4E86\uFF0C\u5C1D\u8BD5\u66F4\u6362\u786C\u4EF6\u8BBE\u5907\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"online-shrink",children:"online shrink"}),"\n",(0,r.jsx)(e.p,{children:"\u6700\u96BE\u7684\u662F\u5C06 root remount \u4E3A ro"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u79BB\u7EBF\u65B9\u5F0F"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"AlpineLinux \u901A\u8FC7\u914D\u7F6E\u542F\u52A8\u53C2\u6570 rootflags=ro \u91CD\u542F\u6302\u8F7D\u4E3A\u53EA\u8BFB"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"tune2fs -O read-only /dev/sda1"})," \u8BBE\u7F6E\u540E\u91CD\u542F\uFF0C\u4F1A\u88AB\u6302\u8F7D\u4E3A ro"]}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:"\u5728\u7EBF"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"pivot root"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"e2image-seek_relative-invalid-argument",children:"e2image seek_relative: Invalid argument"}),"\n",(0,r.jsx)(e.p,{children:"\u76EE\u6807\u8BBE\u5907\u7A7A\u95F4\u4E0D\u591F"}),"\n",(0,r.jsx)(e.h2,{id:"dd-compress",children:"dd compress"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-basj",children:"dd bs=1M iflag=fullblock if=/dev/sda2 status=progress | gzip >img.gz\ngzcat img.gz | dd bs=1M iflag=fullblock of=/dev/sda2 status=progress\n\ndd bs=1M iflag=fullblock if=/dev/sda2 status=progress | zstd -16v >img.zst\nzstdcat img.zst | dd bs=1M iflag=fullblock of=/dev/sda2 status=progress\n\npv /dev/sda2 | zstd -16 >img.zst\nzstdzcat img.zst | pv >/dev/sda2\n\nzstd -16v </dev/sda2 >sda2.zst\nzstdcat -v sda2.zst >/dev/sda2\n"})}),"\n",(0,r.jsx)(e.h2,{id:"mounted-filesystem-with-ordered-data-mode-quota-mode-none",children:"mounted filesystem with ordered data mode. Quota mode: none."}),"\n",(0,r.jsx)(e.p,{children:"\u4E0D\u7BA1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u624B\u52A8\u542F\u52A8 Quota\nsudo tune2fs -o usrquota /dev/sda1\n"})}),"\n",(0,r.jsx)(e.h2,{id:"ssd",children:"ssd"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"mkfs.ext4 -E discard /dev/nvme0n1 # \u542F\u7528 TRIM\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u4F18\u5316",children:"\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["atime -> relatime -> noatime\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u907F\u514D\u9891\u7E41\u66F4\u65B0 atime"}),"\n",(0,r.jsx)(e.li,{children:"relatime \u53EA\u6709\u5728\u4FEE\u6539\u65F6\u95F4\u6216\u66F4\u65B0\u65F6\u95F4\u53D8\u5316\u65F6\u66F4\u65B0 atime, \u6216\u8005\u73B0\u5728\u7684 atime \u6709 24h \u672A\u66F4\u65B0"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["commit=5 -> commit=60\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6BCF 60s \u5199\u5165\u4E00\u6B21"}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},917776:function(n,e,s){s.d(e,{R:()=>d,x:()=>t});var i=s(7378);let r={},l=i.createContext(r);function d(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);