"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["76280"],{95337:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>t,toc:()=>d,default:()=>h,metadata:()=>l,assets:()=>o,contentTitle:()=>c});var l=JSON.parse('{"id":"service/workflow/dbos","title":"DBOS","description":"- DBOS","source":"@site/../notes/service/workflow/dbos.md","sourceDirName":"service/workflow","slug":"/service/workflow/dbos","permalink":"/notes/service/workflow/dbos","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/workflow/dbos.md","tags":[{"inline":true,"label":"Scheduler","permalink":"/notes/tags/scheduler"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1739157197000,"frontMatter":{"tags":["Scheduler"]},"sidebar":"docs","previous":{"title":"conductor","permalink":"/notes/service/workflow/conductor"},"next":{"title":"DMN","permalink":"/notes/service/workflow/dmn"}}'),i=s(86106),r=s(17776);let t={tags:["Scheduler"]},c="DBOS",o={},d=[{value:"ts",id:"ts",level:2}];function a(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"dbos",children:"DBOS"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["DBOS\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5B58\u50A8\u4F7F\u7528 Postgres\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u8868\u7ED3\u6784 ",(0,i.jsx)(e.a,{href:"https://docs.dbos.dev/explanations/system-tables",children:"https://docs.dbos.dev/explanations/system-tables"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/dbos-inc/dbos-transact-ts",children:"dbos-inc/dbos-transact-ts"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MIT, TypeScript"}),"\n",(0,i.jsx)(e.li,{children:"Ultra-Lightweight Durable Execution in TypeScript"}),"\n",(0,i.jsx)(e.li,{children:"npm:@dbos-inc/dbos-sdk"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://github.com/dbos-inc/dbos-transact-py",children:"dbos-inc/dbos-transact-py"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MIT, Python"}),"\n",(0,i.jsx)(e.li,{children:"Ultra-Lightweight Durable Execution in Python"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/dbos-inc/awesome-dbos",children:"dbos-inc/awesome-dbos"})}),"\n",(0,i.jsxs)(e.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"https://supabase.com/blog/durable-workflows-in-postgres-dbos",children:"https://supabase.com/blog/durable-workflows-in-postgres-dbos"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://news.ycombinator.com/item?id=42379974",children:"https://news.ycombinator.com/item?id=42379974"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"ts",children:"ts"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://github.com/dbos-inc/dbos-transact-ts/blob/main/src/dbos.ts",children:"https://github.com/dbos-inc/dbos-transact-ts/blob/main/src/dbos.ts"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"class Example {\n  @DBOS.step()\n  static async step_one() {}\n\n  @DBOS.step()\n  static async step_two() {}\n\n  @DBOS.workflow()\n  static async workflow() {\n    await Example.step_one();\n    await Example.step_two();\n  }\n}\n\nimport { DBOS } from '@dbos-inc/dbos-sdk';\n\nfunction runServer() {\n  DBOS.launch();\n}\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["DBOS.workflow\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"deterministic"})}),"\n",(0,i.jsxs)(e.li,{children:["DBOS.step\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"at least once"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["DBOS.transaction\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"exactly once"}),"\n",(0,i.jsx)(e.li,{children:"DBOS.drizzleClient"}),"\n",(0,i.jsx)(e.li,{children:"DBOS.knexClient"}),"\n",(0,i.jsx)(e.li,{children:"DBOS.typeORMClient"}),"\n",(0,i.jsx)(e.li,{children:"DBOS.prismaClient"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["DBOS.scheduled\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6CE8\u518C\u65B9\u6CD5 crontab"}),"\n",(0,i.jsx)(e.li,{children:"\u662F\u672C\u5730\u8C03\u5EA6\u542F\u52A8\u7684"}),"\n",(0,i.jsxs)(e.li,{children:["\u901A\u8FC7 WorkflowID \u53BB\u91CD const workflowUUID = ",(0,i.jsx)(e.code,{children:"sched-${this.scheduledMethodName}-${nextExecTime.toISOString()}"}),";`"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"DBOS.workflowID - UUID"}),"\n",(0,i.jsxs)(e.li,{children:["DBOS.startWorkflow\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5F00\u542F\u4E00\u4E2A\u65B0\u7684\u5DE5\u4F5C\u6D41"}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:'DBOS.startWorkflow(Example).hello("Wener")'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"DBOS.retrieve_workflow"}),"\n",(0,i.jsxs)(e.li,{children:["DBOS.setEvent\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BBE\u7F6E KV"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"DBOS.getEvent - \u83B7\u53D6 KV by workflowID"}),"\n",(0,i.jsxs)(e.li,{children:["HTTP\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"@DBOS.postApi"}),"\n",(0,i.jsx)(e.li,{children:"@DBOS.getApi"}),"\n",(0,i.jsx)(e.li,{children:"@DBOS.putApi"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"DBOS.send(destinationID,message,topic)"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"DBOS.recv(topic,timeoutSeconds)"})}),"\n",(0,i.jsx)(e.li,{children:"DBOS.withNextWorkflowID"}),"\n",(0,i.jsxs)(e.li,{children:["WorkflowQueue\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u63A7\u5236\u5E76\u884C"}),"\n",(0,i.jsx)(e.li,{children:"Rate Limit"}),"\n",(0,i.jsx)(e.li,{children:"In-Order Processing"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"DBOS.logger"})}),"\n",(0,i.jsxs)(e.li,{children:["Auth\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"DBOS.defaultRequiredRole"}),"\n",(0,i.jsx)(e.li,{children:"DBOS.requiredRole"}),"\n",(0,i.jsx)(e.li,{children:"@Authentication - \u63D0\u4F9B Auth \u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["@StoredProcedure - \u5B58\u50A8\u8FC7\u7A0B\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B2C\u4E00\u4E2A\u53C2\u6570 ctxt: StoredProcedureContext"}),"\n",(0,i.jsx)(e.li,{children:"@dbos-inc/dbos-compiler"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5B9E\u4F8B\u5316\u7684 Class\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"DBOS.configureInstance(MyClass, 'myname', args)"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"extends ConfiguredInstance"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Testing\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"await DBOS.setUpHandlerCallback()"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["Admin API\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"GET /dbos-healthz"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"GET /dbos-perf"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"POST /dbos-workflow-recovery"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"export interface StepConfig {\n  retriesAllowed?: boolean; // \u662F\u5426\u5141\u8BB8\u91CD\u8BD5\u5931\u8D25\uFF1F\uFF08\u9ED8\u8BA4 false\uFF09\n  intervalSeconds?: number; // \u7B2C\u4E00\u6B21\u91CD\u8BD5\u524D\u7B49\u5F85\u7684\u79D2\u6570\uFF08\u9ED8\u8BA4 1\uFF09\u3002\n  maxAttempts?: number; // \u6700\u5927\u91CD\u8BD5\u6B21\u6570\uFF08\u9ED8\u8BA4 3\uFF09\u3002\u5982\u679C\u9519\u8BEF\u53D1\u751F\u6B21\u6570\u8D85\u8FC7\u6B64\u503C\uFF0C\u5219\u629B\u51FA\u5F02\u5E38\u3002\n  backoffRate?: number; // \u91CD\u8BD5\u95F4\u9694\u589E\u52A0\u7684\u500D\u6570\uFF08\u9ED8\u8BA4 2\uFF09\u3002\n}\n\n// \u63D0\u4F9B workflowID\nawait DBOS.withNextWorkflowID('very-unique-id', async () => {\n  return await Example.exampleWorkflow('one', 'two');\n});\n\nclass ScheduledExample {\n  // \u5B9A\u65F6\u4EFB\u52A1\n  // mode: SchedulerMode.ExactlyOncePerInterval \u4E00\u4E2A\u5468\u671F\u5185\u53EA\u6267\u884C\u4E00\u6B21\n  @DBOS.scheduled({ crontab: '*/30 * * * * *' })\n  @DBOS.workflow()\n  static async scheduledFunc(schedTime: Date, startTime: Date) {\n    DBOS.logger.info(`I am a workflow scheduled to run every 30 seconds`);\n  }\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",metastring:'title="dbos-config.yaml"',children:"# To enable auto-completion and validation for this file in VSCode, install the RedHat YAML extension\n# https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml\n\n# yaml-language-server: $schema=https://raw.githubusercontent.com/dbos-inc/dbos-transact/main/dbos-config.schema.json\n\nlanguage: node\ndatabase:\n  hostname: localhost\n  port: 5432\n  username: postgres\n  password: ${PGPASSWORD}\n  connectionTimeoutMillis: 3000\n  # drizzle, knex, prisma, typeorm\n  app_db_client: knex\n  local_suffix: false\n  migrate:\n    - npx knex migrate:latest\n  rollback:\n    - npx knex migrate:rollback\nruntimeConfig:\n  start:\n    - node dist/main.js\n"})})]})}function h(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},17776:function(n,e,s){s.d(e,{R:()=>t,x:()=>c});var l=s(7378);let i={},r=l.createContext(i);function t(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);