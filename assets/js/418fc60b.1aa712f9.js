"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["389354"],{396864:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,toc:()=>c,default:()=>h,metadata:()=>o,assets:()=>r,contentTitle:()=>i});var o=JSON.parse('{"id":"service/storage/nextcloud/nextcloud-faq","title":"Nextcloud FAQ","description":"su as","source":"@site/../notes/service/storage/nextcloud/nextcloud-faq.md","sourceDirName":"service/storage/nextcloud","slug":"/service/storage/nextcloud/faq","permalink":"/notes/service/storage/nextcloud/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/service/storage/nextcloud/nextcloud-faq.md","tags":[{"inline":true,"label":"FAQ","permalink":"/notes/tags/faq"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1752420691000,"frontMatter":{"title":"Nextcloud FAQ","tags":["FAQ"]},"sidebar":"docs","previous":{"title":"Nextcloud \u5F00\u53D1","permalink":"/notes/service/storage/nextcloud/dev"},"next":{"title":"occ","permalink":"/notes/service/storage/nextcloud/occ"}}'),l=t(486106),s=t(917776);let a={title:"Nextcloud FAQ",tags:["FAQ"]},i="Nextcloud FAQ",r={},c=[{value:"su as",id:"su-as",level:2},{value:"cron",id:"cron",level:2},{value:"\u79FB\u9664\u83B7\u53D6\u514D\u8D39\u8D26\u53F7\u7684 Footer",id:"\u79FB\u9664\u83B7\u53D6\u514D\u8D39\u8D26\u53F7\u7684-footer",level:2},{value:"\u6CE8\u610F proxy \u914D\u7F6E",id:"\u6CE8\u610F-proxy-\u914D\u7F6E",level:2},{value:"nextcloud put 413",id:"nextcloud-put-413",level:2},{value:"Auto provisioning not allowed and user hello does not exist",id:"auto-provisioning-not-allowed-and-user-hello-does-not-exist",level:2},{value:"Found an Attribute element with duplicated Name",id:"found-an-attribute-element-with-duplicated-name",level:2},{value:"Command &quot;maintenance&quot; is not defined.",id:"command-maintenance-is-not-defined",level:2},{value:"cURL error 28: Operation timed out after XXXXXX milliseconds",id:"curl-error-28-operation-timed-out-after-xxxxxx-milliseconds",level:2},{value:"Error when trying to connect (Host violates local access rules)",id:"error-when-trying-to-connect-host-violates-local-access-rules",level:2},{value:"fpm caddy",id:"fpm-caddy",level:2},{value:"Collabora Online should expose the same protocol as the server installation. Please check the ssl.enable and ssl.termination settings of your Collabora Online server.",id:"collabora-online-should-expose-the-same-protocol-as-the-server-installation-please-check-the-sslenable-and-ssltermination-settings-of-your-collabora-online-server",level:2},{value:"loading document exception: No acceptable WOPI hosts found matching the target host",id:"loading-document-exception-no-acceptable-wopi-hosts-found-matching-the-target-host",level:2},{value:"Refused to send form data to &#39;https://nextcloud&#39; because it violates the following Content Security Policy directive: &quot;form-action &#39;self&#39; https://collabora&quot;",id:"refused-to-send-form-data-to-httpsnextcloud-because-it-violates-the-following-content-security-policy-directive-form-action-self-httpscollabora",level:2},{value:"AH00558: apache2: Could not reliably determine the server&#39;s fully qualified domain name",id:"ah00558-apache2-could-not-reliably-determine-the-servers-fully-qualified-domain-name",level:2},{value:"Upgrade",id:"upgrade",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"nextcloud-faq",children:"Nextcloud FAQ"})}),"\n",(0,l.jsx)(n.h2,{id:"su-as",children:"su as"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6709\u4E9B\u65F6\u5019\u65E0\u6CD5 ",(0,l.jsx)(n.code,{children:"docker exec -u www-data -it nextcloud bash"})]}),"\n",(0,l.jsx)(n.li,{children:"kubectl \u4E0D\u652F\u6301 -u"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"su -l www-data -s /bin/bash\ncd /var/www/html\nexport PHP_MEMORY_LIMIT=8G\n./occ\n\ntail -f /var/www/html/data/nextcloud.log\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"occ files:scan --all\nocc maintenance:repair --include-expensive\nocc db:add-missing-indices\n"})}),"\n",(0,l.jsx)(n.h2,{id:"cron",children:"cron"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"/nextcloud/cron.php"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"crontab -u www-data -l\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-txt",children:"*/5  *  *  *  * php -f /var/www/nextcloud/cron.php\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u79FB\u9664\u83B7\u53D6\u514D\u8D39\u8D26\u53F7\u7684-footer",children:"\u79FB\u9664\u83B7\u53D6\u514D\u8D39\u8D26\u53F7\u7684 Footer"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"su -l www-data -s /bin/bash\ncd /var/www/html\n./occ config:system:set simpleSignUpLink.shown --value=false --type=boolean\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6CE8\u610F-proxy-\u914D\u7F6E",children:"\u6CE8\u610F proxy \u914D\u7F6E"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5982\u679C\u51FA\u73B0 office \u6253\u4E0D\u5F00\uFF0C\u4E5F\u53EF\u80FD\u662F\u5F00\u4E86 proxy \u5BFC\u81F4\u65E0\u6CD5\u8FDE\u63A5"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"nextcloud-put-413",children:"nextcloud put 413"}),"\n",(0,l.jsx)(n.p,{children:"\u53D1\u751F\u672A\u77E5\u9519\u8BEF"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8C03\u6574 nginx\u3001haproxy \u6700\u5927 body \u5927\u5C0F"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"auto-provisioning-not-allowed-and-user-hello-does-not-exist",children:"Auto provisioning not allowed and user hello does not exist"}),"\n",(0,l.jsx)(n.h2,{id:"found-an-attribute-element-with-duplicated-name",children:"Found an Attribute element with duplicated Name"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Keycloak"}),"\n",(0,l.jsx)(n.li,{children:"(Realm) -> Client Scopes -> role_list (saml) -> Mappers tab -> role list -> 'Single Role Attribute'."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"command-maintenance-is-not-defined",children:'Command "maintenance:install" is not defined.'}),"\n",(0,l.jsxs)(n.p,{children:["\u5E94\u7528\u88AB\u91CD\u65B0\u5B89\u88C5\u4E86\uFF0C\u56E0\u4E3A\u6CA1\u6709\u68C0\u6D4B\u5230 ",(0,l.jsx)(n.code,{children:"/var/www/html/version.php"}),"\uFF0C\u9700\u8981\u6CE8\u610F\u6302\u8F7D\u8DEF\u5F84"]}),"\n",(0,l.jsx)(n.h2,{id:"curl-error-28-operation-timed-out-after-xxxxxx-milliseconds",children:"cURL error 28: Operation timed out after XXXXXX milliseconds"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/nextcloud/server/issues/18103",children:"#18103"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"error-when-trying-to-connect-host-violates-local-access-rules",children:"Error when trying to connect (Host violates local access rules)"}),"\n",(0,l.jsx)(n.p,{children:"\u914D\u7F6E"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"'allow_local_remote_servers'=>true,\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo -u www-data ./occ config:system:set allow_local_remote_servers --value=true --type=boolean\n"})}),"\n",(0,l.jsx)(n.h2,{id:"fpm-caddy",children:"fpm caddy"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"https:// {\n\n      reverse_proxy /loleaflet collabora:9980\n      reverse_proxy /hosting/discovery collabora:9980\n      reverse_proxy /lool collabora:9980\n      reverse_proxy /cool/* collabora:9980\n      reverse_proxy /hosting/capabilities collabora:9980\n      reverse_proxy /browser collabora:9980\n\n\n        header {\nStrict-Transport-Security max-age=31536000;\n        }\n\n	tls internal {\n		on_demand\n	}\n\n        #redir /.well-known/carddav /remote.php/dav 301\n        #redir /.well-known/caldav /remote.php/dav 301\n\n        # .htaccess / data / config / ... shouldn't be accessible from outside\n        @forbidden {\n                path    /.htaccess\n                path    /data/*\n                path    /config/*\n                path    /db_structure\n                path    /.xml\n                path    /README\n                path    /3rdparty/*\n                path    /lib/*\n                path    /templates/*\n                path    /occ\n                path    /console.php\n        }\n\n        respond @forbidden 404\n\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"collabora-online-should-expose-the-same-protocol-as-the-server-installation-please-check-the-sslenable-and-ssltermination-settings-of-your-collabora-online-server",children:"Collabora Online should expose the same protocol as the server installation. Please check the ssl.enable and ssl.termination settings of your Collabora Online server."}),"\n",(0,l.jsx)(n.h2,{id:"loading-document-exception-no-acceptable-wopi-hosts-found-matching-the-target-host",children:"loading document exception: No acceptable WOPI hosts found matching the target host"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -e 'domain=nextcloud.wener.me'\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6CE8\u610F\u914D\u7F6E domain"}),"\n"]}),"\n",(0,l.jsxs)(n.h2,{id:"refused-to-send-form-data-to-httpsnextcloud-because-it-violates-the-following-content-security-policy-directive-form-action-self-httpscollabora",children:["Refused to send form data to '",(0,l.jsx)(n.a,{href:"https://nextcloud",children:"https://nextcloud"}),"' because it violates the following Content Security Policy directive: \"form-action 'self' ",(0,l.jsx)(n.a,{href:"https://collabora",children:"https://collabora"}),'"']}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"CSP"}),"\n",(0,l.jsx)(n.li,{children:"form-action 'self'"}),"\n",(0,l.jsxs)(n.li,{children:["\u5982\u679C\u662F http \u548C https \u95EE\u9898\u53EF\u4EE5\u914D\u7F6E ",(0,l.jsx)(n.code,{children:"'overwriteprotocol' => 'https'"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"./occ config:system:set overwriteprotocol --value=https\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ah00558-apache2-could-not-reliably-determine-the-servers-fully-qualified-domain-name",children:"AH00558: apache2: Could not reliably determine the server's fully qualified domain name"}),"\n",(0,l.jsx)(n.p,{children:"Apache \u9519\u8BEF\u4FE1\u606F\uFF0C\u4E0D\u5F71\u54CD"}),"\n",(0,l.jsx)(n.h2,{id:"upgrade",children:"Upgrade"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u6CE8\u610F Disabled incompatible app, \u5982\u679C\u5173\u4E86\u7F51\u7EDC\u4F1A\u76F4\u63A5\u88AB\u7981\u7528"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"./occ maintenance:repair --include-expensive\n./occ db:add-missing-indices\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker exec -it -u www-data nextcloud bash -c './occ maintenance:repair --include-expensive; ./occ db:add-missing-indices'\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Initializing finished\nWarning: /var/www/html/config/redis.config.php differs from the latest version of this image at /usr/src/nextcloud/config/redis.config.php\nWarning: /var/www/html/config/reverse-proxy.config.php differs from the latest version of this image at /usr/src/nextcloud/config/reverse-proxy.config.php\nWarning: /var/www/html/config/s3.config.php differs from the latest version of this image at /usr/src/nextcloud/config/s3.config.php\nWarning: /var/www/html/config/smtp.config.php differs from the latest version of this image at /usr/src/nextcloud/config/smtp.config.php\nWarning: /var/www/html/config/upgrade-disable-web.config.php differs from the latest version of this image at /usr/src/nextcloud/config/upgrade-disable-web.config.php\n"})})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},917776:function(e,n,t){t.d(n,{R:()=>a,x:()=>i});var o=t(7378);let l={},s=o.createContext(l);function a(e){let n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);