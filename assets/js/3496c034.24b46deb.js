"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["459696"],{76962:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>h,metadata:()=>r,assets:()=>a,contentTitle:()=>o});var r=JSON.parse('{"id":"db/relational/postgresql/postgresql-tuning","title":"PostgreSQL Tuning","description":"Tools & Resources","source":"@site/../notes/db/relational/postgresql/postgresql-tuning.md","sourceDirName":"db/relational/postgresql","slug":"/db/relational/postgresql/tuning","permalink":"/notes/db/relational/postgresql/tuning","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/db/relational/postgresql/postgresql-tuning.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"PostgreSQL Tuning"},"sidebar":"docs","previous":{"title":"Trigger","permalink":"/notes/db/relational/postgresql/trigger"},"next":{"title":"PostgreSQL Upgrade","permalink":"/notes/db/relational/postgresql/upgrade"}}'),s=i(486106),t=i(917776);let l={title:"PostgreSQL Tuning"},o="PostgreSQL Tuning",a={},d=[{value:"Tools &amp; Resources",id:"tools--resources",level:2},{value:"IO Benchmarking (fio)",id:"io-benchmarking-fio",level:2},{value:"Optimization Techniques",id:"optimization-techniques",level:2},{value:"UNLOGGED Tables",id:"unlogged-tables",level:3},{value:"WAL Configuration",id:"wal-configuration",level:3},{value:"Memory (<code>work_mem</code>)",id:"memory-work_mem",level:3},{value:"HyperLogLog (HLL)",id:"hyperloglog-hll",level:3}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"postgresql-tuning",children:"PostgreSQL Tuning"})}),"\n",(0,s.jsx)(n.h2,{id:"tools--resources",children:"Tools & Resources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://tatiyants.com/pev",children:"Explain Analysis Visualization (PEV)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://explain.depesz.com/",children:"Explain Depesz"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://pgtune.leopard.in.ua/",children:"PGTune"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/PacktPublishing/PostgreSQL-High-Performance-Cookbook",children:"PostgreSQL High Performance Cookbook"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.justwatch.com/blog/post/debugging-postgresql-performance-the-hard-way/",children:"Debugging Performance the Hard Way"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"io-benchmarking-fio",children:"IO Benchmarking (fio)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Sequential mixed read/write (50/50)\nfio --ioengine=libaio --direct=1 --name=test_seq --filename=test_file --bs=8k --iodepth=32 --size=1G --readwrite=rw --rwmixread=50\n\n# Random mixed read/write (50/50)\nfio --ioengine=libaio --direct=1 --name=test_rand --filename=test_file --bs=8k --iodepth=32 --size=1G --readwrite=randrw --rwmixread=50\n"})}),"\n",(0,s.jsx)(n.h2,{id:"optimization-techniques",children:"Optimization Techniques"}),"\n",(0,s.jsx)(n.h3,{id:"unlogged-tables",children:"UNLOGGED Tables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Effect"}),": No WAL logging, data lost on crash/unclean shutdown. Not replicated."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use Case"}),": Bulk loading, temporary data, reproducible data."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Command"}),": ",(0,s.jsx)(n.code,{children:"CREATE UNLOGGED TABLE ..."})," or ",(0,s.jsx)(n.code,{children:"ALTER TABLE ... SET UNLOGGED"})," (locks table)."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"wal-configuration",children:"WAL Configuration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"synchronous_commit"})}),":\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on"})," (default): Safe, wait for flush."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"off"}),": Async commit. Loss of recent transactions (default 3x ",(0,s.jsx)(n.code,{children:"wal_writer_delay"}),") possible on crash. Integrity maintained. Good for analytics/bulk loading."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"local"}),", ",(0,s.jsx)(n.code,{children:"remote_write"}),", ",(0,s.jsx)(n.code,{children:"remote_apply"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"memory-work_mem",children:["Memory (",(0,s.jsx)(n.code,{children:"work_mem"}),")"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Default 4MB is per-operation (sort/hash)."}),"\n",(0,s.jsxs)(n.li,{children:["Monitor ",(0,s.jsx)(n.code,{children:"log_temp_files"})," to see spills to disk."]}),"\n",(0,s.jsxs)(n.li,{children:["Increase for complex analytical queries, but watch out for ",(0,s.jsx)(n.code,{children:"max_connections * work_mem * operations"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"hyperloglog-hll",children:"HyperLogLog (HLL)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Efficient distinct counting for rollups."}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/citusdata/postgresql-hll",children:"citusdata/postgresql-hll"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},917776:function(e,n,i){i.d(n,{R:()=>l,x:()=>o});var r=i(7378);let s={},t=r.createContext(s);function l(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);