"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["23019"],{70246:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>a,default:()=>u,metadata:()=>i,assets:()=>o,contentTitle:()=>c});var i=JSON.parse('{"id":"devops/service/consul-conf","title":"Consul \u914D\u7F6E","description":"- Configuration","source":"@site/../notes/devops/service/consul-conf.md","sourceDirName":"devops/service","slug":"/devops/service/consul-conf","permalink":"/notes/devops/service/consul-conf","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/service/consul-conf.md","tags":[{"inline":true,"label":"Configuration","permalink":"/notes/tags/configuration"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1646989992000,"frontMatter":{"title":"Consul \u914D\u7F6E","tags":["Configuration"]},"sidebar":"docs","previous":{"title":"Ambassador","permalink":"/notes/devops/service/ambassador"},"next":{"title":"Consule Connect Mesh","permalink":"/notes/devops/service/consul-connect"}}'),r=s(86106),t=s(17776);let l={title:"Consul \u914D\u7F6E",tags:["Configuration"]},c="Consul \u914D\u7F6E",o={},a=[{value:"acl",id:"acl",level:2},{value:"\u914D\u7F6E\u8BB0\u5F55",id:"\u914D\u7F6E\u8BB0\u5F55",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"consul-\u914D\u7F6E",children:"Consul \u914D\u7F6E"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.consul.io/docs/agent/options",children:"Configuration"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5355\u673A\u914D\u7F6E"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data_dir": "/var/consul",\n  "server": true,\n  "bootstrap_expect": 1,\n  "disable_update_check": true,\n  "disable_remote_exec": true,\n  "enable_syslog": true\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"acl",children:"acl"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.hashicorp.com/tutorials/consul/access-control-setup-production",children:"https://learn.hashicorp.com/tutorials/consul/access-control-setup-production"})}),"\n",(0,r.jsxs)(n.li,{children:["Token \u7C7B\u578B\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["master - \u4E3B\u4EE4\u724C\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7B49\u540C\u4E8E acl bootstrap \u7684\u4EE4\u724C - \u5EFA\u8BAE\u8BBE\u7F6E - \u8BBE\u7F6E\u540E\u4E0D\u518D\u9700\u8981 acl bootstrap"}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u4E8E\u4E3B dc \u7684 server \u4E4B\u95F4"}),"\n",(0,r.jsx)(n.li,{children:"\u4F7F\u7528 UUID"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["default - \u9ED8\u8BA4 - \u5982\u679C\u6CA1\u6709\u5177\u4F53\u7684 token\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u4E8E\u5411\u670D\u52A1\u7AEF\u53D1\u8D77\u8BF7\u6C42"}),"\n",(0,r.jsx)(n.li,{children:"\u6CA1\u6709\u5219\u7B49\u540C\u4E8E anonymous"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["agent\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u4E8E\u5BA2\u6237\u7AEF\u6216\u670D\u52A1\u6267\u884C\u5185\u90E8\u64CD\u4F5C"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679C\u6CA1\u6709\u5219\u4F7F\u7528 default"}),"\n",(0,r.jsx)(n.li,{children:"\u81F3\u5C11\u9700\u8981\u6743\u9650\u80FD\u8BBE\u7F6E\u8282\u70B9\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["agent_master\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8BBF\u95EE agent \u7EC8\u7AEF\uFF0C\u8BFB\u5199 agent \u6743\u9650"}),"\n",(0,r.jsx)(n.li,{children:"\u670D\u52A1\u4E2D\u65AD\u65F6\u53EF\u7528\u4E8E operator"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["replication\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u4E8E\u6388\u6743\u4E8C\u7EA7 dc \u8BBF\u95EE\u4E3B dc \u8FDB\u884C\u590D\u5236\u64CD\u4F5C"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u914D\u7F6E\u8BB0\u5F55",children:"\u914D\u7F6E\u8BB0\u5F55"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5982\u679C\u5B58\u5728\u5BF9\u4E8E\u7684\u670D\u52A1\u5219\u4F1A\u8FDB\u884C\u5408\u5E76\u914D\u7F6E"}),"\n",(0,r.jsxs)(n.li,{children:["\u7C7B\u578B\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ingress-gateway"}),"\n",(0,r.jsx)(n.li,{children:"proxy-defaults - \u9ED8\u8BA4\u4EE3\u7406\u914D\u7F6E"}),"\n",(0,r.jsxs)(n.li,{children:["service-defaults\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Protocol"}),"\n",(0,r.jsxs)(n.li,{children:["MeshGateway\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mode: none, local, remote"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"ExternalSNI"}),"\n",(0,r.jsxs)(n.li,{children:["Expose\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Checks = true"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"service-resolver - matches service instances with a specific Connect upstream discovery requests"}),"\n",(0,r.jsx)(n.li,{children:"service-router - defines where to send layer 7 traffic based on the HTTP route"}),"\n",(0,r.jsx)(n.li,{children:"service-splitter - defines how to divide requests for a single HTTP route based on percentages"}),"\n",(0,r.jsx)(n.li,{children:"terminating-gateway - \u4E0E terminating gateway \u5173\u8054\u7684\u670D\u52A1"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat <<HCL | consul config write -\nKind      = "service-defaults"\nName      = "web-test"\nProtocol  = "http"\nHCL\n\nconsul config list -kind service-defaults\nconsul config read -kind service-defaults -name web-test\n\ncat <<HCL | consul config write -\nKind      = "service-defaults"\nName      = "static-server"\nProtocol  = "http"\nHCL\ncat <<HCL | consul config write -\nKind = "service-router"\nName = "web-test"\nRoutes = [\n  {\n    Match {\n      HTTP {\n        PathPrefix = "/to/static-server"\n      }\n    }\n\n    Destination {\n      Service = "static-server"\n    }\n  },\n]\nHCL\n'})})]})}function u(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},17776:function(e,n,s){s.d(n,{R:()=>l,x:()=>c});var i=s(7378);let r={},t=i.createContext(r);function l(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);