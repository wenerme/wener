"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["90373"],{54120:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>h,metadata:()=>t,assets:()=>o,contentTitle:()=>i});var t=JSON.parse('{"id":"os/linux/shell/doas","title":"doas","description":"- doas","source":"@site/../notes/os/linux/shell/doas.md","sourceDirName":"os/linux/shell","slug":"/os/linux/shell/doas","permalink":"/notes/os/linux/shell/doas","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/shell/doas.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1668620824000,"frontMatter":{"title":"doas"},"sidebar":"docs","previous":{"title":"dd","permalink":"/notes/os/linux/shell/dd"},"next":{"title":"expect","permalink":"/notes/os/linux/shell/expect"}}'),r=s(86106),d=s(17776);let l={title:"doas"},i="doas",o={},c=[{value:"doas.conf",id:"doasconf",level:2}];function a(e){let n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"doas",children:"doas"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/openbsd/src/tree/master/usr.bin/doas",children:"doas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"95% of the features of sudo with a fraction of the codebase"}),"\n",(0,r.jsx)(n.li,{children:"\u7EA6 1000 loc - sudo \u7EA6 18k loc"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"/etc/doas.conf"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://man.openbsd.org/doas",children:"doas.1"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://man.openbsd.org/doas.conf.5",children:"doas.conf.5"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# run as wener\ndoas -u wener whoami\n# -s shell -> sudo su\ndoas -s\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"option"}),(0,r.jsx)(n.th,{children:"mean"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["-a ",(0,r.jsx)(n.em,{children:"style"})]}),(0,r.jsx)(n.td,{children:"auth style in /etc/login.conf"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["-C ",(0,r.jsx)(n.em,{children:"config"})]}),(0,r.jsx)(n.td,{children:"check dose.conf"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-L"}),(0,r.jsx)(n.td,{children:"clear persisted auth"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-n"}),(0,r.jsx)(n.td,{children:"non interactive mode - \u8981\u6C42 nopass"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"-s"}),(0,r.jsx)(n.td,{children:"exec $SHELL or shell in /etc/passwd"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["-u ",(0,r.jsx)(n.em,{children:"user"})]}),(0,r.jsxs)(n.td,{children:["as ",(0,r.jsx)(n.em,{children:"user"})," - \u9ED8\u8BA4 root"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"doasconf",children:"doas.conf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pre",metastring:'title="\u914D\u7F6E\u8BED\u6CD5"',children:"permit|deny [options] identity [as target] [cmd command [args ...]]\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"permit|deny"}),"\n",(0,r.jsxs)(n.li,{children:["options\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"nopass - \u4E0D\u9700\u8981\u8F93\u5165\u5BC6\u7801"}),"\n",(0,r.jsx)(n.li,{children:"nolog - \u4E0D\u8BB0\u5F55\u6210\u529F\u6267\u884C\u7684\u547D\u4EE4\u5230 syslogd"}),"\n",(0,r.jsx)(n.li,{children:"persist - \u8BB0\u5F55\u5BC6\u7801\u6388\u6743\u4E00\u6BB5\u65F6\u95F4 - \u7C7B\u4F3C macOS \u4F53\u9A8C"}),"\n",(0,r.jsxs)(n.li,{children:["keepenv - \u4FDD\u7559\u73AF\u5883\u53D8\u91CF\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9ED8\u8BA4\u73AF\u5883\u53D8\u91CF HOME, LOGNAME, PATH, SHELL, USER, DOAS_USER, DISPLAY TERM"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"setenv { [variable ...] [variable=value ...] }"})," - \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u524D\u7F00 ",(0,r.jsx)(n.code,{children:"-"})," \u53EF\u79FB\u9664"]}),"\n",(0,r.jsxs)(n.li,{children:["\u503C\u53EF\u7528 ",(0,r.jsx)(n.code,{children:"$"})," \u5F15\u7528\u522B\u7684\u73AF\u5883\u53D8\u91CF"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["identity - \u7528\u6237\u540D\u3001\u5206\u7EC4 ",(0,r.jsx)(n.code,{children:":group"}),"\u3001ID"]}),"\n",(0,r.jsx)(n.li,{children:"as target"}),"\n",(0,r.jsx)(n.li,{children:"cmd command - \u9650\u5B9A\u6267\u884C\u547D\u4EE4"}),"\n",(0,r.jsxs)(n.li,{children:["args ",(0,r.jsx)(n.code,{children:"[argument ...]"})," - \u9650\u5B9A\u53C2\u6570"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pre",metastring:'title="doas.conf"',children:"permit nopass admin as root\n\npermit nopass wener as root cmd apk args upgrade\n\npermit nopass setenv { -http_proxy APT_CONFIG=/etc/apt/apt.conf.d/50appstream } :updaters cmd apt args update\n\n# group :wheel\npermit nopass keepenv :wheel\n"})})]})}function h(e={}){let{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},17776:function(e,n,s){s.d(n,{R:()=>l,x:()=>i});var t=s(7378);let r={},d=t.createContext(r);function l(e){let n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);