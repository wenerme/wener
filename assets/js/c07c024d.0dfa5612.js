"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["529551"],{662842:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>h,metadata:()=>s,assets:()=>o,contentTitle:()=>a});var s=JSON.parse('{"id":"devops/web/traefik/README","title":"Traefik","description":"- traefik/traefik","source":"@site/../notes/devops/web/traefik/README.md","sourceDirName":"devops/web/traefik","slug":"/devops/web/traefik/","permalink":"/notes/devops/web/traefik/","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/devops/web/traefik/README.md","tags":[],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1743657456000,"frontMatter":{"title":"Traefik"},"sidebar":"docs","previous":{"title":"openresty","permalink":"/notes/devops/web/nginx/openresty"},"next":{"title":"Traefik V1","permalink":"/notes/devops/web/traefik/v1"}}'),i=r(486106),t=r(917776);let l={title:"Traefik"},a="Traefik",o={},d=[{value:"\u89C4\u5219",id:"\u89C4\u5219",level:2},{value:"\u914D\u7F6E",id:"\u914D\u7F6E",level:2},{value:"\u9759\u6001\u914D\u7F6E\u9879",id:"\u9759\u6001\u914D\u7F6E\u9879",level:3},{value:"PowerDNS \u8BC1\u4E66",id:"powerdns-\u8BC1\u4E66",level:4},{value:"Docker \u914D\u7F6E\u53D1\u73B0",id:"docker-\u914D\u7F6E\u53D1\u73B0",level:4},{value:"traefik v1 vs v2",id:"traefik-v1-vs-v2",level:2}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"traefik",children:"Traefik"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/traefik/traefik",children:"traefik/traefik"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MIT, Go"}),"\n",(0,i.jsx)(n.li,{children:"The Cloud Native Application Proxy"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["ISSUES\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u652F\u6301\u6CDB\u57DF\u540D"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/containous/traefik/issues/5048",children:"#5048"})," \u652F\u6301 UDP"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["ACME\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"20 certificates per domain per week"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://letsencrypt.org/docs/rate-limits/",children:"https://letsencrypt.org/docs/rate-limits/"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6CE8\u610F\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5982\u679C EndPoint \u662F HTTPS \u4F46\u662F router \u672A\u6307\u5B9A tls \u4F1A\u65E0\u6CD5\u5339\u914D\u51FA\u73B0 404 - router \u76F8\u5F53\u4E8E\u662F\u5339\u914D HTTP"}),"\n",(0,i.jsxs)(n.li,{children:["V2 \u4E0D\u652F\u6301\u9AD8\u53EF\u7528\u90E8\u7F72 ",(0,i.jsx)(n.a,{href:"https://github.com/containous/traefik/issues/5792",children:"#5792"})]}),"\n",(0,i.jsx)(n.li,{children:"\u4E0D\u652F\u6301\u91CD\u5199 Host"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://raw.githubusercontent.com/containous/traefik/master/traefik.sample.toml",children:"traefik.sample.toml"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542F\u52A8\n# \u914D\u7F6E\u6587\u4EF6\u652F\u6301 yaml\u3001toml\u3001json\n# \u4EBA\u4E3A\u914D\u7F6E\u63A8\u8350 yaml\ntraefik --configfile traefik.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u57FA\u7840\u914D\u7F6E"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"providers:\n  file:\n    # \u81EA\u52A8\u76D1\u542C\u8BE5\u76EE\u5F55\u914D\u7F6E\n    directory: traefik.d\n    watch: true\n\nentryPoints:\n  http:\n    address: ':8080'\n  https:\n    address: ':8443'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u89C4\u5219",children:"\u89C4\u5219"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Host \u5339\u914D\u57DF\u540D"}),"\n",(0,i.jsxs)(n.li,{children:["HostRegexp\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'HostRegexp("a.example.com","{subdomain}.domain.com","{subdomain:[a-z]+}.domain.com")'})}),"\n",(0,i.jsxs)(n.li,{children:["\u5E76\u4E0D\u662F\u771F\u6B63\u7684\u5B8C\u5168\u6B63\u5219\u5339\u914D - \u53EA\u6709\u5728 ",(0,i.jsx)(n.code,{children:"{}"})," \u5185\u7684\u624D\u4F1A\u5904\u7406"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4F7F\u7528\u7684\u662F gorilla/mux \u7684 ",(0,i.jsx)(n.a,{href:"https://github.com/gorilla/mux/blob/4de8a5a4d283677c69afa1a86a044c8451633a18/route.go#L293:17",children:"Host"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u914D\u7F6E",children:"\u914D\u7F6E"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.traefik.io/master/reference/static-configuration/file/",children:"Static Configuration"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u9759\u6001\u914D\u7F6E\u9879",children:"\u9759\u6001\u914D\u7F6E\u9879"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# \u5168\u5C40\u914D\u7F6E\nglobal:\n  checkNewVersion: false\n  sendAnonymousUsage: false\n# \u670D\u52A1\u7AEF\u4F20\u8F93\u914D\u7F6E\nserversTransport:\n  insecureSkipVerify: false\n  rootCAs: ['foobar', 'foobar']\n  maxIdleConnsPerHost: 42\n  forwardingTimeouts:\n    dialTimeout: 42\n    responseHeaderTimeout: 42\n    idleConnTimeout: 42\n\n# \u9ED8\u8BA4\nentryPoints:\n  web:\n    address: ':80'\n  websecure:\n    address: ':443'\n# \u914D\u7F6E\u53D1\u73B0\nproviders:\n  providersThrottleDuration: 42\n  file:\n    directory: traefik.d\n    watch: true\n    filename: traefik.yaml\n    debugLogGeneratedTemplate: true\n# \u542F\u7528 API\napi:\n  # \u4E0D\u5B89\u5168\u6A21\u5F0F\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE\n  # \u5B89\u5168\u6A21\u5F0F\u4F1A\u5B9A\u4E49 api@internal \u5185\u90E8\u670D\u52A1\uFF0C\u9700\u8981\u81EA\u884C\u914D\u7F6E\u8DEF\u7531\n  insecure: true\n  dashboard: true\n  # \u6DFB\u52A0 /debug \u7AEF\u53E3\n  debug: true\n# \u6307\u6807\u76D1\u63A7\nmetrics:\n  prometheus:\n    buckets: []\n    addEntryPointsLabels: true\n    addServicesLabels: true\n    entryPoint: traefik\n# \u542F\u7528 PING - \u7528\u4E8E\u5065\u5EB7\u68C0\u67E5 - \u7AEF\u53E3\u4E3A /ping\nping:\n  entryPoint: traefik\n# \u65E5\u5FD7\u914D\u7F6E\nlog:\n  level: INFO\n  filePath: traefik.log\n  # common/json\n  format: common\n# \u8BBF\u95EE\u65E5\u5FD7\u914D\u7F6E\naccessLog:\n  filePath: access.log\n  format: json\n  # \u5728\u5185\u5B58\u7F13\u51B2\u7684\u884C\u6570\n  bufferingSize: 100\n  # \u843D\u65E5\u5FD7\u7684\u6761\u4EF6 - \u6216 \u5173\u7CFB\n  filters:\n    statusCodes: [400, 401]\n    # \u91CD\u8BD5\n    retryAttempts: true\n    # \u81F3\u5C11 10ms\n    minDuration: 10\n  # \u5B57\u6BB5\u63A7\u5236\n  fields:\n    # \u4FDD\u7559\u5B57\u6BB5\n    defaultMode: keep\n    names:\n      # \u4E22\u5F03\u5B57\u6BB5\n      ClientUsername: drop\n      name1: foobar\n    headers:\n      # \u5C06\u5B57\u6BB5\u503C\u66FF\u6362\u4E3A redacted\n      'User-Agent': 'redact'\n\n# \u8C03\u7528\u8DDF\u8E2A\ntracing:\n  serviceName: foobar\n  spanNameLimit: 42\n  zipkin:\n    httpEndpoint: foobar\n    sameSpan: true\n    id128Bit: true\n    sampleRate: 42\n# \u4E3B\u673A\u57DF\u540D\u89E3\u6790\nhostResolver:\n  cnameFlattening: true\n  resolvConfig: foobar\n  resolvDepth: 5\n# \u8BC1\u4E66\u89E3\u6790\ncertificatesResolvers:\n  CertificateResolver0:\n    # let\u2018s encrypt\n    acme:\n      email: foobar\n      caServer: foobar\n      storage: foobar\n      keyType: foobar\n      dnsChallenge:\n        provider: foobar\n        delayBeforeCheck: 42\n        resolvers:\n          - foobar\n          - foobar\n        disablePropagationCheck: true\n      httpChallenge:\n        entryPoint: foobar\n      tlsChallenge: {}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"powerdns-\u8BC1\u4E66",children:"PowerDNS \u8BC1\u4E66"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"certificatesResolvers:\n  pdns:\n    acme:\n      dnsChallenge:\n        # \u901A\u8FC7\u73AF\u5883\u53D8\u91CF\u914D\u7F6E\u94FE\u63A5\u4FE1\u606F PDNS_API_KEY, PDNS_API_URL\n        # \u73AF\u5883\u53D8\u91CF\u4E5F\u53EF\u4EE5\u4F7F\u7528 *_FILE \u6307\u5411\u6587\u4EF6\u6765\u914D\u7F6E\n        provider: pdns\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4F7F\u7528"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"http:\n  routers:\n    traefik:\n      entryPoints: [https]\n      rule: Host(`traefik.example.com`)\n      service: api@internal\n      tls:\n        # \u5F15\u7528\u5B9A\u4E49\n        certResolver: pdns\n        # \u4F7F\u7528\u901A\u914D\u7B26\u8BC1\u4E66\n        domains:\n          - main: example.com\n            sans:\n              - '*.example.com'\n"})}),"\n",(0,i.jsx)(n.h4,{id:"docker-\u914D\u7F6E\u53D1\u73B0",children:"Docker \u914D\u7F6E\u53D1\u73B0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# \u8FD0\u884C docker \u6DFB\u52A0 -v /var/run/docker.sock:/var/run/docker.sock\nproviders:\n  docker:\n    endpoint: \'unix:///var/run/docker.sock\'\n    # \u662F\u5426\u9ED8\u8BA4\u66B4\u9732\u670D\u52A1 - \u6B63\u5E38\u9700\u8981 traefik.enable=true\n    exposedByDefault: false\n    # \u9ED8\u8BA4\u7684\u6620\u5C04\u89C4\u5219\n    # \u652F\u6301 https://masterminds.github.io/sprig \u51FD\u6570\n    # defaultRule: "Host(`{{ .Name }}.{{ index .Labels \\"customLabel\\"}}`)"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  -l traefik.enable=true \\\n  -l traefik.http.routers.my-container.rule=Host(`mydomain.com`) \\\n  -l traefik.http.services.my-container-service.loadbalancer.server.port=80\n  --name web nginx\n\n# \u6307\u5B9A\u7AEF\u53E3 - \u591A\u4E2A\u9017\u53F7\u5206\u5272\n# traefik.http.routers.my-container.entrypoints=https\n# \u542F\u7528 tls\n# traefik.http.routers.my-container.tls=true\n"})}),"\n",(0,i.jsx)(n.h1,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.h2,{id:"traefik-v1-vs-v2",children:"traefik v1 vs v2"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u65B0\u7279\u6027\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u652F\u6301\u5E26 SNI \u7684 TCP \u8DEF\u7531\u548C\u591A\u534F\u8BAE\u7AEF\u53E3"}),"\n",(0,i.jsx)(n.li,{children:"\u652F\u6301 TCP \u548C HTTP \u5728\u540C\u4E00\u4E2A\u7AEF\u53E3 - \u4F7F\u7528 SNI \u533A\u5206"}),"\n",(0,i.jsx)(n.li,{children:"\u65B0\u7684\u7ED3\u6784 Routers, Middlewares, Services"}),"\n",(0,i.jsx)(n.li,{children:"\u65B0\u7684\u76D1\u63A7\u9875\u9762"}),"\n",(0,i.jsx)(n.li,{children:"\u5E26\u6743\u91CD\u7684 AB \u53D1\u5E03"}),"\n",(0,i.jsx)(n.li,{children:"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861\u652F\u6301\u955C\u50CF\u8BF7\u6C42 - \u5C06\u8BF7\u6C42\u53D1\u9001\u5230\u591A\u4E2A\u7AEF\u5FFD\u7565\u8FD4\u56DE\u7ED3\u679C"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FC1\u79FB\u70B9\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6CA1\u6709\u4E86 Frontends \u548C Backends \u6982\u5FF5\uFF0C\u65B0\u7684\u6838\u5FC3\u7EC4\u4EF6\u4E3A Routers, Middlewares, Services"}),"\n",(0,i.jsx)(n.li,{children:"TLS \u6BCF\u4E2A\u8DEF\u7531\u52A8\u6001\u914D\u7F6E - v1 \u4E3A\u5168\u5C40\u9759\u6001"}),"\n",(0,i.jsx)(n.li,{children:"HTTP \u8C03\u6574 HTTPS \u73B0\u5728\u662F\u8DEF\u7531 - v1 \u9700\u8981\u5728\u5165\u53E3\u914D\u7F6E"}),"\n",(0,i.jsx)(n.li,{children:"LetsEncrypt \u914D\u7F6E\u8C03\u6574"}),"\n",(0,i.jsx)(n.li,{children:"\u65E5\u5FD7\u4E0D\u5728\u4F5C\u4E3A\u5168\u5C40\u914D\u7F6E\uFF0C\u914D\u7F6E\u5728 log \u533A\u5757\u4E0B"}),"\n",(0,i.jsx)(n.li,{children:"\u79FB\u9664\u4E86\u6240\u6709\u5168\u5C40\u8BBE\u7F6E"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"v2 \u7684 provider \u652F\u6301\u8F83\u5C11"})," - \u4F1A\u9010\u6E10\u5B8C\u5584"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u8003\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://blog.containo.us/traefik-2-0-6531ec5196c2",children:"v2"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.traefik.io/migration/v1-to-v2/",children:"v1 \u8FC1\u79FB v2"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},917776:function(e,n,r){r.d(n,{R:()=>l,x:()=>a});var s=r(7378);let i={},t=s.createContext(i);function l(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);