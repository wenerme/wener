"use strict";(self.webpackChunkwener_website=self.webpackChunkwener_website||[]).push([["584955"],{817004:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>t,assets:()=>d,contentTitle:()=>l});var t=JSON.parse('{"id":"os/dual-system","title":"Dual System Boot","description":"UEFI QEMU","source":"@site/../notes/os/dual-system.md","sourceDirName":"os","slug":"/os/dual-system","permalink":"/notes/os/dual-system","draft":false,"unlisted":false,"editUrl":"https://github.com/wenerme/wener/edit/master/notes/../notes/os/dual-system.md","tags":[{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Boot","permalink":"/notes/tags/boot"},{"inline":true,"label":"UEFI","permalink":"/notes/tags/uefi"},{"inline":true,"label":"Windows","permalink":"/notes/tags/windows"},{"inline":true,"label":"Linux","permalink":"/notes/tags/linux"}],"version":"current","lastUpdatedBy":"wener","lastUpdatedAt":1767451770000,"frontMatter":{"title":"Dual System Boot","tags":["OS","Boot","UEFI","Windows","Linux"]},"sidebar":"docs","previous":{"title":"Printer","permalink":"/notes/os/device/printer"},"next":{"title":"FreeBSD","permalink":"/notes/os/freebsd/"}}'),s=i(486106),o=i(917776);let r={title:"Dual System Boot",tags:["OS","Boot","UEFI","Windows","Linux"]},l="Dual System Boot",d={},a=[{value:"UEFI QEMU",id:"uefi-qemu",level:2},{value:"Windows Boot Manager",id:"windows-boot-manager",level:2},{value:"SSD Optimization",id:"ssd-optimization",level:2},{value:"UEFI + GPT",id:"uefi--gpt",level:2},{value:"ESP (EFI System Partition)",id:"esp-efi-system-partition",level:3},{value:"MSR (Microsoft Reserved Partition)",id:"msr-microsoft-reserved-partition",level:3},{value:"Windows Boot Files",id:"windows-boot-files",level:3},{value:"Recovery",id:"recovery",level:3},{value:"GRUB",id:"grub",level:2},{value:"Add Windows 8.1 Entry",id:"add-windows-81-entry",level:3},{value:"Tools",id:"tools",level:2},{value:"Systemd EFISTUB Update",id:"systemd-efistub-update",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"dual-system-boot",children:"Dual System Boot"})}),"\n",(0,s.jsx)(n.h2,{id:"uefi-qemu",children:"UEFI QEMU"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://fedoraproject.org/wiki/Using_UEFI_with_QEMU",children:"Using UEFI with QEMU"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://unix.stackexchange.com/a/57221/47774",children:"How to boot EFI kernel using QEMU ?"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt",children:"OVMF Whitepaper"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/tianocore/tianocore.github.io/wiki/How-to-run-OVMF",children:"How to run OVMF"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/tianocore/tianocore.github.io/wiki/EDK-II",children:"EDK II"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/tianocore/edk2",children:"tianocore/edk2"})}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"EDK II is a modern, feature-rich, cross-platform firmware development environment for the UEFI and PI specifications. EDK II is open source, using a BSD license."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"windows-boot-manager",children:"Windows Boot Manager"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"bcdedit /set {ID} device partition=c:\nbcdedit /set {ID} path \\linux.bin\nbcdedit /displayorder {ID} /addlast\nbcdedit /timeout 30\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ssd-optimization",children:"SSD Optimization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://bbs.zol.com.cn/diybbs/d34028_544.html",children:"SSD\u56FA\u6001\u786C\u76D8\u4F18\u5316\u8BBE\u7F6E\u56FE\u6587\u6559\u7A0B"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.ithome.com/html/win10/206428.htm",children:"\u5982\u4F55\u5728Win10\u4E0B\u5F00\u542FSSD\u56FA\u6001\u786C\u76D8TRIM"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"uefi--gpt",children:"UEFI + GPT"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://wangpai.2345.cn/thread.php?fid=12&pid=2964106",children:"UEFI SecureBoot ESP MSR \u7B49\u76F8\u5173\u540D\u8BCD\u89E3\u91CA"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"esp-efi-system-partition",children:"ESP (EFI System Partition)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://bbs.archlinuxcn.org/viewtopic.php?id=3474",children:"win8.1\u4E0Earchlinux(UEFI+GPT)\u53CC\u7CFB\u7EDF\u5171\u5B58\u2014\u7A97\u53E3\u73AF\u5883\u914D\u7F6E"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/Dual_boot_with_Windows",children:"Dual boot with Windows"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/GRUB/Tips_and_tricks",children:"GRUB/Tips and tricks"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/GRUB/EFI_examples",children:"GRUB/EFI examples"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://wiki.archlinux.org/index.php/EFI_System_Partition",children:"EFI System Partition"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://tech.memoryimprintstudio.com/dual-boot-installation-of-arch-linux-with-preinstalled-windows-10-with-encryption/",children:"\u5B89\u88C5win10_arch\u53CC\u7CFB\u7EDF\u8FC7\u7A0B"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"ESP\u5206\u533A\u662FFAT32\u683C\u5F0F\u7684\uFF0C\u4E3B\u8981\u7528\u6765\u653EWindows\u7684\u5F15\u5BFC\u6587\u4EF6\u3002UEFI\u4E0D\u652F\u6301\u4ECENTFS\u683C\u5F0F\u7684\u5206\u533A\u542F\u52A8\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"msr-microsoft-reserved-partition",children:"MSR (Microsoft Reserved Partition)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"MSR\u5206\u533A\u5373 Microsoft Retain \u5FAE\u8F6F\u4FDD\u7559\u5206\u533A\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u5C0F\u4E8E 16 GB \u7684\u78C1\u76D8\uFF0CMSR \u5206\u533A\u4E3A 32 MB\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u5927\u4E8E 16 GB \u7684\u78C1\u76D8\uFF0CMSR \u5206\u533A\u4E3A 128 MB\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u6CA1\u6709MSR\u5206\u533AWindows\u8FD8\u662F\u53EF\u4EE5\u542F\u52A8\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"windows-boot-files",children:"Windows Boot Files"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Windows Boot Manager"}),": \u542F\u52A8\u9009\u9879"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"bootmgfw.efi"}),": \u5F15\u5BFCWindows\u7684\u5F15\u5BFC\u6587\u4EF6\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Bootx64.efi"}),": UEFI\u7684\u5FC5\u9700\u5F15\u5BFC\u6587\u4EF6\uFF01"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CS-M"}),": Compatibility Support Module\uFF0C\u517C\u5BB9\u6027\u652F\u6301\u6A21\u5757\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"recovery",children:"Recovery"}),"\n",(0,s.jsxs)(n.p,{children:["\u6062\u590D\u5F15\u5BFC\u9879\uFF1A\u5728pe\u4E2D\u8FD0\u884Ccmd\u540E\u8F93\u5165 ",(0,s.jsx)(n.code,{children:"bcdboot c:\\windows /f all /s f: /l zh-cn"})]}),"\n",(0,s.jsx)(n.h2,{id:"grub",children:"GRUB"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub\n"})}),"\n",(0,s.jsx)(n.h3,{id:"add-windows-81-entry",children:"Add Windows 8.1 Entry"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cfg",children:"# /boot/grub/grub.cfg\n\nmenuentry 'windows8' {\n    insmod part_gpt\n    insmod chain\n    set root='(hd0,gpt2)'\n    chainloader /EFI/microsoft/Boot/bootmgfw.efi\n}\n\nif [ \"${grub_platform}\" == \"efi\" ]; then\n    menuentry \"Microsoft Windows Vista/7/8/10 UEFI-GPT\" {\n        insmod part_gpt\n        insmod fat\n        insmod search_fs_uuid\n        insmod chain\n        search --fs-uuid --set=root $hints_string $fs_uuid\n        chainloader /EFI/Microsoft/Boot/bootmgfw.efi\n    }\nfi\n\n# BIOS+MBR\nmenuentry 'Windows ' {\n    insmod ntfs\n    set root='(hd0,msdos3)'\n    search --no-floppy --fs-uuid --set=root \u4F60\u7684\u786C\u76D8UUID\n    chainloader +1\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ms-sys"}),": Write MBRs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"efibootmgr"}),": Manage EFI boot entries"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://etcher.io/",children:"Etcher"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ms-sys --partition /dev/sda1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"systemd-efistub-update",children:"Systemd EFISTUB Update"}),"\n",(0,s.jsx)(n.p,{children:"Monitor kernel updates to copy EFISTUB kernel to ESP."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"/etc/systemd/system/efistub-update.path"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=Copy EFISTUB Kernel to EFI System Partition\n\n[Path]\nPathChanged=/boot/initramfs-linux-fallback.img\n\n[Install]\nWantedBy=multi-user.target\nWantedBy=system-update.target\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"/etc/systemd/system/efistub-update.service"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=Copy EFISTUB Kernel to EFI System Partition\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/cp -af /boot/vmlinuz-linux esp/EFI/arch/\nExecStart=/usr/bin/cp -af /boot/initramfs-linux.img esp/EFI/arch/\nExecStart=/usr/bin/cp -af /boot/initramfs-linux-fallback.img esp/EFI/arch/\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://blog.icehoney.me/posts/2015-10-28-UEFI-dual-boot-Archlinux",children:"UEFI dual boot Archlinux"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},917776:function(e,n,i){i.d(n,{R:()=>r,x:()=>l});var t=i(7378);let s={},o=t.createContext(s);function r(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);