<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-os/alpine/alpine-ops" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>Alpine 运维笔记 | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/notes/os/alpine/ops /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Alpine 运维笔记 | Wener Live & Life"/><meta data-rh=true name=description content=bash /><meta data-rh=true property=og:description content=bash /><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/notes/os/alpine/ops /><link data-rh=true rel=alternate href=https://wener.me/notes/os/alpine/ops hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/notes/os/alpine/ops hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://wener.me/notes/os/","name":"操作系统","position":1},{"@type":"ListItem","item":"https://wener.me/notes/os/alpine/","name":"Alpine","position":2},{"@type":"ListItem","item":"https://wener.me/notes/os/alpine/ops","name":"Alpine 运维笔记","position":3}]}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.72c320db.js defer></script><script src=/assets/js/main.c07313b6.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/notes>笔记</a><a class="navbar__item navbar__link" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class=docsWrapper_oymo><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ZPA9" type=button></button><div class=docRoot_ng2Q><aside class="theme-doc-sidebar-container docSidebarContainer_nyHU"><div class=sidebarViewport_rLoj><div class=sidebar_TmDF><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jRin"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes><span title=笔记 class=linkLabel_JPPZ>笔记</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/adobe/photoshop><span title=adobe class=categoryLinkLabel_RkOu>adobe</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ai><span title=AI class=categoryLinkLabel_RkOu>AI</span></a><button aria-label="Expand sidebar category 'AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/algorithm><span title=算法 class=categoryLinkLabel_RkOu>算法</span></a><button aria-label="Expand sidebar category '算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/blockchain><span title=区块链 class=categoryLinkLabel_RkOu>区块链</span></a><button aria-label="Expand sidebar category '区块链'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/cn><span title=CN class=categoryLinkLabel_RkOu>CN</span></a><button aria-label="Expand sidebar category 'CN'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/courses><span title=课程 class=categoryLinkLabel_RkOu>课程</span></a><button aria-label="Expand sidebar category '课程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/culture><span title=文化 class=categoryLinkLabel_RkOu>文化</span></a><button aria-label="Expand sidebar category '文化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/db><span title=数据库 class=categoryLinkLabel_RkOu>数据库</span></a><button aria-label="Expand sidebar category '数据库'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/dev><span title=开发 class=categoryLinkLabel_RkOu>开发</span></a><button aria-label="Expand sidebar category '开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/devops><span title=DevOps class=categoryLinkLabel_RkOu>DevOps</span></a><button aria-label="Expand sidebar category 'DevOps'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/economics><span title=经济学 class=categoryLinkLabel_RkOu>经济学</span></a><button aria-label="Expand sidebar category '经济学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/electrical><span title=电学基础 class=categoryLinkLabel_RkOu>电学基础</span></a><button aria-label="Expand sidebar category '电学基础'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/embedded/awesome><span title=embedded class=categoryLinkLabel_RkOu>embedded</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/evolve><span title=自我成长 class=categoryLinkLabel_RkOu>自我成长</span></a><button aria-label="Expand sidebar category '自我成长'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/hardware><span title=硬件 class=categoryLinkLabel_RkOu>硬件</span></a><button aria-label="Expand sidebar category '硬件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/healthcare><span title=健康 class=categoryLinkLabel_RkOu>健康</span></a><button aria-label="Expand sidebar category '健康'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/howto/network/dns-prevent-spoofing><span title=howto class=categoryLinkLabel_RkOu>howto</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/java><span title=Java class=categoryLinkLabel_RkOu>Java</span></a><button aria-label="Expand sidebar category 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/languages><span title=语言 class=categoryLinkLabel_RkOu>语言</span></a><button aria-label="Expand sidebar category '语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes/linguistics><span title=Linguistics class=linkLabel_JPPZ>Linguistics</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/math><span title=数学 class=categoryLinkLabel_RkOu>数学</span></a><button aria-label="Expand sidebar category '数学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/mgmt><span title=管理 class=categoryLinkLabel_RkOu>管理</span></a><button aria-label="Expand sidebar category '管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/network/application/dns><span title=network class=categoryLinkLabel_RkOu>network</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ops><span title=运维 class=categoryLinkLabel_RkOu>运维</span></a><button aria-label="Expand sidebar category '运维'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" href=/notes/os><span title=操作系统 class=categoryLinkLabel_RkOu>操作系统</span></a><button aria-label="Collapse sidebar category '操作系统'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/os/alpine><span title=Alpine class=categoryLinkLabel_RkOu>Alpine</span></a><button aria-label="Collapse sidebar category 'Alpine'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/apk><span title=apk class=linkLabel_JPPZ>apk</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/awesome><span title="AlpineLinux Awesome" class=linkLabel_JPPZ>AlpineLinux Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/boot><span title="Alpin Boot" class=linkLabel_JPPZ>Alpin Boot</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/chroot><span title="Alpine chroot 环境" class=linkLabel_JPPZ>Alpine chroot 环境</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/desktop><span title="Alpine Desktop" class=linkLabel_JPPZ>Alpine Desktop</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/faq><span title="Alpine FAQ" class=linkLabel_JPPZ>Alpine FAQ</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/glibc><span title="Alpine GLIBC" class=linkLabel_JPPZ>Alpine GLIBC</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/health><span title="Health Check" class=linkLabel_JPPZ>Health Check</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/image><span title="Alpine Image" class=linkLabel_JPPZ>Alpine Image</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/install><span title="AlpineLinux Install" class=linkLabel_JPPZ>AlpineLinux Install</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/intro><span title="Alpine 入门" class=linkLabel_JPPZ>Alpine 入门</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/lbu><span title="Alpine local backup" class=linkLabel_JPPZ>Alpine local backup</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/notes/os/alpine/ops><span title="Alpine 运维笔记" class=linkLabel_JPPZ>Alpine 运维笔记</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/pkgs><span title="Alpine 包维护" class=linkLabel_JPPZ>Alpine 包维护</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/pxe><span title=pxe class=linkLabel_JPPZ>pxe</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/rpi><span title="Alpine Linux on Raspberry Pi" class=linkLabel_JPPZ>Alpine Linux on Raspberry Pi</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/setup><span title="AlpineLinux Setup" class=linkLabel_JPPZ>AlpineLinux Setup</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/takeover><span title=takeover class=linkLabel_JPPZ>takeover</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/tip><span title="Alpine Tip" class=linkLabel_JPPZ>Alpine Tip</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/version><span title="AlpineLinux 版本历史" class=linkLabel_JPPZ>AlpineLinux 版本历史</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/virt><span title="Alpine Virt" class=linkLabel_JPPZ>Alpine Virt</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/alpine/postmarketos><span title=postmarketOS class=linkLabel_JPPZ>postmarketOS</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/android><span title=Android class=categoryLinkLabel_RkOu>Android</span></a><button aria-label="Expand sidebar category 'Android'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/bsd/awesome><span title=bsd class=categoryLinkLabel_RkOu>bsd</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/busybox><span title=Busybox class=categoryLinkLabel_RkOu>Busybox</span></a><button aria-label="Expand sidebar category 'Busybox'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/centos><span title=CentOS class=categoryLinkLabel_RkOu>CentOS</span></a><button aria-label="Expand sidebar category 'CentOS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/chromeos><span title=ChromeOS class=linkLabel_JPPZ>ChromeOS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/darwin><span title=Darwin class=linkLabel_JPPZ>Darwin</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/debian><span title=Debian class=categoryLinkLabel_RkOu>Debian</span></a><button aria-label="Expand sidebar category 'Debian'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/freebsd><span title=FreeBSD class=linkLabel_JPPZ>FreeBSD</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/fuchsia><span title=Fuchsia class=linkLabel_JPPZ>Fuchsia</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/lakka><span title="lakka tv" class=linkLabel_JPPZ>lakka tv</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/libreelec><span title=LibreELEC class=linkLabel_JPPZ>LibreELEC</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/admin><span title=linux class=categoryLinkLabel_RkOu>linux</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/macos><span title=macOS class=categoryLinkLabel_RkOu>macOS</span></a><button aria-label="Expand sidebar category 'macOS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/mobile><span title=手机 class=linkLabel_JPPZ>手机</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/network><span title=网络设备系统 class=categoryLinkLabel_RkOu>网络设备系统</span></a><button aria-label="Expand sidebar category '网络设备系统'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/openbsd><span title=OpenBSD class=linkLabel_JPPZ>OpenBSD</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/awesome><span title="OS Awesome" class=linkLabel_JPPZ>OS Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/faq><span title="OS FAQ" class=linkLabel_JPPZ>OS FAQ</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/glossary><span title="OS Glossary" class=linkLabel_JPPZ>OS Glossary</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/rhel/anaconda><span title=rhel class=categoryLinkLabel_RkOu>rhel</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/synology><span title=Synology class=linkLabel_JPPZ>Synology</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/ubuntu><span title=Ubuntu class=categoryLinkLabel_RkOu>Ubuntu</span></a><button aria-label="Expand sidebar category 'Ubuntu'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/virt><span title=虚拟化 class=categoryLinkLabel_RkOu>虚拟化</span></a><button aria-label="Expand sidebar category '虚拟化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/windows><span title=Windows class=categoryLinkLabel_RkOu>Windows</span></a><button aria-label="Expand sidebar category 'Windows'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/philosophy><span title=理念 class=categoryLinkLabel_RkOu>理念</span></a><button aria-label="Expand sidebar category '理念'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/photography><span title=摄影 class=categoryLinkLabel_RkOu>摄影</span></a><button aria-label="Expand sidebar category '摄影'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/platform><span title=平台 class=categoryLinkLabel_RkOu>平台</span></a><button aria-label="Expand sidebar category '平台'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/psychology/glossary><span title=psychology class=categoryLinkLabel_RkOu>psychology</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/queue><span title=Queue class=categoryLinkLabel_RkOu>Queue</span></a><button aria-label="Expand sidebar category 'Queue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/security><span title=安全 class=categoryLinkLabel_RkOu>安全</span></a><button aria-label="Expand sidebar category '安全'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/service><span title=服�务 class=categoryLinkLabel_RkOu>服务</span></a><button aria-label="Expand sidebar category '服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/software><span title=软件 class=categoryLinkLabel_RkOu>软件</span></a><button aria-label="Expand sidebar category '软件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/std><span title=标准数据 class=categoryLinkLabel_RkOu>标准数据</span></a><button aria-label="Expand sidebar category '标准数据'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/voip><span title=VoIP class=categoryLinkLabel_RkOu>VoIP</span></a><button aria-label="Expand sidebar category 'VoIP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/web><span title=Web class=categoryLinkLabel_RkOu>Web</span></a><button aria-label="Expand sidebar category 'Web'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_NY7h"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c8nQ><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_GAGP><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YQ1L"><div class=docItemContainer_Wjg4><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_tiqF" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_WTWT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/os><span>操作系统</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/os/alpine><span>Alpine</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Alpine 运维笔记</span></ul></nav><div class="tocCollapsible_GvsH theme-doc-toc-mobile tocMobile_qJgM"><button type=button class="clean-btn tocCollapsibleButton_LnP0">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Alpine 运维笔记</h1></header><div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">lsblk --output NAME,SIZE,VENDOR,FSTYPE,LABEL,UUID,MODE         # 查看磁盘硬盘</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lsblk -x NAME --output NAME,SIZE,VENDOR,FSTYPE,LABEL,UUID,MODE # 使用 NAME 排序</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add wpa_supplicant e2fsprogs-extra</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 基础工具</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add bash tar util-linux iproute2 curl busybox-extras file nano libc6-compat gcompat</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=bash>bash<a href=#bash class=hash-link aria-label="Direct link to bash" title="Direct link to bash" translate=no>​</a></h2>
<ul>
<li><a href="https://pkgs.alpinelinux.org/packages?name=*-bash-completion&branch=v3.6&repo=&arch=x86_64" target=_blank rel="noopener noreferrer">*-bash-completion</a>
<ul>
<li>其他的 bash 补全的包</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># Bash</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add shadow bash</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">usermod --shell /bin/bash admin</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 该步骤要求输入密码</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># chsh root -s /bin/bash</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 补全</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add bash-completion</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 加载补全</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">source /etc/profile.d/bash_completion.sh</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=替换-apk-仓库镜像>替换 apk 仓库镜像<a href=#替换-apk-仓库镜像 class=hash-link aria-label="Direct link to 替换 apk 仓库镜像" title="Direct link to 替换 apk 仓库镜像" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">echo "http://mirrors.sjtug.sjtu.edu.cn/alpine/v$(sed -n 's/\.\d\+$//p' /etc/alpine-release)/main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">http://mirrors.sjtug.sjtu.edu.cn/alpine/v$(sed -n 's/\.\d\+$//p' /etc/alpine-release)/community" > /etc/apk/repositories</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk update</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=manpages>manpages<a href=#manpages class=hash-link aria-label="Direct link to manpages" title="Direct link to manpages" translate=no>​</a></h2>
<ul>
<li>Alpine 默认不会安装 doc 和 man</li>
<li>所有的文档以 -doc 结尾</li>
<li>文档位于 /usr/share/man</li>
<li><a href=https://wiki.alpinelinux.org/wiki/How_to_get_regular_stuff_working target=_blank rel="noopener noreferrer">How to get regular stuff working</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add --no-cache man man-pages mdocml-apropos less less-doc</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">export PAGER=less</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 安装和查看</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add --no-cache curl-doc</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">man curl</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 或者直接使用 docker 便于查文档</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">docker run --rm -it wener/base:man</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 可以安装映射到主机</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">docker run --rm -it -v $PWD/man:/usr/share/man wener/base:man</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=基础运维>基础运维<a href=#基础运维 class=hash-link aria-label="Direct link to 基础运维" title="Direct link to 基础运维" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 基础工具</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add nano file grep htop rsync curl openssl</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 简化链接</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add tmux mosh</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># sshrc - https://github.com/Russell91/sshrc</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 依赖包</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add vim tar coreutils openssl</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 证书</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># /etc/ssl/certs/ca-certificates.crt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 系统信息</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add neofetch</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=系统运维>系统运维<a href=#系统运维 class=hash-link aria-label="Direct link to 系统运维" title="Direct link to 系统运维" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 常用工具</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add util-linux</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 扩展工具</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add blkid cfdisk findmnt mcookie setpriv sfdisk</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 补全</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add util-linux-bash-completion</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 信息查询工具</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add lsof</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=硬件运维>硬件运维<a href=#硬件运维 class=hash-link aria-label="Direct link to 硬件运维" title="Direct link to 硬件运维" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add pciutils</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add usbutils</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add parted</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add ddrescue</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># dmidecode ownership vpddecode biosdecode</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add dmidecode</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=setup-disk>setup-disk<a href=#setup-disk class=hash-link aria-label="Direct link to setup-disk" title="Direct link to setup-disk" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 制作系统盘</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># swap 0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">setup-disk -m sys -s 0 -v /dev/sda</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ==========</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 新系统检查项</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ==========</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改主机名</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">setup-hostname -n alpine-test</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">/etc/init.d/hostname --quiet restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">nano /etc/hosts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改网络地址</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">nano /etc/network/interfaces</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=本地仓库>本地仓库<a href=#本地�仓库 class=hash-link aria-label="Direct link to 本地仓库" title="Direct link to 本地仓库" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">ARCH=$(apk print --print-arch)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">REPO=$PWD/repo</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkdir -p $REPO/$ARCH</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk fetch -vRo $REPO/$ARCH nano</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 可以指定仓库</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk fetch -vRo $REPO/$ARCH -X http://mirrors.aliyun.com/alpine/edge/main --no-cache linux-firmware-brcm</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 创建索引</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 这里的 APKINDEX 是未签名的</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk index -o $REPO/$ARCH/APKINDEX.tar.gz $REPO/$ARCH/*.apk</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk -X $REPO update --allow-untrust</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk -X $REPO search --allow-untrust nano</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=容器>容器<a href=#容器 class=hash-link aria-label="Direct link to 容器" title="Direct link to 容器" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># Docker</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add docker</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add docker</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=磁盘扩展>磁盘扩展<a href=#磁盘扩展 class=hash-link aria-label="Direct link to 磁盘扩展" title="Direct link to 磁盘扩展" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 扩展分区</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 假设分区结构为: boot,swap,root,空闲</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 删除最后一个分区, 再创建最后一个分区, 确保起点位置不变</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># F 可以看到空余空间</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 手动分区</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># fdisk /dev/sda</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 或直接分区</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add util-linux</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo -e 'd\n\nn\n\n\n\n\n\np\nw\n' | fdisk /dev/sda</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 重启</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 不重启应该也是可以的 - ext4 支持在线扩容</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># reboot</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 扩展文件系统</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add e2fsprogs-extra</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">resize2fs /dev/sda2</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 检查结果</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">df -h /</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># parted 也可以</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">parted /dev/sdb resize 1 1 200M</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">parted /dev/sdb resizepart 1 400M</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">resize2fs /dev/sdb1 400M</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=udev>udev<a href=#udev class=hash-link aria-label="Direct link to udev" title="Direct link to udev" translate=no>​</a></h2>
<ul>
<li>Gentoo <a href=https://wiki.gentoo.org/wiki/Project:Eudev target=_blank rel="noopener noreferrer">Eudev</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 设置 /dev/disk</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add udev-init-scripts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># OpenRC compatible fork of systemd-udev</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add eudev</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># init: udev udev-trigger udev-postmount udev-settle</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add udev sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add udev-trigger sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果想要立即启用</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service udev start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service udev-trigger start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">udevadm trigger</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 该包会影响网卡名字</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 会添加 /lib/udev/rules.d/80-net-name-slot.rules</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 需要参数 net.ifnames=0 来关闭</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 大多数时候不需要</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># apk add eudev-netifnames</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 所有定义的规则</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">udevadm info --export-db</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=zfs>zfs<a href=#zfs class=hash-link aria-label="Direct link to zfs" title="Direct link to zfs" translate=no>​</a></h2>
<ul>
<li>先安装 <a href=#udev>udev</a> 环境</li>
<li>使用 zfs 时最好使用 uuid, 因为名字可能会发生变化</li>
<li>0.6 时, 导致直接系统重启</li>
<li>0.6 的 init 不是 openrc 的脚本, 启动会警告</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add zfs zfs-{scripts,udev}</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 区分 lts, virt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add zfs-lts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 加载内核模块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe zfs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo zfs > /etc/modules-load.d/zfs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># init: zfs-import zfs-mount zfs-share zfs-zed</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add zfs-import sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add zfs-mount sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 立即启动</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service zfs-import start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service zfs-mount start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 检测是否正常</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool status</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看磁盘量</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">parted --list</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看现有磁盘 UUID</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 依赖于 udev</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 一般会有 ata, scsi, wwn 前缀之类</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ls -lh /dev/disk/by-id/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 只看主盘</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ls -lh /dev/disk/by-id/ | grep 'sd.$'</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -f 强制创建, 避免 Does not contain an EFI label 错误</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -o ashift=12 使用高级磁盘格式</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -m /mnt/data 指定挂载点, 不指定则默认挂载为 /&lt;pool></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1 Pool 的名字</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># raidz 使用 RADI-Z 冗余</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool create -f -o ashift=12 -m /mnt/data p1 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  raidz \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  ata-VBOX_HARDDISK_VB63cffc10-3a66b288 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  ata-VBOX_HARDDISK_VBfb21373d-56cc6c57 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  ata-VBOX_HARDDISK_VB91ae7aad-d4a73895</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看状态</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool status</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#   pool: p1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#  state: ONLINE</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#   scan: none requested</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># config:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	NAME                                       STATE     READ WRITE CKSUM</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	p1                                         ONLINE       0     0     0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	  raidz1-0                                 ONLINE       0     0     0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	    ata-VBOX_HARDDISK_VB63cffc10-3a66b288  ONLINE       0     0     0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	    ata-VBOX_HARDDISK_VBfb21373d-56cc6c57  ONLINE       0     0     0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 	    ata-VBOX_HARDDISK_VB91ae7aad-d4a73895  ONLINE       0     0     0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># errors: No known data errors</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 此时可以重启测试看看 pool 是否还在</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool status -x</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 将 scrub 作为周期性任务</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 一般一两周一次, 至少一月一次</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo '#!/bin/sh -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool scrub main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">' > /etc/periodic/monthly/zfs-scrub</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">chmod +x /etc/periodic/monthly/zfs-scrub</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service crond start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add crond</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 测试 crond</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># busybox 的 run-parts 功能较少</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add run-parts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">run-parts /etc/periodic/monthly -v --report</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=uninstall-zfs>uninstall zfs<a href=#uninstall-zfs class=hash-link aria-label="Direct link to uninstall zfs" title="Direct link to uninstall zfs" translate=no>​</a></h3>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 销毁使用的 pool</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool destroy pool</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 停止 service</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service zfs-import stop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service zfs-mount stop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 移除 init</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update del zfs-import sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update del zfs-mount sysinit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 移除内核模块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe -r zfs</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=btrfs>btrfs<a href=#btrfs class=hash-link aria-label="Direct link to btrfs" title="Direct link to btrfs" translate=no>​</a></h2>
<ul>
<li>
<p>kernel <a href=https://btrfs.wiki.kernel.org/ target=_blank rel="noopener noreferrer">btrfs</a></p>
<ul>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs(5) target=_blank rel="noopener noreferrer">btrfs.5</a></li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Status target=_blank rel="noopener noreferrer">Status</a></li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Mount_options target=_blank rel="noopener noreferrer">Mount options</a></li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Incremental_Backup target=_blank rel="noopener noreferrer">Incremental Backup</a></li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Problem_FAQ target=_blank rel="noopener noreferrer">FAQ</a></li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Gotchas target=_blank rel="noopener noreferrer">Gotchas</a>
<ul>
<li>不建议使用 RAID5, RAID6</li>
</ul>
</li>
<li><a href=https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices target=_blank rel="noopener noreferrer">Using Btrfs with Multiple Devices</a></li>
</ul>
</li>
<li>
<p>Debian <a href=https://wiki.debian.org/Btrfs target=_blank rel="noopener noreferrer">Btrfs</a></p>
<ul>
<li>不要使用 4.11.x</li>
<li>quotas 和 qgroups 有问题</li>
<li>subvol 不能够被挂在为不同的选项</li>
<li>compress=lzo 可能比较危险</li>
<li>-o compress 可能会放大碎片</li>
</ul>
</li>
<li>
<p>Archlinux <a href=https://wiki.archlinux.org/index.php/Btrfs target=_blank rel="noopener noreferrer">Btrfs</a></p>
<ul>
<li><a href=https://wiki.archlinux.org/index.php/Btrfs_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87) target=_blank rel="noopener noreferrer">中文</a></li>
</ul>
</li>
<li>
<p>raid0, raid1, raid5, raid6, raid10, dup, single</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 辅助程序</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add btrfs-progs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add btrfs-progs-extra</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 补全</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add btrfs-progs-bash-completion</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 加载内核模块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe btrfs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 确保启动时加载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo btrfs >> /etc/modules</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 加载模块后会生成, 如果没有可以手动创建</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mknod /dev/btrfs-control c 10 234</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -M 混合元数据和数据, 适用于小数据, 数据大了过后磁盘布局不可预见</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -L 指定标签</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -U 可手动指定 UUID, 避免修改 fstab</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># -O 指定特性</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkfs.btrfs --help</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看支持的特性</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkfs.btrfs -O list-all</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mixed-bg            - mixed data and metadata block groups (0x4, compat=2.6.37, safe=2.6.37)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># extref              - increased hardlink limit per file to 65536 (0x40, compat=3.7, safe=3.12, default=3.12)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># raid56              - raid56 extended format (0x80, compat=3.9)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># skinny-metadata     - reduced-size metadata extent refs (0x100, compat=3.10, safe=3.18, default=3.18)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># no-holes            - no explicit hole extents for files (0x200, compat=3.14, safe=4.0)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># a.b.c.d 做 raid 1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 这几个设备的 uuid 会变成一样</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkfs.btrfs -d raid1 -m raid1 /dev/sd{a,b,c,d}</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 此时可以将任意一个设备进行挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mount /dev/sda /mnt/main/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 设备扫描</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs device scan</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看文件系统</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs filesystem show</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看使用量</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs fi df /data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 执行 scrub</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-scrub</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 结果会存储于 /var/lib/btrfs/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs sc start /data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看执行状态</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs sc status /data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 执行 check</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># check or repair a btrfs filesystem</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-check</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 不建议执行在线检测</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 自动挂载需要修改 /etc/fstab</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo "UUID=$(blkid -s UUID -o value /dev/sda) /data btrfs defaults 0 0" >> /etc/fstab</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=failed-to-read-the-system-array>failed to read the system array<a href=#failed-to-read-the-system-array class=hash-link aria-label="Direct link to failed to read the system array" title="Direct link to failed to read the system array" translate=no>​</a></h3>
<ul>
<li>会导致启动时挂载失败</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">[ 1985.671707] BTRFS info (device sde): disk space caching is enabled</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 1985.671712] BTRFS info (device sde): has skinny extents</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 1985.675608] BTRFS error (device sde): failed to read the system array: -5</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 1985.731217] BTRFS error (device sde): open_ctree failed</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 从新扫描后挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs dev scan</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mount -a</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果还不行可以尝试</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">btrfs rescue zero-log /dev/sde</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mount -a</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=networking>networking<a href=#networking class=hash-link aria-label="Direct link to networking" title="Direct link to networking" translate=no>​</a></h2>
<ul>
<li>auto
<ul>
<li>try to <code>ip link set &lt;dev> up</code> at boot. Best choice for anything PCIe/SoC.</li>
</ul>
</li>
<li>allow-hotplug
<ul>
<li>for kernel+drivers+udev to detect the device, then <code>ip link set &lt;dev> up</code> it. The only thing that can deal with annoying USB, SDIO, etc.</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add ethtool</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 支持更多的参数</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add ifupdown</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add iftop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 支持 -v</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add run-parts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add iproute2</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># A utility to ping multiple hosts at once</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># http://fping.org/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add fping</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 设置地址和掩码</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ifconfig eth1 192.168.8.182 netmask 255.255.252.0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 实际调用</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 这里的 run-parts 可能是 busybox 的 run-parts, 不支持 -v, 建议额外安装</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># run-parts --exit-on-error --verbose /etc/network/if-pre-up.d</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ip addr add 192.168.8.182/255.255.252.0 broadcast 192.168.11.255 	  dev eth1 label eth1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ifup -v eth1</span><br/></span></code></pre></div></div>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 一个网卡, 多个网关</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto eth0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iface eth0 inet static</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    address 10.1.248.11</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    netmask 255.255.255.0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    up ip route add default via 10.1.248.1 dev eth0  metric 100</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    up ip route add default via 10.1.248.3 dev eth0  metric 200</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 一个网卡, 多个地址</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto eth0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iface eth0 inet static</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  address aaa.aaa.aaa.aaa</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  netmask 255.255.254.0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  gateway bbb.bbb.bbb.bbb</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  dns-nameservers ccc.ccc.ccc.ccc ddd.ddd.ddd.ddd eee.eee.eee.eee</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  dns-search vps-number.com</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  # 或者</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  up ip addr add fff.fff.fff.fff/prefixlen dev eth0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">auto eth0:0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iface eth0:0 inet static</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  address fff.fff.fff.fff</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  netmask 255.255.254.0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=network-benchmark>network benchmark<a href=#network-benchmark class=hash-link aria-label="Direct link to network benchmark" title="Direct link to network benchmark" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add iperf3 iptraf-ng iftop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iperf3 -s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iperf3 -c HOST</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=init>init<a href=#init class=hash-link aria-label="Direct link to init" title="Direct link to init" translate=no>​</a></h2>
<ul>
<li>openrc</li>
<li><code>/etc/conf.d/localmount</code>
<ul>
<li>可配置强制挂载点</li>
</ul>
</li>
</ul>
<pre tabindex=0 class="codeBlockStandalone_e_f0 thin-scrollbar language-conf codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><code class=codeBlockLines_NG8l></code></pre>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=iscsi>iscsi<a href=#iscsi class=hash-link aria-label="Direct link to iscsi" title="Direct link to iscsi" translate=no>​</a></h2>
<ul>
<li><a href=https://github.com/open-iscsi target=_blank rel="noopener noreferrer">https://github.com/open-iscsi</a></li>
<li><a href=https://github.com/open-iscsi/open-iscsi target=_blank rel="noopener noreferrer">https://github.com/open-iscsi/open-iscsi</a></li>
<li><a href=https://github.com/open-iscsi/targetcli-fb target=_blank rel="noopener noreferrer">https://github.com/open-iscsi/targetcli-fb</a></li>
<li><a href=https://wiki.archlinux.org/index.php/ISCSI_Target target=_blank rel="noopener noreferrer">https://wiki.archlinux.org/index.php/ISCSI_Target</a></li>
</ul>
<p><a href=http://scst.sourceforge.net/ target=_blank rel="noopener noreferrer">http://scst.sourceforge.net/</a></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># An administration shell for storage targets</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># init: targetcli</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># bin: targetcli</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># apk add targetcli</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ISCSI target for SCST - userspace tools</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># apk add iscsi-scst</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># High performance, transport independent, multi-platform iSCSI initiator</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># init: iscsid</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># bin: iscsi_discovery, iscsiadm, iscsi-iname</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># sbin: iscsid, iscsistart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># conf:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#   /etc/iscsi/initiatorname.iscsi</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#   /etc/iscsi/iscsid.conf</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#   /etc/iscsi/ifaces/iface</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add open-iscsi</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=stress>stress<a href=#stress class=hash-link aria-label="Direct link to stress" title="Direct link to stress" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">stress --vm-bytes $(awk '/MemFree/{printf "%d\n", $2 * 0.9;}' &lt; /proc/meminfo)k --vm-keep -m 1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">stress --vm-bytes $(awk '/MemFree/{printf "%d\n", $2 * 0.097;}' &lt; /proc/meminfo)k --vm-keep -m 10</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=disk>disk<a href=#disk class=hash-link aria-label="Direct link to disk" title="Direct link to disk" translate=no>​</a></h2>
<ul>
<li>badblocks</li>
<li>e2fsprogs-extra</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add cdrkit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 检测 iso 是否可启动</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 结果中会包含 El Torito 信息</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># https://en.wikipedia.org/wiki/El_Torito_(CD-ROM_standard)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">isoinfo -d -i is_it_bootable.iso</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># burn iso</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">pv spp-2016.10.0.iso | dd bs=4M of=/dev/sdd</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=qemu>QEMU<a href=#qemu class=hash-link aria-label="Direct link to QEMU" title="Direct link to QEMU" translate=no>​</a></h2>
<ul>
<li><a href=https://www.qemu.org/ target=_blank rel="noopener noreferrer">QEMU</a>
<ul>
<li><a href=https://qemu.weilnetz.de/doc/qemu-doc.html target=_blank rel="noopener noreferrer">Doc</a></li>
</ul>
</li>
</ul>
<p>If you want to run VM as unprivileged user and let Qemu create tunX devices,
then you must add that user to the group "qemu".
If you use KVM for hardware-assisted virtualization, then you may also need
to add that user to the group "kvm".</p>
<p><a href=https://wiki.archlinux.org/index.php/QEMU_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87) target=_blank rel="noopener noreferrer">https://wiki.archlinux.org/index.php/QEMU_(简体中文)</a></p>
<p><a href=https://allyourco.de/running-vmware-esxi-under-qemu-kvm/ target=_blank rel="noopener noreferrer">https://allyourco.de/running-vmware-esxi-under-qemu-kvm/</a></p>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=kvm>kvm<a href=#kvm class=hash-link aria-label="Direct link to kvm" title="Direct link to kvm" translate=no>​</a></h3>
<ul>
<li><a href=https://wiki.alpinelinux.org/wiki/KVM target=_blank rel="noopener noreferrer">https://wiki.alpinelinux.org/wiki/KVM</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 基础</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add qemu-system-x86_64 libvirt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 32 位</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add qemu-system-i386</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果需要 GUI 管理</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add libvirt-daemon dbus polkit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果想用其他磁盘格式</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk add qemu-img</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 启用内核模块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe kvm-intel</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo kvm-intel >> /etc/modules</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果是 AMD</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># modprobe kvm-amd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 开机启用</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add libvirtd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add dbus</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># KVM 默认会桥接 NAT, 如果想使用默认的网络配置, 需要加载 tun 模块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe tun</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 添加用户到分组</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">addgroup $USER kvm</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">addgroup $USER qemu</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">addgroup $USER libvirt</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=virtual-disk>virtual-disk<a href=#virtual-disk class=hash-link aria-label="Direct link to virtual-disk" title="Direct link to virtual-disk" translate=no>​</a></h3>
<ul>
<li><a href=https://en.wikibooks.org/wiki/QEMU/Images target=_blank rel="noopener noreferrer">https://en.wikibooks.org/wiki/QEMU/Images</a></li>
<li>qemu-nbd
<ul>
<li>QEMU Disk Network Block Device Server</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe nbd max_part=16</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 链接</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">qemu-nbd -c /dev/nbd0 image.qcow2</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">partprobe /dev/nbd0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mount /dev/nbd0p1 /mnt/image</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">umount /mnt/image</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 断开连接</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">qemu-nbd -c /dev/nbd0</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=ftp>ftp<a href=#ftp class=hash-link aria-label="Direct link to ftp" title="Direct link to ftp" translate=no>​</a></h2>
<ul>
<li>Archlinux <a href=https://wiki.archlinux.org/index.php/Very_Secure_FTP_Daemon target=_blank rel="noopener noreferrer">vsftpd</a></li>
<li><a href=http://vsftpd.beasts.org/vsftpd_conf.html target=_blank rel="noopener noreferrer">vsftpd.conf</a></li>
<li><a href=https://security.appspot.com/vsftpd.html target=_blank rel="noopener noreferrer">https://security.appspot.com/vsftpd.html</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add vsftp</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改配置</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">nano /etc/vsftpd/vsftpd.conf</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 最简配置, 允许匿名操作</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.old</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo "</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">anonymous_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">write_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">anon_upload_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">anon_mkdir_write_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">dirmessage_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">xferlog_enable=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">xferlog_file=/dev/stdout</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">connect_from_port_20=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ftpd_banner=Welcome to wener FTP service.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">listen=YES</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">background=NO</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">" > /etc/vsftpd/vsftpd.conf</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=lvm>lvm<a href=#lvm class=hash-link aria-label="Direct link to lvm" title="Direct link to lvm" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add lvm2</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">modprobe dm-mod</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 扫描逻辑分组</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">vgscan</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 激活</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">vgchange -ay SangomaVG</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lvs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mount /dev/SangomaVG/root /mnt/data</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=libguestfs>libguestfs<a href=#libguestfs class=hash-link aria-label="Direct link to libguestfs" title="Direct link to libguestfs" translate=no>​</a></h2>
<ul>
<li><a href=https://en.wikipedia.org/wiki/Libguestfs target=_blank rel="noopener noreferrer">https://en.wikipedia.org/wiki/Libguestfs</a></li>
<li><a href=https://bugs.alpinelinux.org/issues/1792 target=_blank rel="noopener noreferrer">https://bugs.alpinelinux.org/issues/1792</a></li>
<li>会编译失败, 因为用了 glibc 特有的 printf 修饰符
<ul>
<li><a href=https://www.redhat.com/archives/libguestfs/2016-August/msg00002.html target=_blank rel="noopener noreferrer">https://www.redhat.com/archives/libguestfs/2016-August/msg00002.html</a></li>
<li>No support for glibc-style extended printf formatters.</li>
</ul>
</li>
</ul>
<pre tabindex=0 class="codeBlockStandalone_e_f0 thin-scrollbar language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><code class=codeBlockLines_NG8l></code></pre>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">guestfish: guest filesystem shell</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">guestfish lets you edit virtual machine filesystems</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Copyright (C) 2009-2016 Red Hat Inc.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Usage:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  guestfish [--options] cmd [: cmd : cmd ...]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Options:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -h|--cmd-help        List available commands</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -h|--cmd-help cmd    Display detailed help on 'cmd'</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -a|--add image       Add image</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -c|--connect uri     Specify libvirt URI for -d option</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --csh                Make --listen csh-compatible</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -d|--domain guest    Add disks from libvirt guest</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --echo-keys          Don't turn off echo for passphrases</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -f|--file file       Read commands from file</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --format[=raw|..]    Force disk format for -a option</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -i|--inspector       Automatically mount filesystems</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --keys-from-stdin    Read passphrases from stdin</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --listen             Listen for remote commands</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --live               Connect to a live virtual machine</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -m|--mount dev[:mnt[:opts[:fstype]]]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">                       Mount dev on mnt (if omitted, /)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --network            Enable network</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -N|--new [filename=]type</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">                       Create prepared disk (test&lt;N>.img or filename)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -n|--no-sync         Don't autosync</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --no-dest-paths      Don't tab-complete paths from guest fs</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --pipe-error         Pipe commands can detect write errors</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --progress-bars      Enable progress bars even when not interactive</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --no-progress-bars   Disable progress bars</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --remote[=pid]       Send commands to remote guestfish</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -r|--ro              Mount read-only</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --selinux            Enable SELinux support</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -v|--verbose         Verbose messages</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -V|--version         Display version and exit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -w|--rw              Mount read-write</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -x                   Echo each command before executing it</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">To examine a disk image, ISO, hard disk, filesystem etc:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  guestfish [--ro|--rw] -i -a /path/to/disk.img</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">or</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  guestfish [--ro|--rw] -i -d name-of-libvirt-domain</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">--ro recommended to avoid any writes to the disk image.  If -i option fails</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">run again without -i and use 'run' + 'list-filesystems' + 'mount' cmds.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">For more information, see the manpage guestfish(1).</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=acf>acf<a href=#acf class=hash-link aria-label="Direct link to acf" title="Direct link to acf" translate=no>​</a></h2>
<ul>
<li><a href=https://wiki.alpinelinux.org/wiki/Alpine_Configuration_Framework_Design target=_blank rel="noopener noreferrer">Alpine Configuration Framework Design</a></li>
<li><a href=https://wiki.alpinelinux.org/wiki/ACF_packages target=_blank rel="noopener noreferrer">ACF packages</a></li>
<li><a href="https://pkgs.alpinelinux.org/packages?name=acf-*&branch=v3.6&arch=x86_64" target=_blank rel="noopener noreferrer">acf-*</a></li>
</ul>
<pre tabindex=0 class="codeBlockStandalone_e_f0 thin-scrollbar language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><code class=codeBlockLines_NG8l></code></pre>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=crond>crond<a href=#crond class=hash-link aria-label="Direct link to crond" title="Direct link to crond" translate=no>​</a></h2>
<ul>
<li>实际执行时使用的 run-parts</li>
<li>busybox 自带的 run-parts 功能较少, 可额外安装</li>
</ul>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">echo 'CRON_OPTS="-c /etc/crontabs -L /var/log/crond.log -l 6"' > /etc/conf.d/crond</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update add crond</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service crond restart</span><br/></span></code></pre></div></div>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">BusyBox v1.26.2 (2017-10-04 13:37:41 GMT) multi-call binary.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Usage: run-parts [-a ARG]... [-u UMASK] [--reverse] [--test] [--exit-on-error] DIRECTORY</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Run a bunch of scripts in DIRECTORY</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	-a ARG		Pass ARG as argument to scripts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	-u UMASK	Set UMASK before running scripts</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	--reverse	Reverse execution order</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	--test		Dry run</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">	--exit-on-error	Exit if a script exits with non-zero</span><br/></span></code></pre></div></div>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">Usage: run-parts [OPTION]... DIRECTORY</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --test          print script names which would run, but don't run them.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --list          print names of all valid files (can not be used with</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">                      --test)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -v, --verbose       print script names before running them.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --report        print script names if they produce output.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --reverse       reverse execution order of scripts.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --exit-on-error exit as soon as a script returns with a non-zero exit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">                      code.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --lsbsysinit    validate filenames based on LSB sysinit specs.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --new-session   run each script in a separate process session</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">      --regex=PATTERN validate filenames based on POSIX ERE pattern PATTERN.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -u, --umask=UMASK   sets umask to UMASK (octal), default is 022.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -a, --arg=ARGUMENT  pass ARGUMENT to scripts, use once for each argument.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -V, --version       output version information and exit.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  -h, --help          display this help and exit.</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=wireguard>wireguard<a href=#wireguard class=hash-link aria-label="Direct link to wireguard" title="Direct link to wireguard" translate=no>​</a></h2>
<ul>
<li>3.8 还没有，需要使用 edge</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">qemu-img create -f raw edge-virt.raw 300M</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">wget https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.8/releases/x86_64/alpine-virt-3.8.2-x86_64.iso</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">qemu-system-x86_64 -m 2g -hda edge-virt.raw -net nic -net user,hostfwd=tcp::2222-:22 -cdrom alpine-virt-3.8.2-x86_64.iso -boot d</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Setup VM</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">setup-interfaces</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service networking restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">setup-sshd -c openssh</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo root:root | chpasswd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service sshd restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># From Host</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ssh-keygen -R [127.0.0.1]:2222</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ssh root@127.0.0.1 -p 2222</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo "http://mirrors.aliyun.com/alpine/edge/main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">http://mirrors.aliyun.com/alpine/edge/community</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">http://mirrors.aliyun.com/alpine/edge/testing" >> /etc/apk/repositories</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk update</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ERASE_DISKS=/dev/sda setup-disk -m sys -s 0 /dev/sda</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">poweroff</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=faq>FAQ<a href=#faq class=hash-link aria-label="Direct link to FAQ" title="Direct link to FAQ" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=ip-ioctl-0x8913-failed-no-such-device>ip: ioctl 0x8913 failed: no such device<a href=#ip-ioctl-0x8913-failed-no-such-device class=hash-link aria-label="Direct link to ip: ioctl 0x8913 failed: no such device" title="Direct link to ip: ioctl 0x8913 failed: no such device" translate=no>​</a></h3>
<ul>
<li>可能是网卡名字发生了改变</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=恢复网卡名字>恢复网卡名字<a href=#恢复网卡名字 class=hash-link aria-label="Direct link to 恢复网卡名字" title="Direct link to 恢复网卡名字" translate=no>​</a></h3>
<ul>
<li>安装 udev 后可能会出现, 因为 udev 可能会进行重命名</li>
<li>此时 eth0 可能就不存在了, 此时可能名字为 enp0s3 这样的</li>
<li>在 udev 中改变 if name 的为独立包, <code> eudev-netifnames</code>, 将该包移除即可
<ul>
<li><code>/lib/udev/rules.d/80-net-name-slot.rules</code></li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看网络设备名</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /proc/net/dev</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看网络控制器</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lspci | egrep -i --color 'network|ethernet'</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看网络相关硬件</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lshw -class network</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ifconfig -a</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip link show</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip a</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=文件系统变成了只读>文件系统变成了只读<a href=#文件系统变成了只读 class=hash-link aria-label="Direct link to 文件系统变成了只读" title="Direct link to 文件系统变成了只读" translate=no>​</a></h3>
<ul>
<li>看看 <code>/etc/fstab</code> 的 UUID 是否有多的,错误的或重复的</li>
<li>使用 df 查看当前挂载设备</li>
<li>blkid 查看设备 UUID</li>
<li>从新挂载为读写 <code>mount -rw -o remount UUID=&lt;正确的 UUID> /</code></li>
<li>修改 <code>/etc/fstab</code></li>
<li>重启</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=find-sysmodulepcc_cpufreq>find: /sys/module/pcc_cpufreq<a href=#find-sysmodulepcc_cpufreq class=hash-link aria-label="Direct link to find: /sys/module/pcc_cpufreq" title="Direct link to find: /sys/module/pcc_cpufreq" translate=no>​</a></h3>
<ul>
<li>查看 linux/cpufreq</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=traps-rc-status3854-general-protection>traps: rc-status[3854] general protection<a href=#traps-rc-status3854-general-protection class=hash-link aria-label="Direct link to traps: rc-status[3854] general protection" title="Direct link to traps: rc-status[3854] general protection" translate=no>​</a></h3>
<ul>
<li><code>rc-status sysinit</code> 时出现该异常</li>
<li><a href=https://github.com/OpenRC/openrc/issues/168 target=_blank rel="noopener noreferrer">OpenRC/openrc#168</a></li>
</ul>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">[ 6921.149981] traps: rc-status[3854] general protection ip:7ca2e00baa1b sp:7ecdf01d7038 error:0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 6921.149987]  in ld-musl-x86_64.so.1[7ca2e009d000+89000]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 6921.150003] grsec: From 192.168.11.29: Segmentation fault occurred at            (nil) in /bin/rc-status[rc-status:3854] uid/euid:0/0 gid/egid:0/0, parent /bin/bash[bash:3570] uid/euid:0/0 gid/egid:0/0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">[ 6921.150020] grsec: From 192.168.11.29: denied resource overstep by requesting 4096 for RLIMIT_CORE against limit 0 for /bin/rc-status[rc-status:3854] uid/euid:0/0 gid/egid:0/0, parent /bin/bash[bash:3570] uid/euid:0/0 gid/egid:0/0</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 生成转储的异常为 denied resource overstep by requesting 4096 for RLIMIT_CORE against limit 0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看当前的 limit</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ulimit -a</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 配置文件</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /etc/security/limits.conf</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># RLIMIT_CORE = 0 说明不能创建转储</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 针对当前会话设置, 再次调用时会生成 core 文件</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ulimit -c 4096</span><br/></span></code></pre></div></div>
<p>RLIMIT_AS //进程的最大虚内存空间，字节为单位。
RLIMIT_CORE //内核转存文件的最大长度。
RLIMIT_CPU //最大允许的 CPU 使用时间，秒为单位。当进程达到软限制，内核将给其发送 SIGXCPU 信号，这一信号的默认行为是终止进程的执行。然而，可以捕捉信号，处理句柄可将控制返回给主程序。如果进程继续耗费 CPU 时间，核心会以每秒一次的频率给其发送 SIGXCPU 信号，直到达到硬限制，那时将给进程发送 SIGKILL 信号终止其执行。
RLIMIT_DATA //进程数据段的最大值。
RLIMIT_FSIZE //进程可建立的文件的最大长度。如果进程试图超出这一限制时，核心会给其发送 SIGXFSZ 信号，默认情况下将终止进程的执行。
RLIMIT_LOCKS //进程可建立的锁和租赁的最大值。
RLIMIT_MEMLOCK //进程可锁定在内存中的最大数据量，字节为单位。
RLIMIT_MSGQUEUE //进程可为 POSIX 消息队列分配的最大字节数。
RLIMIT_NICE //进程可通过 setpriority() 或 nice()调用设置的最大完美值。
RLIMIT_NOFILE //指定比进程可打开的最大文件描述词大一的值，超出此值，将会产生 EMFILE 错误。
RLIMIT_NPROC //用户可拥有的最大进程数。
RLIMIT_RTPRIO //进程可通过 sched_setscheduler 和 sched_setparam 设置的最大实时优先级。
RLIMIT_SIGPENDING //用户可拥有的最大挂起信号数。
RLIMIT_STACK //最大的进程堆栈，以字节为单位。</p>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=ip-rtnetlink-answers-file-exists>ip: RTNETLINK answers: File exists<a href=#ip-rtnetlink-answers-file-exists class=hash-link aria-label="Direct link to ip: RTNETLINK answers: File exists" title="Direct link to ip: RTNETLINK answers: File exists" translate=no>​</a></h3>
<ul>
<li>ip addr add 时出现</li>
<li>usually indicates that a route already exists and you are trying to add it again.</li>
<li><a href=http://man7.org/linux/man-pages/man7/rtnetlink.7.html target=_blank rel="noopener noreferrer">rtnetlink.7</a>
<ul>
<li>Linux IPv4 routing socket</li>
</ul>
</li>
<li>网络启停时是依据 <code>/var/run/ifstate</code> 中的 if 状态进行操作</li>
<li>如果一开始停止失败, 那么就会导致启动是会, 导致实际的 if 状态和 ifstate 中的状态不一致</li>
<li><a href=https://www.thomas-krenn.com/en/wiki/Two_Default_Gateways_on_One_System target=_blank rel="noopener noreferrer">Two Default Gateways on One System</a></li>
<li>inetfaces 中只能指定一条 gateway
<ul>
<li>如果指定了多条会出现该异常</li>
</ul>
</li>
<li><a href=http://lartc.org/ target=_blank rel="noopener noreferrer">Linux Advanced Routing & Traffic Control</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 例如</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip addr add 192.168.8.182/255.255.252.0 broadcast 192.168.8.255 dev eth1 label eth1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 此时可以尝试</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip addr flush dev eth1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看实际操作</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">strace -e open ifup eth1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 直接添加 eth1=eth1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">nano /var/run/ifstate</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 然后就可以正常操作 ifup 和 ifdown 了</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=grsec-time-set-by-sbinhwclockhwclock2863>grsec: time set by /sbin/hwclock[hwclock:2863]<a href=#grsec-time-set-by-sbinhwclockhwclock2863 class=hash-link aria-label="Direct link to grsec: time set by /sbin/hwclock[hwclock:2863]" title="Direct link to grsec: time set by /sbin/hwclock[hwclock:2863]" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">[   14.977686] grsec: time set by /sbin/hwclock[hwclock:2863] uid/euid:0/0 gid/egid:0/0, parent /lib/rc/sh/openrc-run.sh[openrc-run.sh:2838] uid/euid:0/0 gid/egid:0/0</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=node-docker-seg-fault>node docker seg fault<a href=#node-docker-seg-fault class=hash-link aria-label="Direct link to node docker seg fault" title="Direct link to node docker seg fault" translate=no>​</a></h3>
<ul>
<li><a href=https://github.com/sass/node-sass/issues/2031 target=_blank rel="noopener noreferrer">sass/node-sass#2031</a> Segmentation fault on Node 8 alpine (docker)</li>
<li>是由于线程栈太小了导致</li>
<li>jubel-han 的 <a href=https://github.com/jubel-han/dockerfiles/blob/master/node/Dockerfile target=_blank rel="noopener noreferrer">Dockerfile</a> 提供了一个 LD_PRELOAD</li>
<li><a href=https://stackoverflow.com/q/426230/1870054 target=_blank rel="noopener noreferrer">What is the LD_PRELOAD trick?</a></li>
<li><a href=http://wiki.musl-libc.org/wiki/Functional_differences_from_glibc#Thread_stack_size target=_blank rel="noopener noreferrer">http://wiki.musl-libc.org/wiki/Functional_differences_from_glibc#Thread_stack_size</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=php-下-iconv-有问题>PHP 下 iconv 有问题<a href=#php-下-iconv-有问题 class=hash-link aria-label="Direct link to PHP 下 iconv 有问题" title="Direct link to PHP 下 iconv 有问题" translate=no>​</a></h3>
<p>Alpine 下 PHP 的 iconv 有问题 <a href=https://github.com/docker-library/php/issues/428 target=_blank rel="noopener noreferrer">https://github.com/docker-library/php/issues/428</a>
<a href=https://github.com/docker-library/php/issues/240 target=_blank rel="noopener noreferrer">https://github.com/docker-library/php/issues/240</a></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add --no-cache gnu-libiconv --repository http://mirrors.aliyun.com/alpine/edge/testing</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">LD_PRELOAD=/usr/lib/preloadable_libiconv.so php</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 或</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">export LD_PRELOAD="/usr/lib/preloadable_libiconv.so php"</span><br/></span></code></pre></div></div>
<div class="language-Dockerfile language-dockerfile codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-dockerfile codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">RUN apk add gnu-libiconv --no-cache --repository mirrors.aliyun.com/alpine/edge/testing</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ENV LD_PRELOAD /usr/lib/preloadable_libiconv.so php</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=rc-status-sysinit-异常>rc-status sysinit 异常<a href=#rc-status-sysinit-异常 class=hash-link aria-label="Direct link to rc-status sysinit 异常" title="Direct link to rc-status sysinit 异常" translate=no>​</a></h3>
<ul>
<li>可能是由于 zfs-zed 导致</li>
<li><a href=https://github.com/OpenRC/openrc/issues/168#issuecomment-349870167 target=_blank rel="noopener noreferrer">https://github.com/OpenRC/openrc/issues/168#issuecomment-349870167</a></li>
<li><a href=https://github.com/zfsonlinux/zfs/issues/6930 target=_blank rel="noopener noreferrer">https://github.com/zfsonlinux/zfs/issues/6930</a></li>
<li><a href=https://wiki.debian.org/LSBInitScripts target=_blank rel="noopener noreferrer">https://wiki.debian.org/LSBInitScripts</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=启动分区修复>启动分区修复<a href=#启动分区修复 class=hash-link aria-label="Direct link to 启动分区修复" title="Direct link to 启动分区修复" translate=no>​</a></h3>
<ol>
<li>mbr 坏了但分区是好的</li>
</ol>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">dd bs=440 conv=notrunc count=1 if=/usr/share/syslinux/mbr.bin of=/dev/sdc</span><br/></span></code></pre></div></div>
<ol start=2>
<li>启动分区坏了</li>
</ol>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看分区信息</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">file -s /dev/sdc1</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=tbd>TBD<a href=#tbd class=hash-link aria-label="Direct link to TBD" title="Direct link to TBD" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">[    0.013013] DMAR-IR: This system BIOS has enabled interrupt remapping</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">               on a chipset that contains an erratum making that</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">               feature unstable.  To maintain system stability</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">               interrupt remapping is being disabled.  Please</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">               contact your BIOS vendor for an update</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=install-utmpwtmp>install utmp/wtmp<a href=#install-utmpwtmp class=hash-link aria-label="Direct link to install utmp/wtmp" title="Direct link to install utmp/wtmp" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">apk add utmps</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># /run/utmp</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service utmpd start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service wtmpd start</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=ntpd>ntpd<a href=#ntpd class=hash-link aria-label="Direct link to ntpd" title="Direct link to ntpd" translate=no>​</a></h2>
<ul>
<li>推荐使用 chrony</li>
<li>busybox 的 ntpd 能用</li>
<li><a href=https://www.pool.ntp.org/zone/hk target=_blank rel="noopener noreferrer">https://www.pool.ntp.org/zone/hk</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># busybox openntpd chrony none</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">setup-ntp -c chrony</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看同步状态</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">adjtimex</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 停止旧的 ntpd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-update del ntpd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service ntpd stop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># busybox ntpd 手动同步</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ntpd -dn -N -p pool.ntp.org</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ntpd -dn -N -p 3.cn.pool.ntp.org</span><br/></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/notes/../notes/os/alpine/alpine-ops.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2024-05-31T05:40:08.000Z itemprop=dateModified>May 31, 2024</time></b> by <b>wener</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/notes/os/alpine/lbu><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Alpine local backup</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/notes/os/alpine/pkgs><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Alpine 包维护</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_wpyd thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#bash class="table-of-contents__link toc-highlight">bash</a><li><a href=#替换-apk-仓库镜像 class="table-of-contents__link toc-highlight">替换 apk 仓库镜像</a><li><a href=#manpages class="table-of-contents__link toc-highlight">manpages</a><li><a href=#基础运维 class="table-of-contents__link toc-highlight">基础运维</a><li><a href=#系统运维 class="table-of-contents__link toc-highlight">系统运维</a><li><a href=#硬件运维 class="table-of-contents__link toc-highlight">硬件运维</a><li><a href=#setup-disk class="table-of-contents__link toc-highlight">setup-disk</a><li><a href=#本地仓库 class="table-of-contents__link toc-highlight">本地仓库</a><li><a href=#容器 class="table-of-contents__link toc-highlight">容器</a><li><a href=#磁盘扩展 class="table-of-contents__link toc-highlight">磁盘扩展</a><li><a href=#udev class="table-of-contents__link toc-highlight">udev</a><li><a href=#zfs class="table-of-contents__link toc-highlight">zfs</a><ul><li><a href=#uninstall-zfs class="table-of-contents__link toc-highlight">uninstall zfs</a></ul><li><a href=#btrfs class="table-of-contents__link toc-highlight">btrfs</a><ul><li><a href=#failed-to-read-the-system-array class="table-of-contents__link toc-highlight">failed to read the system array</a></ul><li><a href=#networking class="table-of-contents__link toc-highlight">networking</a><li><a href=#network-benchmark class="table-of-contents__link toc-highlight">network benchmark</a><li><a href=#init class="table-of-contents__link toc-highlight">init</a><li><a href=#iscsi class="table-of-contents__link toc-highlight">iscsi</a><li><a href=#stress class="table-of-contents__link toc-highlight">stress</a><li><a href=#disk class="table-of-contents__link toc-highlight">disk</a><li><a href=#qemu class="table-of-contents__link toc-highlight">QEMU</a><ul><li><a href=#kvm class="table-of-contents__link toc-highlight">kvm</a><li><a href=#virtual-disk class="table-of-contents__link toc-highlight">virtual-disk</a></ul><li><a href=#ftp class="table-of-contents__link toc-highlight">ftp</a><li><a href=#lvm class="table-of-contents__link toc-highlight">lvm</a><li><a href=#libguestfs class="table-of-contents__link toc-highlight">libguestfs</a><li><a href=#acf class="table-of-contents__link toc-highlight">acf</a><li><a href=#crond class="table-of-contents__link toc-highlight">crond</a><li><a href=#wireguard class="table-of-contents__link toc-highlight">wireguard</a><li><a href=#faq class="table-of-contents__link toc-highlight">FAQ</a><ul><li><a href=#ip-ioctl-0x8913-failed-no-such-device class="table-of-contents__link toc-highlight">ip: ioctl 0x8913 failed: no such device</a><li><a href=#恢复网卡名字 class="table-of-contents__link toc-highlight">恢复网卡名字</a><li><a href=#文件系统�变成了只读 class="table-of-contents__link toc-highlight">文件系统变成了只读</a><li><a href=#find-sysmodulepcc_cpufreq class="table-of-contents__link toc-highlight">find: /sys/module/pcc_cpufreq</a><li><a href=#traps-rc-status3854-general-protection class="table-of-contents__link toc-highlight">traps: rc-status[3854] general protection</a><li><a href=#ip-rtnetlink-answers-file-exists class="table-of-contents__link toc-highlight">ip: RTNETLINK answers: File exists</a><li><a href=#grsec-time-set-by-sbinhwclockhwclock2863 class="table-of-contents__link toc-highlight">grsec: time set by /sbin/hwclock[hwclock:2863]</a><li><a href=#node-docker-seg-fault class="table-of-contents__link toc-highlight">node docker seg fault</a><li><a href=#php-下-iconv-有问题 class="table-of-contents__link toc-highlight">PHP 下 iconv 有问题</a><li><a href=#rc-status-sysinit-异常 class="table-of-contents__link toc-highlight">rc-status sysinit 异常</a><li><a href=#启动分区修复 class="table-of-contents__link toc-highlight">启动分区修复</a><li><a href=#tbd class="table-of-contents__link toc-highlight">TBD</a></ul><li><a href=#install-utmpwtmp class="table-of-contents__link toc-highlight">install utmp/wtmp</a><li><a href=#ntpd class="table-of-contents__link toc-highlight">ntpd</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2025 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2025-10-09 13:46</div></div></div></footer></div></body>