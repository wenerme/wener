<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-os/linux/fs/zfs/zfs-tuning" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>ZFS 调优 | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/notes/os/linux/fs/zfs/tuning /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="ZFS 调优 | Wener Live & Life"/><meta data-rh=true name=description content="- 提升 应用性能 - 针对工作负载调优 - recordsize，logbias、sync=off"/><meta data-rh=true property=og:description content="- 提升 应用性能 - 针对工作负载调优 - recordsize，logbias、sync=off"/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/notes/os/linux/fs/zfs/tuning /><link data-rh=true rel=alternate href=https://wener.me/notes/os/linux/fs/zfs/tuning hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/notes/os/linux/fs/zfs/tuning hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://wener.me/notes/os/","name":"操作系统","position":1},{"@type":"ListItem","item":"https://wener.me/notes/os/linux/fs/","name":"FS","position":2},{"@type":"ListItem","item":"https://wener.me/notes/os/linux/fs/zfs/","name":"ZFS","position":3},{"@type":"ListItem","item":"https://wener.me/notes/os/linux/fs/zfs/tuning","name":"ZFS 调优","position":4}]}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.1c95f9ff.js defer></script><script src=/assets/js/main.8891074e.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/notes>笔记</a><a class="navbar__item navbar__link" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class=docsWrapper_oymo><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ZPA9" type=button></button><div class=docRoot_ng2Q><aside class="theme-doc-sidebar-container docSidebarContainer_nyHU"><div class=sidebarViewport_rLoj><div class=sidebar_TmDF><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jRin"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes><span title=笔记 class=linkLabel_JPPZ>笔记</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/adobe/photoshop><span title=adobe class=categoryLinkLabel_RkOu>adobe</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ai><span title=AI class=categoryLinkLabel_RkOu>AI</span></a><button aria-label="Expand sidebar category 'AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/algorithm><span title=算法 class=categoryLinkLabel_RkOu>算法</span></a><button aria-label="Expand sidebar category '算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/blockchain><span title=区块链 class=categoryLinkLabel_RkOu>区块链</span></a><button aria-label="Expand sidebar category '区块链'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/cn><span title=CN class=categoryLinkLabel_RkOu>CN</span></a><button aria-label="Expand sidebar category 'CN'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/courses><span title=课程 class=categoryLinkLabel_RkOu>课程</span></a><button aria-label="Expand sidebar category '课程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/culture><span title=文化 class=categoryLinkLabel_RkOu>文化</span></a><button aria-label="Expand sidebar category '文化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/db><span title=数据库 class=categoryLinkLabel_RkOu>数据库</span></a><button aria-label="Expand sidebar category '数据库'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/dev><span title=开发 class=categoryLinkLabel_RkOu>开发</span></a><button aria-label="Expand sidebar category '开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/devops><span title=DevOps class=categoryLinkLabel_RkOu>DevOps</span></a><button aria-label="Expand sidebar category 'DevOps'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/economics><span title=经济学 class=categoryLinkLabel_RkOu>经济学</span></a><button aria-label="Expand sidebar category '经济学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/electrical><span title=电学基础 class=categoryLinkLabel_RkOu>电学基础</span></a><button aria-label="Expand sidebar category '电学基础'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/embedded/arduino><span title=embedded class=categoryLinkLabel_RkOu>embedded</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/evolve><span title=自我成长 class=categoryLinkLabel_RkOu>自我成长</span></a><button aria-label="Expand sidebar category '自我成长'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/hardware><span title=硬件 class=categoryLinkLabel_RkOu>硬件</span></a><button aria-label="Expand sidebar category '硬件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/healthcare><span title=健康 class=categoryLinkLabel_RkOu>健康</span></a><button aria-label="Expand sidebar category '健康'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/howto/network/dns-prevent-spoofing><span title=howto class=categoryLinkLabel_RkOu>howto</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/java><span title=Java class=categoryLinkLabel_RkOu>Java</span></a><button aria-label="Expand sidebar category 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/languages><span title=语言 class=categoryLinkLabel_RkOu>语言</span></a><button aria-label="Expand sidebar category '语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes/linguistics><span title=Linguistics class=linkLabel_JPPZ>Linguistics</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/math><span title=数学 class=categoryLinkLabel_RkOu>数学</span></a><button aria-label="Expand sidebar category '数学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/mgmt><span title=管理 class=categoryLinkLabel_RkOu>管理</span></a><button aria-label="Expand sidebar category '管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/network/application/dict><span title=network class=categoryLinkLabel_RkOu>network</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ops><span title=运维 class=categoryLinkLabel_RkOu>运维</span></a><button aria-label="Expand sidebar category '运维'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" href=/notes/os><span title=操作系统 class=categoryLinkLabel_RkOu>操作系统</span></a><button aria-label="Collapse sidebar category '操作系统'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/alpine><span title=Alpine class=categoryLinkLabel_RkOu>Alpine</span></a><button aria-label="Expand sidebar category 'Alpine'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/android><span title=Android class=categoryLinkLabel_RkOu>Android</span></a><button aria-label="Expand sidebar category 'Android'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/archlinux><span title=ArchLinux class=linkLabel_JPPZ>ArchLinux</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/bsd><span title=BSD class=categoryLinkLabel_RkOu>BSD</span></a><button aria-label="Expand sidebar category 'BSD'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/busybox><span title=Busybox class=categoryLinkLabel_RkOu>Busybox</span></a><button aria-label="Expand sidebar category 'Busybox'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/centos><span title=CentOS class=categoryLinkLabel_RkOu>CentOS</span></a><button aria-label="Expand sidebar category 'CentOS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/chromeos><span title=ChromeOS class=linkLabel_JPPZ>ChromeOS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/darwin><span title=Darwin class=linkLabel_JPPZ>Darwin</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/debian><span title=Debian class=categoryLinkLabel_RkOu>Debian</span></a><button aria-label="Expand sidebar category 'Debian'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/device/auto><span title=device class=categoryLinkLabel_RkOu>device</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/dual-system><span title="Dual System Boot" class=linkLabel_JPPZ>Dual System Boot</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/freebsd><span title=FreeBSD class=linkLabel_JPPZ>FreeBSD</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/fuchsia><span title=Fuchsia class=linkLabel_JPPZ>Fuchsia</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/lakka><span title="lakka tv" class=linkLabel_JPPZ>lakka tv</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/libreelec><span title=LibreELEC class=linkLabel_JPPZ>LibreELEC</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/notes/os/linux/admin><span title=linux class=categoryLinkLabel_RkOu>linux</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/admin><span title="Linux Admin" class=categoryLinkLabel_RkOu>Linux Admin</span></a><button aria-label="Expand sidebar category 'Linux Admin'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/alsa><span title="ALSA (Advanced Linux Sound Architecture)" class=linkLabel_JPPZ>ALSA (Advanced Linux Sound Architecture)</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/boot><span title="Linux Boot" class=categoryLinkLabel_RkOu>Linux Boot</span></a><button aria-label="Expand sidebar category 'Linux Boot'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/build><span title=Build class=linkLabel_JPPZ>Build</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/chrony><span title=chrony class=linkLabel_JPPZ>chrony</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/cluster/awesome><span title=cluster class=categoryLinkLabel_RkOu>cluster</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/coreutils><span title=coreutils class=linkLabel_JPPZ>coreutils</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/desktop><span title="Linux 桌面环境综述 (Linux Desktop Overview)" class=categoryLinkLabel_RkOu>Linux 桌面环境综述 (Linux Desktop Overview)</span></a><button aria-label="Expand sidebar category 'Linux 桌面环境综述 (Linux Desktop Overview)'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/dev><span title="Linux Device" class=categoryLinkLabel_RkOu>Linux Device</span></a><button aria-label="Expand sidebar category 'Linux Device'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/embedded><span title="Linux 嵌入式开发 (Embedded Linux)" class=linkLabel_JPPZ>Linux 嵌入式开发 (Embedded Linux)</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/os/linux/fs><span title=FS class=categoryLinkLabel_RkOu>FS</span></a><button aria-label="Collapse sidebar category 'FS'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/bcachefs><span title=bcachefs class=linkLabel_JPPZ>bcachefs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/bindfs><span title=bind class=linkLabel_JPPZ>bind</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/btrfs><span title=Btrfs class=linkLabel_JPPZ>Btrfs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/cifs><span title=CIFS class=linkLabel_JPPZ>CIFS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/erofs><span title=erofs class=linkLabel_JPPZ>erofs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/exfat><span title=exFAT class=linkLabel_JPPZ>exFAT</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/ext4><span title=ext4 class=linkLabel_JPPZ>ext4</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/f2fs><span title=f2fs class=linkLabel_JPPZ>f2fs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/ext><span title="file extname" class=linkLabel_JPPZ>file extname</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/faq><span title=文件系统常见问题 class=linkLabel_JPPZ>文件系统常见问题</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/hierarchy><span title="Filesystem Hierarchy Standard" class=linkLabel_JPPZ>Filesystem Hierarchy Standard</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/fuse><span title=FUSE class=linkLabel_JPPZ>FUSE</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/ksmbd><span title=KSMBD class=linkLabel_JPPZ>KSMBD</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/fs/nfs><span title=NFS class=categoryLinkLabel_RkOu>NFS</span></a><button aria-label="Expand sidebar category 'NFS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/ntfs><span title=NTFS class=linkLabel_JPPZ>NTFS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/raid><span title=RAID class=linkLabel_JPPZ>RAID</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/rootfs><span title=rootfs class=linkLabel_JPPZ>rootfs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/sfdisk><span title=sfdisk class=linkLabel_JPPZ>sfdisk</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/smb><span title=SMB class=linkLabel_JPPZ>SMB</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/os/linux/fs/zfs><span title=ZFS class=categoryLinkLabel_RkOu>ZFS</span></a><button aria-label="Collapse sidebar category 'ZFS'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/sanoid><span title=sanoid class=linkLabel_JPPZ>sanoid</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/admin><span title="ZFS 管理" class=linkLabel_JPPZ>ZFS 管理</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/awesome><span title="ZFS Awesome" class=linkLabel_JPPZ>ZFS Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/cli><span title="ZFS 命令行" class=linkLabel_JPPZ>ZFS 命令行</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/draid><span title=dRAID class=linkLabel_JPPZ>dRAID</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/faq><span title="ZFS 常见问题" class=linkLabel_JPPZ>ZFS 常见问题</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/inside><span title=Inside class=linkLabel_JPPZ>Inside</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/ops><span title="ZFS Ops" class=linkLabel_JPPZ>ZFS Ops</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/postgresql><span title="PostgreSQL & ZFS" class=linkLabel_JPPZ>PostgreSQL & ZFS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/snapshot><span title="ZFS Snapshot" class=linkLabel_JPPZ>ZFS Snapshot</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/stat><span title=Stat class=linkLabel_JPPZ>Stat</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/notes/os/linux/fs/zfs/tuning><span title="ZFS 调优" class=linkLabel_JPPZ>ZFS 调优</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs/zfs/version><span title="OpenZFS Version" class=linkLabel_JPPZ>OpenZFS Version</span></a></ul></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/fs><span title="分区类型代码 (Partition Type Codes)" class=linkLabel_JPPZ>分区类型代码 (Partition Type Codes)</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/hardware/dmidecode><span title=hardware class=categoryLinkLabel_RkOu>hardware</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/hostname><span title=hostname class=linkLabel_JPPZ>hostname</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/init/awesome><span title=init class=categoryLinkLabel_RkOu>init</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/libc><span title=libc class=categoryLinkLabel_RkOu>libc</span></a><button aria-label="Expand sidebar category 'libc'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/awesome><span title="Linux Awesome" class=linkLabel_JPPZ>Linux Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/default><span title=推荐默认设置 class=linkLabel_JPPZ>推荐默认设置</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/faq><span title="Linux FAQ" class=linkLabel_JPPZ>Linux FAQ</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/glossary><span title="Linux Glossary" class=linkLabel_JPPZ>Linux Glossary</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/hardening><span title="Linux 安全加固" class=linkLabel_JPPZ>Linux 安全加固</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/pam><span title="Linux PAM" class=linkLabel_JPPZ>Linux PAM</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/version><span title="Linux Releases" class=linkLabel_JPPZ>Linux Releases</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/mpp/opencl><span title=mpp class=categoryLinkLabel_RkOu>mpp</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/network><span title="Linux 网络" class=categoryLinkLabel_RkOu>Linux 网络</span></a><button aria-label="Expand sidebar category 'Linux 网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/ntp><span title=NTP class=linkLabel_JPPZ>NTP</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/partition><span title=Partition class=linkLabel_JPPZ>Partition</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/pm/nix><span title=pm class=categoryLinkLabel_RkOu>pm</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/posix><span title=POSIX class=linkLabel_JPPZ>POSIX</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/security/chmod><span title=security class=categoryLinkLabel_RkOu>security</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/selinux><span title=selinux class=linkLabel_JPPZ>selinux</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/service/incron><span title=service class=categoryLinkLabel_RkOu>service</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/shell/bash><span title=shell class=categoryLinkLabel_RkOu>shell</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/signal><span title=Signal class=linkLabel_JPPZ>Signal</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/linux/stat><span title=stat class=categoryLinkLabel_RkOu>stat</span></a><button aria-label="Expand sidebar category 'stat'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/linux/sys/audit><span title=sys class=categoryLinkLabel_RkOu>sys</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux/util-linux><span title=util-linux class=linkLabel_JPPZ>util-linux</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/linux-distro><span title="Linux 发行版列表与比较 (Linux Distributions List & Comparison)" class=linkLabel_JPPZ>Linux 发行版列表与比较 (Linux Distributions List & Comparison)</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/macos><span title=macOS class=categoryLinkLabel_RkOu>macOS</span></a><button aria-label="Expand sidebar category 'macOS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/mips><span title="MIPS 架构" class=linkLabel_JPPZ>MIPS 架构</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/mobile><span title=手机 class=linkLabel_JPPZ>手机</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/network><span title=网络设备系统 class=categoryLinkLabel_RkOu>网络设备系统</span></a><button aria-label="Expand sidebar category '网络设备系统'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/openbsd><span title=OpenBSD class=linkLabel_JPPZ>OpenBSD</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/awesome><span title="OS Awesome" class=linkLabel_JPPZ>OS Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/faq><span title="OS FAQ" class=linkLabel_JPPZ>OS FAQ</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/glossary><span title="OS Glossary" class=linkLabel_JPPZ>OS Glossary</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/os/rhel/anaconda><span title=rhel class=categoryLinkLabel_RkOu>rhel</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/os/synology><span title=Synology class=linkLabel_JPPZ>Synology</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/ubuntu><span title="Ubuntu Server Guide" class=categoryLinkLabel_RkOu>Ubuntu Server Guide</span></a><button aria-label="Expand sidebar category 'Ubuntu Server Guide'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/virt><span title=虚拟化 class=categoryLinkLabel_RkOu>虚拟化</span></a><button aria-label="Expand sidebar category '虚拟化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/os/windows><span title="Windows OS" class=categoryLinkLabel_RkOu>Windows OS</span></a><button aria-label="Expand sidebar category 'Windows OS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/philosophy><span title=理念 class=categoryLinkLabel_RkOu>理念</span></a><button aria-label="Expand sidebar category '理念'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/photography><span title=摄影 class=categoryLinkLabel_RkOu>摄影</span></a><button aria-label="Expand sidebar category '摄影'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/platform><span title=平台 class=categoryLinkLabel_RkOu>平台</span></a><button aria-label="Expand sidebar category '平台'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/psychology/mbti><span title=psychology class=categoryLinkLabel_RkOu>psychology</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/queue><span title=Queue class=categoryLinkLabel_RkOu>Queue</span></a><button aria-label="Expand sidebar category 'Queue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/security><span title=安全 class=categoryLinkLabel_RkOu>安全</span></a><button aria-label="Expand sidebar category '安全'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/service><span title=服务 class=categoryLinkLabel_RkOu>服务</span></a><button aria-label="Expand sidebar category '服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/software><span title=软件 class=categoryLinkLabel_RkOu>软件</span></a><button aria-label="Expand sidebar category '软件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/std><span title=标准数据 class=categoryLinkLabel_RkOu>标准数据</span></a><button aria-label="Expand sidebar category '标准数据'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/voip><span title=VoIP class=categoryLinkLabel_RkOu>VoIP</span></a><button aria-label="Expand sidebar category 'VoIP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/web><span title=Web class=categoryLinkLabel_RkOu>Web</span></a><button aria-label="Expand sidebar category 'Web'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_NY7h"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c8nQ><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_GAGP><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YQ1L"><div class=docItemContainer_Wjg4><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_tiqF" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_WTWT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/os><span>操作系统</span></a><li class=breadcrumbs__item><span class=breadcrumbs__link>linux</span><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/os/linux/fs><span>FS</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/os/linux/fs/zfs><span>ZFS</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>ZFS 调优</span></ul></nav><div class="tocCollapsible_GvsH theme-doc-toc-mobile tocMobile_qJgM"><button type=button class="clean-btn tocCollapsibleButton_LnP0">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZFS Tuning</h1></header>
<div class="theme-admonition theme-admonition-tip admonition_phik alert alert--success"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>目的</div><div class=admonitionContent_R6P7><ul>
<li>提升 应用性能 - 针对工作负载调优 - recordsize，logbias、sync=off</li>
<li>提升 读 - cache、内存</li>
<li>提升 写 - slog、zfs_txg_timeout</li>
<li>提升 空间使用率 - 压缩、recordsize、draid</li>
<li>提升 安全 - 热备、冷备、sync</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-caution admonition_phik alert alert--warning"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>caution</div><div class=admonitionContent_R6P7><ul>
<li>slog 不是 write buffer</li>
</ul></div></div>
<ul>
<li>/proc/spl/kstat/zfs/main/iostats</li>
<li>/sys/module/zfs/parameters
<ul>
<li>ZFS 内核模块参数</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_phik alert alert--success"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_R6P7><ul>
<li>使用机械盘时，建议配备一个 SSD 分两个区，一个做 SLOG 一个做 L2ARC - 并增加 zfs_txg_timeout</li>
<li>compressratio 受 recordsize 影响
<ul>
<li><a href=https://github.com/openzfs/zfs/discussions/11293 target=_blank rel="noopener noreferrer">https://github.com/openzfs/zfs/discussions/11293</a></li>
</ul>
</li>
<li>总是开启 compression</li>
</ul></div></div>



































<table><thead><tr><th>zpool prop<th>default<th>recommand<tbody><tr><td>ashift<td>0<td>12<tr><td>atime<td>on<td>off<tr><td>recordsize<td>128K<td><tr><td>logbias<td>latency<td><tr><td>autotrim<td>off<td>SDD 推荐 on</table>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">zdb | grep ashift # 查看使用的 ashift</span><br/></span></code></pre></div></div>
<ul>
<li>ashift
<ul>
<li>2^n - block size/sector size</li>
<li>匹配底层物理 sector size</li>
<li>0 为自动检测</li>
<li>一般为 12 - 4K</li>
</ul>
</li>
</ul>
<hr/>
<ul>
<li>source
<ul>
<li>default</li>
<li>temporary
<ul>
<li>临时挂载点属性 - 会映射到 mount</li>
</ul>
</li>
<li>inherited from</li>
<li>local</li>
</ul>
</li>
<li>xattrs=on
<ul>
<li>存储扩展信息到隐藏目录，访问文件时需要额外 lookup</li>
</ul>
</li>
<li>xattr=sa
<ul>
<li>存储扩展信息到 inode</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set compression=lz4 data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set atime=off data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set relatime=on data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set xattr=sa data</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 断电可能丢失一定数据</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set sync=disabled POOL</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># primarycache=metadata - 看情况</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set atime=off relatime=on xattr=sa compression=lz4 sync=disabled POOL</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get all POOL | grep -E 'compression|atime|xattr|sync|primarycache|recordsize'</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=zil-slog>ZIL SLOG<a href=#zil-slog class=hash-link aria-label="Direct link to ZIL SLOG" title="Direct link to ZIL SLOG" translate=no>​</a></h2>
<ul>
<li>ZIL - ZFS Intent Log
<ul>
<li>短期存储</li>
<li>ZIL 默认存在于硬盘上的特殊区域 - 产生双写 - 先写 ZIL 在写回到磁盘区域</li>
<li>不会使用 ZIL 的场景
<ul>
<li>logbias=throughput</li>
<li><strong>大块</strong> - 例如： 数据同步时不会用到</li>
</ul>
</li>
<li><strong>只用于系统 crash 恢复</strong></li>
</ul>
</li>
<li>SLOG - Separate ZFS Intent Log
<ul>
<li>ZIL 存储于额外的磁盘</li>
<li>替代存储磁盘上的 ZIL - 避免双写</li>
<li><strong>不是写缓存</strong></li>
<li>用不了多少空间
<ul>
<li>一般 16G 或 32G 足矣</li>
<li>max amount of write traffic per second x 15</li>
<li>TXG commit interval - transaction group commit interval - 5s-10s
<ul>
<li>zfs_txg_synctime</li>
<li>增加 事务 延时来增加使用的 slog</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_phik alert alert--success"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_R6P7><p>小的写操作会先聚合重排序，然后一次性写入，此时使用 SLOG 能提升性能<ul>
<li>避免 write IOPS amplification</li>
</ul><p><strong>无 SLOG</strong><ul>
<li>async write -> TXG RAM -> ZPool</li>
<li>sync write -> TXG RAM & ZIL</li>
<li>TXG RAM -> ZPool</li>
</ul><p><strong>有 SLOG</strong><ul>
<li>sync write -> TXG RAM & SLOG</li>
<li>系统恢复时 SLOG -> TXG RAM -> replay TXG -> ZPool</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=sync>sync<a href=#sync class=hash-link aria-label="Direct link to sync" title="Direct link to sync" translate=no>​</a></h3>
<ul>
<li>sync=standard
<ul>
<li>POSIX-compatible</li>
<li>synchronous only if requested</li>
<li>部分情况会写入到 slog</li>
</ul>
</li>
<li>sync=always
<ul>
<li>主要保障数据安全</li>
<li>有些不支持 journal 的 DB 必须要 sync</li>
<li>slog 很快 可以考虑</li>
<li>会强制先写入到 log 设备 - <strong>不会增加性能</strong></li>
</ul>
</li>
<li>sync=disabled - sync=never, sync=off
<ul>
<li>让写入更快</li>
<li>忽略 O_SYNC</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># txg 提交间隔 - 5秒</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /sys/module/zfs/parameters/zfs_txg_timeout</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 增加 slog 使用量, 180s 提交一次</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo 180 | sudo tee /sys/module/zfs/parameters/zfs_txg_timeout</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 持久化</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo "options zfs zfs_txg_timeout=180" | sudo tee /etc/modprobe.d/zfs.conf</span><br/></span></code></pre></div></div>





















































<table><thead><tr><th>parameter<th>default<th>prefer<th>note<tbody><tr><td>zfs_txg_timeout<td>5<td>120<td>强制提交 Transaction Group (TXG) 的时间间隔,更大的值可以聚合更多数据<tr><td>---<td><td><td><tr><td>zfs_dirty_data_max<td>10% RAM<td><td><tr><td>zfs_dirty_data_max_percent<td>10% RAM<td><td><tr><td>zfs_dirty_data_sync_percent<td>20<td><td>达到 zfs_dirty_data_max 比例后出发 sync<tr><td>zfs_dirty_data_max_max<td>25% RAM<td><td><tr><td>zfs_dirty_data_max_max_percent<td>25% RAM<td><td></table>
<ul>
<li><a href=https://jrs-s.net/2019/05/02/zfs-sync-async-zil-slog/ target=_blank rel="noopener noreferrer">https://jrs-s.net/2019/05/02/zfs-sync-async-zil-slog/</a></li>
<li><a href=https://www.truenas.com/blog/zfs-zil-and-slog-demystified/ target=_blank rel="noopener noreferrer">https://www.truenas.com/blog/zfs-zil-and-slog-demystified/</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=logbias>logbias<a href=#logbias class=hash-link aria-label="Direct link to logbias" title="Direct link to logbias" translate=no>​</a></h2>
<ul>
<li>logbias=latency
<ul>
<li>无 SLOG，block 较大能提升性能</li>
</ul>
</li>
<li>logbias=throughput
<ul>
<li>小 block 写入产生非常多碎片</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">zfs send dataset > /dev/null</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool iostat -r 1</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://bun.uptrace.dev/postgres/tuning-zfs-aws-ebs.html#logbias target=_blank rel="noopener noreferrer">https://bun.uptrace.dev/postgres/tuning-zfs-aws-ebs.html#logbias</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=ashift>ashift<a href=#ashift class=hash-link aria-label="Direct link to ashift" title="Direct link to ashift" translate=no>​</a></h2>

































<table><thead><tr><th style=text-align:right>ashift<th style=text-align:right>sector<tbody><tr><td style=text-align:right>9<td style=text-align:right>512 B<tr><td style=text-align:right>10<td style=text-align:right>1 KB<tr><td style=text-align:right>11<td style=text-align:right>2 KB<tr><td style=text-align:right>12<td style=text-align:right>4 KB<tr><td style=text-align:right>13<td style=text-align:right>8 KB<tr><td style=text-align:right>14<td style=text-align:right>16 KB</table>
<ul>
<li>12=4KB - 常用的 PageSize</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=l2arc>L2ARC<a href=#l2arc class=hash-link aria-label="Direct link to L2ARC" title="Direct link to L2ARC" translate=no>​</a></h2>
<ul>
<li>读缓存</li>
<li>ARC 为内存</li>
<li>L2ARC 为 cache 设备</li>
<li>之前是覆盖写</li>
<li>目前支持 TRIM - <a href=https://github.com/zfsonlinux/zfs/pull/9789 target=_blank rel="noopener noreferrer">https://github.com/zfsonlinux/zfs/pull/9789</a>
<ul>
<li>l2arc_trim_ahead - 需要时多 trim 多少</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 可查看 SSD trim 支持情况</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool status -t</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 触发 pool</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool trim pool</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=磁盘信息>磁盘信息<a href=#磁盘信息 class=hash-link aria-label="Direct link to 磁盘信息" title="Direct link to 磁盘信息" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># sector size</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># phy sector size</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">blockdev --getss --getpbsz /dev/sda</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /sys/block/sd{a,b}/queue/{logical_block_size,physical_block_size,optimal_io_size}</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://github.com/bradfa/flashbench target=_blank rel="noopener noreferrer">bradfa/flashbench</a>
<ul>
<li>检测闪存的 block size</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=atime-on-temporary>atime on temporary<a href=#atime-on-temporary class=hash-link aria-label="Direct link to atime on temporary" title="Direct link to atime on temporary" translate=no>​</a></h2>
<p>atime 总是为 on</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=zfs_vdev_mirror_rotating_inc>zfs_vdev_mirror_rotating_inc<a href=#zfs_vdev_mirror_rotating_inc class=hash-link aria-label="Direct link to zfs_vdev_mirror_rotating_inc" title="Direct link to zfs_vdev_mirror_rotating_inc" translate=no>​</a></h2>
<ul>
<li>mirror ssd + hdd
<ul>
<li>保留读性能</li>
<li>写性能无法保障</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=ssd-trim>SSD TRIM<a href=#ssd-trim class=hash-link aria-label="Direct link to SSD TRIM" title="Direct link to SSD TRIM" translate=no>​</a></h2>
<ul>
<li><code>zpool set autotrim=on</code> + cron <code>zpool trim</code></li>
<li><a href=https://github.com/openzfs/zfs/commit/1b939560be5c51deecf875af9dada9d094633bf7 target=_blank rel="noopener noreferrer">https://github.com/openzfs/zfs/commit/1b939560be5c51deecf875af9dada9d094633bf7</a></li>
<li><a href=https://openzfs.github.io/openzfs-docs/man/8/zpool-trim.8.html target=_blank rel="noopener noreferrer">https://openzfs.github.io/openzfs-docs/man/8/zpool-trim.8.html</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=参考>参考<a href=#参考 class=hash-link aria-label="Direct link to 参考" title="Direct link to 参考" translate=no>​</a></h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=1Wo3i2gkAIk" target=_blank rel="noopener noreferrer">How the ZFS Adaptive Replacement Cache works</a>
<ul>
<li><strong>Free RAM is wasted RAM</strong></li>
<li>ARC 维护 LRU,LFU</li>
<li>缓存 fs 和 metadata - metadata 默认 25% cache</li>
<li>Compress ARC - 存储更多缓存</li>
<li>block - 512b - 16MB</li>
<li>基于内存压力调整使用的缓存量 - adaptive</li>
<li>tuning
<ul>
<li>file server - 大 ARC, 缓存更多 metadata, 可考虑 L2ARC</li>
<li>block storage/iSCSI - 大 ARC, 配置 volblocksize</li>
<li>Database/A - 小 ARC, 只缓存 metadata, large db buffer cache</li>
<li>Database/B - 中 ARC, 只缓存 metadata, small db buffer cache, compression 能让 ARC 命中更多缓存</li>
<li>Hypervisor - 中小 ARC, 为 VM 预留内存, 避免双缓存</li>
</ul>
</li>
</ul>
</li>
<li><a href=https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Workload%20Tuning.html target=_blank rel="noopener noreferrer">Workload Tuning</a>
<ul>
<li>PosstgreSQL - <a href=https://vadosware.io/post/everything-ive-seen-on-optimizing-postgres-on-zfs-on-linux/ target=_blank rel="noopener noreferrer">Everything I've seen on optimizing Postgres on ZFS</a>
<ul>
<li>recordsize=8K</li>
<li>logbias=throughput</li>
</ul>
</li>
<li>MySQL InnoDB
<ul>
<li>recordsize=16K</li>
<li>primarycache=metadata</li>
<li>logbias=throughput</li>
<li>my.cnf
<ul>
<li>skip-innodb_doublewrite</li>
<li>innodb_use_native_aio=0</li>
<li>innodb_use_atomic_writes=0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href=https://www.delphix.com/blog/delphix-engineering/zfs-raidz-stripe-width-or-how-i-learned-stop-worrying-and-love-raidz target=_blank rel="noopener noreferrer">ZFS RAIDZ stripe width, or: How I Learned to Stop Worrying and Love RAIDZ</a></li>
<li><a href=https://www.unixarena.com/2013/07/zfs-how-to-extend-zpool-and-re-layout.html target=_blank rel="noopener noreferrer">ZFS – How to Extend ZPOOL and Re-layout ?</a></li>
<li><a href=https://docs.oracle.com/cd/E23824_01/html/821-1448/ftyue.html target=_blank rel="noopener noreferrer">ZFS Terminology</a></li>
<li><a href=https://docs.google.com/spreadsheets/d/1pdu_X2tR4ztF6_HLtJ-Dc4ZcwUdt6fkCjpnXxAEFlyA target=_blank rel="noopener noreferrer">ZFS overhead calc.xlsx</a></li>
<li><a href=https://blogs.oracle.com/roch/tuning-zfs-recordsize target=_blank rel="noopener noreferrer">Tuning ZFS recordsize</a></li>
<li><a href=https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Module%20Parameters.html target=_blank rel="noopener noreferrer">Module Parameters</a></li>
<li><a href=https://calomel.org/freebsd_network_tuning.html target=_blank rel="noopener noreferrer">https://calomel.org/freebsd_network_tuning.html</a></li>
<li><a href=https://docs.freebsd.org/en/books/handbook/zfs/#zfs-advanced-tuning target=_blank rel="noopener noreferrer">https://docs.freebsd.org/en/books/handbook/zfs/#zfs-advanced-tuning</a>
\n## Tuning Reference\n</li>
</ul>
<hr/>
<p>id: zfs-tuning
title: 调优</p>
<hr/>
<h1>ZFS Tuning</h1>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=raidz>RAIDZ<a href=#raidz class=hash-link aria-label="Direct link to RAIDZ" title="Direct link to RAIDZ" translate=no>​</a></h2>
<p><a href=https://serverfault.com/a/1021299/190601 target=_blank rel="noopener noreferrer">https://serverfault.com/a/1021299/190601</a></p>
<p>record size 默认 128KiB
Valid options are 512b to 1024KiB in powers of 2.
sector size / ashift = 512/4096
zfs set recordsize=64k mypool/myfs</p>
<p>ARC Adaptive Replacement Cache</p>
<p>cat /proc/spl/kstat/zfs/arcstats
c 目标 arc
c_max 最大 arc
size 当前 arc</p>
<p>modprobe zfs zfs_arc_max=N
/sys/module/zfs/parameters/zfs_arc_max</p>
<p>awk '/^size/ { print <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>1</mn><mi mathvariant=normal>"</mi><mi mathvariant=normal>"</mi></mrow><annotation encoding=application/x-tex>1 " " </annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.6944em></span><span class=mord>1""</span></span></span></span>3 / 1048576 }' &lt; /proc/spl/kstat/zfs/arcstats</p>
<p><a href=https://superuser.com/a/1137417/242730 target=_blank rel="noopener noreferrer">https://superuser.com/a/1137417/242730</a>
<a href=https://github.com/openzfs/zfs/blob/384328e544b1847236a07df231e1b7b10e4cc6ce/cmd/arc_summary/arc_summary.py target=_blank rel="noopener noreferrer">https://github.com/openzfs/zfs/blob/384328e544b1847236a07df231e1b7b10e4cc6ce/cmd/arc_summary/arc_summary.py</a></p>
<ul>
<li><a href=http://open-zfs.org/wiki/Performance_tuning target=_blank rel="noopener noreferrer">Performance tuning</a>
<a href=https://docs.oracle.com/cd/E18752_01/html/819-5461/ftyue.html target=_blank rel="noopener noreferrer">https://docs.oracle.com/cd/E18752_01/html/819-5461/ftyue.html</a></li>
</ul>















<table><thead><tr><th>属性<th>默认<th>说明<tbody><tr><td>recordsize<td>128K<td>内部 COW 的基本单位, 可选值 x^2 can be set to any power of 2 from 512 bytes to 128 kilobytes</table>
<p>zdb</p>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=recordsize>recordsize<a href=#recordsize class=hash-link aria-label="Direct link to recordsize" title="Direct link to recordsize" translate=no>​</a></h3>
<p>内部 COW 的基本单位
可选值 x^2
对新的文件生效</p>
<p>ZFS: Performance and Capacity Impact of Ashift=9 on 4K Sector Drives
<a href=http://louwrentius.com/zfs-performance-and-capacity-impact-of-ashift9-on-4k-sector-drives.html target=_blank rel="noopener noreferrer">http://louwrentius.com/zfs-performance-and-capacity-impact-of-ashift9-on-4k-sector-drives.html</a></p>
<p>ZAP (ZFS Attribute Processor)</p>
<p>basic unit of data used for internal copy-on-write on files</p>
<p>read from either ARC (cheap) or disk (expensive)</p>
<ul>
<li><a href=https://wiki.freebsd.org/ZFSTuningGuide target=_blank rel="noopener noreferrer">https://wiki.freebsd.org/ZFSTuningGuide</a></li>
<li><a href=http://fibrevillage.com/storage/171-zfs-on-linux-performance-tuning target=_blank rel="noopener noreferrer">http://fibrevillage.com/storage/171-zfs-on-linux-performance-tuning</a></li>
</ul>
<p>Introducing ZFS Properties
<a href=https://docs.oracle.com/cd/E53394_01/html/E54801/gazss.html target=_blank rel="noopener noreferrer">https://docs.oracle.com/cd/E53394_01/html/E54801/gazss.html</a></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 设置和查看 dedup</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 开启 dedup 后只对新写入的数据有效</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set dedup=on main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get dedup main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Simulated DDT histogram</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 模拟使用 dedup 会带来的好处</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zdb -S main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 获取 pool 的 dedup 率</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool get dedupratio main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看 dedup 状态</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Total allocated blocks 实际使用大小 Total referenced blocks 去重前的大小</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 内存占用 DDT entries 2530438, size 682B on disk, 151B in core = 2530438*151/1024/1024 = 364m</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zpool status -D main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#  dedup: DDT entries 2530438, size 682B on disk, 151B in core</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># bucket              allocated                       referenced</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ______   ______________________________   ______________________________</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># refcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ------   ------   -----   -----   -----   ------   -----   -----   -----</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#      1    2.37M    285G    276G    276G    2.37M    285G    276G    276G</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#      2    42.5K   5.30G   5.18G   5.18G    92.5K   11.5G   11.3G   11.3G</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#      4    2.01K    255M    239M    239M    8.89K   1.10G   1.04G   1.04G</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#      8      444   55.5M   54.1M   54.0M    4.74K    606M    594M    594M</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#     16      108   13.5M   13.5M   13.5M    2.21K    282M    282M    282M</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">#  Total    2.41M    290G    281G    282G    2.47M    298G    289G    289G</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># atime - 上次访问时间, 一般不需要, 并且非常影响读性能</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set atime=off main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># relatime - atime 的折中方案, 类似于 ext4/xfs atime 语义, 只有在修改时间或更新时间变化时更新 atime, 或者现在的 atime 有 24h 未更新</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 只有在开启 atime 时才会生效</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set atime=on relatime=on main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># compression - 压缩, 默认 lz4, 可选值 on, off, zstd, lzjb, lz4, gzip, gzip-N</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 目前设置为 lzjb, gzip, or gzip-N 等同于设置为 on</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 属性可缩写为 compress</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 设置压缩后只对新的数据有影响</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set compression=lz4 main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 只读属性, 获取当前的压缩率</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get compressratio main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># logbias - 控制 zfs 如何优化同步请求, 默认 latency</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># latency 以优化延迟为主, 使用额外的日志设备来处理</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># throughput 不会使用额外的日志设备</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 在没有 log 设备时, 默认会在 pool 上预留部分空间用于存储 ZIL, zfs 使用 ZIL 用于崩溃恢复</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set logbias=all main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 但数据库一般都会直接做同步操作, 开启该功能相当于对磁盘进行两次提交, 影响性能</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 在非数据库文件系统和一级配置了 log 设备的文件系统上, 设置这个可能对性能有不好的影响</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set logbias=throughput main/postgres</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># recordsize - 推荐块大小, 默认情况下, 使用默认值即可, 默认 128KiB</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 可使用缩写  recsize</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 该属性主要针对数据库设计, 每次访问文件都是固定大小. ZFS 会根据内部算法自动调整块大小, 数据库会创建比较大的文件, 但每次访问都是非常小的随机块.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 但针对数据库, 建议使用数据库记录大小, 大多数关系型数据库都是 8K 的块</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set recordsize=8K main/postgres</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get recordsize main/archive</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># primarycache - 控制什么会被缓存在主要缓存中 ARC, 默认 all 可选值 all, none, metadata</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 一般数据库都会用自己的方式实现缓存, 因此没有必要让 zfs 再缓存数据</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs set primarycache=metadata main/postgres</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># secondarycache - 控制什么会进入到二级缓存 L2ARC, 默认 all, 可选值  all, none, metadata</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get secondarycache main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># type - 只读, 获取数据集类型 filesystem, volume, 或 snapshot.</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get type main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># used - 只读, 获取已使用空间</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get used main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># available - 只读, 可用空间</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get available main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># creation - 只读, 创建时间</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get creation main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mounted - 只读, 是否已经挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mountpoint - 挂载点</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># quota - 限额</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># readonly - 是否只读</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># version - 只读, 磁盘文件系统版本, 独立于 pool 版本</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get version main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># xattr - 是否启用扩展属性</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get xattr main</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 所有配置参数</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ======</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">zfs get all p1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># NAME  PROPERTY              VALUE           SOURCE</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    type                  filesystem      -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    creation              1507714508      -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    used                  400K            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    available             138M            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    referenced            128K            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    compressratio         1.00x           -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    mounted               yes             -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    quota                 none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    reservation           none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    recordsize            128K            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    mountpoint            /mnt/data       local</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    sharenfs              off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    checksum              on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    compression           off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    atime                 on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    devices               on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    exec                  on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    setuid                on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    readonly              off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    zoned                 off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    snapdir               hidden          default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    aclinherit            restricted      default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    canmount              on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    xattr                 on              default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    copies                1               default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    version               5               -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    utf8only              off             -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    normalization         none            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    casesensitivity       sensitive       -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    vscan                 off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    nbmand                off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    sharesmb              off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    refquota              none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    refreservation        none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    primarycache          all             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    secondarycache        all             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    usedbysnapshots       0               -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    usedbydataset         128K            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    usedbychildren        272K            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    usedbyrefreservation  0               -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    logbias               latency         default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    dedup                 off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    mlslabel              none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    sync                  standard        default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    refcompressratio      1.00x           -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    written               128K            -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    logicalused           92.5K           -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    logicalreferenced     40K             -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    filesystem_limit      none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    snapshot_limit        none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    filesystem_count      none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    snapshot_count        none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    snapdev               hidden          default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    acltype               off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    context               none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    fscontext             none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    defcontext            none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    rootcontext           none            default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    relatime              off             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    redundant_metadata    all             default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># p1    overlay               off             default</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=tuning>Tuning<a href=#tuning class=hash-link aria-label="Direct link to Tuning" title="Direct link to Tuning" translate=no>​</a></h2>
<ul>
<li><a href=https://github.com/openzfs/zfs/issues/9375 target=_blank rel="noopener noreferrer">#9375</a> - Subpar performance of RAIDZ, reads are slower than writes</li>
<li><a href=https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/ZFS%20on%20Linux%20Module%20Parameters.html target=_blank rel="noopener noreferrer">模块参数</a></li>
<li><a href=https://openzfs.github.io/openzfs-docs/man/8/zfs.8.html target=_blank rel="noopener noreferrer">zfs.8</a></li>
<li><a href=https://openzfs.github.io/openzfs-docs/man/8/zfsprops.8.html target=_blank rel="noopener noreferrer">zfsprops.8</a></li>
<li><a href=https://openzfs.github.io/openzfs-docs/man/8/zpoolprops.8.html target=_blank rel="noopener noreferrer">zpoolprops.8</a></li>
</ul>
<p>zpool get -o all all main | egrep 'ashift'
zfs get all main/data | egrep 'ashift|relatime|canmount|compression|xattr|dnodesize|acltype|normalization'</p>
<p>ashift=12
relatime=on
canmount=off
compression=lz4
xattr=sa
dnodesize=auto
acltype=posixacl
normalization=formD</p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># https://jrs-s.net/2018/03/13/zvol-vs-qcow2-with-kvm/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 4k 随机</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># randread - 随机读</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">fio --name=random-write --ioengine=sync --iodepth=4 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --rw=randwrite --bs=4k --direct=0 --size=256m --numjobs=2 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --end_fsync=1</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=result>RESULT<a href=#result class=hash-link aria-label="Direct link to RESULT" title="Direct link to RESULT" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=raidz1-randwrite-4k-x-2>raidz1 randwrite 4k x 2<a href=#raidz1-randwrite-4k-x-2 class=hash-link aria-label="Direct link to raidz1 randwrite 4k x 2" title="Direct link to raidz1 randwrite 4k x 2" translate=no>​</a></h3>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">fio --name=random-write --ioengine=sync --iodepth=4 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --rw=randwrite --bs=4k --direct=0 --size=256m --numjobs=2 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --end_fsync=1</span><br/></span></code></pre></div></div>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">Jobs: 1 (f=1): [F(1),_(1)][100.0%][w=232MiB/s][w=59.5k IOPS][eta 00m:00s]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">random-write: (groupid=0, jobs=1): err= 0: pid=27959: Thu Jul 16 00:22:03 2020</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  write: IOPS=2338, BW=9353KiB/s (9578kB/s)(256MiB/28027msec); 0 zone resets</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    clat (usec): min=4, max=495041, avg=415.40, stdev=4703.61</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     lat (usec): min=4, max=495042, avg=415.48, stdev=4703.63</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    clat percentiles (usec):</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     |  1.00th=[     5],  5.00th=[     5], 10.00th=[     5], 20.00th=[     6],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 30.00th=[     6], 40.00th=[     6], 50.00th=[     6], 60.00th=[     6],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 70.00th=[     6], 80.00th=[     7], 90.00th=[    12], 95.00th=[    54],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 99.00th=[ 13042], 99.50th=[ 20841], 99.90th=[ 67634], 99.95th=[ 82314],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 99.99th=[149947]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">   bw (  KiB/s): min=   71, max=14744, per=4.02%, avg=751.23, stdev=2173.43, samples=47</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">   iops        : min=   17, max= 3686, avg=187.70, stdev=543.36, samples=47</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (usec)   : 10=89.76%, 20=2.80%, 50=2.36%, 100=2.50%, 250=0.21%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (usec)   : 500=0.23%, 750=0.02%, 1000=0.01%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (msec)   : 2=0.03%, 4=0.09%, 10=0.81%, 20=0.65%, 50=0.38%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (msec)   : 100=0.12%, 250=0.04%, 500=0.01%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  cpu          : usr=0.33%, sys=3.28%, ctx=2037, majf=0, minf=13</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     issued rwts: total=0,65536,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=4</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">random-write: (groupid=0, jobs=1): err= 0: pid=27960: Thu Jul 16 00:22:03 2020</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  write: IOPS=3768, BW=14.7MiB/s (15.4MB/s)(256MiB/17392msec); 0 zone resets</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    clat (usec): min=4, max=122329, avg=253.68, stdev=2705.38</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     lat (usec): min=4, max=122329, avg=253.78, stdev=2705.40</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    clat percentiles (usec):</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     |  1.00th=[    5],  5.00th=[    5], 10.00th=[    5], 20.00th=[    6],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 30.00th=[    6], 40.00th=[    6], 50.00th=[    6], 60.00th=[    6],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 70.00th=[    7], 80.00th=[   15], 90.00th=[   20], 95.00th=[   57],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 99.00th=[10159], 99.50th=[18220], 99.90th=[39584], 99.95th=[52167],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     | 99.99th=[82314]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">   bw (  KiB/s): min=  312, max=209976, per=45.19%, avg=8454.06, stdev=36298.89, samples=33</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">   iops        : min=   78, max=52494, avg=2113.52, stdev=9074.72, samples=33</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (usec)   : 10=78.23%, 20=13.08%, 50=2.80%, 100=4.46%, 250=0.05%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (usec)   : 500=0.18%, 750=0.01%, 1000=0.01%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (msec)   : 2=0.01%, 4=0.01%, 10=0.16%, 20=0.59%, 50=0.37%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  lat (msec)   : 100=0.05%, 250=0.01%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  cpu          : usr=0.65%, sys=5.59%, ctx=1290, majf=0, minf=12</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     issued rwts: total=0,65536,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=4</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">Run status group 0 (all jobs):</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  WRITE: bw=18.3MiB/s (19.2MB/s), 9353KiB/s-14.7MiB/s (9578kB/s-15.4MB/s), io=512MiB (537MB), run=17392-28027msec</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=raidz1-seqwrite-512k-x-2>raidz1 seqwrite 512k x 2<a href=#raidz1-seqwrite-512k-x-2 class=hash-link aria-label="Direct link to raidz1 seqwrite 512k x 2" title="Direct link to raidz1 seqwrite 512k x 2" translate=no>​</a></h3>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">fio --name=seq-write --ioengine=libaio --iodepth=4 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --rw=seqread --bs=4k --direct=0 --size=256m --numjobs=2 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --end_fsync=1</span><br/></span></code></pre></div></div>
<p><a href=https://superuser.com/questions/1137416/how-can-i-determine-the-current-size-of-the-arc-in-zfs-and-how-does-the-arc-rel target=_blank rel="noopener noreferrer">https://superuser.com/questions/1137416/how-can-i-determine-the-current-size-of-the-arc-in-zfs-and-how-does-the-arc-rel</a>
<a href=https://www.unixarena.com/2013/07/zfs-zpool-cache-and-log-devices.html/ target=_blank rel="noopener noreferrer">https://www.unixarena.com/2013/07/zfs-zpool-cache-and-log-devices.html/</a></p>
<p>缓存使用情况
zpool iostat -v</p>
<p>ZFS Caches:
ZFS Caching mechanisms will also use LRU (Least Recently Used) caching algorithm which is used processor caching technology. ZFS has two type of caches.1.ZFS ARC 2.ZFS L2ARC</p>
<p>ZFS ARC:
ZFS Adjustable Replacement Cache will typically occupy 7/8 of available physical memory and this memory will be released for applications whenever required, ZFS ARC will adjust the memory usage according to the kernel needs.</p>
<p>ZFS L2ARC:
ZFS L2ARC is level 2 adjustable replacement cache and normally L2ARC resides on fastest LUNS or SSD.L2ARC Cache devices provide an additional layer of caching between main memory and disk.It increases the great performance of random-read workloads of static content.Here we will see how to setup L2ARC on physical disks.</p>
<p><a href=https://www.servethehome.com/zfs-on-ubuntu-create-zfs-pool-with-nvme-l2arc-and-share-via-smb/ target=_blank rel="noopener noreferrer">https://www.servethehome.com/zfs-on-ubuntu-create-zfs-pool-with-nvme-l2arc-and-share-via-smb/</a></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/notes/../notes/os/linux/fs/zfs/zfs-tuning.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2026-01-03T14:49:30.000Z itemprop=dateModified>Jan 3, 2026</time></b> by <b>wener</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/notes/os/linux/fs/zfs/stat><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Stat</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/notes/os/linux/fs/zfs/version><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>OpenZFS Version</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_wpyd thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#zil-slog class="table-of-contents__link toc-highlight">ZIL SLOG</a><ul><li><a href=#sync class="table-of-contents__link toc-highlight">sync</a></ul><li><a href=#logbias class="table-of-contents__link toc-highlight">logbias</a><li><a href=#ashift class="table-of-contents__link toc-highlight">ashift</a><li><a href=#l2arc class="table-of-contents__link toc-highlight">L2ARC</a><li><a href=#磁盘信息 class="table-of-contents__link toc-highlight">磁盘信息</a><li><a href=#atime-on-temporary class="table-of-contents__link toc-highlight">atime on temporary</a><li><a href=#zfs_vdev_mirror_rotating_inc class="table-of-contents__link toc-highlight">zfs_vdev_mirror_rotating_inc</a><li><a href=#ssd-trim class="table-of-contents__link toc-highlight">SSD TRIM</a><li><a href=#参考 class="table-of-contents__link toc-highlight">参考</a><li><a href=#raidz class="table-of-contents__link toc-highlight">RAIDZ</a><ul><li><a href=#recordsize class="table-of-contents__link toc-highlight">recordsize</a></ul><li><a href=#tuning class="table-of-contents__link toc-highlight">Tuning</a><li><a href=#result class="table-of-contents__link toc-highlight">RESULT</a><ul><li><a href=#raidz1-randwrite-4k-x-2 class="table-of-contents__link toc-highlight">raidz1 randwrite 4k x 2</a><li><a href=#raidz1-seqwrite-512k-x-2 class="table-of-contents__link toc-highlight">raidz1 seqwrite 512k x 2</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2026 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2026-03-02 13:32</div></div></div></footer></div></body>