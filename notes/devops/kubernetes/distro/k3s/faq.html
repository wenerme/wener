<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devops/kubernetes/distro/k3s/k3s-faq" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>K3S 常见问题 | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/notes/devops/kubernetes/distro/k3s/faq /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="K3S 常见问题 | Wener Live & Life"/><meta data-rh=true name=description content="- 尽量指定固定的 node-ip"/><meta data-rh=true property=og:description content="- 尽量指定固定的 node-ip"/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/notes/devops/kubernetes/distro/k3s/faq /><link data-rh=true rel=alternate href=https://wener.me/notes/devops/kubernetes/distro/k3s/faq hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/notes/devops/kubernetes/distro/k3s/faq hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://wener.me/notes/devops/","name":"DevOps","position":1},{"@type":"ListItem","item":"https://wener.me/notes/devops/kubernetes/","name":"Kubernetes","position":2},{"@type":"ListItem","item":"https://wener.me/notes/devops/kubernetes/distro/","name":"发行版","position":3},{"@type":"ListItem","item":"https://wener.me/notes/devops/kubernetes/distro/k3s/","name":"K3S","position":4},{"@type":"ListItem","item":"https://wener.me/notes/devops/kubernetes/distro/k3s/faq","name":"K3S 常见问题","position":5}]}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.72c320db.js defer></script><script src=/assets/js/main.c07313b6.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/notes>笔记</a><a class="navbar__item navbar__link" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class=docsWrapper_oymo><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ZPA9" type=button></button><div class=docRoot_ng2Q><aside class="theme-doc-sidebar-container docSidebarContainer_nyHU"><div class=sidebarViewport_rLoj><div class=sidebar_TmDF><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jRin"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes><span title=笔记 class=linkLabel_JPPZ>笔记</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/adobe/photoshop><span title=adobe class=categoryLinkLabel_RkOu>adobe</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ai><span title=AI class=categoryLinkLabel_RkOu>AI</span></a><button aria-label="Expand sidebar category 'AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/algorithm><span title=算法 class=categoryLinkLabel_RkOu>算法</span></a><button aria-label="Expand sidebar category '算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/blockchain><span title=区块链 class=categoryLinkLabel_RkOu>区块链</span></a><button aria-label="Expand sidebar category '区块链'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/cn><span title=CN class=categoryLinkLabel_RkOu>CN</span></a><button aria-label="Expand sidebar category 'CN'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/courses><span title=课程 class=categoryLinkLabel_RkOu>课程</span></a><button aria-label="Expand sidebar category '课程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/culture><span title=文化 class=categoryLinkLabel_RkOu>文化</span></a><button aria-label="Expand sidebar category '文化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/db><span title=数据库 class=categoryLinkLabel_RkOu>数据库</span></a><button aria-label="Expand sidebar category '数据库'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/dev><span title=开发 class=categoryLinkLabel_RkOu>开发</span></a><button aria-label="Expand sidebar category '开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" href=/notes/devops><span title=DevOps class=categoryLinkLabel_RkOu>DevOps</span></a><button aria-label="Collapse sidebar category 'DevOps'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/container><span title=容器 class=categoryLinkLabel_RkOu>容器</span></a><button aria-label="Expand sidebar category '容器'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/awesome><span title="DevOps Awesome" class=linkLabel_JPPZ>DevOps Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/faq><span title="DevOps 常见问题" class=linkLabel_JPPZ>DevOps 常见问题</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/glossary><span title="DevOps Glossary" class=linkLabel_JPPZ>DevOps Glossary</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/docker><span title=Docker class=categoryLinkLabel_RkOu>Docker</span></a><button aria-label="Expand sidebar category 'Docker'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/dotenv><span title=dotenv class=linkLabel_JPPZ>dotenv</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/gomplate><span title=gomplate class=linkLabel_JPPZ>gomplate</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/infra><span title=基础设施 class=categoryLinkLabel_RkOu>基础设施</span></a><button aria-label="Expand sidebar category '基础设施'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/devops/kubernetes><span title=Kubernetes class=categoryLinkLabel_RkOu>Kubernetes</span></a><button aria-label="Collapse sidebar category 'Kubernetes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/devops/kubernetes/app/cookbook><span title=app class=categoryLinkLabel_RkOu>app</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/cncf><span title=CNCF class=linkLabel_JPPZ>CNCF</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/dev><span title="Kubernetes 开发" class=categoryLinkLabel_RkOu>Kubernetes 开发</span></a><button aria-label="Expand sidebar category 'Kubernetes 开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/devops/kubernetes/distro><span title=发行版 class=categoryLinkLabel_RkOu>发行版</span></a><button aria-label="Collapse sidebar category '发行版'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/autok3s><span title=autok3s class=linkLabel_JPPZ>autok3s</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/distro/k0s><span title=k0s class=categoryLinkLabel_RkOu>k0s</span></a><button aria-label="Expand sidebar category 'k0s'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/devops/kubernetes/distro/k3s><span title=K3S class=categoryLinkLabel_RkOu>K3S</span></a><button aria-label="Collapse sidebar category 'K3S'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/k3d><span title="K3S in Docker" class=linkLabel_JPPZ>K3S in Docker</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/centos><span title=Centos class=linkLabel_JPPZ>Centos</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/conf><span title="K3S 配置" class=linkLabel_JPPZ>K3S 配置</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/cookbook><span title="K3S Cookbook" class=linkLabel_JPPZ>K3S Cookbook</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/notes/devops/kubernetes/distro/k3s/faq><span title="K3S 常见问题" class=linkLabel_JPPZ>K3S 常见问题</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/install><span title=Install class=linkLabel_JPPZ>Install</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/upgrade><span title="K3S 升级" class=linkLabel_JPPZ>K3S 升级</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/version><span title="K3S Version" class=linkLabel_JPPZ>K3S Version</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/k3s/k3sos><span title=K3SOS class=linkLabel_JPPZ>K3SOS</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/kine><span title=kine class=linkLabel_JPPZ>kine</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/distro/sealos><span title=sealos class=linkLabel_JPPZ>sealos</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/internal><span title="Kubernetes Internal" class=categoryLinkLabel_RkOu>Kubernetes Internal</span></a><button aria-label="Expand sidebar category 'Kubernetes Internal'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/awesome><span title="K8S Awesome" class=linkLabel_JPPZ>K8S Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/dashboard><span title="Kubernates 面板" class=linkLabel_JPPZ>Kubernates 面板</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/event><span title=Event class=linkLabel_JPPZ>Event</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/faq><span title="K8S 常见问题" class=linkLabel_JPPZ>K8S 常见问题</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/feature><span title=MountPropagation class=linkLabel_JPPZ>MountPropagation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/features><span title="K8S Features" class=linkLabel_JPPZ>K8S Features</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/glossary><span title="K8S 词汇表" class=linkLabel_JPPZ>K8S 词汇表</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/my-practice><span title="我的 K8S 实践" class=linkLabel_JPPZ>我的 K8S 实践</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/story><span title="K8S 使用经验" class=linkLabel_JPPZ>K8S 使用经验</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/kubernetes/version><span title="Kubernetes 版本" class=linkLabel_JPPZ>Kubernetes 版本</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/network><span title="Kubernates 网络" class=categoryLinkLabel_RkOu>Kubernates 网络</span></a><button aria-label="Expand sidebar category 'Kubernates 网络'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/devops/kubernetes/ops/helm><span title=ops class=categoryLinkLabel_RkOu>ops</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/platform><span title="K8S 平台" class=categoryLinkLabel_RkOu>K8S 平台</span></a><button aria-label="Expand sidebar category 'K8S 平台'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/kubernetes/storage><span title="Kubernates 存储" class=categoryLinkLabel_RkOu>Kubernates 存储</span></a><button aria-label="Expand sidebar category 'Kubernates 存储'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/devops/metrics/altermanager><span title=metrics class=categoryLinkLabel_RkOu>metrics</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/service><span title=服务 class=categoryLinkLabel_RkOu>服务</span></a><button aria-label="Expand sidebar category '服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/sla><span title=SLA class=linkLabel_JPPZ>SLA</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/sre><span title=SRE class=linkLabel_JPPZ>SRE</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/status><span title=Status class=linkLabel_JPPZ>Status</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/storage><span title=Storage class=categoryLinkLabel_RkOu>Storage</span></a><button aria-label="Expand sidebar category 'Storage'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/telementry><span title=Telementry class=linkLabel_JPPZ>Telementry</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/devops/upgrade><span title=系统升级 class=linkLabel_JPPZ>系统升级</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/devops/web><span title=Web class=categoryLinkLabel_RkOu>Web</span></a><button aria-label="Expand sidebar category 'Web'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/devops/xaas/db-schema><span title=xaas class=categoryLinkLabel_RkOu>xaas</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/economics><span title=经济学 class=categoryLinkLabel_RkOu>经济学</span></a><button aria-label="Expand sidebar category '经济学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/electrical><span title=电学基础 class=categoryLinkLabel_RkOu>电学基础</span></a><button aria-label="Expand sidebar category '电学基础'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/embedded/awesome><span title=embedded class=categoryLinkLabel_RkOu>embedded</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/evolve><span title=自我成长 class=categoryLinkLabel_RkOu>自我成长</span></a><button aria-label="Expand sidebar category '自我成长'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/hardware><span title=硬件 class=categoryLinkLabel_RkOu>硬件</span></a><button aria-label="Expand sidebar category '硬件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/healthcare><span title=健康 class=categoryLinkLabel_RkOu>健康</span></a><button aria-label="Expand sidebar category '健康'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/howto/network/dns-prevent-spoofing><span title=howto class=categoryLinkLabel_RkOu>howto</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/java><span title=Java class=categoryLinkLabel_RkOu>Java</span></a><button aria-label="Expand sidebar category 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/languages><span title=语言 class=categoryLinkLabel_RkOu>语言</span></a><button aria-label="Expand sidebar category '语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes/linguistics><span title=Linguistics class=linkLabel_JPPZ>Linguistics</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/math><span title=数学 class=categoryLinkLabel_RkOu>数学</span></a><button aria-label="Expand sidebar category '数学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/mgmt><span title=管理 class=categoryLinkLabel_RkOu>管理</span></a><button aria-label="Expand sidebar category '管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/network/application/dns><span title=network class=categoryLinkLabel_RkOu>network</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ops><span title=运维 class=categoryLinkLabel_RkOu>运维</span></a><button aria-label="Expand sidebar category '运维'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/os><span title=操作系��统 class=categoryLinkLabel_RkOu>操作系统</span></a><button aria-label="Expand sidebar category '操作系统'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/philosophy><span title=理念 class=categoryLinkLabel_RkOu>理念</span></a><button aria-label="Expand sidebar category '理念'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/photography><span title=摄影 class=categoryLinkLabel_RkOu>摄影</span></a><button aria-label="Expand sidebar category '摄影'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/platform><span title=平台 class=categoryLinkLabel_RkOu>平台</span></a><button aria-label="Expand sidebar category '平台'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/psychology/glossary><span title=psychology class=categoryLinkLabel_RkOu>psychology</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/queue><span title=Queue class=categoryLinkLabel_RkOu>Queue</span></a><button aria-label="Expand sidebar category 'Queue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/security><span title=安全 class=categoryLinkLabel_RkOu>安全</span></a><button aria-label="Expand sidebar category '安全'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/service><span title=服务 class=categoryLinkLabel_RkOu>服务</span></a><button aria-label="Expand sidebar category '服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/software><span title=软件 class=categoryLinkLabel_RkOu>软件</span></a><button aria-label="Expand sidebar category '软件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/std><span title=标准数据 class=categoryLinkLabel_RkOu>标准数据</span></a><button aria-label="Expand sidebar category '标准数据'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/voip><span title=VoIP class=categoryLinkLabel_RkOu>VoIP</span></a><button aria-label="Expand sidebar category 'VoIP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/web><span title=Web class=categoryLinkLabel_RkOu>Web</span></a><button aria-label="Expand sidebar category 'Web'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_NY7h"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c8nQ><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_GAGP><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YQ1L"><div class=docItemContainer_Wjg4><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_tiqF" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_WTWT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/devops><span>DevOps</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/devops/kubernetes><span>Kubernetes</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/devops/kubernetes/distro><span>发行版</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/devops/kubernetes/distro/k3s><span>K3S</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>K3S 常见问题</span></ul></nav><div class="tocCollapsible_GvsH theme-doc-toc-mobile tocMobile_qJgM"><button type=button class="clean-btn tocCollapsibleButton_LnP0">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>K3S 常见问题</h1></header>
<div class="theme-admonition theme-admonition-caution admonition_phik alert alert--warning"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>caution</div><div class=admonitionContent_R6P7><ul>
<li>尽量指定固定的 node-ip
<ul>
<li>避免因网络迁移导致集群不可用</li>
<li>同时影响 tls</li>
<li>node.spec.addresses
<ul>
<li>type: InternalIP</li>
</ul>
</li>
</ul>
</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-网络结构>K3S 网络结构<a href=#k3s-网络结构 class=hash-link aria-label="Direct link to K3S 网络结构" title="Direct link to K3S 网络结构" translate=no>​</a></h2>
<ul>
<li>容器 10.42.0.0/16 - 可以 ping 通</li>
<li>服务 10.43.0.0/16 - 不可以 ping</li>
<li>每个节点一个 /24 网络 - 也就是说最多 255 个节点</li>
<li>每个节点最多获取到 255 个 容器 IP 和 服务 IP
<ul>
<li>默认限制每个节点 110 个 Pod - 一般来说是足够的</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_phik alert alert--warning"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>caution</div><div class=admonitionContent_R6P7><ul>
<li>使用 host-gw, 重启/重建 tun 设备后路由丢失，目前通过重启 k3s 服务解决。
<ul>
<li><a href=https://github.com/flannel-io/flannel/issues/1070 target=_blank rel="noopener noreferrer">flannel-io/flannel#1070</a></li>
</ul>
</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=访问-k3s-的-etcd>访问 K3S 的 ETCD<a href=#访问-k3s-的-etcd class=hash-link aria-label="Direct link to 访问 K3S 的 ETCD" title="Direct link to 访问 K3S 的 ETCD" translate=no>​</a></h2>
<ul>
<li>只支持部分接口</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># kine 不支持 --keys-only</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ETCDCTL_API=3 etcdctl --endpoints=unix:///var/lib/rancher/k3s/server/kine.sock get /registry/clusterrolebindings/system:kube-dns</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 所有</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ETCDCTL_API=3 etcdctl --endpoints=unix:///var/lib/rancher/k3s/server/kine.sock get / --prefix</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=dns-问题>DNS 问题<a href=#dns-问题 class=hash-link aria-label="Direct link to DNS 问题" title="Direct link to DNS 问题" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">nslookup kubernetes.default</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 确保网络正常</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ping 1.1.1.1</span><br/></span></code></pre></div></div>
<ul>
<li>确保 coredns 能联网</li>
<li>kube-dns.kube-system.svc.cluster.local
<ul>
<li>10.43.0.10</li>
<li>coredns</li>
</ul>
</li>
<li>coredns</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=flannel-网络问题>flannel 网络问题<a href=#flannel-网络问题 class=hash-link aria-label="Direct link to flannel 网络问题" title="Direct link to flannel 网络问题" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 排查 host 路由</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">route -n</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /run/flannel/subnet.env</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># host</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ping 10.42.0.1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 排查 pod 网络</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">tcpdump -i cni0 -nn -s0 -v -l host</span><br/></span></code></pre></div></div>
<div class="language-ini codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockTitle_Lwh4>subnet.env</div><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-ini codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token key attr-name" style="color:rgb(255, 203, 107)">FLANNEL_NETWORK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">10.42.0.0/16</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">FLANNEL_SUBNET</span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">10.42.0.1/24</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">FLANNEL_MTU</span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">1450</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key attr-name" style="color:rgb(255, 203, 107)">FLANNEL_IPMASQ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token value attr-value">true</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=pod-之间网络不通>pod 之间网络不通<a href=#pod-之间网络不通 class=hash-link aria-label="Direct link to pod 之间网络不通" title="Direct link to pod 之间网络不通" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">iptables -P FORWARD ACCEPT</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/8809 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/8809</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=containerd-配置>containerd 配置<a href=#containerd-配置 class=hash-link aria-label="Direct link to containerd 配置" title="Direct link to containerd 配置" translate=no>​</a></h2>
<ul>
<li>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</li>
<li>config.toml.tmpl</li>
<li><a href=https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates_linux.go target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates_linux.go</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=docker-vs-containerd>docker vs containerd<a href=#docker-vs-containerd class=hash-link aria-label="Direct link to docker vs containerd" title="Direct link to docker vs containerd" translate=no>​</a></h2>
<ul>
<li>docker
<ul>
<li>操作运维熟悉</li>
<li>可独立使用</li>
<li>docker 命令好用</li>
<li>镜像、缓存会更加友好 - 虽然 containerd 有 docker shim</li>
</ul>
</li>
<li>containerd
<ul>
<li>docker 底层也是使用的 containerd</li>
<li>因此使用 docker 会额外消耗一些内存</li>
<li>没有专用的 cli - crictl 主要用于调试</li>
</ul>
</li>
</ul>
<hr/>
<p>如果已经运行了 docker 建议使用 docker，否则没必要额外安装，直接使用内置 containerd。</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-每月重启>k3s 每月重启<a href=#k3s-每月重启 class=hash-link aria-label="Direct link to k3s 每月重启" title="Direct link to k3s 每月重启" translate=no>​</a></h2>
<ul>
<li>90 天 renew</li>
<li>随机 sleep 0-99 分钟</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">echo '#!/bin/sh -</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sleep ${RANDOM:0:2}m</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service k3s restart --ifstarted</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rc-service k0scontroller restart --ifstarted</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">' | sudo tee /etc/periodic/monthly/kube-restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo chmod +x /etc/periodic/monthly/kube-restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rc-service crond start --ifstopped</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rc-update add crond</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-状态清理>k3s 状态清理<a href=#k3s-状态清理 class=hash-link aria-label="Direct link to k3s 状态清理" title="Direct link to k3s 状态清理" translate=no>​</a></h2>
<ul>
<li>K3S 节点重置</li>
<li>cni0 和 flannel.1 不一定存在
<ul>
<li>取决于安装方式</li>
<li>/var/lib/cni</li>
</ul>
</li>
</ul>
<p><strong>脚本清理</strong></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果通过 get.k3s.io 安装会有该脚本</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">/usr/local/bin/k3s-killall.sh</span><br/></span></code></pre></div></div>
<p><strong>手动清理</strong></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 清理 iptables 规则</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iptables-save | grep -v KUBE- | grep -v CNI- | iptables-restore</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">iptables-save | grep -v 10.4[2,3] | iptables-restore</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 容器镜像清理</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 停止所有 pod，清除停止容器，清除 volume，但保留下载的镜像</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">docker stop $(docker ps -aq)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">docker system prune --volumes -f</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">docker system prune -f</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果不想保留镜像</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># docker system prune -a</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 取消所有挂载</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo umount $(mount -v | grep '/var/lib/kubelet' | awk '{print $3}')</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># k3s 和 kubelet 状态</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -rf /var/lib/rancher</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -rf /var/lib/kubelet</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># kubeconf</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -f /etc/rancher/k3s/k3s.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 日志清理</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -rf /var/log/containers/*</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -rf /var/log/pods/*</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">sudo rm -f /var/log/k3s.log</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果用了数据库</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo drop table if exists kine | psql -d $DATABASE_URL</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果有日志文件，例如 --log k3s-server.log --alsologtostderr</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rm k3s{,-server,-agent}.log -f</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip li del cni0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ip li del flannel.1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rm -rf /var/lib/cni/*</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-部署资源使用情况分析>K3S 部署资源使用情况分析<a href=#k3s-部署资源使用情况分析 class=hash-link aria-label="Direct link to K3S 部署资源使用情况分析" title="Direct link to K3S 部署资源使用情况分析" translate=no>​</a></h2>
<ul>
<li>AlpineLinux - 50M
<ul>
<li>显存 32M</li>
<li>sshd,tincd,dbus</li>
</ul>
</li>
<li>dockerd - 97M + shim/8M</li>
<li>containerd - 50M + shim/11M
<ul>
<li>docker 也依赖 containerd</li>
</ul>
</li>
<li>server 550M
<ul>
<li><code>--disable=traefik，servicelb</code></li>
<li>server 也会启动 agent</li>
<li>容器
<ul>
<li>metrics-server</li>
<li>coredns</li>
<li>local-path-provisioner</li>
</ul>
</li>
</ul>
</li>
<li>agent 180M</li>
<li>运行基础服务 - ingress-nginx, metallb, cert-manager, kubernetes-dashboard
<ul>
<li>server - 1G</li>
<li>agent - 450M</li>
<li>+linkerd
<ul>
<li>server 1.55G</li>
<li>agent 920M</li>
</ul>
</li>
</ul>
</li>
<li>参考
<ul>
<li><a href=https://rancher.com/docs/k3s/latest/en/installation/installation-requirements/resource-profiling/ target=_blank rel="noopener noreferrer">K3s Resource Profiling</a></li>
<li><a href=http://ceur-ws.org/Vol-2839/paper11.pdf target=_blank rel="noopener noreferrer">Profiling Lightweight Container Platforms: MicroK8s and K3s in Comparison to Kubernetes</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=区分-worker-和-cp>区分 worker 和 cp<a href=#区分-worker-和-cp class=hash-link aria-label="Direct link to 区分 worker 和 cp" title="Direct link to 区分 worker 和 cp" translate=no>​</a></h2>
<ul>
<li><code>--node-taint k3s-controlplane=true:NoExecute</code></li>
<li><code>--node-taint CriticalAddonsOnly=true:NoExecute</code>
<ul>
<li>不运行一般 payload</li>
</ul>
</li>
<li>--node-label, --node-taint
<ul>
<li>第一次加入集群时有效</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=生成的证书自定义域名>生成的证书自定义域名<a href=#生成的证书自定义域名 class=hash-link aria-label="Direct link to 生成的证书自定义域名" title="Direct link to 生成的证书自定义域名" translate=no>​</a></h2>
<ul>
<li><code>--tls-san YOUR_IP_OR_HOSTNAME_HERE</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=x509-certificate-relies-on-legacy-common-name-field-use-sans-or-temporarily-enable-common-name-matching-with-godebugx509ignorecn0>x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0<a href=#x509-certificate-relies-on-legacy-common-name-field-use-sans-or-temporarily-enable-common-name-matching-with-godebugx509ignorecn0 class=hash-link aria-label="Direct link to x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0" title="Direct link to x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0" translate=no>​</a></h2>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">E0905 23:03:57.992668   12600 controller.go:114] loading OpenAPI spec for "v1alpha1.tap.linkerd.io" failed with: failed to retrieve openAPI spec, http error: ResponseCode: 503, Body: Error trying to reach service: 'x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0', Header: map[Content-Type:[text/plain; charset=utf-8] X-Content-Type-Options:[nosniff]]</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 启动时添加环境变量</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">GODEBUG=x509ignoreCN=0</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-etcd-备份>k3s etcd 备份<a href=#k3s-etcd-备份 class=hash-link aria-label="Direct link to k3s etcd 备份" title="Direct link to k3s etcd 备份" translate=no>​</a></h2>
<ul>
<li>默认快照目录 /server/db/snapshots</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=迁移-k3s-data-dir>迁移 k3s data-dir<a href=#迁移-k3s-data-dir class=hash-link aria-label="Direct link to 迁移 k3s data-dir" title="Direct link to 迁移 k3s data-dir" translate=no>​</a></h2>
<blockquote>
<p>data-dir 包含 etc, local-path StorageClass, longhorn 存储 - 影响性能</p>
</blockquote>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">service k3s stop</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 如果没有 k3s-killal 可以考虑关闭 k3s 开机自动启动然后重启</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">k3s-killall</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">mkdir -p /data/k3s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rsync -aP /var/lib/rancher/k3s/ /data/k3s/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改 data-dir 启动服务</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo 'data-dir: /data/k3s' >> /etc/rancher/k3s/config.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service k3s start</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># busybox 的 lsof 不支持过滤路径</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">apk search lsof</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lsof +D /data/k3s | wc -l</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 输出 0 则迁移完成</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lsof +D /var/lib/rancher/k3s | wc -l</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 清除</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rm -rf /var/lib/rancher/k3s</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=containerstatus-from-runtime-service-failed-rpc-error-code--unavailable-desc--connection-error-desc--transport-error-while-dialing-dial-unix-missing-address>ContainerStatus from runtime service failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial unix: missing address"<a href=#containerstatus-from-runtime-service-failed-rpc-error-code--unavailable-desc--connection-error-desc--transport-error-while-dialing-dial-unix-missing-address class=hash-link aria-label='Direct link to ContainerStatus from runtime service failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial unix: missing address"' title='Direct link to ContainerStatus from runtime service failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial unix: missing address"' translate=no>​</a></h2>
<p>似乎是 containerd 的问题</p>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/1901 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/1901</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=出现很奇怪的-probe-失败看不到日志重启-pod-也无法修复>出现很奇怪的 probe 失败，看不到日志，重启 pod 也无法修复<a href=#出现很奇怪的-probe-失败看不到�日志重启-pod-也无法修复 class=hash-link aria-label="Direct link to 出现很奇怪的 probe 失败，看不到日志，重启 pod 也无法修复" title="Direct link to 出现很奇怪的 probe 失败，看不到日志，重启 pod 也无法修复" translate=no>​</a></h2>
<p>可能是是 k3s 网络 proxy 异常了，尝试重启 k3s 服务。</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-占用大量带宽>k3s 占用大量带宽<a href=#k3s-占用大量带宽 class=hash-link aria-label="Direct link to k3s 占用大量带宽" title="Direct link to k3s 占用大量带宽" translate=no>​</a></h2>
<ul>
<li>master 之间交互跑完了 50M 带宽</li>
</ul>
<p>重启 k3s 解决</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-check-config>k3s check-config<a href=#k3s-check-config class=hash-link aria-label="Direct link to k3s check-config" title="Direct link to k3s check-config" translate=no>​</a></h2>
<ul>
<li>cgroups V1/Hybrid on non-Systemd init - <a href=https://github.com/tianon/cgroupfs-mount target=_blank rel="noopener noreferrer">https://github.com/tianon/cgroupfs-mount</a></li>
<li><a href=https://raw.githubusercontent.com/k3s-io/k3s/master/contrib/util/check-config.sh target=_blank rel="noopener noreferrer">https://raw.githubusercontent.com/k3s-io/k3s/master/contrib/util/check-config.sh</a>
<ul>
<li>还不支持 cgroupv2 <a href=https://github.com/k3s-io/k3s/issues/3897 target=_blank rel="noopener noreferrer">#3897</a></li>
</ul>
</li>
<li>cgroupv2
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/900 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/900</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=log-rotate>log rotate<a href=#log-rotate class=hash-link aria-label="Direct link to log rotate" title="Direct link to log rotate" translate=no>​</a></h2>
<ul>
<li>直接 truncate 方式
<ul>
<li><a href=https://github.com/rancher/k3os/issues/433#issuecomment-749216549 target=_blank rel="noopener noreferrer">https://github.com/rancher/k3os/issues/433#issuecomment-749216549</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=failed-to-authenticate-request-from>Failed to authenticate request from<a href=#failed-to-authenticate-request-from class=hash-link aria-label="Direct link to Failed to authenticate request from" title="Direct link to Failed to authenticate request from" translate=no>​</a></h2>
<p>通常是 worker 证书失效了</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=x509-certificate-has-expired-or-is-not-yet-valid>x509: certificate has expired or is not yet valid<a href=#x509-certificate-has-expired-or-is-not-yet-valid class=hash-link aria-label="Direct link to x509: certificate has expired or is not yet valid" title="Direct link to x509: certificate has expired or is not yet valid" translate=no>​</a></h2>
<blockquote>
<p>注意区分是 worker 证书失效还是 server 证书失效</p>
</blockquote>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">x509: certificate has expired or is not yet valid: current time 2022-03-28T15:55:27+08:00 is after 2022-02-20T13:44:47Z</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockTitle_Lwh4>检查失效时间</div><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 当前证书 失效时间</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">curl -v -k https://localhost:6443 -s 2>&1 | grep date</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">openssl s_client -connect localhost:6443 -showcerts &lt; /dev/null 2>&1 | openssl x509 -noout -enddate</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">for i in $(ls /var/lib/rancher/k3s/server/tls/*.crt); do</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  echo $i</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  openssl x509 -enddate -noout -in $i</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">done</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">kubectl get secret -n kube-system k3s-serving -o jsonpath='{.data.tls\.crt}' | base64 -d | openssl x509 -noout -text | grep Not</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockTitle_Lwh4>触发 rotate</div><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">openssl s_client -connect localhost:6443 -showcerts &lt; /dev/null 2>&1 | openssl x509 -noout -startdate -enddate</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 设置为 &lt; 90 天</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">date -s 20210514</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># sudo hwclock -w</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service k3s restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># sudo chronyc -a makestep</span><br/></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 可以尝试</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">kubectl --insecure-skip-tls-verify delete secret -n kube-system k3s-serving</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">rm -f /var/lib/rancher/k3s/server/tls/dynamic-cert.json</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 重启 k3s</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://www.ibm.com/support/pages/node/6444205 target=_blank rel="noopener noreferrer">https://www.ibm.com/support/pages/node/6444205</a></li>
<li><a href=https://github.com/k3s-io/k3s/issues/1621 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/1621</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=unable-to-authenticate-the-request-errinvalid-bearer-token>Unable to authenticate the request err="invalid bearer token"<a href=#unable-to-authenticate-the-request-errinvalid-bearer-token class=hash-link aria-label='Direct link to Unable to authenticate the request err="invalid bearer token"' title='Direct link to Unable to authenticate the request err="invalid bearer token"' translate=no>​</a></h2>
<ul>
<li>server 版本不一致 导致过问题 - v1.20, v1.22</li>
</ul>
<p><strong>可以尝试，不一定能解决</strong></p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">kubectl -n kube-system get secrets | grep "coredns"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">kubectl -n kube-system delete secret coredns-token-lkt4c</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">kubectl -n kube-system delete pod coredns-66c464876b-25kl9</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/2788 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/2788</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=etcdserver-mvcc-required-revision-has-been-compacted>etcdserver: mvcc: required revision has been compacted<a href=#etcdserver-mvcc-required-revision-has-been-compacted class=hash-link aria-label="Direct link to etcdserver: mvcc: required revision has been compacted" title="Direct link to etcdserver: mvcc: required revision has been compacted" translate=no>​</a></h2>
<ul>
<li>没问题</li>
<li><a href=https://github.com/k3s-io/k3s/issues/4419#issuecomment-962897354 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/4419#issuecomment-962897354</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=transport-error-while-dialing-dial-tcp-1270012379-connect-connection-refused>transport: Error while dialing dial tcp 127.0.0.1:2379: connect: connection refused<a href=#transport-error-while-dialing-dial-tcp-1270012379-connect-connection-refused class=hash-link aria-label="Direct link to transport: Error while dialing dial tcp 127.0.0.1:2379: connect: connection refused" title="Direct link to transport: Error while dialing dial tcp 127.0.0.1:2379: connect: connection refused" translate=no>​</a></h2>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/4728 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/4728</a>
<ul>
<li>双节点 HA Matser 重启后出现</li>
<li><a href=https://github.com/k3s-io/k3s/pull/5254 target=_blank rel="noopener noreferrer">#5254</a></li>
</ul>
</li>
<li><a href=https://github.com/k3s-io/k3s/issues/2345 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/2345</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=failed-to-reconcile-with-temporary-etcd-walpb-crc-mismatch>Failed to reconcile with temporary etcd: walpb: crc mismatch<a href=#failed-to-reconcile-with-temporary-etcd-walpb-crc-mismatch class=hash-link aria-label="Direct link to Failed to reconcile with temporary etcd: walpb: crc mismatch" title="Direct link to Failed to reconcile with temporary etcd: walpb: crc mismatch" translate=no>​</a></h2>
<ul>
<li>k3s restore 旧的会放到 <code>${data-dir}/server/db/etcd-old/</code></li>
<li>默认本地快照 <code>${data-dir}/server/db/snapshots</code></li>
<li>data-dir=/var/lib/rancher/k3s</li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">k3s etcd-snapshot list</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 尝试恢复</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">k3s server --cluster-reset --cluster-reset-restore-path=/var/lib/rancher/k3s/server/db/snapshots/XXX</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mv /var/lib/rancher/k3s/server/db/etcd/ etcd.bk</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># k3s etcd-snapshot prune --snapshot-retention 10</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=cluster-id-mismatch>cluster ID mismatch<a href=#cluster-id-mismatch class=hash-link aria-label="Direct link to cluster ID mismatch" title="Direct link to cluster ID mismatch" translate=no>​</a></h2>
<p>部分 master 恢复后可能出现，其他节点需要 reset 或 restore</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=invalid-bearer-token-token-has-been-invalidated>invalid bearer token, Token has been invalidated<a href=#invalid-bearer-token-token-has-been-invalidated class=hash-link aria-label="Direct link to invalid bearer token, Token has been invalidated" title="Direct link to invalid bearer token, Token has been invalidated" translate=no>​</a></h2>
<p>renew 后出现</p>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=user-k3s-cloud-controller-manager-cannot-get-resource-leases-in-api-group-coordinationk8sio-in-the-namespace-kube-system>User "k3s-cloud-controller-manager" cannot get resource "leases" in API group "coordination.k8s.io" in the namespace "kube-system"<a href=#user-k3s-cloud-controller-manager-cannot-get-resource-leases-in-api-group-coordinationk8sio-in-the-namespace-kube-system class=hash-link aria-label='Direct link to User "k3s-cloud-controller-manager" cannot get resource "leases" in API group "coordination.k8s.io" in the namespace "kube-system"' title='Direct link to User "k3s-cloud-controller-manager" cannot get resource "leases" in API group "coordination.k8s.io" in the namespace "kube-system"' translate=no>​</a></h2>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/6119 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/6119</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=ulimit>ulimit<a href=#ulimit class=hash-link aria-label="Direct link to ulimit" title="Direct link to ulimit" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># openrc</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">echo 'rc_ulimit="-n 1048576"' >> /etc/rancher/k3s/k3s.env</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=单节点转多节点>单节点转多节点<a href=#单节点转多节点 class=hash-link aria-label="Direct link to 单节点转多节点" title="Direct link to 单节点转多节点" translate=no>​</a></h2>
<ul>
<li>单节点 -> HA</li>
<li>SQLite -> ETCD</li>
<li>修改存储然后重启即可
<ul>
<li>启动的时候添加 cluster-init 即可</li>
<li>当本地已经发现 etcd 数据库时，--cluster-init, --server, --datastore-endpoint 会被忽略</li>
</ul>
</li>
<li><a href=https://docs.k3s.io/datastore/ha-embedded#existing-clusters target=_blank rel="noopener noreferrer">https://docs.k3s.io/datastore/ha-embedded#existing-clusters</a></li>
</ul>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">echo 'cluster-init: true' >> /etc/rancher/k3s/config.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 迁移后会记录 state.db.migrated</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">service k3s restart</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">du -sh /var/lib/rancher/k3s/server/db/etcd</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># etcd 支持快照</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">k3s etcd-snapshot save</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">k3s etcd-snapshot list</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 快照目录</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ls /var/lib/rancher/k3s/server/db/snapshots</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 判断</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">lsof -f -- /var/lib/rancher/k3s/server/db/state.db-wal</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=max-pods>max-pods<a href=#max-pods class=hash-link aria-label="Direct link to max-pods" title="Direct link to max-pods" translate=no>​</a></h2>
<ul>
<li>默认 110</li>
</ul>
<ol>
<li>by config.yaml</li>
</ol>
<div class="language-yaml codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-yaml codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token key atrule">kubelet-arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> config=/etc/rancher/k3s/kubelet.config</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  - 'maxPods=250'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  - "kube-reserved=cpu=500m,memory=1Gi,ephemeral-storage=2Gi"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  - "system-reserved=cpu=500m, memory=1Gi,ephemeral-storage=2Gi"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  - "eviction-hard=memory.available&lt;500Mi,nodefs.available&lt;10%"</span><br/></span></code></pre></div></div>
<ol start=2>
<li>by config file</li>
</ol>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">--kubelet-arg=config=/etc/rancher/k3s/kubelet.config</span><br/></span></code></pre></div></div>
<p><strong>/etc/rancher/k3s/kubelet.config</strong></p>
<div class="language-yaml codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-yaml codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> kubelet.config.k8s.io/v1beta1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> KubeletConfiguration</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">maxPods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/ target=_blank rel="noopener noreferrer">https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/</a></li>
<li><a href=https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/ target=_blank rel="noopener noreferrer">https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/</a></li>
<li><a href=https://docs.k3s.io/cli/agent#customized-flags target=_blank rel="noopener noreferrer">https://docs.k3s.io/cli/agent#customized-flags</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=waiting-for-containerd-startup-rpc-error-code--unimplemented-desc--unknown-service-runtimev1runtimeservice>Waiting for containerd startup: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService<a href=#waiting-for-containerd-startup-rpc-error-code--unimplemented-desc--unknown-service-runtimev1runtimeservice class=hash-link aria-label="Direct link to Waiting for containerd startup: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService" title="Direct link to Waiting for containerd startup: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService" translate=no>​</a></h2>
<ul>
<li>k3s/agent/containerd/containerd.log</li>
<li>k3s v1.25 -> v1.26</li>
</ul>
<div class="language-text codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-text codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398351570+08:00" level=info msg="Connect containerd service"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398408099+08:00" level=info msg="using legacy CRI server"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398418537+08:00" level=info msg="using experimental NRI integration - disable nri plugin to prevent this"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398549887+08:00" level=warning msg="failed to load plugin io.containerd.grpc.v1.cri" error="failed to create CRI service: failed to find snapshotter \"zfs\""</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398913047+08:00" level=info msg=serving... address=/run/k3s/containerd/containerd.sock.ttrpc</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398971211+08:00" level=info msg=serving... address=/run/k3s/containerd/containerd.sock</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">time="2023-06-04T16:17:14.398989382+08:00" level=info msg="containerd successfully booted in 0.430664s"</span><br/></span></code></pre></div></div>
<p>是因为 <code>failed to find snapshotter "zfs"</code> 导致</p>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">k3s ctr plugin ls</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=failed-to-get-network-cbr0-cached-result-decoding-version-from-network-config-unexpected-end-of-json-input>failed to get network "cbr0" cached result: decoding version from network config: unexpected end of JSON input"<a href=#failed-to-get-network-cbr0-cached-result-decoding-version-from-network-config-unexpected-end-of-json-input class=hash-link aria-label='Direct link to failed to get network "cbr0" cached result: decoding version from network config: unexpected end of JSON input"' title='Direct link to failed to get network "cbr0" cached result: decoding version from network config: unexpected end of JSON input"' translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">grep 'failed to get network' /var/log/k3s.log</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">ls -s /var/lib/cni/flannel/ # size=0 的文件</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">k3s ctr container rm $(find /var/lib/cni/flannel/ -size 0 | xargs -n1 basename)</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">find /var/lib/cni/flannel/ -size 0 -delete</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">find /var/lib/cni/results/ -size 0 -delete # cached result</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/6185#issuecomment-1399502450 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/6185#issuecomment-1399502450</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=watch-chan-error-etcdserver-no-leader>watch chan error: etcdserver: no leader<a href=#watch-chan-error-etcdserver-no-leader class=hash-link aria-label="Direct link to watch chan error: etcdserver: no leader" title="Direct link to watch chan error: etcdserver: no leader" translate=no>​</a></h2>
<ul>
<li>2 master</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=k3s-unable-to-apply-rc_ulimit-settings>k3s: unable to apply RC_ULIMIT settings<a href=#k3s-unable-to-apply-rc_ulimit-settings class=hash-link aria-label="Direct link to k3s: unable to apply RC_ULIMIT settings" title="Direct link to k3s: unable to apply RC_ULIMIT settings" translate=no>​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=cluster-ca-certificate-is-not-trusted-by-the-host-ca-bundle-but-the-token-does-not-include-a-ca-hash-use-the-full-token-from-the-servers-node-token-file-to-enable-cluster-ca-validation>Cluster CA certificate is not trusted by the host CA bundle, but the token does not include a CA hash. Use the full token from the server's node-token file to enable Cluster CA validation.<a href=#cluster-ca-certificate-is-not-trusted-by-the-host-ca-bundle-but-the-token-does-not-include-a-ca-hash-use-the-full-token-from-the-servers-node-token-file-to-enable-cluster-ca-validation class=hash-link aria-label="Direct link to Cluster CA certificate is not trusted by the host CA bundle, but the token does not include a CA hash. Use the full token from the server's node-token file to enable Cluster CA validation." title="Direct link to Cluster CA certificate is not trusted by the host CA bundle, but the token does not include a CA hash. Use the full token from the server's node-token file to enable Cluster CA validation." translate=no>​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=starting-kubernetes-preparing-server-token-ca-hash-does-not-match-the-cluster-ca-certificate-hash>starting kubernetes: preparing server: token CA hash does not match the Cluster CA certificate hash<a href=#starting-kubernetes-preparing-server-token-ca-hash-does-not-match-the-cluster-ca-certificate-hash class=hash-link aria-label="Direct link to starting kubernetes: preparing server: token CA hash does not match the Cluster CA certificate hash" title="Direct link to starting kubernetes: preparing server: token CA hash does not match the Cluster CA certificate hash" translate=no>​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=etcd-cluster-join-failed-cannot-fetch-cluster-info-from-peer-urls-could-not-retrieve-cluster-information-from-the-given-urls>etcd cluster join failed: cannot fetch cluster info from peer urls: could not retrieve cluster information from the given URLs<a href=#etcd-cluster-join-failed-cannot-fetch-cluster-info-from-peer-urls-could-not-retrieve-cluster-information-from-the-given-urls class=hash-link aria-label="Direct link to etcd cluster join failed: cannot fetch cluster info from peer urls: could not retrieve cluster information from the given URLs" title="Direct link to etcd cluster join failed: cannot fetch cluster info from peer urls: could not retrieve cluster information from the given URLs" translate=no>​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=iptables-rule-leak>iptables rule leak<a href=#iptables-rule-leak class=hash-link aria-label="Direct link to iptables rule leak" title="Direct link to iptables rule leak" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">iptables -L | wc -l -c</span><br/></span></code></pre></div></div>
<ul>
<li><a href=https://github.com/k3s-io/k3s/issues/294 target=_blank rel="noopener noreferrer">https://github.com/k3s-io/k3s/issues/294</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=containerd-pid>containerd pid<a href=#containerd-pid class=hash-link aria-label="Direct link to containerd pid" title="Direct link to containerd pid" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">ps -e -o pid= -o args= | sed -e 's/^ *//; s/\s\s*/\t/;' | grep containerd-shim | grep '/run/k3s/containerd' | cut -f1</span><br/></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>Tags:</b><ul class="tags_noif padding--none margin-left--sm"><li class=tag_mzC7><a rel=tag class="tag_xI_x tagRegular_Q4uH" href=/notes/tags/faq>FAQ</a></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/notes/../notes/devops/kubernetes/distro/k3s/k3s-faq.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2024-10-16T05:25:47.000Z itemprop=dateModified>Oct 16, 2024</time></b> by <b>wener</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/notes/devops/kubernetes/distro/k3s/cookbook><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>K3S Cookbook</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/notes/devops/kubernetes/distro/k3s/install><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Install</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_wpyd thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#k3s-网络结构 class="table-of-contents__link toc-highlight">K3S 网络结构</a><li><a href=#访问-k3s-的-etcd class="table-of-contents__link toc-highlight">访问 K3S 的 ETCD</a><li><a href=#dns-问题 class="table-of-contents__link toc-highlight">DNS 问题</a><li><a href=#flannel-网络问题 class="table-of-contents__link toc-highlight">flannel 网络问题</a><li><a href=#pod-之间网络不通 class="table-of-contents__link toc-highlight">pod 之间网络不通</a><li><a href=#containerd-配置 class="table-of-contents__link toc-highlight">containerd 配置</a><li><a href=#docker-vs-containerd class="table-of-contents__link toc-highlight">docker vs containerd</a><li><a href=#k3s-每月重启 class="table-of-contents__link toc-highlight">k3s 每月重启</a><li><a href=#k3s-状态清理 class="table-of-contents__link toc-highlight">k3s 状态清理</a><li><a href=#k3s-部署资源使用情况分析 class="table-of-contents__link toc-highlight">K3S 部署资源使用情况分析</a><li><a href=#区分-worker-和-cp class="table-of-contents__link toc-highlight">区分 worker 和 cp</a><li><a href=#生成的证书自定义域名 class="table-of-contents__link toc-highlight">生成的证书自定义域名</a><li><a href=#x509-certificate-relies-on-legacy-common-name-field-use-sans-or-temporarily-enable-common-name-matching-with-godebugx509ignorecn0 class="table-of-contents__link toc-highlight">x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0</a><li><a href=#k3s-etcd-备份 class="table-of-contents__link toc-highlight">k3s etcd 备份</a><li><a href=#迁移-k3s-data-dir class="table-of-contents__link toc-highlight">迁移 k3s data-dir</a><li><a href=#containerstatus-from-runtime-service-failed-rpc-error-code--unavailable-desc--connection-error-desc--transport-error-while-dialing-dial-unix-missing-address class="table-of-contents__link toc-highlight">ContainerStatus from runtime service failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial unix: missing address"</a><li><a href=#出现很奇怪的-probe-失败看不到日志重启-pod-也无法修复 class="table-of-contents__link toc-highlight">出现很奇怪的 probe 失败，看不到日志，重启 pod 也无法修复</a><li><a href=#k3s-占用大量带宽 class="table-of-contents__link toc-highlight">k3s 占用大量带宽</a><li><a href=#k3s-check-config class="table-of-contents__link toc-highlight">k3s check-config</a><li><a href=#log-rotate class="table-of-contents__link toc-highlight">log rotate</a><li><a href=#failed-to-authenticate-request-from class="table-of-contents__link toc-highlight">Failed to authenticate request from</a><li><a href=#x509-certificate-has-expired-or-is-not-yet-valid class="table-of-contents__link toc-highlight">x509: certificate has expired or is not yet valid</a><li><a href=#unable-to-authenticate-the-request-errinvalid-bearer-token class="table-of-contents__link toc-highlight">Unable to authenticate the request err="invalid bearer token"</a><li><a href=#etcdserver-mvcc-required-revision-has-been-compacted class="table-of-contents__link toc-highlight">etcdserver: mvcc: required revision has been compacted</a><li><a href=#transport-error-while-dialing-dial-tcp-1270012379-connect-connection-refused class="table-of-contents__link toc-highlight">transport: Error while dialing dial tcp 127.0.0.1:2379: connect: connection refused</a><li><a href=#failed-to-reconcile-with-temporary-etcd-walpb-crc-mismatch class="table-of-contents__link toc-highlight">Failed to reconcile with temporary etcd: walpb: crc mismatch</a><li><a href=#cluster-id-mismatch class="table-of-contents__link toc-highlight">cluster ID mismatch</a><li><a href=#invalid-bearer-token-token-has-been-invalidated class="table-of-contents__link toc-highlight">invalid bearer token, Token has been invalidated</a><li><a href=#user-k3s-cloud-controller-manager-cannot-get-resource-leases-in-api-group-coordinationk8sio-in-the-namespace-kube-system class="table-of-contents__link toc-highlight">User "k3s-cloud-controller-manager" cannot get resource "leases" in API group "coordination.k8s.io" in the namespace "kube-system"</a><li><a href=#ulimit class="table-of-contents__link toc-highlight">ulimit</a><li><a href=#单节点转多节点 class="table-of-contents__link toc-highlight">单节点转多节点</a><li><a href=#max-pods class="table-of-contents__link toc-highlight">max-pods</a><li><a href=#waiting-for-containerd-startup-rpc-error-code--unimplemented-desc--unknown-service-runtimev1runtimeservice class="table-of-contents__link toc-highlight">Waiting for containerd startup: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService</a><li><a href=#failed-to-get-network-cbr0-cached-result-decoding-version-from-network-config-unexpected-end-of-json-input class="table-of-contents__link toc-highlight">failed to get network "cbr0" cached result: decoding version from network config: unexpected end of JSON input"</a><li><a href=#watch-chan-error-etcdserver-no-leader class="table-of-contents__link toc-highlight">watch chan error: etcdserver: no leader</a><li><a href=#k3s-unable-to-apply-rc_ulimit-settings class="table-of-contents__link toc-highlight">k3s: unable to apply RC_ULIMIT settings</a><li><a href=#cluster-ca-certificate-is-not-trusted-by-the-host-ca-bundle-but-the-token-does-not-include-a-ca-hash-use-the-full-token-from-the-servers-node-token-file-to-enable-cluster-ca-validation class="table-of-contents__link toc-highlight">Cluster CA certificate is not trusted by the host CA bundle, but the token does not include a CA hash. Use the full token from the server's node-token file to enable Cluster CA validation.</a><li><a href=#starting-kubernetes-preparing-server-token-ca-hash-does-not-match-the-cluster-ca-certificate-hash class="table-of-contents__link toc-highlight">starting kubernetes: preparing server: token CA hash does not match the Cluster CA certificate hash</a><li><a href=#etcd-cluster-join-failed-cannot-fetch-cluster-info-from-peer-urls-could-not-retrieve-cluster-information-from-the-given-urls class="table-of-contents__link toc-highlight">etcd cluster join failed: cannot fetch cluster info from peer urls: could not retrieve cluster information from the given URLs</a><li><a href=#iptables-rule-leak class="table-of-contents__link toc-highlight">iptables rule leak</a><li><a href=#containerd-pid class="table-of-contents__link toc-highlight">containerd pid</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2025 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2025-10-09 13:46</div></div></div></footer></div></body>