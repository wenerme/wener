<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-service/observability/metrics/thanos" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>Thanos | Wener Live & Life</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://wener.me/notes/service/observability/metrics/thanos /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Thanos | Wener Live & Life"/><meta data-rh=true name=description content="- thanos-io/thanos"/><meta data-rh=true property=og:description content="- thanos-io/thanos"/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://wener.me/notes/service/observability/metrics/thanos /><link data-rh=true rel=alternate href=https://wener.me/notes/service/observability/metrics/thanos hreflang=en /><link data-rh=true rel=alternate href=https://wener.me/notes/service/observability/metrics/thanos hreflang=x-default /><link data-rh=true rel=preconnect href=https://37P8DMWBKF-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://wener.me/notes/service/","name":"服务","position":1},{"@type":"ListItem","item":"https://wener.me/notes/service/observability/","name":"可观察性","position":2},{"@type":"ListItem","item":"https://wener.me/notes/service/observability/metrics/","name":"指标","position":3},{"@type":"ListItem","item":"https://wener.me/notes/service/observability/metrics/thanos","name":"Thanos","position":4}]}</script><link rel=alternate type=application/rss+xml href=/story/rss.xml title="Wener Live & Life RSS Feed"><link rel=alternate type=application/atom+xml href=/story/atom.xml title="Wener Live & Life Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-30404720-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-30404720-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-30404720-1",{})</script><link rel=search type=application/opensearchdescription+xml title="Wener Live & Life" href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css><script src=https://static.cloudflareinsights.com/beacon.min.js async data-cf-beacon='{"token": "e9a1b931103044f3940ee67b78c7df70"}' defer></script><link rel=stylesheet href=/assets/css/styles.fa221ee1.css /><script src=/assets/js/runtime~main.72c320db.js defer></script><script src=/assets/js/main.c07313b6.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_jKDA href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo-head.svg alt="Wener Logo" class="themedComponent_j2y5 themedComponent--dark_PUQY"/></div><b class="navbar__title text--truncate">Wener</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/notes>笔记</a><a class="navbar__item navbar__link" href=/story>故事</a><a class="navbar__item navbar__link" href=/notes/howto/network/dns-prevent-spoofing>指南</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/wenerme/wener target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a><div class="toggle_N7Mq colorModeToggle_vh_y"><button class="clean-btn toggleButton_PaHe toggleButtonDisabled_RC4w" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 lightToggleIcon_M1mU"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 darkToggleIcon_sEdo"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_Q188 systemToggleIcon_cOyE"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_d_Bn><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_c22C"><div class=docsWrapper_oymo><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ZPA9" type=button></button><div class=docRoot_ng2Q><aside class="theme-doc-sidebar-container docSidebarContainer_nyHU"><div class=sidebarViewport_rLoj><div class=sidebar_TmDF><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jRin"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes><span title=笔记 class=linkLabel_JPPZ>笔记</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/adobe/photoshop><span title=adobe class=categoryLinkLabel_RkOu>adobe</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ai><span title=AI class=categoryLinkLabel_RkOu>AI</span></a><button aria-label="Expand sidebar category 'AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/algorithm><span title=算法 class=categoryLinkLabel_RkOu>算法</span></a><button aria-label="Expand sidebar category '算法'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/blockchain><span title=区块链 class=categoryLinkLabel_RkOu>区块链</span></a><button aria-label="Expand sidebar category '区块链'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/cn><span title=CN class=categoryLinkLabel_RkOu>CN</span></a><button aria-label="Expand sidebar category 'CN'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/courses><span title=课程 class=categoryLinkLabel_RkOu>课程</span></a><button aria-label="Expand sidebar category '课程'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/culture><span title=文化 class=categoryLinkLabel_RkOu>文化</span></a><button aria-label="Expand sidebar category '文化'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/db><span title=数据库 class=categoryLinkLabel_RkOu>数据库</span></a><button aria-label="Expand sidebar category '数据库'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/dev><span title=开发 class=categoryLinkLabel_RkOu>开发</span></a><button aria-label="Expand sidebar category '开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/devops><span title=DevOps class=categoryLinkLabel_RkOu>DevOps</span></a><button aria-label="Expand sidebar category 'DevOps'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/economics><span title=经济学 class=categoryLinkLabel_RkOu>经济学</span></a><button aria-label="Expand sidebar category '经济学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/electrical><span title=电学基础 class=categoryLinkLabel_RkOu>电学基础</span></a><button aria-label="Expand sidebar category '电学基础'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/embedded/awesome><span title=embedded class=categoryLinkLabel_RkOu>embedded</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/evolve><span title=自我成长 class=categoryLinkLabel_RkOu>自我成长</span></a><button aria-label="Expand sidebar category '自我成长'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/hardware><span title=硬件 class=categoryLinkLabel_RkOu>硬件</span></a><button aria-label="Expand sidebar category '硬件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/healthcare><span title=健康 class=categoryLinkLabel_RkOu>健康</span></a><button aria-label="Expand sidebar category '健康'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/howto/network/dns-prevent-spoofing><span title=howto class=categoryLinkLabel_RkOu>howto</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/java><span title=Java class=categoryLinkLabel_RkOu>Java</span></a><button aria-label="Expand sidebar category 'Java'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/languages><span title=语言 class=categoryLinkLabel_RkOu>语言</span></a><button aria-label="Expand sidebar category '语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/notes/linguistics><span title=Linguistics class=linkLabel_JPPZ>Linguistics</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/math><span title=数学 class=categoryLinkLabel_RkOu>数学</span></a><button aria-label="Expand sidebar category '数学'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/mgmt><span title=管理 class=categoryLinkLabel_RkOu>管理</span></a><button aria-label="Expand sidebar category '管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/network/application/dns><span title=network class=categoryLinkLabel_RkOu>network</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/ops><span title=运维 class=categoryLinkLabel_RkOu>运维</span></a><button aria-label="Expand sidebar category '运维'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/os><span title=操作系统 class=categoryLinkLabel_RkOu>操作系统</span></a><button aria-label="Expand sidebar category '操作系统'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/philosophy><span title=理念 class=categoryLinkLabel_RkOu>理念</span></a><button aria-label="Expand sidebar category '理念'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/photography><span title=摄影 class=categoryLinkLabel_RkOu>摄影</span></a><button aria-label="Expand sidebar category '摄影'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/platform><span title=平台 class=categoryLinkLabel_RkOu>平台</span></a><button aria-label="Expand sidebar category '平台'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/notes/psychology/glossary><span title=psychology class=categoryLinkLabel_RkOu>psychology</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/queue><span title=Queue class=categoryLinkLabel_RkOu>Queue</span></a><button aria-label="Expand sidebar category 'Queue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/security><span title=安全 class=categoryLinkLabel_RkOu>安全</span></a><button aria-label="Expand sidebar category '安全'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" href=/notes/service><span title=服务 class=categoryLinkLabel_RkOu>服务</span></a><button aria-label="Collapse sidebar category '服务'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/analytics><span title=统计 class=categoryLinkLabel_RkOu>统计</span></a><button aria-label="Expand sidebar category '统计'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/api/awesome><span title=api class=categoryLinkLabel_RkOu>api</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/auth><span title=Auth class=categoryLinkLabel_RkOu>Auth</span></a><button aria-label="Expand sidebar category 'Auth'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/baas><span title="Backend as a Service" class=categoryLinkLabel_RkOu>Backend as a Service</span></a><button aria-label="Expand sidebar category 'Backend as a Service'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/bi/awesome><span title=bi class=categoryLinkLabel_RkOu>bi</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/business/glossary><span title=business class=categoryLinkLabel_RkOu>business</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/cctv><span title=CCTV class=linkLabel_JPPZ>CCTV</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/cms><span title="CMS 概览" class=categoryLinkLabel_RkOu>CMS 概览</span></a><button aria-label="Expand sidebar category 'CMS 概览'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/collaboration><span title=协同软件 class=categoryLinkLabel_RkOu>协同软件</span></a><button aria-label="Expand sidebar category '协同软件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/commerce><span title=电商 class=categoryLinkLabel_RkOu>电商</span></a><button aria-label="Expand sidebar category '电商'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/data><span title=数据 class=categoryLinkLabel_RkOu>数据</span></a><button aria-label="Expand sidebar category '数据'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/dev/backstage><span title=dev class=categoryLinkLabel_RkOu>dev</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/dns><span title="DNS Service" class=categoryLinkLabel_RkOu>DNS Service</span></a><button aria-label="Expand sidebar category 'DNS Service'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/document><span title=办公套件 class=categoryLinkLabel_RkOu>办公套件</span></a><button aria-label="Expand sidebar category '办公套件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/download><span title=下载器 class=categoryLinkLabel_RkOu>下载器</span></a><button aria-label="Expand sidebar category '下载器'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/edms><span title=档案管理 class=categoryLinkLabel_RkOu>档案管理</span></a><button aria-label="Expand sidebar category '档案管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/email><span title=EMail class=categoryLinkLabel_RkOu>EMail</span></a><button aria-label="Expand sidebar category 'EMail'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/erp><span title=ERP class=categoryLinkLabel_RkOu>ERP</span></a><button aria-label="Expand sidebar category 'ERP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/forge><span title=Forge class=categoryLinkLabel_RkOu>Forge</span></a><button aria-label="Expand sidebar category 'Forge'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/forum/awesome><span title=forum class=categoryLinkLabel_RkOu>forum</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/geo/awesome><span title=geo class=categoryLinkLabel_RkOu>geo</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/im><span title=即时通讯 class=categoryLinkLabel_RkOu>即时通讯</span></a><button aria-label="Expand sidebar category '即时通讯'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/linear><span title=Linear class=linkLabel_JPPZ>Linear</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/lms><span title=LMS class=linkLabel_JPPZ>LMS</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/media><span title=媒体 class=categoryLinkLabel_RkOu>媒体</span></a><button aria-label="Expand sidebar category '媒体'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/messaging/centrifugo><span title=messaging class=categoryLinkLabel_RkOu>messaging</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/network><span title=网络服务 class=categoryLinkLabel_RkOu>网络服务</span></a><button aria-label="Expand sidebar category '网络服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/notification/novu><span title=notification class=categoryLinkLabel_RkOu>notification</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/notion><span title=Notion class=linkLabel_JPPZ>Notion</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/service/observability><span title=可观察性 class=categoryLinkLabel_RkOu>可观察性</span></a><button aria-label="Collapse sidebar category '可观察性'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/alertmanager><span title=alertmanager class=linkLabel_JPPZ>alertmanager</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/goaccess><span title=goaccess class=linkLabel_JPPZ>goaccess</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/observability/grafana><span title=Grafana class=categoryLinkLabel_RkOu>Grafana</span></a><button aria-label="Expand sidebar category 'Grafana'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/highlight><span title=highlight class=linkLabel_JPPZ>highlight</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/observability/logging/fluentbit><span title=logging class=categoryLinkLabel_RkOu>logging</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--active" tabindex=0 href=/notes/service/observability/metrics><span title=指标 class=categoryLinkLabel_RkOu>指标</span></a><button aria-label="Collapse sidebar category '指标'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/metrics/cortex><span title=Cortex class=linkLabel_JPPZ>Cortex</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/metrics/m3><span title=M3 class=linkLabel_JPPZ>M3</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/metrics/faq><span title=指标服务常见问题 class=linkLabel_JPPZ>指标服务常见问题</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/observability/metrics/prometheus><span title=Prometheus class=categoryLinkLabel_RkOu>Prometheus</span></a><button aria-label="Expand sidebar category 'Prometheus'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/metrics/promxy><span title=promxy class=linkLabel_JPPZ>promxy</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/metrics/thanos-version><span title="Thanos 版本" class=linkLabel_JPPZ>Thanos 版本</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/notes/service/observability/metrics/thanos><span title=Thanos class=linkLabel_JPPZ>Thanos</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/observability/metrics/victoria-metrics><span title=VictoriaMetrics class=categoryLinkLabel_RkOu>VictoriaMetrics</span></a><button aria-label="Expand sidebar category 'VictoriaMetrics'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/netdata><span title=netdata class=linkLabel_JPPZ>netdata</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/awesome><span title="Observability Awesome" class=linkLabel_JPPZ>Observability Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/faq><span title="Observability FAQ" class=linkLabel_JPPZ>Observability FAQ</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/glossary><span title="Observability Glossary" class=linkLabel_JPPZ>Observability Glossary</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/openobserve><span title=OpenObserve class=linkLabel_JPPZ>OpenObserve</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/opentelemetry><span title=OpenTelemetry class=linkLabel_JPPZ>OpenTelemetry</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/observability/tracing><span title=链路跟踪 class=categoryLinkLabel_RkOu>链路跟踪</span></a><button aria-label="Expand sidebar category '链路跟踪'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/uptime-kuma><span title=uptime-kuma class=linkLabel_JPPZ>uptime-kuma</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/vector><span title=vector class=linkLabel_JPPZ>vector</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/observability/vrl><span title=vrl class=linkLabel_JPPZ>vrl</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/p2p/ipfs><span title=p2p class=categoryLinkLabel_RkOu>p2p</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/password><span title=密码管理 class=categoryLinkLabel_RkOu>密码管理</span></a><button aria-label="Expand sidebar category '密码管理'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/placeholder><span title=Placeholder class=linkLabel_JPPZ>Placeholder</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/realtime><span title=Realtime class=categoryLinkLabel_RkOu>Realtime</span></a><button aria-label="Expand sidebar category 'Realtime'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/search/awesome><span title=search class=categoryLinkLabel_RkOu>search</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/security/infisical><span title=security class=categoryLinkLabel_RkOu>security</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/selfhost><span title=SelfHost class=categoryLinkLabel_RkOu>SelfHost</span></a><button aria-label="Expand sidebar category 'SelfHost'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/serverless><span title=Serverless class=categoryLinkLabel_RkOu>Serverless</span></a><button aria-label="Expand sidebar category 'Serverless'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/awesome><span title="Service Awesome" class=linkLabel_JPPZ>Service Awesome</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/notes/service/faq><span title="Service FAQ" class=linkLabel_JPPZ>Service FAQ</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/storage><span title=存储服务 class=categoryLinkLabel_RkOu>存储服务</span></a><button aria-label="Expand sidebar category '存储服务'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/telecom/device><span title=telecom class=categoryLinkLabel_RkOu>telecom</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/torrent><span title=Torrent class=categoryLinkLabel_RkOu>Torrent</span></a><button aria-label="Expand sidebar category 'Torrent'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/vpn/goproxy><span title=vpn class=categoryLinkLabel_RkOu>vpn</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/wiki><span title=Wiki class=categoryLinkLabel_RkOu>Wiki</span></a><button aria-label="Expand sidebar category 'Wiki'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" tabindex=0 href=/notes/service/workflow><span title=Workflow class=categoryLinkLabel_RkOu>Workflow</span></a><button aria-label="Expand sidebar category 'Workflow'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/notes/service/xaas/awesome><span title=xaas class=categoryLinkLabel_RkOu>xaas</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/software><span title=软件 class=categoryLinkLabel_RkOu>软件</span></a><button aria-label="Expand sidebar category '软件'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/std><span title=标准数据 class=categoryLinkLabel_RkOu>标准数据</span></a><button aria-label="Expand sidebar category '标准数据'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/voip><span title=VoIP class=categoryLinkLabel_RkOu>VoIP</span></a><button aria-label="Expand sidebar category 'VoIP'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_irRK menu__link menu__link--sublist" href=/notes/web><span title=Web class=categoryLinkLabel_RkOu>Web</span></a><button aria-label="Expand sidebar category 'Web'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_NY7h"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_c8nQ><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_GAGP><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_YQ1L"><div class=docItemContainer_Wjg4><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_tiqF" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_WTWT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/service><span>服务</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/service/observability><span>可观察性</span></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/notes/service/observability/metrics><span>指标</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Thanos</span></ul></nav><div class="tocCollapsible_GvsH theme-doc-toc-mobile tocMobile_qJgM"><button type=button class="clean-btn tocCollapsibleButton_LnP0">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Thanos</h1></header>
<ul>
<li><a href=https://github.com/thanos-io/thanos target=_blank rel="noopener noreferrer">thanos-io/thanos</a>
<ul>
<li>Prometheus 长期存储</li>
<li>后端使用对象存储服务</li>
</ul>
</li>
<li>多租户方案
<ul>
<li>sidecar 配置 external label，使用多层 query</li>
<li>receive 接收多租户，但不推荐
<ul>
<li>适用于网络隔离场景，querier 无法直接访问 sidecar 时</li>
</ul>
</li>
</ul>
</li>
<li><a href=https://thanos.io/storage.md target=_blank rel="noopener noreferrer">存储</a>
<ul>
<li>S3</li>
<li>GCS</li>
<li>Azure</li>
<li>OpenStack Swift</li>
<li>Tencent COS</li>
<li>AliYun OSS</li>
</ul>
</li>
<li>块存储
<ul>
<li>基于 Prometheus TSDB</li>
<li>默认 2h 一个区块</li>
<li>每个块都有对应的 index
<ul>
<li>指标名字</li>
<li>标签</li>
<li>时间范围</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_phik alert alert--warning"><div class=admonitionHeading_zxjO><span class=admonitionIcon_bSNx><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>caution</div><div class=admonitionContent_R6P7><ul>
<li>compact
<ul>
<li>raw 格式数据<strong>非常大</strong> - 需要 compact 进行压缩</li>
<li>如果 raw 导致磁盘空间满，会可能驱逐 compact 进入恶性循环</li>
<li>compact 需要与 存储 服务进行大量数据交互 - 最好在同一个节点或机房</li>
<li>一个 bucket 只能运行 <strong>一个</strong> compact
<ul>
<li>因此有一定规模后 compact 反而可能成为瓶颈</li>
</ul>
</li>
</ul>
</li>
<li>receive
<ul>
<li>因为需要缓存接收的数据，因此也需要磁盘空间 一般 3-5 G</li>
</ul>
</li>
<li>一个租户需要一个 Bucket
<ul>
<li><a href=https://github.com/thanos-io/thanos/issues/1318 target=_blank rel="noopener noreferrer">#1318</a> 提议添加前缀 - 但工作量很大</li>
</ul>
</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=组件>组件<a href=#组件 class=hash-link aria-label="Direct link to 组件" title="Direct link to 组件" translate=no>​</a></h2>
<ul>
<li>Thanos 分为多个组件
<ul>
<li>compactor, query, query-frontend, receive, rule, sidecar, store</li>
</ul>
</li>
<li>compactor
<ul>
<li>不参与集群</li>
<li>压缩 OSS 数据</li>
<li>下采样 - downsampling
<ul>
<li>大于 40 小时创建 5m 采样</li>
<li>大于 10 天创建 1h 采样</li>
</ul>
</li>
<li>默认永久保留 <code>--retention.resolution-X=0d</code> - X 为采样类型 - raw,5m,1h</li>
<li>执行保留策略 - 删除旧数据</li>
<li>一个 bucket 部署一个 - 并行部署多个会有问题</li>
<li>下采样并不会节省空间，每个原始区块会添加额外的下采样区块数据 - 只比原始的小一点点
<ul>
<li>相当于容量增加 3 倍</li>
</ul>
</li>
<li>提升范围查询性能</li>
<li>运行需要本地临时存储
<ul>
<li>建议 100G</li>
<li>可重启后删除 - 不需要持久</li>
</ul>
</li>
<li>kube-thanos 将 compact 部署为 sts 而不是 cronjob</li>
</ul>
</li>
<li>query
<ul>
<li>无状态，可扩容</li>
<li>实现 Prometheus HTTP v1 API</li>
<li>PromQL</li>
<li>从 StoreAPI 获取数据
<ul>
<li>部分返回
<ul>
<li><code>?partial_response=1</code> - 请求接受部分响应</li>
<li><code>--query.partial-response</code> - 控制是否开启和策略</li>
<li><code>--query.timeout=2m</code> - 查询超时</li>
<li><code>--query.lookback-delta=5m</code> - 回查时间，过短会产生 gap，至少设置为抓取时间两倍</li>
<li><code>--store.response-timeout</code> - 存储响应超时</li>
<li><code>--no-query.partial-response</code> - 强制关闭</li>
</ul>
</li>
<li>支持指定副本 label 就行去重
<ul>
<li><code>?replicaLabels=replicaA&replicaLabels=replicaB</code></li>
</ul>
</li>
<li>数据去重
<ul>
<li><code>?dedup</code></li>
<li><code>--query.replica-label</code> - 基于副本标签进行去重</li>
</ul>
</li>
<li>自动下采样
<ul>
<li><code>?max_source_resolution=5m</code> - 0s 禁用，可设置为 1h 或 auto
<ul>
<li>如果发现数据有 gap 可禁用</li>
</ul>
</li>
<li><code>--query.auto-downsampling</code> - 默认为 step/5</li>
</ul>
</li>
<li>并发 select
<ul>
<li><code>--query.max-concurrent-select=4</code> - 每次请求的最大并发 select</li>
<li><code>--query.max-concurrent=20</code> - 最大并发查询数</li>
</ul>
</li>
<li>支持自定义返回字段</li>
<li>支持过滤 store
<ul>
<li><code>?query=up&dedup=true&partial_response=true&storeMatch[]={__address__=~"prometheus-foo.*"}</code></li>
</ul>
</li>
</ul>
</li>
<li>grafana 可配置查询参数 <code>max_source_resolution=auto&partial_response=true</code></li>
</ul>
</li>
<li>query-frontend
<ul>
<li>无状态，可扩容</li>
<li>实际使用时影响查询性能的关键组件</li>
<li>处理 <code>/api/v1/query_range</code></li>
<li><code>--query-frontend.downstream-url</code> - 下游 Prometheus 地址 - 一般为 Thanos Query 暴露地址</li>
<li><code>--query-frontend.compress-responses</code> - 响应结果压缩</li>
<li>并行
<ul>
<li><code>-query-range.max-query-length=0</code> - 限制查询长度</li>
<li><code>--query-range.max-query-parallelism=14</code> - 最大并行查询</li>
</ul>
</li>
<li>切分查询
<ul>
<li><code>--query-range.split-interval=24h</code> - 切分并行查询的间隔 <code>response-cache-config</code></li>
<li>可以避免 query 查询过大数据导致 OOM</li>
<li>并行查询效率更好</li>
<li>query 负载均衡</li>
</ul>
</li>
<li>重试
<ul>
<li><code>--query-range.max-retries-per-request=5</code></li>
</ul>
</li>
<li>缓存
<ul>
<li>下次查询时复用</li>
<li>缺少数据会并行查询就行补齐</li>
<li>支持 IN-MEMORY 和 MEMCACHED</li>
<li><code>--query-range.response-cache-max-freshness=1m</code> - 缓存的最新时间 - 小于该时间不缓存</li>
<li><code>--query-range.response-cache-config-file</code></li>
<li><code>--query-range.response-cache-config</code></li>
</ul>
</li>
<li>记录慢查询
<ul>
<li><code>--query-frontend.log-queries-longer-than</code></li>
</ul>
</li>
</ul>
</li>
<li>receive
<ul>
<li>实现 Prometheus 远程写入接口，写入本地 tsdb</li>
<li>目前只支持单个 tsdb</li>
<li>暴露 StoreAPI</li>
<li>实现基于推送的指标采集</li>
<li>用于网络不互通、外部指标采集环境</li>
<li>可继续传递到 receive
<ul>
<li>支持多副本</li>
</ul>
</li>
<li>可以用支持多租户
<ul>
<li>租户头 <code>--receive.tenant-header=THANOS-TENANT</code> 可用于分流</li>
</ul>
</li>
<li>注意 ⚠️
<ul>
<li>write 地址为 <code>/api/v1/receive</code></li>
<li>节点调整时确保数据被刷到 存储</li>
<li>重启后可能会收到大量 Prometheus 请求需要控制好流量</li>
<li>默认会添加 <code>tenant_id="default-tenant"</code> - 可自行控制</li>
<li>资源占用较多，反向代理也会占用资源
<ul>
<li>4k/s 大约 0.1 CPU, 250M 内存</li>
<li>0 负载的 nginx 多了 1 的 CPU</li>
</ul>
</li>
</ul>
</li>
<li>参考
<ul>
<li><a href=https://thanos.io/tip/proposals/201812_thanos-remote-receive.md/ target=_blank rel="noopener noreferrer">Thanos Remote Write</a></li>
</ul>
</li>
</ul>
</li>
<li>rule
<ul>
<li>对查询求值 - 提供 StoreAPI，结果写入磁盘</li>
<li>类似一个简单的 Prometheus 实例</li>
<li>因为是查询的分布式数据，查询可能失败，用于监控时需要小心</li>
<li>支持配置记录规则、告警规则</li>
</ul>
</li>
<li>sidecar
<ul>
<li>上传 Prometheus 的数据到对象存储</li>
<li>提供 StoreAPI</li>
<li>要求 prometheus 设置参数
<ul>
<li><code>--storage.tsdb.min-block-duration=2h</code></li>
<li><code>--storage.tsdb.max-block-duration=2h</code></li>
</ul>
</li>
<li>数据有大约 2h 延时，如果 prometheus 异常数据丢失则可能丢失 2h 的监控数据</li>
<li>要求 prometheus 配置 external_labels - 用于去重</li>
<li>默认不会上传已压缩数据
<ul>
<li>tsdb 块下 meta.json 里的 <code>compaction.level</code> 表示了压缩级别 - 1 为未压缩</li>
<li><code>--shipper.upload-compacted</code> 上传压缩数据 - 用于第一次迁移</li>
</ul>
</li>
<li>注意 ⚠️
<ul>
<li>无法 flush 数据 - prometheus 无法 flush wal，因此可能会丢失 2h 数据</li>
</ul>
</li>
</ul>
</li>
<li>store
<ul>
<li>存储网关 - Store Gateway</li>
<li>读取 对象存储 暴露 StoreAPI</li>
<li>支持索引缓存
<ul>
<li>in-memory</li>
<li>memcached</li>
</ul>
</li>
<li>支持 Bucket 缓存 - 缓存 Prometheus 区块数据
<ul>
<li>memcached</li>
</ul>
</li>
<li>默认内存缓存 250M</li>
<li>支持文件缓存 index-header, in-mem cache items, meta.jsons</li>
<li>注意
<ul>
<li>初始索引过程可能会耗费大量内存</li>
</ul>
</li>
</ul>
</li>
<li>tools
<ul>
<li>bucket 管理工具
<ul>
<li>ls、verify、downsampling、inspect、replicate、web</li>
</ul>
</li>
<li>规则检查</li>
</ul>
</li>
<li>StoreAPI
<ul>
<li>提供数据的后端接口</li>
<li>Prometheus Sidecar</li>
<li>对象存储 - Store Gateway</li>
<li>全局 alerting/recording 规则结果 - Ruler</li>
<li>Receiver</li>
<li>其他 Queriers</li>
<li>其他指标系统 - OpenTSDB</li>
</ul>
</li>
<li><a href=https://github.com/G-Research/thanos-remote-read target=_blank rel="noopener noreferrer">G-Research/thanos-remote-read</a>
<ul>
<li>将 remove read 暴露为 StoreAPI</li>
<li>也可以使用 Sidecar + Prometheus Remote Read 来达到相同目的</li>
</ul>
</li>
</ul>






































































<table><thead><tr><th>Component<th>Interface<th>Port<tbody><tr><td>Sidecar<td>gRPC<td>10901<tr><td>Sidecar<td>HTTP<td>10902<tr><td>Query<td>gRPC<td>10903<tr><td>Query<td>HTTP<td>10904<tr><td>Store<td>gRPC<td>10905<tr><td>Store<td>HTTP<td>10906<tr><td>Receive<td>gRPC (StoreAPI)<td>10907<tr><td>Receive<td>HTTP (remote write API)<td>10908<tr><td>Receive<td>HTTP<td>10909<tr><td>Rule<td>gRPC<td>10910<tr><td>Rule<td>HTTP<td>10911<tr><td>Compact<td>HTTP<td>10912</table>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># macOS</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">brew install thanos</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># external_labels 是必须的</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat &lt;&lt;YAML > prometheus.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">global:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  external_labels:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    cluster: test</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    replica: svr-1</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  scrape_interval: 15s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">scrape_configs:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  - job_name: "prometheus"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    static_configs:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    - targets: ["localhost:9090"]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  - job_name: "node"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    static_configs:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    - targets: ["localhost:9100"]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">YAML</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 默认参数</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># http://localhost:9090</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">prometheus \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --config.file="prometheus.yml" \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --storage.tsdb.path=data/ \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --storage.tsdb.max-block-duration=2h \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --storage.tsdb.min-block-duration=2h \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --web.enable-lifecycle \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --web.enable-admin-api</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat &lt;&lt;YAML > thanos-store.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">type: S3</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">config:</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  bucket: "metrics"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  endpoint: "minio.cluster.internal"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  insecure: true</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  signature_version2: false</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  access_key: "key"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  secret_key: "secretsecret"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">YAML</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Sidecar 上传 chunk 暴露 prometheus 为 StoreAPI</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 默认 http://localhost:10902 grpc://localhost:10901</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos sidecar \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --tsdb.path="./data" \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --prometheus.url=http://localhost:9090 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --objstore.config-file=thanos-store.yaml \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --http-address="0.0.0.0:10902" \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --grpc-address="0.0.0.0:10901"</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 暴露 S3 为 StoreAPI</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改端口避免冲突</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos store \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --http-address=0.0.0.0:10912 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --grpc-address=0.0.0.0:10911 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --data-dir="./store-cache" \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --objstore.config-file=thanos-store.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查询</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 修改端口避免冲突</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查询 UI http://localhost:11902/graph</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># --store 为后端</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos query \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --http-address=0.0.0.0:11902 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --grpc-address=0.0.0.0:11901 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --store=localhost:10901 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    --store=localhost:10911</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 压缩</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># --data-dir cache blocks and process compactions</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># --wait 等待新的任务，默认执行完成后退出</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos compact \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --http-address=0.0.0.0:12902 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --data-dir=thanos-compact \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --objstore.config-file=thanos-store.yaml \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --wait</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=tool>Tool<a href=#tool class=hash-link aria-label="Direct link to Tool" title="Direct link to Tool" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看 bucket 分布情况</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># http://localhost:10902/</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket web --objstore.config-file=thanos-bucket.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 查看 bucket</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket ls</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 以 table 显示 bucket 信息</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># | ULID | FROM | UNTIL | RANGE | UNTIL-DOWN | #SERIES | #SAMPLES | #CHUNKS | COMP-LEVEL | COMP-FAILED | LABELS | RESOLUTION | SOURCE |</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket inspect</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 标记删除或不压缩</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># tools bucket mark --id=ID --marker=MARKER --details=DETAILS</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Marker - deletion-mark.json,no-compact-mark.json</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># mark 或删除在 web 上不会刷新，需要停止从开</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket mark --id 01EJD9PS4P3MJMF3TGJGTJTE25 --marker deletion-mark.json --details 'useless bucket'</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 立即清除被 mark bucket</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 默认由 compactor 来清理</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket cleanup</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># out.txt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos tools bucket inspect --log.level error --objstore.config-file=thanos-store.yaml > out.txt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># ids.txt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat out.txt | grep -P '\d\d-2021' | cut -d '|' -f 2  | tr -d ' '| sed 's/^/--id=/' > ids.txt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># filter & delete</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 批量标记删除 - 需要有 compact 实际删除 - 或者执行 compact --delete-delay=0</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat out.txt | grep -P '(01|02|03|04|05|06|07|08)-2021' | cut -d '|' -f 2  | tr -d ' '| sed 's/^/--id=/' | xargs thanos tools bucket mark --marker deletion-mark.json --details 'delete' --objstore.config-file=thanos-store.yaml</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat ids.txt | xargs thanos tools bucket mark --marker deletion-mark.json --details 'delete' --objstore.config-file=thanos-store.yaml</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=缓存配置>缓存配置<a href=#缓存配置 class=hash-link aria-label="Direct link to 缓存配置" title="Direct link to 缓存配置" translate=no>​</a></h2>
<div class="language-yaml codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-yaml codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 文件缓存</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> IN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">MEMORY</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_size_items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2048</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 缓存时效</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">validity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 6h</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> MEMCACHED</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">addresses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 0s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_idle_connections</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_async_concurrency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_async_buffer_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_get_multi_concurrency</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_item_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">max_get_multi_batch_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">dns_provider_update_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 0s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">expiration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 0s</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=存储配置>存储配置<a href=#存储配置 class=hash-link aria-label="Direct link to 存储配置" title="Direct link to 存储配置" translate=no>​</a></h2>
<ul>
<li><a href=https://thanos.io/tip/thanos/storage.md target=_blank rel="noopener noreferrer">Storage</a></li>
</ul>
<div class="language-yaml codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-yaml codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># S3 常用配置</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> S3</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">bucket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># HTTP 还是 HTTPS</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">insecure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">access_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">secret_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 部分 S3 实现需要设置为 false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">signature_version2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># multipart 上传的单块 大小 - 部分 S3 实现需要修改</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 0 -> 默认 128m</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">part_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># S3 完整配置</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> S3</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">bucket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">access_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">insecure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">signature_version2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">secret_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">put_user_metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">http_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">idle_conn_timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 1m30s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">response_header_timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 2m</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">insecure_skip_verify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">trace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">enable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">part_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">134217728</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sse_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">kms_key_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">kms_encryption_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">    </span><span class="token key atrule">encryption_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 阿里云 OSS</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ALIYUNOSS</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">bucket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">access_key_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">access_key_secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 腾讯云 COS</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> COS</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">bucket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">app_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">secret_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">secret_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=kubernetest>Kubernetest<a href=#kubernetest class=hash-link aria-label="Direct link to Kubernetest" title="Direct link to Kubernetest" translate=no>​</a></h2>
<ul>
<li><a href=https://github.com/thanos-io/kube-thanos target=_blank rel="noopener noreferrer">thanos-io/kube-thanos</a> - jsonnet manifest
<ul>
<li><a href=https://github.com/thanos-io/kube-thanos/blob/master/examples/all/manifests target=_blank rel="noopener noreferrer">examples/all/manifests</a>
<ul>
<li>示例，值得参考</li>
</ul>
</li>
</ul>
</li>
<li><a href=https://github.com/banzaicloud/thanos-operator target=_blank rel="noopener noreferrer">banzaicloud/thanos-operator</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=tracing>Tracing<a href=#tracing class=hash-link aria-label="Direct link to Tracing" title="Direct link to Tracing" translate=no>​</a></h2>
<ul>
<li><a href=https://thanos.io/tip/thanos/tracing.md/ target=_blank rel="noopener noreferrer">Tracing</a></li>
</ul>
<div class="language-yaml codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-yaml codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> JAEGER</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">service_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">disabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">rpc_metrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">tags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sampler_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sampler_param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sampler_manager_host_port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sampler_max_operations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">sampler_refresh_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 0s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">reporter_max_queue_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">reporter_flush_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 0s</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">reporter_log_spans</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">agent_host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">''</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  </span><span class="token key atrule">agent_port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=faq>FAQ<a href=#faq class=hash-link aria-label="Direct link to FAQ" title="Direct link to FAQ" translate=no>​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=expire>Expire<a href=#expire class=hash-link aria-label="Direct link to Expire" title="Direct link to Expire" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain"># --delete-delay=0 - 立即删除 - 默认 48h</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">thanos compact \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --http-address=0.0.0.0:12902 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --data-dir=thanos-compact \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --objstore.config-file=thanos-store.yaml \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --wait \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --compact.concurrency=32 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --retention.resolution-raw=30d \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --retention.resolution-5m=90d \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --retention.resolution-1h=180d \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --delete-delay=0</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=sidecar-上传历史文件>Sidecar 上传历史文件<a href=#sidecar-上传历史文件 class=hash-link aria-label="Direct link to Sidecar 上传历史文件" title="Direct link to Sidecar 上传历史文件" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">thanos sidecar \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --tsdb.path=/var/lib/prometheus/data/ \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --prometheus.url=http://localhost:9090 \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --objstore.config-file=thanos-bucket.yaml \</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  --shipper.upload-compacted</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_EG6R" id=sidecar-暴露-prometheus-为-storeapi>Sidecar 暴露 Prometheus 为 StoreAPI<a href=#sidecar-暴露-prometheus-为-storeapi class=hash-link aria-label="Direct link to Sidecar 暴露 Prometheus 为 StoreAPI" title="Direct link to Sidecar 暴露 Prometheus 为 StoreAPI" translate=no>​</a></h3>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">thanos sidecar --prometheus.url=http://localhost:9090</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=跨网络部署方案>跨网络部署方案<a href=#跨网络部署方案 class=hash-link aria-label="Direct link to 跨网络部署方案" title="Direct link to 跨网络部署方案" translate=no>​</a></h2>
<ol>
<li>Prometheus Remote Write + Thanos Receive</li>
</ol>
<ul>
<li>优点
<ul>
<li>部署简单</li>
<li>不丢数据</li>
</ul>
</li>
<li>缺点
<ul>
<li>RW 性能扩容问题
<ul>
<li>默认 max_samples_per_send 为 100，指标上去后很容易 qps 上百</li>
<li>如果使用了反向代理，反向代理也会有一定性能问题</li>
<li>增大单次批量会占用较多内存，例如 max_samples_per_send 5000 capacity 1000 启动发送后内存达到 1G+</li>
</ul>
</li>
<li>稳定性问题
<ul>
<li>需要额外维护 thanos receive</li>
</ul>
</li>
<li>thanos receive 有状态 - 本地记录 tsdb</li>
</ul>
</li>
<li>参考
<ul>
<li><a href=https://thanos.io/tip/proposals/201812_thanos-remote-receive.md/ target=_blank rel="noopener noreferrer">Thanos Remote Write</a></li>
</ul>
</li>
</ul>
<ol>
<li>Prometheus + Sidecar + Prometheus Remote Write + Thanos Receive</li>
</ol>
<ul>
<li>Sidecar 上传 2h</li>
<li>Receive 查询最近 2h</li>
<li>优点 - thanos receive 状态无所谓，可丢弃</li>
<li>缺点 - 多部署一个 sidecar</li>
</ul>
<ol>
<li>Prometheus + Sidecar + StoreAPI tunnel</li>
</ol>
<ul>
<li>StoreAPI 默认 h2c</li>
<li>缺点
<ul>
<li>grpc 不能 tunnel 到子路径，需要使用子域名或独立端口</li>
<li>需要额外的 tunnel 部署</li>
</ul>
</li>
<li>优点
<ul>
<li>简单易理解</li>
<li>打通所需服务网络</li>
</ul>
</li>
</ul>
<ol>
<li>Prometheus + Sidecar + Prometheus:8080 tunnel + Sidecar</li>
</ol>
<ul>
<li>可以将 9090 tunnel 到子路径</li>
<li>内网 sidecar 将 tunnel 暴露为 StoreAPI</li>
<li>缺点
<ul>
<li>多部署一个 sidecar 到内网</li>
</ul>
</li>
<li>优点
<ul>
<li>可 tunnel 到子路径</li>
<li>打通所监控的 prometheus</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=自动下采样>自动下采样<a href=#自动下采样 class=hash-link aria-label="Direct link to 自动下采样" title="Direct link to 自动下采样" translate=no>​</a></h2>
<ul>
<li><code>?max_source_resolution</code>
<ul>
<li>0s - 禁用</li>
<li>5m</li>
<li>1h</li>
<li>auto - 自动</li>
</ul>
</li>
<li>使用 rate 可能会导致 gap</li>
<li>参考
<ul>
<li><a href=https://github.com/thanos-io/thanos/issues/813 target=_blank rel="noopener noreferrer">#813</a></li>
</ul>
</li>
</ul>
<div class="language-promql codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-promql codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 5m 使用下采样会有 gap</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>avg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">irate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">node_cpu_seconds_total</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token context-labels label-key attr-name" style="color:rgb(255, 203, 107)">mode</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token context-labels label-value attr-value">"system"</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token context-range punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token context-range range-duration number" style="color:rgb(247, 140, 108)">5m</span><span class="token context-range punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>by</span><span class="token plain"> </span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token vector-match label-key attr-name" style="color:rgb(255, 203, 107)">instance</span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 10m 则没有问题</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>avg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">irate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">node_cpu_seconds_total</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token context-labels label-key attr-name" style="color:rgb(255, 203, 107)">mode</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token context-labels label-value attr-value">"system"</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token context-range punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token context-range range-duration number" style="color:rgb(247, 140, 108)">10m</span><span class="token context-range punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>by</span><span class="token plain"> </span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token vector-match label-key attr-name" style="color:rgb(255, 203, 107)">instance</span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># grafana</span><span class="token plain"></span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"></span><span class="token keyword" style=font-style:italic>avg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">irate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">node_cpu_seconds_total</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token context-labels label-key attr-name" style="color:rgb(255, 203, 107)">mode</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token context-labels label-value attr-value">"system"</span><span class="token context-labels punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">$__interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style=font-style:italic>by</span><span class="token plain"> </span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token vector-match label-key attr-name" style="color:rgb(255, 203, 107)">instance</span><span class="token vector-match punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_EG6R" id=filter-meta-in-oss>filter meta in oss<a href=#filter-meta-in-oss class=hash-link aria-label="Direct link to filter meta in oss" title="Direct link to filter meta in oss" translate=no>​</a></h2>
<div class="language-bash codeBlockContainer_ljD1 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_rhaG><pre tabindex=0 class="prism-code language-bash codeBlock_mx9Q thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_NG8l><span class=token-line style=color:#bfc7d5><span class="token plain">ls */meta.json | xargs -n 1 -I {}  sh -c "dirname {} | tr -d '\n';echo -n ' ';jq -r '.maxTime/1000 | todate' {}" > /tmp/dump.txt</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># 强制删除</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">cat /tmp/dump.txt | grep '2021-' | awk '{print $1}' | sudo xargs -I {} rm -r {}</span><br/></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/wenerme/wener/edit/master/notes/../notes/service/observability/metrics/thanos.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_A7Jz aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_Hg3U"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-09-01T01:27:07.000Z itemprop=dateModified>Sep 1, 2025</time></b> by <b>wener</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/notes/service/observability/metrics/thanos-version><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Thanos 版本</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/notes/service/observability/metrics/victoria-metrics><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>VictoriaMetrics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_wpyd thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#组件 class="table-of-contents__link toc-highlight">组件</a><li><a href=#tool class="table-of-contents__link toc-highlight">Tool</a><li><a href=#缓存配置 class="table-of-contents__link toc-highlight">缓存配置</a><li><a href=#存储配置 class="table-of-contents__link toc-highlight">存储配置</a><li><a href=#kubernetest class="table-of-contents__link toc-highlight">Kubernetest</a><li><a href=#tracing class="table-of-contents__link toc-highlight">Tracing</a><li><a href=#faq class="table-of-contents__link toc-highlight">FAQ</a><li><a href=#expire class="table-of-contents__link toc-highlight">Expire</a><li><a href=#sidecar-上传历史文件 class="table-of-contents__link toc-highlight">Sidecar 上传历史文件</a><ul><li><a href=#sidecar-暴露-prometheus-为-storeapi class="table-of-contents__link toc-highlight">Sidecar 暴露 Prometheus 为 StoreAPI</a></ul><li><a href=#跨网络部署方案 class="table-of-contents__link toc-highlight">跨网络部署方案</a><li><a href=#自动下采样 class="table-of-contents__link toc-highlight">自动下采样</a><li><a href=#filter-meta-in-oss class="table-of-contents__link toc-highlight">filter meta in oss</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>笔记</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/notes/java>Java</a><li class=footer__item><a class=footer__link-item href=/notes/os/alpine>AlpineLinux</a><li class=footer__item><a class=footer__link-item href=/notes/devops/kubernetes>Kubernates</a><li class=footer__item><a class=footer__link-item href=/notes/voip>VoIP</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Projects</div><ul class="footer__items clean-list"><li class=footer__item>
              <div>
              <a class=footer__link-item href=https://github.com/wenerme/wener>Wener</a>
              -
              <a class=footer__link-item href=https://github.com/wenerme/wener/actions title="wenerme/wener - ci">
              <img style="vertical-align: middle;opacity: .4;" src=https://github.com/wenerme/wener/workflows/Build/badge.svg />
              </a>
              </div>
              <li class=footer__item><a href=https://apis.wener.me target=_blank rel="noopener noreferrer" class=footer__link-item>Wener's Apis<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_kUGX><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/story>Blog</a><li class=footer__item><a href=https://github.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub</a><li class=footer__item><a href=https://twitter.com/wenerme target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter</a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--light_v877"/><img src=/img/wener-logo.svg alt="Wener Site" class="footer__logo themedComponent_j2y5 themedComponent--dark_PUQY"/></div><div class=footer__copyright>Copyright © 1992-2025 Wener - <img alt=cc-by-sa-4.0 src=https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-sa.svg /> - Build @2025-10-09 13:46</div></div></div></footer></div></body>